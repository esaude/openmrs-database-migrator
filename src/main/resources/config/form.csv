form_id,name,version,build,published,description,encounter_type,template,xslt,creator,date_created,changed_by,date_changed,retired,retired_by,date_retired,retired_reason,uuid
1,Template: Basic Form,0.1,1,0,core elements needed for most forms,4,,<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,12/15/2008 10:29,0,,,,e28a599e-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
11,PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO,0.1,89,0,Processo de Hospital de Dia Pediatria 2/2,3,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/11-0.1-89.xsn\" solutionVersion=\"0.1.0.89\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/11-89\" id=\"11\" name=\"PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <pediatric_objective_exam openmrs_concept=\"1622^PEDIATRIC OBJECTIVE EXAM^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </weight_kg>\,,,,,,,,,,,,,,,,,
      <height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </height_cm>\,,,,,,,,,,,,,,,,,
      <head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </head_circumference>\,,,,,,,,,,,,,,,,,
      <pediatric_diagnostic_exam multiple=\"1\" openmrs_concept=\"1616^PEDIATRIC DIAGNOSTIC EXAM^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <anemia openmrs_concept=\"3^ANEMIA^99DCT\">false</anemia>\,,,,,,,,,,,,,,,,,
            <shortness_of_breath openmrs_concept=\"5960^SHORTNESS OF BREATH^99DCT\">false</shortness_of_breath>\,,,,,,,,,,,,,,,,,
            <dermatitis openmrs_concept=\"119^DERMATITIS^99DCT\">false</dermatitis>\,,,,,,,,,,,,,,,,,
            <lymphadenopathy openmrs_concept=\"161^LYMPHADENOPATHY^99DCT\">false</lymphadenopathy>\,,,,,,,,,,,,,,,,,
            <parotidas_aumentadas openmrs_concept=\"1540^PAROTIDAS AUMENTADAS^99DCT\">false</parotidas_aumentadas>\,,,,,,,,,,,,,,,,,
            <ictericas openmrs_concept=\"1419^ICTERICAS^99DCT\">false</ictericas>\,,,,,,,,,,,,,,,,,
            <fever openmrs_concept=\"5945^FEVER^99DCT\">false</fever>\,,,,,,,,,,,,,,,,,
            <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\,,,,,,,,,,,,,,,,
      </pediatric_diagnostic_exam>\,,,,,,,,,,,,,,,,,
      <oral_exam_non_specific openmrs_concept=\"1542^ORAL EXAM, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </oral_exam_non_specific>\,,,,,,,,,,,,,,,,,
      <pulmonary_exam_auscultation_mv multiple=\"0\" openmrs_concept=\"1545^PULMONARY EXAM AUSCULTATION MV^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pulmonary_exam_auscultation_mv>\,,,,,,,,,,,,,,,,,
      <pulmonary_exam_auscultation multiple=\"1\" openmrs_concept=\"1629^PULMONARY EXAM AUSCULTATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <sopro_tubarico openmrs_concept=\"1550^SOPRO TUBARICO^99DCT\">false</sopro_tubarico>\,,,,,,,,,,,,,,,,,
            <snoring openmrs_concept=\"1549^SNORING^99DCT\">false</snoring>\,,,,,,,,,,,,,,,,,
            <murmur_anforico openmrs_concept=\"1551^MURMUR ANFORICO^99DCT\">false</murmur_anforico>\,,,,,,,,,,,,,,,,,
            <fervor openmrs_concept=\"1548^FERVOR^99DCT\">false</fervor>\,,,,,,,,,,,,,,,,,
      </pulmonary_exam_auscultation>\,,,,,,,,,,,,,,,,,
      <cardiac_exam_findings multiple=\"1\" openmrs_concept=\"1124^CARDIAC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <s3_gallop openmrs_concept=\"550^S3 GALLOP^99DCT\">false</s3_gallop>\,,,,,,,,,,,,,,,,,
            <cardiac_murmur openmrs_concept=\"562^CARDIAC MURMUR^99DCT\">false</cardiac_murmur>\,,,,,,,,,,,,,,,,,
            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\,,,,,,,,,,,,,,,,,
            <abnormal_sounds openmrs_concept=\"1117^ABNORMAL SOUNDS^99DCT\">false</abnormal_sounds>\,,,,,,,,,,,,,,,,,
            <left_ventricular_lift openmrs_concept=\"5156^LEFT VENTRICULAR LIFT^99DCT\">false</left_ventricular_lift>\,,,,,,,,,,,,,,,,,
            <right_ventricular_lift openmrs_concept=\"5157^RIGHT VENTRICULAR LIFT^99DCT\">false</right_ventricular_lift>\,,,,,,,,,,,,,,,,,
            <evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false</evidence_of_cardiac_enlargement>\,,,,,,,,,,,,,,,,,
            <diastolic_descresendo_murmur openmrs_concept=\"5160^DIASTOLIC DESCRESENDO MURMUR^99DCT\">false</diastolic_descresendo_murmur>\,,,,,,,,,,,,,,,,,
            <holosystolic_murmur openmrs_concept=\"5162^HOLOSYSTOLIC MURMUR^99DCT\">false</holosystolic_murmur>\,,,,,,,,,,,,,,,,,
            <diastolic_rumble openmrs_concept=\"5164^DIASTOLIC RUMBLE^99DCT\">false</diastolic_rumble>\,,,,,,,,,,,,,,,,,
            <systolic_ejection_murmur openmrs_concept=\"5166^SYSTOLIC EJECTION MURMUR^99DCT\">false</systolic_ejection_murmur>\,,,,,,,,,,,,,,,,,
            <pericardial_friction_rub openmrs_concept=\"5176^PERICARDIAL FRICTION RUB^99DCT\">false</pericardial_friction_rub>\,,,,,,,,,,,,,,,,,
            <chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false</chronic_obstructive_pulmonary_disease>\,,,,,,,,,,,,,,,,,
            <arrythmia openmrs_concept=\"1395^ARRYTHMIA^99DCT\">false</arrythmia>\,,,,,,,,,,,,,,,,,
      </cardiac_exam_findings>\,,,,,,,,,,,,,,,,,
      <ap_te multiple=\"0\" openmrs_concept=\"1552^PULMONARY AUSCULTATION TE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ap_te>\,,,,,,,,,,,,,,,,,
      <liver_size openmrs_concept=\"5153^LIVER SIZE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </liver_size>\,,,,,,,,,,,,,,,,,
      <spleen_size openmrs_concept=\"5195^SPLEEN SIZE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </spleen_size>\,,,,,,,,,,,,,,,,,
      <other_masses_description openmrs_concept=\"1553^OTHER MASSES, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </other_masses_description>\,,,,,,,,,,,,,,,,,
      <perineum_description openmrs_concept=\"1554^PERINEUM, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </perineum_description>\,,,,,,,,,,,,,,,,,
      <membros_superiores openmrs_concept=\"1555^MEMBROS SUPERIORES^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </membros_superiores>\,,,,,,,,,,,,,,,,,
      <membros_inferiores openmrs_concept=\"1556^LOWER LIMBS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </membros_inferiores>\,,,,,,,,,,,,,,,,,
      <neurological_exam_other openmrs_concept=\"1407^NEUROLOGICAL EXAM OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </neurological_exam_other>\,,,,,,,,,,,,,,,,,
      <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </non_coded_diagnosis>\,,,,,,,,,,,,,,,,,
    </pediatric_objective_exam>\,,,,,,,,,,,,,,,,,
    <pediatric_blood_tests openmrs_concept=\"1618^PEDIATRIC BLOOD TESTS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hemoglobin>\,,,,,,,,,,,,,,,,,
      <hematocrit openmrs_concept=\"1015^HEMATOCRIT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hematocrit>\,,,,,,,,,,,,,,,,,
      <platelets openmrs_concept=\"729^PLATELETS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </platelets>\,,,,,,,,,,,,,,,,,
      <white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </white_blood_cells>\,,,,,,,,,,,,,,,,,
      <neutrophils openmrs_concept=\"1022^NEUTROPHILS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </neutrophils>\,,,,,,,,,,,,,,,,,
      <lymphocytes openmrs_concept=\"1021^LYMPHOCYTES^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymphocytes>\,,,,,,,,,,,,,,,,,
      <eosinophils openmrs_concept=\"1024^EOSINOPHILS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </eosinophils>\,,,,,,,,,,,,,,,,,
      <erythrocyte_sedimentation_rate openmrs_concept=\"855^ERYTHROCYTE SEDIMENTATION RATE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </erythrocyte_sedimentation_rate>\,,,,,,,,,,,,,,,,,
      <total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </total_protein>\,,,,,,,,,,,,,,,,,
      <globulinas openmrs_concept=\"1520^GLOBULINS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </globulinas>\,,,,,,,,,,,,,,,,,
      <immuno_globulin_hiv openmrs_concept=\"1519^IMMUNO GLOBULIN HIV^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </immuno_globulin_hiv>\,,,,,,,,,,,,,,,,,
      <urinary_albumin openmrs_concept=\"849^URINARY ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </urinary_albumin>\,,,,,,,,,,,,,,,,,
      <fa openmrs_concept=\"1521^FA^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </fa>\,,,,,,,,,,,,,,,,,
      <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cd4_count>\,,,,,,,,,,,,,,,,,
      <cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cd4_percent>\,,,,,,,,,,,,,,,,,
      <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_viral_load>\,,,,,,,,,,,,,,,,,
      <hiv_viral_load_log openmrs_concept=\"1518^HIV VIRAL LOAD LOG^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_viral_load_log>\,,,,,,,,,,,,,,,,,
      <total_bilirubin openmrs_concept=\"655^TOTAL BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </total_bilirubin>\,,,,,,,,,,,,,,,,,
      <direct_bilirubin openmrs_concept=\"1297^DIRECT BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </direct_bilirubin>\,,,,,,,,,,,,,,,,,
      <serum_glutamic-oxaloacetic_transaminase openmrs_concept=\"653^SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glutamic-oxaloacetic_transaminase>\,,,,,,,,,,,,,,,,,
      <serum_glutamic-pyruvic_transaminase openmrs_concept=\"654^SERUM GLUTAMIC-PYRUVIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glutamic-pyruvic_transaminase>\,,,,,,,,,,,,,,,,,
      <lactate_dehydrogenase openmrs_concept=\"1014^LACTATE DEHYDROGENASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lactate_dehydrogenase>\,,,,,,,,,,,,,,,,,
      <blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </blood_urea_nitrogen>\,,,,,,,,,,,,,,,,,
      <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_creatinine>\,,,,,,,,,,,,,,,,,
      <serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_sodium>\,,,,,,,,,,,,,,,,,
      <serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_potassium>\,,,,,,,,,,,,,,,,,
      <serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glucose>\,,,,,,,,,,,,,,,,,
      <serum_albumin openmrs_concept=\"848^SERUM ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_albumin>\,,,,,,,,,,,,,,,,,
      <alkaline_phosphatase openmrs_concept=\"785^ALKALINE PHOSPHATASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </alkaline_phosphatase>\,,,,,,,,,,,,,,,,,
      <mean_corpuscular_volume openmrs_concept=\"851^MEAN CORPUSCULAR VOLUME^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mean_corpuscular_volume>\,,,,,,,,,,,,,,,,,
    </pediatric_blood_tests>\,,,,,,,,,,,,,,,,,
    <pediatric_urinalysis multiple=\"1\" openmrs_concept=\"1619^PEDIATRIC URINALYSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <urina_piocytes openmrs_concept=\"1525^URINA PIOCYTES^99DCT\">false</urina_piocytes>\,,,,,,,,,,,,,,,,,
        <urine_erithrocytes openmrs_concept=\"1523^URINE ERITHROCYTES^99DCT\">false</urine_erithrocytes>\,,,,,,,,,,,,,,,,,
        <urine_leucocytes openmrs_concept=\"1522^URINE LEUCOCYTES^99DCT\">false</urine_leucocytes>\,,,,,,,,,,,,,,,,,
        <epithelial_cells openmrs_concept=\"666^EPITHELIAL CELLS^99DCT\">false</epithelial_cells>\,,,,,,,,,,,,,,,,,
        <urine_cilinders openmrs_concept=\"1524^URINE CILINDERS^99DCT\">false</urine_cilinders>\,,,,,,,,,,,,,,,,,
    </pediatric_urinalysis>\,,,,,,,,,,,,,,,,,
    <pediatric_feces_test multiple=\"1\" openmrs_concept=\"1620^PEDIATRIC FECES TEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <feces_giardia openmrs_concept=\"1527^FECES GIARDIA^99DCT\">false</feces_giardia>\,,,,,,,,,,,,,,,,,
        <feces_e_hystolitica openmrs_concept=\"1529^FECES E HYSTOLITICA^99DCT\">false</feces_e_hystolitica>\,,,,,,,,,,,,,,,,,
        <feces_strongolides openmrs_concept=\"1526^FECES STRONGOLIDES^99DCT\">false</feces_strongolides>\,,,,,,,,,,,,,,,,,
        <fezes_trichuria openmrs_concept=\"1528^FEZES TRICHURIA^99DCT\">false</fezes_trichuria>\,,,,,,,,,,,,,,,,,
        <feces_ascaris openmrs_concept=\"1530^FECES ASCARIS^99DCT\">false</feces_ascaris>\,,,,,,,,,,,,,,,,,
    </pediatric_feces_test>\,,,,,,,,,,,,,,,,,
    <feces_other openmrs_concept=\"1531^FECES OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </feces_other>\,,,,,,,,,,,,,,,,,
    <lcr_patologico multiple=\"0\" openmrs_concept=\"1532^LCR PATHOLOGY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </lcr_patologico>\,,,,,,,,,,,,,,,,,
    <x-ray_chest multiple=\"1\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
        <pulmonary_effusion openmrs_concept=\"1136^PULMONARY EFFUSION^99DCT\">false</pulmonary_effusion>\,,,,,,,,,,,,,,,,,
        <miliary_changes openmrs_concept=\"1137^MILIARY CHANGES^99DCT\">false</miliary_changes>\,,,,,,,,,,,,,,,,,
        <evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false</evidence_of_cardiac_enlargement>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <infiltrate openmrs_concept=\"6049^INFILTRATE^99DCT\">false</infiltrate>\,,,,,,,,,,,,,,,,,
        <diffuse_non-miliary_changes openmrs_concept=\"6050^DIFFUSE NON-MILIARY CHANGES^99DCT\">false</diffuse_non-miliary_changes>\,,,,,,,,,,,,,,,,,
        <cavitary_lesion openmrs_concept=\"6052^CAVITARY LESION^99DCT\">false</cavitary_lesion>\,,,,,,,,,,,,,,,,,
        <infiltrate_retuculonodular openmrs_concept=\"1641^INFILTRATE RETUCULONODULAR^99DCT\">false</infiltrate_retuculonodular>\,,,,,,,,,,,,,,,,,
        <infiltrado_reticular openmrs_concept=\"1643^INFILTRADO RETICULAR^99DCT\">false</infiltrado_reticular>\,,,,,,,,,,,,,,,,,
        <derrames openmrs_concept=\"1647^DERRAMES^99DCT\">false</derrames>\,,,,,,,,,,,,,,,,,
        <condensacoes openmrs_concept=\"1644^CONDENSACOES^99DCT\">false</condensacoes>\,,,,,,,,,,,,,,,,,
        <adenopatias_aumentadas openmrs_concept=\"1645^ADENOPATIAS AUMENTADAS^99DCT\">false</adenopatias_aumentadas>\,,,,,,,,,,,,,,,,,
        <mediastino_alargado openmrs_concept=\"1646^MEDIASTINO ALARGADO^99DCT\">false</mediastino_alargado>\,,,,,,,,,,,,,,,,,
        <negative openmrs_concept=\"664^NEGATIVE^99DCT\">false</negative>\,,,,,,,,,,,,,,,,,
        <positive openmrs_concept=\"703^POSITIVE^99DCT\">false</positive>\,,,,,,,,,,,,,,,,,
        <unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false</unknown>\,,,,,,,,,,,,,,,,,
    </x-ray_chest>\,,,,,,,,,,,,,,,,,
    <x-ray_chest_other openmrs_concept=\"1642^X-RAY, CHEST, OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </x-ray_chest_other>\,,,,,,,,,,,,,,,,,
    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </non_coded_diagnosis>\,,,,,,,,,,,,,,,,,
    <pediatric_initial_treatment openmrs_concept=\"1648^PEDIATRIC INITIAL TREATMENT^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <patient_is_on_antibiotic_treatment multiple=\"0\" openmrs_concept=\"1533^PATIENT IS ON ANTIBIOTIC TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_is_on_antibiotic_treatment>\,,,,,,,,,,,,,,,,,
      <antibiotics_prescribed multiple=\"1\" openmrs_concept=\"1621^ANTIBIOTICS PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <penicillin openmrs_concept=\"784^PENICILLIN^99DCT\">false</penicillin>\,,,,,,,,,,,,,,,,,
            <cefuroxime openmrs_concept=\"737^CEFUROXIME^99DCT\">false</cefuroxime>\,,,,,,,,,,,,,,,,,
            <cefixime openmrs_concept=\"963^CEFIXIME^99DCT\">false</cefixime>\,,,,,,,,,,,,,,,,,
            <amoxicillin openmrs_concept=\"265^AMOXICILLIN^99DCT\">false</amoxicillin>\,,,,,,,,,,,,,,,,,
            <cetirizine openmrs_concept=\"779^CETIRIZINE^99DCT\">false</cetirizine>\,,,,,,,,,,,,,,,,,
            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
            <trimethoprim openmrs_concept=\"91^TRIMETHOPRIM^99DCT\">false</trimethoprim>\,,,,,,,,,,,,,,,,,
      </antibiotics_prescribed>\,,,,,,,,,,,,,,,,,
      <antiretroviral_use multiple=\"0\" openmrs_concept=\"1192^ANTIRETROVIRAL USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </antiretroviral_use>\,,,,,,,,,,,,,,,,,
      <current_antiretroviral_drugs_used_for_treatment multiple=\"1\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
            <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\,,,,,,,,,,,,,,,,,
            <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\,,,,,,,,,,,,,,,,,
            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
            <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\,,,,,,,,,,,,,,,,,
            <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\,,,,,,,,,,,,,,,,,
            <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\,,,,,,,,,,,,,,,,,
            <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\,,,,,,,,,,,,,,,,,
            <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\,,,,,,,,,,,,,,,,,
            <zidovudine_lamivudine_nevirapine openmrs_concept=\"1651^ZIDOVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\,,,,,,,,,,,,,,,,,
            <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\,,,,,,,,,,,,,,,,,
            <zidovudine_lamivudine_efavirenz openmrs_concept=\"1703^ZIDOVUDINE + LAMIVUDINE + EFAVIRENZ^99DCT\">false</zidovudine_lamivudine_efavirenz>\,,,,,,,,,,,,,,,,,
            <zidovudine_lamivudine_nelfinavir openmrs_concept=\"1702^ZIDOVUDINE + LAMIVUDINE + NELFINAVIR^99DCT\">false</zidovudine_lamivudine_nelfinavir>\,,,,,,,,,,,,,,,,,
            <stavudinelamivudineefavirennz openmrs_concept=\"1827^STAVUDINE+LAMIVUDINE+EFAVIRENNZ^99DCT\">false</stavudinelamivudineefavirennz>\,,,,,,,,,,,,,,,,,
            <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\,,,,,,,,,,,,,,,,,
            <d4t-40 openmrs_concept=\"625^STAVUDINE^99DCT^6^d4T-40^99RX\">false</d4t-40>\,,,,,,,,,,,,,,,,,
            <d4t-30 openmrs_concept=\"625^STAVUDINE^99DCT^5^d4T-30^99RX\">false</d4t-30>\,,,,,,,,,,,,,,,,,
            <lopinavir_and_ritonavir openmrs_concept=\"794^LOPINAVIR AND RITONAVIR^99DCT\">false</lopinavir_and_ritonavir>\,,,,,,,,,,,,,,,,,
            <triomune-30 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^2^Triomune-30^99RX\">false</triomune-30>\,,,,,,,,,,,,,,,,,
            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <triomune-40 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^3^Triomune-40^99RX\">false</triomune-40>\,,,,,,,,,,,,,,,,,
            <ddi_125 openmrs_concept=\"796^DIDANOSINE^99DCT^9^DDI 125^99RX\">false</ddi_125>\,,,,,,,,,,,,,,,,,
            <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\,,,,,,,,,,,,,,,,,
            <ddi_200 openmrs_concept=\"796^DIDANOSINE^99DCT^10^DDI 200^99RX\">false</ddi_200>\,,,,,,,,,,,,,,,,,
            <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\,,,,,,,,,,,,,,,,,
            <zidovudinelamivudinelopinavir openmrs_concept=\"6100^ZIDOVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</zidovudinelamivudinelopinavir>\,,,,,,,,,,,,,,,,,
            <zidovudinelamivudinesaquinavir openmrs_concept=\"6101^ZIDOVUDINE+LAMIVUDINE+SAQUINAVIR^99DCT\">false</zidovudinelamivudinesaquinavir>\,,,,,,,,,,,,,,,,,
            <stavudinelamivudineabacavir openmrs_concept=\"6102^STAVUDINE+LAMIVUDINE+ABACAVIR^99DCT\">false</stavudinelamivudineabacavir>\,,,,,,,,,,,,,,,,,
            <stavudinelamivudinelopinavir openmrs_concept=\"6103^STAVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</stavudinelamivudinelopinavir>\,,,,,,,,,,,,,,,,,
            <abacavirlamivudineefavirenz openmrs_concept=\"6104^ABACAVIR+LAMIVUDINE+EFAVIRENZ^99DCT\">false</abacavirlamivudineefavirenz>\,,,,,,,,,,,,,,,,,
            <abc3tcnvp openmrs_concept=\"6105^ABC+3TC+NVP^99DCT\">false</abc3tcnvp>\,,,,,,,,,,,,,,,,,
            <abc3tclpv openmrs_concept=\"6106^ABC+3TC+LPV^99DCT\">false</abc3tclpv>\,,,,,,,,,,,,,,,,,
            <tdfazt3tclpv openmrs_concept=\"6107^TDF+AZT+3TC+LPV^99DCT\">false</tdfazt3tclpv>\,,,,,,,,,,,,,,,,,
            <tdf3tclpv openmrs_concept=\"6108^TDF+3TC+LPV^99DCT\">false</tdf3tclpv>\,,,,,,,,,,,,,,,,,
            <aztddilpv openmrs_concept=\"6109^AZT+DDI+LPV^99DCT\">false</aztddilpv>\,,,,,,,,,,,,,,,,,
            <d4t_63tcnvp openmrs_concept=\"6110^D4T 6+3TC+NVP^99DCT\">false</d4t_63tcnvp>\,,,,,,,,,,,,,,,,,
            <d4t_63tcefv openmrs_concept=\"6111^D4T 6+3TC+EFV^99DCT\">false</d4t_63tcefv>\,,,,,,,,,,,,,,,,,
            <d4t_63tcabc openmrs_concept=\"6112^D4T 6+3TC+ABC^99DCT\">false</d4t_63tcabc>\,,,,,,,,,,,,,,,,,
            <d4t_63tclpv openmrs_concept=\"6113^D4T 6+3TC+LPV^99DCT\">false</d4t_63tclpv>\,,,,,,,,,,,,,,,,,
            <azt603tcnvp openmrs_concept=\"6114^AZT60+3TC+NVP^99DCT\">false</azt603tcnvp>\,,,,,,,,,,,,,,,,,
            <azt603tcefv openmrs_concept=\"6115^AZT60+3TC+EFV^99DCT\">false</azt603tcefv>\,,,,,,,,,,,,,,,,,
            <azt603tcabc openmrs_concept=\"6116^AZT60+3TC+ABC^99DCT\">false</azt603tcabc>\,,,,,,,,,,,,,,,,,
            <azt603tclpv openmrs_concept=\"6117^AZT60+3TC+LPV^99DCT\">false</azt603tclpv>\,,,,,,,,,,,,,,,,,
            <ddi50abclpv openmrs_concept=\"6118^DDI50+ABC+LPV^99DCT\">false</ddi50abclpv>\,,,,,,,,,,,,,,,,,
            <ddi250ecabclpv openmrs_concept=\"6119^DDI250Ec+ABC+LPV^99DCT\">false</ddi250ecabclpv>\,,,,,,,,,,,,,,,,,
      </current_antiretroviral_drugs_used_for_treatment>\,,,,,,,,,,,,,,,,,
      <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
      <cotrimoxazole_use_specifically openmrs_concept=\"1536^COTRIMOXAZOLE USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cotrimoxazole_use_specifically>\,,,,,,,,,,,,,,,,,
      <vitamin_a multiple=\"0\" openmrs_concept=\"1535^VITAMIN A TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </vitamin_a>\,,,,,,,,,,,,,,,,,
      <vitamin_a_use_specifically openmrs_concept=\"1537^VITAMIN A USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </vitamin_a_use_specifically>\,,,,,,,,,,,,,,,,,
      <antifungal_use multiple=\"0\" openmrs_concept=\"1538^ANTIFUNGAL USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </antifungal_use>\,,,,,,,,,,,,,,,,,
      <antifungal_use_specifically openmrs_concept=\"1539^ANTIFUNGAL USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </antifungal_use_specifically>\,,,,,,,,,,,,,,,,,
      <treatment_non_specific openmrs_concept=\"1541^TREATMENT, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </treatment_non_specific>\,,,,,,,,,,,,,,,,,
    </pediatric_initial_treatment>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <problem_list openmrs_concept=\"1284^PROBLEM LIST^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <problem_added multiple=\"0\" openmrs_concept=\"6042^PROBLEM ADDED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </problem_added>\,,,,,,,,,,,,,,,,,
    <problem_resolved multiple=\"0\" openmrs_concept=\"6097^PROBLEM RESOLVED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </problem_resolved>\,,,,,,,,,,,,,,,,,
  </problem_list>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/27/2011 11:59,0,,,,e28a6ace-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
13,Template: MISAU header,0.1,39,0,"header without address, separate line for each item",4,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"Template: MISAU header\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/13-0.1-39.xsn\" solutionVersion=\"0.1.0.39\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/13-39\" id=\"13\" name=\"Template: MISAU header\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}</patient.tribe>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </placeholder>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28a7550-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
37,ADULTO: SEGUIMENTO,0.1,106,1,Ficha de Seguimento adulto,6,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ADULTO: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/37-0.1-106.xsn\" solutionVersion=\"0.1.0.106\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/37-106\" id=\"37\" name=\"ADULTO: SEGUIMENTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </temperature_c>\,,,,,,,,,,,,,,,,,
    <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </weight_kg>\,,,,,,,,,,,,,,,,,
    <altura_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </altura_cm>\,,,,,,,,,,,,,,,,,
    <systolic_blood_pressure openmrs_concept=\"5085^SYSTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </systolic_blood_pressure>\,,,,,,,,,,,,,,,,,
    <month_of_current_gestation openmrs_concept=\"5992^MONTH OF CURRENT GESTATION^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </month_of_current_gestation>\,,,,,,,,,,,,,,,,,
    <mozambique_stage_1_adult multiple=\"1\" openmrs_concept=\"1564^STAGE 1 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <asymptomatic_hiv_infection openmrs_concept=\"5327^ASYMPTOMATIC HIV INFECTION^99DCT\">false</asymptomatic_hiv_infection>\,,,,,,,,,,,,,,,,,
    </mozambique_stage_1_adult>\,,,,,,,,,,,,,,,,,
    <mozambique_stage_2_adult multiple=\"1\" openmrs_concept=\"1565^STAGE 2 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false</hiv_staging_-_adult_herpes_zoster>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false</hiv_staging_-_recurrent_upper_respiratory_infection>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_weight_loss_less_than_ten_percent openmrs_concept=\"5332^HIV STAGING - WEIGHT LOSS LESS THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_less_than_ten_percent>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_minor_mucocutaneous_manifestations openmrs_concept=\"5330^HIV STAGING - MINOR MUCOCUTANEOUS MANIFESTATIONS^99DCT\">false</hiv_staging_-_minor_mucocutaneous_manifestations>\,,,,,,,,,,,,,,,,,
    </mozambique_stage_2_adult>\,,,,,,,,,,,,,,,,,
    <mozambique_stage_3_adult multiple=\"1\" openmrs_concept=\"1566^STAGE 3 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <candidiasis_vaginal openmrs_concept=\"298^CANDIDIASIS, VAGINAL^99DCT\">false</candidiasis_vaginal>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_severe_bacterial_infection openmrs_concept=\"5333^HIV STAGING - SEVERE BACTERIAL INFECTION^99DCT\">false</hiv_staging_-_severe_bacterial_infection>\,,,,,,,,,,,,,,,,,
        <oral_hairy_leukoplakia openmrs_concept=\"5337^ORAL HAIRY LEUKOPLAKIA^99DCT\">false</oral_hairy_leukoplakia>\,,,,,,,,,,,,,,,,,
        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\,,,,,,,,,,,,,,,,
        <bedridden_less_than_50_percent_of_time openmrs_concept=\"1567^BEDRIDDEN LESS THAN 50% OF TIME^99DCT\">false</bedridden_less_than_50_percent_of_time>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_weight_loss_greater_than_ten_percent openmrs_concept=\"5339^HIV STAGING - WEIGHT LOSS GREATER THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_greater_than_ten_percent>\,,,,,,,,,,,,,,,,,
        <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_tuberculosis_within_year openmrs_concept=\"5338^HIV STAGING - TUBERCULOSIS WITHIN YEAR^99DCT\">false</hiv_staging_-_tuberculosis_within_year>\,,,,,,,,,,,,,,,,,
    </mozambique_stage_3_adult>\,,,,,,,,,,,,,,,,,
    <mozambique_stage_4_adult multiple=\"1\" openmrs_concept=\"1569^STAGE 4 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\,,,,,,,,,,,,,,,,,
        <cervical_cancer openmrs_concept=\"1570^CERVICAL CANCER^99DCT\">false</cervical_cancer>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cytomegalovirus_disease openmrs_concept=\"5035^HIV STAGING - CYTOMEGALOVIRUS DISEASE^99DCT\">false</hiv_staging_-_cytomegalovirus_disease>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_mycobacterium_other openmrs_concept=\"5043^HIV STAGING - MYCOBACTERIUM, OTHER^99DCT\">false</hiv_staging_-_mycobacterium_other>\,,,,,,,,,,,,,,,,
        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\,,,,,,,,,,,,,,,,,
        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\,,,,,,,,,,,,,,,,,
        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\,,,,,,,,,,,,,,,,
        <bedridden_more_than_50_percent_of_time openmrs_concept=\"1568^BEDRIDDEN MORE THAN 50% OF TIME^99DCT\">false</bedridden_more_than_50_percent_of_time>\,,,,,,,,,,,,,,,,,
        <wasting_syndrome openmrs_concept=\"823^WASTING SYNDROME^99DCT\">false</wasting_syndrome>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cryptococcosis_extrapulmonary openmrs_concept=\"5033^HIV STAGING - CRYPTOCOCCOSIS, EXTRAPULMONARY^99DCT\">false</hiv_staging_-_cryptococcosis_extrapulmonary>\,,,,,,,,,,,,,,,,
        <toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false</toxoplasmosis>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false</hiv_staging_-_mucocutaneous_herpes_simplex>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false</hiv_staging_-_cryptosporidiosis>\,,,,,,,,,,,,,,,,,
        <mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false</mycobacterium_tuberculosis_extrapulmonary>\,,,,,,,,,,,,,,,,
        <encephalopathy openmrs_concept=\"5345^ENCEPHALOPATHY^99DCT\">false</encephalopathy>\,,,,,,,,,,,,,,,,,
    </mozambique_stage_4_adult>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </non_coded_diagnosis>\,,,,,,,,,,,,,,,,,
    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_who_hiv_stage>\,,,,,,,,,,,,,,,,,
    <documented_observed_laboratory_data openmrs_concept=\"1689^DOCUMENTED OBSERVED LABORATORY DATA^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <neutrophils_absolute_count_obs openmrs_concept=\"1690^NEUTROPHILS ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </neutrophils_absolute_count_obs>\,,,,,,,,,,,,,,,,,
      <lymphocites_absolute_count_obs openmrs_concept=\"1691^LYMPHOCITES ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymphocites_absolute_count_obs>\,,,,,,,,,,,,,,,,,
      <hemoglobin_obs openmrs_concept=\"1692^HEMOGLOBIN OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hemoglobin_obs>\,,,,,,,,,,,,,,,,,
      <ast_obs openmrs_concept=\"1693^AST OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ast_obs>\,,,,,,,,,,,,,,,,,
      <alt_obs openmrs_concept=\"1694^ALT OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </alt_obs>\,,,,,,,,,,,,,,,,,
      <cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cd4_absolute_obs>\,,,,,,,,,,,,,,,,,
    </documented_observed_laboratory_data>\,,,,,,,,,,,,,,,,,
    <current_antiretroviral_drugs_used_for_treatment multiple=\"1\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\,,,,,,,,,,,,,,,,,
        <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\,,,,,,,,,,,,,,,,,
        <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\,,,,,,,,,,,,,,,,,
        <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\,,,,,,,,,,,,,,,,,
        <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\,,,,,,,,,,,,,,,,,
        <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\,,,,,,,,,,,,,,,,,
        <zidovudine_lamivudine_nevirapine openmrs_concept=\"1651^ZIDOVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\,,,,,,,,,,,,,,,,,
        <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\,,,,,,,,,,,,,,,,,
        <zidovudine_lamivudine_efavirenz openmrs_concept=\"1703^ZIDOVUDINE + LAMIVUDINE + EFAVIRENZ^99DCT\">false</zidovudine_lamivudine_efavirenz>\,,,,,,,,,,,,,,,,,
        <zidovudine_lamivudine_nelfinavir openmrs_concept=\"1702^ZIDOVUDINE + LAMIVUDINE + NELFINAVIR^99DCT\">false</zidovudine_lamivudine_nelfinavir>\,,,,,,,,,,,,,,,,,
        <stavudinelamivudineefavirennz openmrs_concept=\"1827^STAVUDINE+LAMIVUDINE+EFAVIRENNZ^99DCT\">false</stavudinelamivudineefavirennz>\,,,,,,,,,,,,,,,,,
        <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\,,,,,,,,,,,,,,,,,
        <d4t-40 openmrs_concept=\"625^STAVUDINE^99DCT^6^d4T-40^99RX\">false</d4t-40>\,,,,,,,,,,,,,,,,,
        <d4t-30 openmrs_concept=\"625^STAVUDINE^99DCT^5^d4T-30^99RX\">false</d4t-30>\,,,,,,,,,,,,,,,,,
        <lopinavir_and_ritonavir openmrs_concept=\"794^LOPINAVIR AND RITONAVIR^99DCT\">false</lopinavir_and_ritonavir>\,,,,,,,,,,,,,,,,,
        <triomune-30 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^2^Triomune-30^99RX\">false</triomune-30>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <triomune-40 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^3^Triomune-40^99RX\">false</triomune-40>\,,,,,,,,,,,,,,,,,
        <ddi_125 openmrs_concept=\"796^DIDANOSINE^99DCT^9^DDI 125^99RX\">false</ddi_125>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\,,,,,,,,,,,,,,,,,
        <ddi_200 openmrs_concept=\"796^DIDANOSINE^99DCT^10^DDI 200^99RX\">false</ddi_200>\,,,,,,,,,,,,,,,,,
        <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\,,,,,,,,,,,,,,,,,
        <zidovudinelamivudinelopinavir openmrs_concept=\"6100^ZIDOVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</zidovudinelamivudinelopinavir>\,,,,,,,,,,,,,,,,,
        <zidovudinelamivudinesaquinavir openmrs_concept=\"6101^ZIDOVUDINE+LAMIVUDINE+SAQUINAVIR^99DCT\">false</zidovudinelamivudinesaquinavir>\,,,,,,,,,,,,,,,,,
        <stavudinelamivudineabacavir openmrs_concept=\"6102^STAVUDINE+LAMIVUDINE+ABACAVIR^99DCT\">false</stavudinelamivudineabacavir>\,,,,,,,,,,,,,,,,,
        <stavudinelamivudinelopinavir openmrs_concept=\"6103^STAVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</stavudinelamivudinelopinavir>\,,,,,,,,,,,,,,,,,
        <abacavirlamivudineefavirenz openmrs_concept=\"6104^ABACAVIR+LAMIVUDINE+EFAVIRENZ^99DCT\">false</abacavirlamivudineefavirenz>\,,,,,,,,,,,,,,,,,
        <abc3tcnvp openmrs_concept=\"6105^ABC+3TC+NVP^99DCT\">false</abc3tcnvp>\,,,,,,,,,,,,,,,,,
        <abc3tclpv openmrs_concept=\"6106^ABC+3TC+LPV^99DCT\">false</abc3tclpv>\,,,,,,,,,,,,,,,,,
        <tdfazt3tclpv openmrs_concept=\"6107^TDF+AZT+3TC+LPV^99DCT\">false</tdfazt3tclpv>\,,,,,,,,,,,,,,,,,
        <tdf3tclpv openmrs_concept=\"6108^TDF+3TC+LPV^99DCT\">false</tdf3tclpv>\,,,,,,,,,,,,,,,,,
        <aztddilpv openmrs_concept=\"6109^AZT+DDI+LPV^99DCT\">false</aztddilpv>\,,,,,,,,,,,,,,,,,
        <d4t_63tcnvp openmrs_concept=\"6110^D4T 6+3TC+NVP^99DCT\">false</d4t_63tcnvp>\,,,,,,,,,,,,,,,,,
        <d4t_63tcefv openmrs_concept=\"6111^D4T 6+3TC+EFV^99DCT\">false</d4t_63tcefv>\,,,,,,,,,,,,,,,,,
        <d4t_63tcabc openmrs_concept=\"6112^D4T 6+3TC+ABC^99DCT\">false</d4t_63tcabc>\,,,,,,,,,,,,,,,,,
        <d4t_63tclpv openmrs_concept=\"6113^D4T 6+3TC+LPV^99DCT\">false</d4t_63tclpv>\,,,,,,,,,,,,,,,,,
        <azt603tcnvp openmrs_concept=\"6114^AZT60+3TC+NVP^99DCT\">false</azt603tcnvp>\,,,,,,,,,,,,,,,,,
        <azt603tcefv openmrs_concept=\"6115^AZT60+3TC+EFV^99DCT\">false</azt603tcefv>\,,,,,,,,,,,,,,,,,
        <azt603tcabc openmrs_concept=\"6116^AZT60+3TC+ABC^99DCT\">false</azt603tcabc>\,,,,,,,,,,,,,,,,,
        <azt603tclpv openmrs_concept=\"6117^AZT60+3TC+LPV^99DCT\">false</azt603tclpv>\,,,,,,,,,,,,,,,,,
        <ddi50abclpv openmrs_concept=\"6118^DDI50+ABC+LPV^99DCT\">false</ddi50abclpv>\,,,,,,,,,,,,,,,,,
        <ddi250ecabclpv openmrs_concept=\"6119^DDI250Ec+ABC+LPV^99DCT\">false</ddi250ecabclpv>\,,,,,,,,,,,,,,,,,
    </current_antiretroviral_drugs_used_for_treatment>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment_plan>\,,,,,,,,,,,,,,,,,
    <diastolic_blood_pressure openmrs_concept=\"5086^DIASTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </diastolic_blood_pressure>\,,,,,,,,,,,,,,,,,
    <treatment_prescribed multiple=\"0\" openmrs_concept=\"1719^TREATMENT PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </treatment_prescribed>\,,,,,,,,,,,,,,,,,
    <return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit_date>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </isoniazid_use>\,,,,,,,,,,,,,,,,,
    <hipoteses_de_diagnosticos_outros multiple=\"1\" openmrs_concept=\"1406^OTHER DIAGNOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <anemia openmrs_concept=\"3^ANEMIA^99DCT\">false</anemia>\,,,,,,,,,,,,,,,,,
        <malaria openmrs_concept=\"123^MALARIA^99DCT\">false</malaria>\,,,,,,,,,,,,,,,,,
        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\,,,,,,,,,,,,,,,,,
        <polyp openmrs_concept=\"2142^POLYP^99DCT\">false</polyp>\,,,,,,,,,,,,,,,,,
        <rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false</rectovaginal_fistula>\,,,,,,,,,,,,,,,,,
        <prolapse openmrs_concept=\"2141^PROLAPSE^99DCT\">false</prolapse>\,,,,,,,,,,,,,,,,,
    </hipoteses_de_diagnosticos_outros>\,,,,,,,,,,,,,,,,,
    <nutritional_supplement multiple=\"1\" openmrs_concept=\"2152^NUTRITIONAL SUPPLEMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false</plumpy_nut>\,,,,,,,,,,,,,,,,,
        <basic_food_basket openmrs_concept=\"2151^BASIC FOOD BASKET^99DCT\">false</basic_food_basket>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <enriched_porridge openmrs_concept=\"2150^ENRICHED PORRIDGE^99DCT\">false</enriched_porridge>\,,,,,,,,,,,,,,,,,
    </nutritional_supplement>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/26/2011 18:01,0,,,,e28aa7aa-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
42,"Template: MISAU header, full address",0.1,47,0,Template for MISAU forms with full address,4,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"Template: MISAU header, full address\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/42-0.1-47.xsn\" solutionVersion=\"0.1.0.47\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/42-47\" id=\"42\" name=\"Template: MISAU header, full address\" version=\"0.1\">\,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}</patient.tribe>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </placeholder>\,,,,,,,,,,,,,,,,,
    <organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </organization>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28aabd8-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
44,PEDIATRIA: SEGUIMENTO,0.1,82,1,Ficha de Seguimento pediatria,9,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PEDIATRIA: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/44-0.1-82.xsn\" solutionVersion=\"0.1.0.82\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/44-82\" id=\"44\" name=\"PEDIATRIA: SEGUIMENTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <mozambique_stage_1_pediatric multiple=\"1\" openmrs_concept=\"1558^STAGE 1 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false</hiv_staging_-_adult_herpes_zoster>\,,,,,,,,,,,,,,,,,
        <asymptomatic_hiv_infection openmrs_concept=\"5327^ASYMPTOMATIC HIV INFECTION^99DCT\">false</asymptomatic_hiv_infection>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false</hiv_staging_-_recurrent_upper_respiratory_infection>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_generalized_lymphadenopathy openmrs_concept=\"5328^HIV STAGING - PERSISTENT GENERALIZED LYMPHADENOPATHY^99DCT\">false</hiv_staging_-_persistent_generalized_lymphadenopathy>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_weight_loss_less_than_ten_percent openmrs_concept=\"5332^HIV STAGING - WEIGHT LOSS LESS THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_less_than_ten_percent>\,,,,,,,,,,,,,,,,,
        <minor_cutaneous_manifestations openmrs_concept=\"1296^MINOR CUTANEOUS MANIFESTATIONS^99DCT\">false</minor_cutaneous_manifestations>\,,,,,,,,,,,,,,,,,
    </mozambique_stage_1_pediatric>\,,,,,,,,,,,,,,,,,
    <mozambique_stage_2_pediatric multiple=\"1\" openmrs_concept=\"1561^STAGE 2 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false</hiv_staging_-_serious_bacterial_infections>\,,,,,,,,,,,,,,,,,
        <pneumonia_tuberculous openmrs_concept=\"42^PNEUMONIA, TUBERCULOUS^99DCT\">false</pneumonia_tuberculous>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\,,,,,,,,,,,,,,,,,
        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_weight_loss_greater_than_ten_percent openmrs_concept=\"5339^HIV STAGING - WEIGHT LOSS GREATER THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_greater_than_ten_percent>\,,,,,,,,,,,,,,,,,
        <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\,,,,,,,,,,,,,,,,
        <hepatosplenomegaly openmrs_concept=\"825^HEPATOSPLENOMEGALY^99DCT\">false</hepatosplenomegaly>\,,,,,,,,,,,,,,,,,
        <recurrent_oral_ulcer openmrs_concept=\"2065^RECURRENT ORAL ULCER^99DCT\">false</recurrent_oral_ulcer>\,,,,,,,,,,,,,,,,,
        <parotid_enlargement openmrs_concept=\"1210^PAROTID ENLARGEMENT^99DCT\">false</parotid_enlargement>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false</hiv_staging_-_recurrent_upper_respiratory_infection>\,,,,,,,,,,,,,,,,,
        <molluscum_contagiosum openmrs_concept=\"1212^MOLLUSCUM CONTAGIOSUM^99DCT\">false</molluscum_contagiosum>\,,,,,,,,,,,,,,,,,
        <linear_gingival_erythema openmrs_concept=\"2064^LINEAR GINGIVAL ERYTHEMA^99DCT\">false</linear_gingival_erythema>\,,,,,,,,,,,,,,,,,
        <herpes_zoster openmrs_concept=\"836^HERPES ZOSTER^99DCT\">false</herpes_zoster>\,,,,,,,,,,,,,,,,,
    </mozambique_stage_2_pediatric>\,,,,,,,,,,,,,,,,,
    <mozambique_stage_3_pediatric multiple=\"1\" openmrs_concept=\"1562^STAGE 3 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false</failure_to_thrive>\,,,,,,,,,,,,,,,,,
        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_salmonella_septicemia openmrs_concept=\"5354^HIV STAGING - SALMONELLA SEPTICEMIA^99DCT\">false</hiv_staging_-_salmonella_septicemia>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false</hiv_staging_-_mucocutaneous_herpes_simplex>\,,,,,,,,,,,,,,,,,
        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\,,,,,,,,,,,,,,,,,
        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\,,,,,,,,,,,,,,,,,
        <mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false</mycobacterium_tuberculosis_extrapulmonary>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_lymphoid_interstitial_pneumonia openmrs_concept=\"5024^HIV STAGING - LYMPHOID INTERSTITIAL PNEUMONIA^99DCT\">false</hiv_staging_-_lymphoid_interstitial_pneumonia>\,,,,,,,,,,,,,,,,,
        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_hsv_stomatitis openmrs_concept=\"5020^HIV STAGING - HSV STOMATITIS^99DCT\">false</hiv_staging_-_hsv_stomatitis>\,,,,,,,,,,,,,,,,,
        <chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false</chronic_obstructive_pulmonary_disease>\,,,,,,,,,,,,,,,,,
        <oral_hairy_leukoplakia openmrs_concept=\"5337^ORAL HAIRY LEUKOPLAKIA^99DCT\">false</oral_hairy_leukoplakia>\,,,,,,,,,,,,,,,,,
        <pneumonia_tuberculous openmrs_concept=\"42^PNEUMONIA, TUBERCULOUS^99DCT\">false</pneumonia_tuberculous>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\,,,,,,,,,,,,,,,,,
        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\,,,,,,,,,,,,,,,,
        <tuberculosis_ganglionic openmrs_concept=\"2063^TUBERCULOSIS GANGLIONIC^99DCT\">false</tuberculosis_ganglionic>\,,,,,,,,,,,,,,,,,
        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_refractory_anemia openmrs_concept=\"1217^HIV STAGING - REFRACTORY ANEMIA^99DCT\">false</hiv_staging_-_refractory_anemia>\,,,,,,,,,,,,,,,,,
        <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\,,,,,,,,,,,,,,,,
    </mozambique_stage_3_pediatric>\,,,,,,,,,,,,,,,,,
    <stage_4_pediatric_mozambique multiple=\"1\" openmrs_concept=\"2066^STAGE 4 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false</rectovaginal_fistula>\,,,,,,,,,,,,,,,,,
        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\,,,,,,,,,,,,,,,,,
        <cervical_cancer openmrs_concept=\"1570^CERVICAL CANCER^99DCT\">false</cervical_cancer>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cytomegalovirus_disease openmrs_concept=\"5035^HIV STAGING - CYTOMEGALOVIRUS DISEASE^99DCT\">false</hiv_staging_-_cytomegalovirus_disease>\,,,,,,,,,,,,,,,,,
        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\,,,,,,,,,,,,,,,,,
        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\,,,,,,,,,,,,,,,,,
        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_nonresponsive_herpes_simplex_virus openmrs_concept=\"1216^HIV STAGING - NONRESPONSIVE HERPES SIMPLEX VIRUS^99DCT\">false</hiv_staging_-_nonresponsive_herpes_simplex_virus>\,,,,,,,,,,,,,,,,,
        <toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false</toxoplasmosis>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cryptococcosis_extrapulmonary openmrs_concept=\"5033^HIV STAGING - CRYPTOCOCCOSIS, EXTRAPULMONARY^99DCT\">false</hiv_staging_-_cryptococcosis_extrapulmonary>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_severe_bacterial_infection openmrs_concept=\"5333^HIV STAGING - SEVERE BACTERIAL INFECTION^99DCT\">false</hiv_staging_-_severe_bacterial_infection>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_disseminated_endemic_mycosis openmrs_concept=\"5350^HIV STAGING - DISSEMINATED ENDEMIC MYCOSIS^99DCT\">false</hiv_staging_-_disseminated_endemic_mycosis>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_mycobacterium_avium_complex openmrs_concept=\"5044^HIV STAGING - MYCOBACTERIUM AVIUM COMPLEX^99DCT\">false</hiv_staging_-_mycobacterium_avium_complex>\,,,,,,,,,,,,,,,,,
        <nephropathy openmrs_concept=\"5025^NEPHROPATHY^99DCT\">false</nephropathy>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false</hiv_staging_-_cryptosporidiosis>\,,,,,,,,,,,,,,,,,
        <chronic_malnutrition openmrs_concept=\"1844^CHRONIC MALNUTRITION^99DCT\">false</chronic_malnutrition>\,,,,,,,,,,,,,,,,,
        <encephalopathy openmrs_concept=\"5345^ENCEPHALOPATHY^99DCT\">false</encephalopathy>\,,,,,,,,,,,,,,,,,
        <mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false</mycobacterium_tuberculosis_extrapulmonary>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false</hiv_staging_-_mucocutaneous_herpes_simplex>\,,,,,,,,,,,,,,,,,
    </stage_4_pediatric_mozambique>\,,,,,,,,,,,,,,,,,
    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_patient_hiv_positive>\,,,,,,,,,,,,,,,,,
    <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_dna_polymerase_chain_reaction_qualitative>\,,,,,,,,,,,,,,,,,
    <temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </temperature_c>\,,,,,,,,,,,,,,,,,
    <head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </head_circumference>\,,,,,,,,,,,,,,,,,
    <altura_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </altura_cm>\,,,,,,,,,,,,,,,,,
    <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </weight_kg>\,,,,,,,,,,,,,,,,,
    <weight_divided_by_height_as_a_percentage openmrs_concept=\"1888^WEIGHT DIVIDED BY HEIGHT AS A PERCENTAGE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </weight_divided_by_height_as_a_percentage>\,,,,,,,,,,,,,,,,,
    <psychomotor_development multiple=\"0\" openmrs_concept=\"1882^PSYCHOMOTOR DEVELOPMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </psychomotor_development>\,,,,,,,,,,,,,,,,,
    <treatment_non_specific openmrs_concept=\"1541^TREATMENT, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </treatment_non_specific>\,,,,,,,,,,,,,,,,,
    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </non_coded_diagnosis>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <documented_observed_laboratory_data openmrs_concept=\"1689^DOCUMENTED OBSERVED LABORATORY DATA^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <neutrophils_absolute_count_obs openmrs_concept=\"1690^NEUTROPHILS ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </neutrophils_absolute_count_obs>\,,,,,,,,,,,,,,,,,
      <lymphocites_absolute_count_obs openmrs_concept=\"1691^LYMPHOCITES ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymphocites_absolute_count_obs>\,,,,,,,,,,,,,,,,,
      <hemoglobin_obs openmrs_concept=\"1692^HEMOGLOBIN OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hemoglobin_obs>\,,,,,,,,,,,,,,,,,
      <ast_obs openmrs_concept=\"1693^AST OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ast_obs>\,,,,,,,,,,,,,,,,,
      <alt_obs openmrs_concept=\"1694^ALT OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </alt_obs>\,,,,,,,,,,,,,,,,,
      <cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cd4_absolute_obs>\,,,,,,,,,,,,,,,,,
      <white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </white_blood_cells>\,,,,,,,,,,,,,,,,,
      <total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </total_protein>\,,,,,,,,,,,,,,,,,
      <urinary_albumin openmrs_concept=\"849^URINARY ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </urinary_albumin>\,,,,,,,,,,,,,,,,,
      <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_viral_load>\,,,,,,,,,,,,,,,,,
    </documented_observed_laboratory_data>\,,,,,,,,,,,,,,,,,
    <current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_antiretroviral_drugs_used_for_treatment>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment_plan>\,,,,,,,,,,,,,,,,,
    <hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hospital_slash_clinic>\,,,,,,,,,,,,,,,,,
      <diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </diagnosis_for_hospitalization>\,,,,,,,,,,,,,,,,,
      <date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </date_of_hospital_stay_entry>\,,,,,,,,,,,,,,,,,
      <data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </data_of_hospital_stay_exit>\,,,,,,,,,,,,,,,,,
      <hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hosptal_treatment>\,,,,,,,,,,,,,,,,,
    </hospitalizations>\,,,,,,,,,,,,,,,,,
    <treatment_prescribed multiple=\"0\" openmrs_concept=\"1719^TREATMENT PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </treatment_prescribed>\,,,,,,,,,,,,,,,,,
    <side_effect_with_severity openmrs_concept=\"1365^SIDE EFFECT WITH SEVERITY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </side_effect_with_severity>\,,,,,,,,,,,,,,,,,
    <reason_antiretrovirals_stopped multiple=\"0\" openmrs_concept=\"1252^REASON ANTIRETROVIRALS STOPPED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_antiretrovirals_stopped>\,,,,,,,,,,,,,,,,,
    <adherence multiple=\"0\" openmrs_concept=\"1714^ADHERENCE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </adherence>\,,,,,,,,,,,,,,,,,
    <return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit_date>\,,,,,,,,,,,,,,,,,
    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_who_hiv_stage>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </isoniazid_use>\,,,,,,,,,,,,,,,,,
    <nutritional_supplement multiple=\"1\" openmrs_concept=\"2152^NUTRITIONAL SUPPLEMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false</plumpy_nut>\,,,,,,,,,,,,,,,,,
        <basic_food_basket openmrs_concept=\"2151^BASIC FOOD BASKET^99DCT\">false</basic_food_basket>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <enriched_porridge openmrs_concept=\"2150^ENRICHED PORRIDGE^99DCT\">false</enriched_porridge>\,,,,,,,,,,,,,,,,,
    </nutritional_supplement>\,,,,,,,,,,,,,,,,,
    <hipoteses_de_diagnosticos_outros multiple=\"1\" openmrs_concept=\"1406^OTHER DIAGNOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <anemia openmrs_concept=\"3^ANEMIA^99DCT\">false</anemia>\,,,,,,,,,,,,,,,,,
        <malaria openmrs_concept=\"123^MALARIA^99DCT\">false</malaria>\,,,,,,,,,,,,,,,,,
        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\,,,,,,,,,,,,,,,,,
        <polyp openmrs_concept=\"2142^POLYP^99DCT\">false</polyp>\,,,,,,,,,,,,,,,,,
        <rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false</rectovaginal_fistula>\,,,,,,,,,,,,,,,,,
        <prolapse openmrs_concept=\"2141^PROLAPSE^99DCT\">false</prolapse>\,,,,,,,,,,,,,,,,,
    </hipoteses_de_diagnosticos_outros>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/26/2011 18:23,0,,,,e28ac028-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
50,ADULTO: PROCESSO PARTE B - EXAME CLINICO,1,82,0,Processo de Hospital de Dia 2/2,1,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ADULTO: PROCESSO PARTE B - EXAME CLINICO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/50-1-82.xsn\" solutionVersion=\"1.0.0.82\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/50-82\" id=\"50\" name=\"ADULTO: PROCESSO PARTE B - EXAME CLINICO\" version=\"1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <vital_data openmrs_concept=\"1673^VITAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <written_history openmrs_concept=\"1671^WRITTEN HISTORY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </written_history>\,,,,,,,,,,,,,,,,,
      <general_physical_state multiple=\"0\" openmrs_concept=\"1382^GENERAL PHYSICAL STATE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </general_physical_state>\,,,,,,,,,,,,,,,,,
      <systolic_blood_pressure openmrs_concept=\"5085^SYSTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </systolic_blood_pressure>\,,,,,,,,,,,,,,,,,
      <diastolic_blood_pressure openmrs_concept=\"5086^DIASTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </diastolic_blood_pressure>\,,,,,,,,,,,,,,,,,
      <temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </temperature_c>\,,,,,,,,,,,,,,,,,
      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </weight_kg>\,,,,,,,,,,,,,,,,,
      <height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </height_cm>\,,,,,,,,,,,,,,,,,
      <body_mass_index openmrs_concept=\"1342^BODY MASS INDEX^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </body_mass_index>\,,,,,,,,,,,,,,,,,
      <exame_mucosas multiple=\"1\" openmrs_concept=\"1415^EXAME OF MUCOSAL MEMBRANES^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <conjuntivas openmrs_concept=\"1418^CONJUNTIVAS^99DCT\">false</conjuntivas>\,,,,,,,,,,,,,,,,,
            <anictericas openmrs_concept=\"1420^ANICTERICAS^99DCT\">false</anictericas>\,,,,,,,,,,,,,,,,,
            <ictericas openmrs_concept=\"1419^ICTERICAS^99DCT\">false</ictericas>\,,,,,,,,,,,,,,,,,
            <descoradas openmrs_concept=\"1417^DESCORADAS^99DCT\">false</descoradas>\,,,,,,,,,,,,,,,,,
            <coradas openmrs_concept=\"1416^CORADAS^99DCT\">false</coradas>\,,,,,,,,,,,,,,,,,
      </exame_mucosas>\,,,,,,,,,,,,,,,,,
      <findings_of_the_oral_cavity multiple=\"0\" openmrs_concept=\"1672^FINDINGS OF THE ORAL CAVITY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </findings_of_the_oral_cavity>\,,,,,,,,,,,,,,,,,
      <type_of_oral_sores openmrs_concept=\"1424^TYPE OF ORAL SORES^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </type_of_oral_sores>\,,,,,,,,,,,,,,,,,
    </vital_data>\,,,,,,,,,,,,,,,,,
    <skin_exam_findings multiple=\"0\" openmrs_concept=\"1120^SKIN EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </skin_exam_findings>\,,,,,,,,,,,,,,,,,
    <skin_exam openmrs_concept=\"1674^SKIN EXAM^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <type_of_skin_lesion openmrs_concept=\"1423^TYPE OF SKIN LESION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </type_of_skin_lesion>\,,,,,,,,,,,,,,,,,
      <anatomic_locations multiple=\"0\" openmrs_concept=\"1239^ANATOMIC LOCATIONS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </anatomic_locations>\,,,,,,,,,,,,,,,,,
    </skin_exam>\,,,,,,,,,,,,,,,,,
    <is_patient_hydrated multiple=\"0\" openmrs_concept=\"1425^IS PATIENT HYDRATED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_patient_hydrated>\,,,,,,,,,,,,,,,,,
    <lymph_node_exam_findings multiple=\"1\" openmrs_concept=\"1121^LYMPH NODE EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <submandibular openmrs_concept=\"504^SUBMANDIBULAR^99DCT\">false</submandibular>\,,,,,,,,,,,,,,,,,
        <supraclavicular openmrs_concept=\"505^SUPRACLAVICULAR^99DCT\">false</supraclavicular>\,,,,,,,,,,,,,,,,,
        <inguinal openmrs_concept=\"506^INGUINAL^99DCT\">false</inguinal>\,,,,,,,,,,,,,,,,,
        <cervical openmrs_concept=\"643^CERVICAL^99DCT\">false</cervical>\,,,,,,,,,,,,,,,,,
        <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
        <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\,,,,,,,,,,,,,,,,,
        <axillary openmrs_concept=\"5112^AXILLARY^99DCT\">false</axillary>\,,,,,,,,,,,,,,,,,
        <other_inguinal openmrs_concept=\"1426^OTHER INGUINAL^99DCT\">false</other_inguinal>\,,,,,,,,,,,,,,,,,
    </lymph_node_exam_findings>\,,,,,,,,,,,,,,,,,
    <cardiological_exam openmrs_concept=\"1676^CARDIOLOGICAL EXAM^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <pulse openmrs_concept=\"5087^PULSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pulse>\,,,,,,,,,,,,,,,,,
      <cardiac_exam_findings multiple=\"1\" openmrs_concept=\"1124^CARDIAC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <s3_gallop openmrs_concept=\"550^S3 GALLOP^99DCT\">false</s3_gallop>\,,,,,,,,,,,,,,,,,
            <cardiac_murmur openmrs_concept=\"562^CARDIAC MURMUR^99DCT\">false</cardiac_murmur>\,,,,,,,,,,,,,,,,,
            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\,,,,,,,,,,,,,,,,,
            <abnormal_sounds openmrs_concept=\"1117^ABNORMAL SOUNDS^99DCT\">false</abnormal_sounds>\,,,,,,,,,,,,,,,,,
            <left_ventricular_lift openmrs_concept=\"5156^LEFT VENTRICULAR LIFT^99DCT\">false</left_ventricular_lift>\,,,,,,,,,,,,,,,,,
            <right_ventricular_lift openmrs_concept=\"5157^RIGHT VENTRICULAR LIFT^99DCT\">false</right_ventricular_lift>\,,,,,,,,,,,,,,,,,
            <evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false</evidence_of_cardiac_enlargement>\,,,,,,,,,,,,,,,,,
            <diastolic_descresendo_murmur openmrs_concept=\"5160^DIASTOLIC DESCRESENDO MURMUR^99DCT\">false</diastolic_descresendo_murmur>\,,,,,,,,,,,,,,,,,
            <holosystolic_murmur openmrs_concept=\"5162^HOLOSYSTOLIC MURMUR^99DCT\">false</holosystolic_murmur>\,,,,,,,,,,,,,,,,,
            <diastolic_rumble openmrs_concept=\"5164^DIASTOLIC RUMBLE^99DCT\">false</diastolic_rumble>\,,,,,,,,,,,,,,,,,
            <systolic_ejection_murmur openmrs_concept=\"5166^SYSTOLIC EJECTION MURMUR^99DCT\">false</systolic_ejection_murmur>\,,,,,,,,,,,,,,,,,
            <pericardial_friction_rub openmrs_concept=\"5176^PERICARDIAL FRICTION RUB^99DCT\">false</pericardial_friction_rub>\,,,,,,,,,,,,,,,,,
            <chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false</chronic_obstructive_pulmonary_disease>\,,,,,,,,,,,,,,,,,
            <arrythmia openmrs_concept=\"1395^ARRYTHMIA^99DCT\">false</arrythmia>\,,,,,,,,,,,,,,,,,
      </cardiac_exam_findings>\,,,,,,,,,,,,,,,,,
    </cardiological_exam>\,,,,,,,,,,,,,,,,,
    <pulmonary_exam_set openmrs_concept=\"1675^PULMONARY EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <pulmonary_exam multiple=\"0\" openmrs_concept=\"1427^PULMONARY EXAM^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pulmonary_exam>\,,,,,,,,,,,,,,,,,
      <respiratory_rate openmrs_concept=\"5242^RESPIRATORY RATE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </respiratory_rate>\,,,,,,,,,,,,,,,,,
      <pulmonary_auscultation_non_specific openmrs_concept=\"1543^PULMONARY AUSCULTATION, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pulmonary_auscultation_non_specific>\,,,,,,,,,,,,,,,,,
      <pulmonary_exam_auscultation multiple=\"1\" openmrs_concept=\"1629^PULMONARY EXAM AUSCULTATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <sopro_tubarico openmrs_concept=\"1550^SOPRO TUBARICO^99DCT\">false</sopro_tubarico>\,,,,,,,,,,,,,,,,,
            <snoring openmrs_concept=\"1549^SNORING^99DCT\">false</snoring>\,,,,,,,,,,,,,,,,,
            <murmur_anforico openmrs_concept=\"1551^MURMUR ANFORICO^99DCT\">false</murmur_anforico>\,,,,,,,,,,,,,,,,,
            <fervor openmrs_concept=\"1548^FERVOR^99DCT\">false</fervor>\,,,,,,,,,,,,,,,,,
      </pulmonary_exam_auscultation>\,,,,,,,,,,,,,,,,,
    </pulmonary_exam_set>\,,,,,,,,,,,,,,,,,
    <abdominal_exam_set openmrs_concept=\"1677^ABDOMINAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <abdominal_exam_findings multiple=\"1\" openmrs_concept=\"1125^ABDOMINAL EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <ascites openmrs_concept=\"581^ASCITES^99DCT\">false</ascites>\,,,,,,,,,,,,,,,,,
            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\,,,,,,,,,,,,,,,,,
            <hepatomegaly openmrs_concept=\"5008^HEPATOMEGALY^99DCT\">false</hepatomegaly>\,,,,,,,,,,,,,,,,,
            <splenomegaly openmrs_concept=\"5009^SPLENOMEGALY^99DCT\">false</splenomegaly>\,,,,,,,,,,,,,,,,,
            <mass_abdominal openmrs_concept=\"5103^MASS, ABDOMINAL^99DCT\">false</mass_abdominal>\,,,,,,,,,,,,,,,,
            <abdominal_tenderness openmrs_concept=\"5105^ABDOMINAL TENDERNESS^99DCT\">false</abdominal_tenderness>\,,,,,,,,,,,,,,,,,
            <distended openmrs_concept=\"1397^DISTENDED^99DCT\">false</distended>\,,,,,,,,,,,,,,,,,
            <flatulence openmrs_concept=\"1398^FLATULENCE^99DCT\">false</flatulence>\,,,,,,,,,,,,,,,,,
      </abdominal_exam_findings>\,,,,,,,,,,,,,,,,,
      <abdominal_exam_other openmrs_concept=\"1396^ABDOMINAL EXAM, OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </abdominal_exam_other>\,,,,,,,,,,,,,,,,,
    </abdominal_exam_set>\,,,,,,,,,,,,,,,,,
    <genital_exam_set openmrs_concept=\"1679^GENITAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <urogenital_exam_findings multiple=\"1\" openmrs_concept=\"1126^UROGENITAL EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\,,,,,,,,,,,,,,,,,
            <not_done openmrs_concept=\"1118^NOT DONE^99DCT\">false</not_done>\,,,,,,,,,,,,,,,,,
            <secretions openmrs_concept=\"1399^SECRETIONS^99DCT\">false</secretions>\,,,,,,,,,,,,,,,,,
            <condylomas openmrs_concept=\"1400^CONDYLOMAS^99DCT\">false</condylomas>\,,,,,,,,,,,,,,,,,
            <ulcers openmrs_concept=\"1602^ULCERS^99DCT\">false</ulcers>\,,,,,,,,,,,,,,,,,
      </urogenital_exam_findings>\,,,,,,,,,,,,,,,,,
      <genital_exam_findings_non_coded openmrs_concept=\"1678^GENITAL EXAM FINDINGS, NON CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </genital_exam_findings_non_coded>\,,,,,,,,,,,,,,,,,
    </genital_exam_set>\,,,,,,,,,,,,,,,,,
    <neurological_exam_set openmrs_concept=\"1681^NEUROLOGICAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <neurologic_exam_findings multiple=\"1\" openmrs_concept=\"1129^NEUROLOGIC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <seizure openmrs_concept=\"206^SEIZURE^99DCT\">false</seizure>\,,,,,,,,,,,,,,,,,
            <cranial_nerve_abnormalities openmrs_concept=\"599^CRANIAL NERVE ABNORMALITIES^99DCT\">false</cranial_nerve_abnormalities>\,,,,,,,,,,,,,,,,,
            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\,,,,,,,,,,,,,,,,,
            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\,,,,,,,,,,,,,,,,,
            <asymmetric_reflexes openmrs_concept=\"1199^ASYMMETRIC REFLEXES^99DCT\">false</asymmetric_reflexes>\,,,,,,,,,,,,,,,,,
            <abnormal_gait openmrs_concept=\"5108^ABNORMAL GAIT^99DCT\">false</abnormal_gait>\,,,,,,,,,,,,,,,,,
            <decreased_sensation openmrs_concept=\"5135^DECREASED SENSATION^99DCT\">false</decreased_sensation>\,,,,,,,,,,,,,,,,,
            <abnormal_tone openmrs_concept=\"5264^ABNORMAL TONE^99DCT\">false</abnormal_tone>\,,,,,,,,,,,,,,,,,
            <focal_weakness openmrs_concept=\"6005^FOCAL WEAKNESS^99DCT\">false</focal_weakness>\,,,,,,,,,,,,,,,,,
            <irritability openmrs_concept=\"6023^IRRITABILITY^99DCT\">false</irritability>\,,,,,,,,,,,,,,,,,
            <paresi openmrs_concept=\"1401^PARESI^99DCT\">false</paresi>\,,,,,,,,,,,,,,,,,
            <hemiparesis openmrs_concept=\"828^HEMIPARESIS^99DCT\">false</hemiparesis>\,,,,,,,,,,,,,,,,,
            <peripheral_neuropathy openmrs_concept=\"821^PERIPHERAL NEUROPATHY^99DCT\">false</peripheral_neuropathy>\,,,,,,,,,,,,,,,,,
            <nuchal_rigidity openmrs_concept=\"5170^NUCHAL RIGIDITY^99DCT\">false</nuchal_rigidity>\,,,,,,,,,,,,,,,,,
      </neurologic_exam_findings>\,,,,,,,,,,,,,,,,,
      <type_of_paralysis_non_coded openmrs_concept=\"1680^TYPE OF PARALYSIS, NON CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </type_of_paralysis_non_coded>\,,,,,,,,,,,,,,,,,
      <neurological_exam_other openmrs_concept=\"1407^NEUROLOGICAL EXAM OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </neurological_exam_other>\,,,,,,,,,,,,,,,,,
    </neurological_exam_set>\,,,,,,,,,,,,,,,,,
    <extremities_exam_set openmrs_concept=\"1683^EXTREMITIES EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <extremity_exam_findings multiple=\"0\" openmrs_concept=\"1127^EXTREMITY EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </extremity_exam_findings>\,,,,,,,,,,,,,,,,,
      <anatomic_locations multiple=\"0\" openmrs_concept=\"1239^ANATOMIC LOCATIONS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </anatomic_locations>\,,,,,,,,,,,,,,,,,
    </extremities_exam_set>\,,,,,,,,,,,,,,,,,
    <extremities_exam_other_non_coded openmrs_concept=\"1682^EXTREMITIES EXAM, OTHER NON CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </extremities_exam_other_non_coded>\,,,,,,,,,,,,,,,,,
    <karnofsky_performance_score openmrs_concept=\"5283^KARNOFSKY PERFORMANCE SCORE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </karnofsky_performance_score>\,,,,,,,,,,,,,,,,,
    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </non_coded_diagnosis>\,,,,,,,,,,,,,,,,,
    <counceling_date openmrs_concept=\"1475^COUNCELING DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </counceling_date>\,,,,,,,,,,,,,,,,,
    <thereputic_plan openmrs_concept=\"1474^THEREPUTIC PLAN^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </thereputic_plan>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",9,10/23/2008 10:15,13,1/11/2011 15:23,0,,,,e28ad2ac-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
51,TARV: FRIDA,0.1,68,0,Registo Individual de Dispesas Medicamentos,18,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: FRIDA\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/51-0.1-68.xsn\" solutionVersion=\"0.1.0.68\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/51-68\" id=\"51\" name=\"TARV: FRIDA\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <posology openmrs_concept=\"1711^POSOLOGY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </posology>\,,,,,,,,,,,,,,,,,
    <duration openmrs_concept=\"1710^DURATION^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </duration>\,,,,,,,,,,,,,,,,,
    <quantity_prescribed openmrs_concept=\"1712^QUANTITY PRESCRIBED^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </quantity_prescribed>\,,,,,,,,,,,,,,,,,
    <pills_left_over openmrs_concept=\"1713^PILLS LEFT OVER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </pills_left_over>\,,,,,,,,,,,,,,,,,
    <adherence multiple=\"0\" openmrs_concept=\"1714^ADHERENCE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </adherence>\,,,,,,,,,,,,,,,,,
    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </medication_quantity_available>\,,,,,,,,,,,,,,,,,
    <antiretroviral_plan_-_tarv_start multiple=\"0\" openmrs_concept=\"1255^ANTIRETROVIRAL PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </antiretroviral_plan_-_tarv_start>\,,,,,,,,,,,,,,,,,
    <exit_from_arv_treatment multiple=\"0\" openmrs_concept=\"1708^EXIT FROM ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </exit_from_arv_treatment>\,,,,,,,,,,,,,,,,,
    <current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^CURRENT ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_antiretroviral_drugs_used_for_treatment>\,,,,,,,,,,,,,,,,,
    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </historical_drug_start_date>\,,,,,,,,,,,,,,,,,
    <return_visit_date openmrs_concept=\"5096^RETURN VISIT DATE FOR ARV DRUG^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit_date>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28ae562-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
56,"Template: MISAU header, compact",0.1,92,0,"DO NOT USE \
Header without address made as small as possible",4,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"Template: MISAU header, compact\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/56-0.1-92.xsn\" solutionVersion=\"0.1.0.92\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/56-92\" id=\"56\" name=\"Template: MISAU header, compact\" version=\"0.1\">\,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}</patient.tribe>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <return_visit_date openmrs_concept=\"5096^RETURN VISIT DATE FOR ARV DRUG^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit_date>\,,,,,,,,,,,,,,,,,
    <placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </placeholder>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28b1406-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
60,LABORATORIO GERAL,0.1,116,0,Ficha Laboratorio Todos resultados,13,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"LABORATORIO GERAL\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/60-0.1-116.xsn\" solutionVersion=\"0.1.0.116\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/60-116\" id=\"60\" name=\"LABORATORIO GERAL\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <biochemistry_laboratory_set openmrs_concept=\"1633^BIOCHEMISTRY LABORATORY SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </total_protein>\,,,,,,,,,,,,,,,,,
      <serum_albumin openmrs_concept=\"848^SERUM ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_albumin>\,,,,,,,,,,,,,,,,,
      <globulinas openmrs_concept=\"1520^GLOBULINS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </globulinas>\,,,,,,,,,,,,,,,,,
      <total_bilirubin openmrs_concept=\"655^TOTAL BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </total_bilirubin>\,,,,,,,,,,,,,,,,,
      <direct_bilirubin openmrs_concept=\"1297^DIRECT BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </direct_bilirubin>\,,,,,,,,,,,,,,,,,
      <serum_glutamic-oxaloacetic_transaminase openmrs_concept=\"653^SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glutamic-oxaloacetic_transaminase>\,,,,,,,,,,,,,,,,,
      <serum_glutamic-pyruvic_transaminase openmrs_concept=\"654^SERUM GLUTAMIC-PYRUVIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glutamic-pyruvic_transaminase>\,,,,,,,,,,,,,,,,,
      <lactate_dehydrogenase openmrs_concept=\"1014^LACTATE DEHYDROGENASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lactate_dehydrogenase>\,,,,,,,,,,,,,,,,,
      <alkaline_phosphatase openmrs_concept=\"785^ALKALINE PHOSPHATASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </alkaline_phosphatase>\,,,,,,,,,,,,,,,,,
      <amylase openmrs_concept=\"1299^AMYLASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </amylase>\,,,,,,,,,,,,,,,,,
      <total_cholesterol openmrs_concept=\"1006^TOTAL CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </total_cholesterol>\,,,,,,,,,,,,,,,,,
      <high-density_lipoprotein_cholesterol openmrs_concept=\"1007^HIGH-DENSITY LIPOPROTEIN CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </high-density_lipoprotein_cholesterol>\,,,,,,,,,,,,,,,,,
      <low-density_lipoprotein_cholesterol openmrs_concept=\"1008^LOW-DENSITY LIPOPROTEIN CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </low-density_lipoprotein_cholesterol>\,,,,,,,,,,,,,,,,,
      <creatine_kinase openmrs_concept=\"1011^CREATINE KINASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </creatine_kinase>\,,,,,,,,,,,,,,,,,
      <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_creatinine>\,,,,,,,,,,,,,,,,,
      <gamma_glutamyl_transferase openmrs_concept=\"2077^GAMMA GLUTAMYL TRANSFERASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gamma_glutamyl_transferase>\,,,,,,,,,,,,,,,,,
      <serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glucose>\,,,,,,,,,,,,,,,,,
      <serum_lactate openmrs_concept=\"1012^SERUM LACTATE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_lactate>\,,,,,,,,,,,,,,,,,
      <serum_lipase openmrs_concept=\"1013^SERUM LIPASE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_lipase>\,,,,,,,,,,,,,,,,,
      <triglycerides openmrs_concept=\"1009^TRIGLYCERIDES^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </triglycerides>\,,,,,,,,,,,,,,,,,
      <blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </blood_urea_nitrogen>\,,,,,,,,,,,,,,,,,
      <serum_chloride openmrs_concept=\"1134^SERUM CHLORIDE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_chloride>\,,,,,,,,,,,,,,,,,
      <serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_potassium>\,,,,,,,,,,,,,,,,,
      <serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_sodium>\,,,,,,,,,,,,,,,,,
    </biochemistry_laboratory_set>\,,,,,,,,,,,,,,,,,
    <hemogram_kx21n openmrs_concept=\"1723^HEMOGRAM KX21N^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hemoglobin>\,,,,,,,,,,,,,,,,,
      <hematocrit openmrs_concept=\"1015^HEMATOCRIT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hematocrit>\,,,,,,,,,,,,,,,,,
      <mean_corpuscular_volume openmrs_concept=\"851^MEAN CORPUSCULAR VOLUME^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mean_corpuscular_volume>\,,,,,,,,,,,,,,,,,
      <platelets openmrs_concept=\"729^PLATELETS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </platelets>\,,,,,,,,,,,,,,,,,
      <white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </white_blood_cells>\,,,,,,,,,,,,,,,,,
      <absolute_neutrophil_count openmrs_concept=\"1330^ABSOLUTE NEUTROPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </absolute_neutrophil_count>\,,,,,,,,,,,,,,,,,
      <lymphocytes openmrs_concept=\"1021^LYMPHOCYTES^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymphocytes>\,,,,,,,,,,,,,,,,,
      <neutrophils openmrs_concept=\"1022^NEUTROPHILS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </neutrophils>\,,,,,,,,,,,,,,,,,
      <absolute_lymphocyte_count openmrs_concept=\"952^ABSOLUTE LYMPHOCYTE COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </absolute_lymphocyte_count>\,,,,,,,,,,,,,,,,,
      <eosinophils openmrs_concept=\"1024^EOSINOPHILS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </eosinophils>\,,,,,,,,,,,,,,,,,
      <absolute_eosinophil_count openmrs_concept=\"1332^ABSOLUTE EOSINOPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </absolute_eosinophil_count>\,,,,,,,,,,,,,,,,,
      <basophils openmrs_concept=\"1025^BASOPHILS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </basophils>\,,,,,,,,,,,,,,,,,
      <absolute_basophil_count openmrs_concept=\"1333^ABSOLUTE BASOPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </absolute_basophil_count>\,,,,,,,,,,,,,,,,,
      <monocytes openmrs_concept=\"1023^MONOCYTES^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </monocytes>\,,,,,,,,,,,,,,,,,
      <absolute_monocyte_count openmrs_concept=\"1331^ABSOLUTE MONOCYTE COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </absolute_monocyte_count>\,,,,,,,,,,,,,,,,,
      <red_blood_cells openmrs_concept=\"679^RED BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </red_blood_cells>\,,,,,,,,,,,,,,,,,
      <mean_cell_hemoglobin_concentration openmrs_concept=\"1017^MEAN CELL HEMOGLOBIN CONCENTRATION^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mean_cell_hemoglobin_concentration>\,,,,,,,,,,,,,,,,,
      <mean_corpuscular_hemoglobin openmrs_concept=\"1018^MEAN CORPUSCULAR HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mean_corpuscular_hemoglobin>\,,,,,,,,,,,,,,,,,
      <red_cell_distribution_width openmrs_concept=\"1016^RED CELL DISTRIBUTION WIDTH^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </red_cell_distribution_width>\,,,,,,,,,,,,,,,,,
      <erythrocyte_sedimentation_rate openmrs_concept=\"855^ERYTHROCYTE SEDIMENTATION RATE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </erythrocyte_sedimentation_rate>\,,,,,,,,,,,,,,,,,
      <blood_typing multiple=\"0\" openmrs_concept=\"300^BLOOD TYPING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </blood_typing>\,,,,,,,,,,,,,,,,,
      <mean_platelet_volume openmrs_concept=\"1307^MEAN PLATELET VOLUME^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mean_platelet_volume>\,,,,,,,,,,,,,,,,,
      <vdrl multiple=\"0\" openmrs_concept=\"299^VDRL^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </vdrl>\,,,,,,,,,,,,,,,,,
    </hemogram_kx21n>\,,,,,,,,,,,,,,,,,
    <serum_laboratory_set openmrs_concept=\"1640^SERUM LABORATORY SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </blood_urea_nitrogen>\,,,,,,,,,,,,,,,,,
      <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_creatinine>\,,,,,,,,,,,,,,,,,
      <serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_sodium>\,,,,,,,,,,,,,,,,,
      <serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_potassium>\,,,,,,,,,,,,,,,,,
      <serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </serum_glucose>\,,,,,,,,,,,,,,,,,
    </serum_laboratory_set>\,,,,,,,,,,,,,,,,,
    <immunology openmrs_concept=\"1639^IMMUNOLOGY^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </rapid_plasma_reagin>\,,,,,,,,,,,,,,,,,
      <immuno_globulin_hiv openmrs_concept=\"1519^IMMUNO GLOBULIN HIV^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </immuno_globulin_hiv>\,,,,,,,,,,,,,,,,,
      <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cd4_count>\,,,,,,,,,,,,,,,,,
      <cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </cd4_percent>\,,,,,,,,,,,,,,,,,
    </immunology>\,,,,,,,,,,,,,,,,,
    <virology_tests openmrs_concept=\"1632^VIROLOGY TESTS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_viral_load>\,,,,,,,,,,,,,,,,,
      <hiv_viral_load_log openmrs_concept=\"1518^HIV VIRAL LOAD LOG^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_viral_load_log>\,,,,,,,,,,,,,,,,,
      <viral_load_exam_type multiple=\"0\" openmrs_concept=\"1574^VIRAL LOAD EXAM TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </viral_load_exam_type>\,,,,,,,,,,,,,,,,,
      <hiv_viral_load_qualitative multiple=\"0\" openmrs_concept=\"1305^HIV VIRAL LOAD, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_viral_load_qualitative>\,,,,,,,,,,,,,,,,,
    </virology_tests>\,,,,,,,,,,,,,,,,,
    <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_dna_polymerase_chain_reaction_qualitative>\,,,,,,,,,,,,,,,,,
    <pediatric_urinalysis multiple=\"1\" openmrs_concept=\"1619^PEDIATRIC URINALYSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <urina_piocytes openmrs_concept=\"1525^URINA PIOCYTES^99DCT\">false</urina_piocytes>\,,,,,,,,,,,,,,,,,
        <urine_erithrocytes openmrs_concept=\"1523^URINE ERITHROCYTES^99DCT\">false</urine_erithrocytes>\,,,,,,,,,,,,,,,,,
        <urine_leucocytes openmrs_concept=\"1522^URINE LEUCOCYTES^99DCT\">false</urine_leucocytes>\,,,,,,,,,,,,,,,,,
        <epithelial_cells openmrs_concept=\"666^EPITHELIAL CELLS^99DCT\">false</epithelial_cells>\,,,,,,,,,,,,,,,,,
        <urine_cilinders openmrs_concept=\"1524^URINE CILINDERS^99DCT\">false</urine_cilinders>\,,,,,,,,,,,,,,,,,
    </pediatric_urinalysis>\,,,,,,,,,,,,,,,,,
    <parasitology_feces multiple=\"0\" openmrs_concept=\"1635^PARASITOLOGY, FECES^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </parasitology_feces>\,,,,,,,,,,,,,,,,,
    <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </serum_creatinine>\,,,,,,,,,,,,,,,,,
    <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </sputum_for_acid_fast_bacilli>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",2,10/31/2008 11:06,13,1/11/2011 15:23,0,,,,e28b23a6-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
62,TARV: RASTREIO DE TUBERCULOSE,0.1,60,0,Formulario de restrio de casos de suspeita de tuberculose em doentes com HIV,20,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: RASTREIO DE TUBERCULOSE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/62-0.1-60.xsn\" solutionVersion=\"0.1.0.60\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/62-60\" id=\"62\" name=\"TARV: RASTREIO DE TUBERCULOSE\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <tb_observations multiple=\"1\" openmrs_concept=\"1766^TB OBSERVATIONS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <nightsweats_lasting_more_than_3_weeks openmrs_concept=\"1762^NIGHTSWEATS LASTING MORE THAN 3 WEEKS^99DCT\">false</nightsweats_lasting_more_than_3_weeks>\,,,,,,,,,,,,,,,,,
        <cough_lasting_more_than_3_weeks openmrs_concept=\"1760^COUGH LASTING MORE THAN 3 WEEKS^99DCT\">false</cough_lasting_more_than_3_weeks>\,,,,,,,,,,,,,,,,,
        <weight_loss_of_more_than_3_kg_in_last_month openmrs_concept=\"1764^WEIGHT LOSS OF MORE THAN 3 KG IN LAST MONTH^99DCT\">false</weight_loss_of_more_than_3_kg_in_last_month>\,,,,,,,,,,,,,,,,,
        <coughing_up_blood openmrs_concept=\"1761^COUGHING UP BLOOD^99DCT\">false</coughing_up_blood>\,,,,,,,,,,,,,,,,,
        <fever_lasting_more_than_3_weeks openmrs_concept=\"1763^FEVER LASTING MORE THAN 3 WEEKS^99DCT\">false</fever_lasting_more_than_3_weeks>\,,,,,,,,,,,,,,,,,
        <cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false</cohabitant_being_treated_for_tb>\,,,,,,,,,,,,,,,,,
    </tb_observations>\,,,,,,,,,,,,,,,,,
    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </tubuculosis_exams>\,,,,,,,,,,,,,,,,,
      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </sputum_for_acid_fast_bacilli>\,,,,,,,,,,,,,,,,,
      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </x-ray_chest>\,,,,,,,,,,,,,,,,,
      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ultrasound_tb>\,,,,,,,,,,,,,,,,,
      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymph_node_biopsy>\,,,,,,,,,,,,,,,,,
      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </paracentesis>\,,,,,,,,,,,,,,,,,
      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </thoracentesis>\,,,,,,,,,,,,,,,,,
      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </purified_protein_derivative>\,,,,,,,,,,,,,,,,,
      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gastric_levage>\,,,,,,,,,,,,,,,,,
      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </test_other>\,,,,,,,,,,,,,,,,,
    </tuberculosis_exams_set>\,,,,,,,,,,,,,,,,,
    <does_patient_have_tuberculosis multiple=\"0\" openmrs_concept=\"1785^DOES PATIENT HAVE TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </does_patient_have_tuberculosis>\,,,,,,,,,,,,,,,,,
    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </type_of_tuberculosis>\,,,,,,,,,,,,,,,,,
    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_drug_treatment_start_date>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_tuberculosis_treatment_stopped>\,,,,,,,,,,,,,,,,,
    <tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
    </tuberculosis_prophylaxis_started>\,,,,,,,,,,,,,,,,,
    <reason_tuberculosis_prophylaxis_stopped multiple=\"0\" openmrs_concept=\"1266^REASON TUBERCULOSIS PROPHYLAXIS STOPPED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_tuberculosis_prophylaxis_stopped>\,,,,,,,,,,,,,,,,,
    <service_providing_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1783^SERVICE PROVIDING TUBERCULOSIS TREATMENT ^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </service_providing_tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
    <service_providing_prophylaxis_treatment multiple=\"0\" openmrs_concept=\"1786^SERVICE PROVIDING PROPHYLAXIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </service_providing_prophylaxis_treatment>\,,,,,,,,,,,,,,,,,
    <tuberculosis_drug_treatment_end_date openmrs_concept=\"6120^TUBERCULOSIS DRUG TREATMENT END DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_drug_treatment_end_date>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </isoniazid_use>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/26/2011 17:28,0,,,,e28b2fb8-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
63,TARV: ACONSELHAMENTO,1,73,0,Ficha de aconselhamento Pr-TARV,19,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: ACONSELHAMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/63-1-73.xsn\" solutionVersion=\"1.0.0.73\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/63-73\" id=\"63\" name=\"TARV: ACONSELHAMENTO\" version=\"1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <counseling_session_number openmrs_concept=\"1724^COUNSELING SESSION NUMBER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </counseling_session_number>\,,,,,,,,,,,,,,,,,
    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_who_hiv_stage>\,,,,,,,,,,,,,,,,,
    <cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cd4_absolute_obs>\,,,,,,,,,,,,,,,,,
    <who_slash_cdc_staging_criteria_met multiple=\"0\" openmrs_concept=\"1248^WHO/CDC STAGING CRITERIA MET^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </who_slash_cdc_staging_criteria_met>\,,,,,,,,,,,,,,,,,
    <date_of_counseling_session openmrs_concept=\"1758^DATE OF COUNSELING SESSION^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_counseling_session>\,,,,,,,,,,,,,,,,,
    <counseling_session multiple=\"0\" openmrs_concept=\"1727^COUNSELING SESSION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </counseling_session>\,,,,,,,,,,,,,,,,,
    <confidante_present multiple=\"0\" openmrs_concept=\"1728^CONFIDANTE PRESENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </confidante_present>\,,,,,,,,,,,,,,,,,
    <patient_understands_treatment_concepts multiple=\"0\" openmrs_concept=\"1729^PATIENT UNDERSTANDS TREATMENT CONCEPTS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_understands_treatment_concepts>\,,,,,,,,,,,,,,,,,
    <date_of_evaluation openmrs_concept=\"1730^DATE OF EVALUATION^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_evaluation>\,,,,,,,,,,,,,,,,,
    <patient_knowledge_of_hiv_contraction openmrs_concept=\"1731^PATIENT KNOWLEDGE OF HIV CONTRACTION^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_knowledge_of_hiv_contraction>\,,,,,,,,,,,,,,,,,
    <patient_knowledge_of_effect_of_hiv openmrs_concept=\"1732^PATIENT KNOWLEDGE OF EFFECT OF HIV^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_knowledge_of_effect_of_hiv>\,,,,,,,,,,,,,,,,,
    <patient_understands_purpose_of_cd4 openmrs_concept=\"1733^PATIENT UNDERSTANDS PURPOSE OF CD4^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_understands_purpose_of_cd4>\,,,,,,,,,,,,,,,,,
    <patient_understands_importance_of_adherence openmrs_concept=\"1734^PATIENT UNDERSTANDS IMPORTANCE OF ADHERENCE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_understands_importance_of_adherence>\,,,,,,,,,,,,,,,,,
    <patient_knowledge_of_treatment_duration openmrs_concept=\"1735^PATIENT KNOWLEDGE OF TREATMENT DURATION^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_knowledge_of_treatment_duration>\,,,,,,,,,,,,,,,,,
    <is_the_patient_interested_in_taking_arv multiple=\"0\" openmrs_concept=\"1736^IS THE PATIENT INTERESTED IN TAKING ARV^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_the_patient_interested_in_taking_arv>\,,,,,,,,,,,,,,,,,
    <did_the_patient_sign_the_consent_form multiple=\"0\" openmrs_concept=\"1738^DID THE PATIENT SIGN THE CONSENT FORM^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </did_the_patient_sign_the_consent_form>\,,,,,,,,,,,,,,,,,
    <did_the_patient_present_a_confidant multiple=\"0\" openmrs_concept=\"1739^DID THE PATIENT PRESENT A CONFIDANT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </did_the_patient_present_a_confidant>\,,,,,,,,,,,,,,,,,
    <confidant_name openmrs_concept=\"1740^CONFIDANT NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </confidant_name>\,,,,,,,,,,,,,,,,,
    <confidant_relation_to_candidate openmrs_concept=\"1741^CONFIDANT RELATION TO CANDIDATE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </confidant_relation_to_candidate>\,,,,,,,,,,,,,,,,,
    <does_the_confidant_live_in_the_patients_home multiple=\"0\" openmrs_concept=\"1742^DOES THE CONFIDANT LIVE IN THE PATIENTS HOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </does_the_confidant_live_in_the_patients_home>\,,,,,,,,,,,,,,,,,
    <confidant_contact openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </confidant_contact>\,,,,,,,,,,,,,,,,,
    <can_the_patient_visit_the_hospital_regularly_to_continue_arv_treatment multiple=\"0\" openmrs_concept=\"1743^CAN THE PATIENT VISIT THE HOSPITAL REGULARLY TO CONTINUE ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </can_the_patient_visit_the_hospital_regularly_to_continue_arv_treatment>\,,,,,,,,,,,,,,,,,
    <distance_from_patients_home_to_the_hospital multiple=\"0\" openmrs_concept=\"1747^DISTANCE FROM PATIENTS HOME TO THE HOSPITAL^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </distance_from_patients_home_to_the_hospital>\,,,,,,,,,,,,,,,,,
    <transportation_problems multiple=\"0\" openmrs_concept=\"1737^TRANSPORTATION PROBLEMS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </transportation_problems>\,,,,,,,,,,,,,,,,,
    <problems_with_food_security multiple=\"0\" openmrs_concept=\"1759^PROBLEMS WITH FOOD SECURITY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </problems_with_food_security>\,,,,,,,,,,,,,,,,,
    <other_problems openmrs_concept=\"1748^OTHER PROBLEMS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_problems>\,,,,,,,,,,,,,,,,,
    <arv_adherence_risk multiple=\"0\" openmrs_concept=\"1749^ARV ADHERENCE RISK^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </arv_adherence_risk>\,,,,,,,,,,,,,,,,,
    <drug_habits multiple=\"1\" openmrs_concept=\"1389^DRUG HABIT(S)^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <tobacco openmrs_concept=\"1388^TOBACCO^99DCT\">false</tobacco>\,,,,,,,,,,,,,,,,,
        <alcohol_use openmrs_concept=\"1603^ALCOHOL USE^99DCT\">false</alcohol_use>\,,,,,,,,,,,,,,,,,
        <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\,,,,,,,,,,,,,,,,,
    </drug_habits>\,,,,,,,,,,,,,,,,,
    <does_the_patient_suffer_from_depression multiple=\"0\" openmrs_concept=\"1750^DOES THE PATIENT SUFFER FROM DEPRESSION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </does_the_patient_suffer_from_depression>\,,,,,,,,,,,,,,,,,
    <history_of_poor_adherence openmrs_concept=\"1751^HISTORY OF POOR ADHERENCE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </history_of_poor_adherence>\,,,,,,,,,,,,,,,,,
    <does_the_patient_understand_the_regimen_of_treatment multiple=\"0\" openmrs_concept=\"1752^DOES THE PATIENT UNDERSTAND THE REGIMEN OF TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </does_the_patient_understand_the_regimen_of_treatment>\,,,,,,,,,,,,,,,,,
    <patient_understands_arv_medicines_and_schedules openmrs_concept=\"1753^PATIENT UNDERSTANDS ARV MEDICINES AND SCHEDULES^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_understands_arv_medicines_and_schedules>\,,,,,,,,,,,,,,,,,
    <patient_understands_missed_arv_dose_and_vomiting openmrs_concept=\"1754^PATIENT UNDERSTANDS MISSED ARV DOSE AND VOMITING^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_understands_missed_arv_dose_and_vomiting>\,,,,,,,,,,,,,,,,,
    <patient_understands_arv_side_effects openmrs_concept=\"1755^PATIENT UNDERSTANDS ARV SIDE EFFECTS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_understands_arv_side_effects>\,,,,,,,,,,,,,,,,,
    <is_the_patient_ready_to_take_arv_drugs multiple=\"0\" openmrs_concept=\"1756^IS THE PATIENT READY TO TAKE ARV DRUGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_the_patient_ready_to_take_arv_drugs>\,,,,,,,,,,,,,,,,,
    <comments_of_the_counselor openmrs_concept=\"1757^COMMENTS OF THE COUNSELOR^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </comments_of_the_counselor>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",9,11/6/2008 11:20,13,1/11/2011 15:24,0,,,,e28b3b52-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
65,TARV: SOLICITACAO,0.1,57,0,Ficha de Solicitao de Medicamentos ARV,17,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: SOLICITACAO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/65-0.1-57.xsn\" solutionVersion=\"0.1.0.57\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/65-57\" id=\"65\" name=\"TARV: SOLICITACAO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </name_of_mother>\,,,,,,,,,,,,,,,,,
    <patient_notified_of_tarv_details openmrs_concept=\"1592^PATIENT NOTIFIED OF TARV DETAILS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_notified_of_tarv_details>\,,,,,,,,,,,,,,,,,
    <arv_treatment_plan openmrs_concept=\"1795^ARV TREATMENT PLAN^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^CURRENT ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </current_antiretroviral_drugs_used_for_treatment>\,,,,,,,,,,,,,,,,,
      <arv_dosage_amount openmrs_concept=\"1793^ARV DOSAGE AMOUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </arv_dosage_amount>\,,,,,,,,,,,,,,,,,
      <arv_frequency openmrs_concept=\"1794^ARV FREQUENCY^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </arv_frequency>\,,,,,,,,,,,,,,,,,
    </arv_treatment_plan>\,,,,,,,,,,,,,,,,,
    <patient_has_exibited_symptoms_of_hiv_infection multiple=\"0\" openmrs_concept=\"1591^PATIENT HAS EXIBITED SYMPTOMS OF HIV INFECTION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_has_exibited_symptoms_of_hiv_infection>\,,,,,,,,,,,,,,,,,
    <patient_catagory_for_tarv_request multiple=\"0\" openmrs_concept=\"1585^PATIENT CATAGORY FOR TARV REQUEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_catagory_for_tarv_request>\,,,,,,,,,,,,,,,,,
    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
    <nevaripin_used_during_delivery multiple=\"0\" openmrs_concept=\"1583^NEVARIPIN USED DURING DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </nevaripin_used_during_delivery>\,,,,,,,,,,,,,,,,,
    <patient_reported_current_pcp_prophylaxis multiple=\"0\" openmrs_concept=\"1109^PATIENT REPORTED CURRENT PCP PROPHYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_reported_current_pcp_prophylaxis>\,,,,,,,,,,,,,,,,,
    <rifampicin_use multiple=\"0\" openmrs_concept=\"1582^RIFAMPICIN USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </rifampicin_use>\,,,,,,,,,,,,,,,,,
    <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cd4_count>\,,,,,,,,,,,,,,,,,
    <cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cd4_percent>\,,,,,,,,,,,,,,,,,
    <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_viral_load>\,,,,,,,,,,,,,,,,,
    <viral_load_exam_type multiple=\"0\" openmrs_concept=\"1574^VIRAL LOAD EXAM TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </viral_load_exam_type>\,,,,,,,,,,,,,,,,,
    <months_perscription_is_valid openmrs_concept=\"1290^MONTHS PERSCRIPTION IS VALID^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </months_perscription_is_valid>\,,,,,,,,,,,,,,,,,
    <justification_for_two_months_of_arv_medication openmrs_concept=\"1291^JUSTIFICATION FOR TWO MONTHS OF ARV MEDICATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </justification_for_two_months_of_arv_medication>\,,,,,,,,,,,,,,,,,
    <clinical_hiv_manifestations multiple=\"1\" openmrs_concept=\"1788^CLINICAL HIV MANIFESTATIONS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\,,,,,,,,,,,,,,,,,
        <mac openmrs_concept=\"1796^MAC^99DCT\">false</mac>\,,,,,,,,,,,,,,,,,
        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\,,,,,,,,,,,,,,,,,
        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_lymphoma_brain openmrs_concept=\"5040^HIV STAGING - LYMPHOMA, BRAIN^99DCT\">false</hiv_staging_-_lymphoma_brain>\,,,,,,,,,,,,,,,,
        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false</hiv_staging_-_adult_herpes_zoster>\,,,,,,,,,,,,,,,,,
        <toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false</toxoplasmosis>\,,,,,,,,,,,,,,,,,
        <cryptococcosis openmrs_concept=\"1219^CRYPTOCOCCOSIS^99DCT\">false</cryptococcosis>\,,,,,,,,,,,,,,,,,
        <tuberculosis openmrs_concept=\"58^TUBERCULOSIS^99DCT\">false</tuberculosis>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false</hiv_staging_-_cryptosporidiosis>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_histoplasmosis_disseminated openmrs_concept=\"5038^HIV STAGING - HISTOPLASMOSIS, DISSEMINATED^99DCT\">false</hiv_staging_-_histoplasmosis_disseminated>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_infant_cytomegalovirus openmrs_concept=\"5017^HIV STAGING - INFANT CYTOMEGALOVIRUS^99DCT\">false</hiv_staging_-_infant_cytomegalovirus>\,,,,,,,,,,,,,,,,,
    </clinical_hiv_manifestations>\,,,,,,,,,,,,,,,,,
    <justification_to_change_arv_treatment multiple=\"0\" openmrs_concept=\"1792^JUSTIFICATION TO CHANGE ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </justification_to_change_arv_treatment>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28b5c54-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
67,ADULTO: PROCESSO PARTE A - ANAMNESE,1.1,157,1,Processo de Hospital de Dia 1/2,5,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ADULTO: PROCESSO PARTE A - ANAMNESE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/67-1.1-157.xsn\" solutionVersion=\"1.1.0.157\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/67-157\" id=\"67\" name=\"ADULTO: PROCESSO PARTE A - ANAMNESE\" version=\"1.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}</patient_address.city>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_name>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_surname>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_telephone_number>\,,,,,,,,,,,,,,,,,
    </personal_reference>\,,,,,,,,,,,,,,,,,
    <other_personal_information openmrs_concept=\"1657^OTHER PERSONAL INFORMATION^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <occupation openmrs_concept=\"1459^OCCUPATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </occupation>\,,,,,,,,,,,,,,,,,
      <level_of_education multiple=\"0\" openmrs_concept=\"1443^LEVEL OF EDUCATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </level_of_education>\,,,,,,,,,,,,,,,,,
      <number_of_household_members openmrs_concept=\"1656^NUMBER OF HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_household_members>\,,,,,,,,,,,,,,,,,
    </other_personal_information>\,,,,,,,,,,,,,,,,,
    <civil_information_for_hiv_postitive_patients openmrs_concept=\"1659^CIVIL INFORMATION FOR HIV POSTITIVE PATIENTS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <civil_status multiple=\"0\" openmrs_concept=\"1054^CIVIL STATUS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </civil_status>\,,,,,,,,,,,,,,,,,
      <number_of_wives openmrs_concept=\"5557^NUMBER OF WIVES^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_wives>\,,,,,,,,,,,,,,,,,
      <hiv_status_of_wives multiple=\"0\" openmrs_concept=\"1449^HIV STATUS OF WIVES^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_status_of_wives>\,,,,,,,,,,,,,,,,,
      <patient_id_of_hiv_positive_wife openmrs_concept=\"1450^PATIENT ID OF HIV POSITIVE WIFE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_id_of_hiv_positive_wife>\,,,,,,,,,,,,,,,,,
      <other_partners openmrs_concept=\"1451^OTHER PARTNERS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </other_partners>\,,,,,,,,,,,,,,,,,
      <number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_children>\,,,,,,,,,,,,,,,,,
      <number_of_children_tested_for_hiv openmrs_concept=\"1452^NUMBER OF CHILDREN TESTED FOR HIV^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_children_tested_for_hiv>\,,,,,,,,,,,,,,,,,
      <number_of_hiv_positive_children openmrs_concept=\"1453^NUMBER OF HIV POSITIVE CHILDREN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_hiv_positive_children>\,,,,,,,,,,,,,,,,,
      <patient_id_for_hiv_positive_children openmrs_concept=\"1454^PATIENT ID FOR HIV POSITIVE CHILDREN^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_id_for_hiv_positive_children>\,,,,,,,,,,,,,,,,,
    </civil_information_for_hiv_postitive_patients>\,,,,,,,,,,,,,,,,,
    <social_status openmrs_concept=\"1660^SOCIAL STATUS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <refrigerator_in_home multiple=\"0\" openmrs_concept=\"1455^REFRIGERATOR IN HOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </refrigerator_in_home>\,,,,,,,,,,,,,,,,,
      <home_electricity multiple=\"0\" openmrs_concept=\"5609^HOME ELECTRICITY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </home_electricity>\,,,,,,,,,,,,,,,,,
    </social_status>\,,,,,,,,,,,,,,,,,
    <entry_point_into_hiv_care_set openmrs_concept=\"1625^ENTRY POINT INTO HIV CARE, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </entry_point_into_hiv_care_referal_type>\,,,,,,,,,,,,,,,,,
      <entry_point_into_hiv_care_location_name openmrs_concept=\"1626^ENTRY POINT INTO HIV CARE, LOCATION NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </entry_point_into_hiv_care_location_name>\,,,,,,,,,,,,,,,,,
      <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </entry_point_into_hiv_care_patient_code_at_location>\,,,,,,,,,,,,,,,,,
    </entry_point_into_hiv_care_set>\,,,,,,,,,,,,,,,,,
    <hiv_diagnostics openmrs_concept=\"1661^HIV DIAGNOSTICS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </is_patient_hiv_positive>\,,,,,,,,,,,,,,,,,
      <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_received_counceling>\,,,,,,,,,,,,,,,,,
    </hiv_diagnostics>\,,,,,,,,,,,,,,,,,
    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_counceling>\,,,,,,,,,,,,,,,,,
    <drug_habits multiple=\"1\" openmrs_concept=\"1389^DRUG HABIT(S)^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <tobacco openmrs_concept=\"1388^TOBACCO^99DCT\">false</tobacco>\,,,,,,,,,,,,,,,,,
        <alcohol_use openmrs_concept=\"1603^ALCOHOL USE^99DCT\">false</alcohol_use>\,,,,,,,,,,,,,,,,,
        <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\,,,,,,,,,,,,,,,,,
    </drug_habits>\,,,,,,,,,,,,,,,,,
    <sexual_preference multiple=\"0\" openmrs_concept=\"1375^SEXUAL PREFERENCE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </sexual_preference>\,,,,,,,,,,,,,,,,,
    <number_of_sexual_partners_in_the_last_3_months multiple=\"0\" openmrs_concept=\"1666^NUMBER OF SEXUAL PARTNERS IN THE LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_sexual_partners_in_the_last_3_months>\,,,,,,,,,,,,,,,,,
    <gynacological_history openmrs_concept=\"1393^GYNACOLOGICAL HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <gravida openmrs_concept=\"5624^GRAVIDA^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gravida>\,,,,,,,,,,,,,,,,,
      <gpav_para openmrs_concept=\"1392^GPAV PARA^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gpav_para>\,,,,,,,,,,,,,,,,,
      <gpav_aborted openmrs_concept=\"1390^GPAV ABORTED^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gpav_aborted>\,,,,,,,,,,,,,,,,,
      <gpav_vivos openmrs_concept=\"1391^GPAV VIVOS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gpav_vivos>\,,,,,,,,,,,,,,,,,
      <antecedentes_ginecologicos_outros openmrs_concept=\"1394^GYNECOLOGICAL HISTORY, OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </antecedentes_ginecologicos_outros>\,,,,,,,,,,,,,,,,,
      <date_of_last_menstration openmrs_concept=\"1465^DATE OF LAST MENSTRATION^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </date_of_last_menstration>\,,,,,,,,,,,,,,,,,
    </gynacological_history>\,,,,,,,,,,,,,,,,,
    <obstectric_history openmrs_concept=\"1668^OBSTECTRIC HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prior_abortion multiple=\"0\" openmrs_concept=\"1667^PRIOR ABORTION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prior_abortion>\,,,,,,,,,,,,,,,,,
      <tratamento_ptv multiple=\"0\" openmrs_concept=\"1466^PMTCT TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </tratamento_ptv>\,,,,,,,,,,,,,,,,,
      <tratamento_ptv_quais multiple=\"0\" openmrs_concept=\"1467^PMTCT TREATMENT, SPECIFIC^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </tratamento_ptv_quais>\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
            <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
            <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
      <pregnancy_due_date openmrs_concept=\"1600^PREGNANCY DUE DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pregnancy_due_date>\,,,,,,,,,,,,,,,,,
      <prior_delivery_date openmrs_concept=\"5599^PRIOR DELIVERY DATE^99DCT\" openmrs_datatype=\"TS\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prior_delivery_date>\,,,,,,,,,,,,,,,,,
      <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pregant>\,,,,,,,,,,,,,,,,,
    </obstectric_history>\,,,,,,,,,,,,,,,,,
    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </infant_feeding_method>\,,,,,,,,,,,,,,,,,
    <allergies_to_medicine openmrs_concept=\"1669^ALLERGIES TO MEDICINE^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <medication_allergy multiple=\"0\" openmrs_concept=\"1601^MEDICATION ALLERGY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </medication_allergy>\,,,,,,,,,,,,,,,,,
      <medication_allergies multiple=\"0\" openmrs_concept=\"1605^MEDICATION ALLERGIES^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </medication_allergies>\,,,,,,,,,,,,,,,,,
      <medication_allergy_specific_non_coded openmrs_concept=\"1517^MEDICATION ALLERGY SPECIFIC NON CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </medication_allergy_specific_non_coded>\,,,,,,,,,,,,,,,,,
    </allergies_to_medicine>\,,,,,,,,,,,,,,,,,
    <antiretroviral_use multiple=\"0\" openmrs_concept=\"1192^ANTIRETROVIRAL USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </antiretroviral_use>\,,,,,,,,,,,,,,,,,
    <previous_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1087^PREVIOUS ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </previous_antiretroviral_drugs_used_for_treatment>\,,,,,,,,,,,,,,,,,
    <adult_clinical_history multiple=\"0\" openmrs_concept=\"1670^ADULT CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </adult_clinical_history>\,,,,,,,,,,,,,,,,,
    <clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </clinical_history_not_coded>\,,,,,,,,,,,,,,,,,
    <hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hospital_slash_clinic>\,,,,,,,,,,,,,,,,,
      <diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </diagnosis_for_hospitalization>\,,,,,,,,,,,,,,,,,
      <date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </date_of_hospital_stay_entry>\,,,,,,,,,,,,,,,,,
      <data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </data_of_hospital_stay_exit>\,,,,,,,,,,,,,,,,,
      <hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hosptal_treatment>\,,,,,,,,,,,,,,,,,
    </hospitalizations>\,,,,,,,,,,,,,,,,,
    <hiv_exposure_adult_set openmrs_concept=\"1688^HIV EXPOSURE ADULT, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <hiv_exposure_through_surgery multiple=\"0\" openmrs_concept=\"1685^HIV EXPOSURE THROUGH SURGERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_exposure_through_surgery>\,,,,,,,,,,,,,,,,,
      <description_of_surgical_intervention openmrs_concept=\"1473^DESCRIPTION OF SURGICAL INTERVENTION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </description_of_surgical_intervention>\,,,,,,,,,,,,,,,,,
      <hiv_exposure_through_blood_transfusion multiple=\"0\" openmrs_concept=\"1686^HIV EXPOSURE THROUGH BLOOD TRANSFUSION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_exposure_through_blood_transfusion>\,,,,,,,,,,,,,,,,,
      <hiv_exposure_through_accident multiple=\"0\" openmrs_concept=\"1687^HIV EXPOSURE THROUGH ACCIDENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_exposure_through_accident>\,,,,,,,,,,,,,,,,,
      <description_of_accident openmrs_concept=\"1435^DESCRIPTION OF ACCIDENT^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </description_of_accident>\,,,,,,,,,,,,,,,,,
      <method_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1061^METHOD OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <suspected_past_hiv_exposure openmrs_concept=\"1062^SUSPECTED PAST HIV EXPOSURE^99DCT\">false</suspected_past_hiv_exposure>\,,,,,,,,,,,,,,,,,
            <blood_transfusion openmrs_concept=\"1063^BLOOD TRANSFUSION^99DCT\">false</blood_transfusion>\,,,,,,,,,,,,,,,,,
            <spouses_partner_suspected_hiv openmrs_concept=\"5564^SPOUSES PARTNER SUSPECTED HIV+^99DCT\">false</spouses_partner_suspected_hiv>\,,,,,,,,,,,,,,,,,
            <contaminated_needle_stick openmrs_concept=\"181^CONTAMINATED NEEDLE STICK^99DCT\">false</contaminated_needle_stick>\,,,,,,,,,,,,,,,,,
            <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\,,,,,,,,,,,,,,,,,
            <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
            <unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false</unknown>\,,,,,,,,,,,,,,,,,
            <injections openmrs_concept=\"1507^INJECTIONS^99DCT\">false</injections>\,,,,,,,,,,,,,,,,,
            <surgical_intervention openmrs_concept=\"1472^SURGICAL INTERVENTION^99DCT\">false</surgical_intervention>\,,,,,,,,,,,,,,,,,
            <dental_extraction openmrs_concept=\"1508^DENTAL EXTRACTION^99DCT\">false</dental_extraction>\,,,,,,,,,,,,,,,,,
            <scarrification openmrs_concept=\"1509^SCARRIFICATION^99DCT\">false</scarrification>\,,,,,,,,,,,,,,,,,
            <accidental_exposure openmrs_concept=\"1433^ACCIDENTAL EXPOSURE^99DCT\">false</accidental_exposure>\,,,,,,,,,,,,,,,,,
      </method_of_hiv_exposure>\,,,,,,,,,,,,,,,,,
    </hiv_exposure_adult_set>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",271,11/14/2008 13:46,271,5/15/2018 14:32,0,,,,e28b6096-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
68,PEDIATRIA: PROCESSO PARTE A - ANAMNESE,1.1,110,1,Processo de Hospital de Dia Pediatria 1/2,7,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PEDIATRIA: PROCESSO PARTE A - ANAMNESE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/68-1.1-110.xsn\" solutionVersion=\"1.1.0.110\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/68-110\" id=\"68\" name=\"PEDIATRIA: PROCESSO PARTE A - ANAMNESE\" version=\"1.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}</patient_address.city>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_telephone_number>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_name>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_surname>\,,,,,,,,,,,,,,,,,
    </personal_reference>\,,,,,,,,,,,,,,,,,
    <maternal_data openmrs_concept=\"1607^MATERNAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </name_of_mother>\,,,,,,,,,,,,,,,,,
      <age_of_mother openmrs_concept=\"1478^AGE OF MOTHER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </age_of_mother>\,,,,,,,,,,,,,,,,,
      <mother_alive multiple=\"0\" openmrs_concept=\"1479^MOTHER ALIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mother_alive>\,,,,,,,,,,,,,,,,,
      <mother_ill multiple=\"0\" openmrs_concept=\"1480^MOTHER ILL^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mother_ill>\,,,,,,,,,,,,,,,,,
      <sickness_of_mother openmrs_concept=\"1481^SICKNESS OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </sickness_of_mother>\,,,,,,,,,,,,,,,,,
      <result_of_hiv_test_mother multiple=\"0\" openmrs_concept=\"1483^RESULT OF HIV TEST MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </result_of_hiv_test_mother>\,,,,,,,,,,,,,,,,,
      <professsion_of_mother openmrs_concept=\"1482^PROFESSSION OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </professsion_of_mother>\,,,,,,,,,,,,,,,,,
      <mother_on_antiretroviral_treatment multiple=\"0\" openmrs_concept=\"1484^MOTHER ON ANTIRETROVIRAL TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mother_on_antiretroviral_treatment>\,,,,,,,,,,,,,,,,,
    </maternal_data>\,,,,,,,,,,,,,,,,,
    <paternal_data openmrs_concept=\"1608^PATERNAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <name_of_father openmrs_concept=\"1485^NAME OF FATHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </name_of_father>\,,,,,,,,,,,,,,,,,
      <age_of_father openmrs_concept=\"1486^AGE OF FATHER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </age_of_father>\,,,,,,,,,,,,,,,,,
      <father_alive multiple=\"0\" openmrs_concept=\"1487^FATHER ALIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </father_alive>\,,,,,,,,,,,,,,,,,
      <father_ill multiple=\"0\" openmrs_concept=\"1488^FATHER ILL^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </father_ill>\,,,,,,,,,,,,,,,,,
      <sickness_of_father openmrs_concept=\"1489^SICKNESS OF FATHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </sickness_of_father>\,,,,,,,,,,,,,,,,,
      <profession_of_father openmrs_concept=\"1490^PROFESSION OF FATHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </profession_of_father>\,,,,,,,,,,,,,,,,,
      <result_of_hiv_test_father multiple=\"0\" openmrs_concept=\"1491^RESULT OF HIV TEST FATHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </result_of_hiv_test_father>\,,,,,,,,,,,,,,,,,
      <father_on_antiretroviral_treatment multiple=\"0\" openmrs_concept=\"1492^FATHER ON ANTIRETROVIRAL TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </father_on_antiretroviral_treatment>\,,,,,,,,,,,,,,,,,
    </paternal_data>\,,,,,,,,,,,,,,,,,
    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_counceling>\,,,,,,,,,,,,,,,,,
    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_patient_hiv_positive>\,,,,,,,,,,,,,,,,,
    <entry_point_into_hiv_care_set openmrs_concept=\"1625^ENTRY POINT INTO HIV CARE, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </entry_point_into_hiv_care_referal_type>\,,,,,,,,,,,,,,,,,
      <entry_point_into_hiv_care_location_name openmrs_concept=\"1626^ENTRY POINT INTO HIV CARE, LOCATION NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </entry_point_into_hiv_care_location_name>\,,,,,,,,,,,,,,,,,
      <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </entry_point_into_hiv_care_patient_code_at_location>\,,,,,,,,,,,,,,,,,
    </entry_point_into_hiv_care_set>\,,,,,,,,,,,,,,,,,
    <pediatric_clinical_history multiple=\"1\" openmrs_concept=\"1610^PEDIATRIC CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false</candidiasis>\,,,,,,,,,,,,,,,,,
        <tuberculosis_treatment_status openmrs_concept=\"5965^TUBERCULOSIS TREATMENT STATUS^99DCT\">false</tuberculosis_treatment_status>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false</hiv_staging_-_serious_bacterial_infections>\,,,,,,,,,,,,,,,,,
        <failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false</failure_to_thrive>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\,,,,,,,,,,,,,,,,,
        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\,,,,,,,,,,,,,,,,
        <cough_persistent openmrs_concept=\"1429^COUGH, PERSISTENT^99DCT\">false</cough_persistent>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\,,,,,,,,,,,,,,,,,
        <cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false</cohabitant_being_treated_for_tb>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\,,,,,,,,,,,,,,,,
    </pediatric_clinical_history>\,,,,,,,,,,,,,,,,,
    <clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </clinical_history_not_coded>\,,,,,,,,,,,,,,,,,
    <pediatric_personal_history openmrs_concept=\"1612^PEDIATRIC PERSONAL HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <method_of_delivery multiple=\"0\" openmrs_concept=\"5630^METHOD OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </method_of_delivery>\,,,,,,,,,,,,,,,,,
      <location_of_birth openmrs_concept=\"1505^LOCATION OF BIRTH^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </location_of_birth>\,,,,,,,,,,,,,,,,,
      <pregnancy_to_term multiple=\"0\" openmrs_concept=\"1500^PREGNANCY TO TERM^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pregnancy_to_term>\,,,,,,,,,,,,,,,,,
      <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </birth_weight_kg>\,,,,,,,,,,,,,,,,,
      <perinatal_exposure_to_arv_mother multiple=\"0\" openmrs_concept=\"1501^PERINATAL EXPOSURE TO ARV, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </perinatal_exposure_to_arv_mother>\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
            <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
            <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
      <prenatal_exposure_to_arv_at_birth multiple=\"0\" openmrs_concept=\"1502^PRENATAL EXPOSURE TO ARV, AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_exposure_to_arv_at_birth>\,,,,,,,,,,,,,,,,,
      <perinatal_arv_medication_at_birth multiple=\"0\" openmrs_concept=\"1503^PERINATAL ARV MEDICATION, AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </perinatal_arv_medication_at_birth>\,,,,,,,,,,,,,,,,,
      <newborn_pathology openmrs_concept=\"1506^NEWBORN PATHOLOGY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </newborn_pathology>\,,,,,,,,,,,,,,,,,
    </pediatric_personal_history>\,,,,,,,,,,,,,,,,,
    <method_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1061^METHOD OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <suspected_past_hiv_exposure openmrs_concept=\"1062^SUSPECTED PAST HIV EXPOSURE^99DCT\">false</suspected_past_hiv_exposure>\,,,,,,,,,,,,,,,,,
        <blood_transfusion openmrs_concept=\"1063^BLOOD TRANSFUSION^99DCT\">false</blood_transfusion>\,,,,,,,,,,,,,,,,,
        <spouses_partner_suspected_hiv openmrs_concept=\"5564^SPOUSES PARTNER SUSPECTED HIV+^99DCT\">false</spouses_partner_suspected_hiv>\,,,,,,,,,,,,,,,,,
        <contaminated_needle_stick openmrs_concept=\"181^CONTAMINATED NEEDLE STICK^99DCT\">false</contaminated_needle_stick>\,,,,,,,,,,,,,,,,,
        <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false</unknown>\,,,,,,,,,,,,,,,,,
        <injections openmrs_concept=\"1507^INJECTIONS^99DCT\">false</injections>\,,,,,,,,,,,,,,,,,
        <surgical_intervention openmrs_concept=\"1472^SURGICAL INTERVENTION^99DCT\">false</surgical_intervention>\,,,,,,,,,,,,,,,,,
        <dental_extraction openmrs_concept=\"1508^DENTAL EXTRACTION^99DCT\">false</dental_extraction>\,,,,,,,,,,,,,,,,,
        <scarrification openmrs_concept=\"1509^SCARRIFICATION^99DCT\">false</scarrification>\,,,,,,,,,,,,,,,,,
        <accidental_exposure openmrs_concept=\"1433^ACCIDENTAL EXPOSURE^99DCT\">false</accidental_exposure>\,,,,,,,,,,,,,,,,,
    </method_of_hiv_exposure>\,,,,,,,,,,,,,,,,,
    <hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hospital_slash_clinic>\,,,,,,,,,,,,,,,,,
      <diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </diagnosis_for_hospitalization>\,,,,,,,,,,,,,,,,,
      <date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </date_of_hospital_stay_entry>\,,,,,,,,,,,,,,,,,
      <data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </data_of_hospital_stay_exit>\,,,,,,,,,,,,,,,,,
      <hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hosptal_treatment>\,,,,,,,,,,,,,,,,,
    </hospitalizations>\,,,,,,,,,,,,,,,,,
    <pediatric_nutrition openmrs_concept=\"1614^PEDIATRIC NUTRITION^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <child_breast_fed_in_past multiple=\"0\" openmrs_concept=\"6061^CHILD BREAST FED IN PAST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </child_breast_fed_in_past>\,,,,,,,,,,,,,,,,,
      <was_the_child_exclusivly_breastfed multiple=\"0\" openmrs_concept=\"1613^WAS THE CHILD EXCLUSIVLY BREASTFED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </was_the_child_exclusivly_breastfed>\,,,,,,,,,,,,,,,,,
      <age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </age_weaned_from_breast_feeding_months>\,,,,,,,,,,,,,,,,,
      <pav_complete multiple=\"0\" openmrs_concept=\"1511^PAV COMPLETE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </pav_complete>\,,,,,,,,,,,,,,,,,
      <dpm_age_chronological_years openmrs_concept=\"1512^DPM AGE CHRONOLOGICAL YEARS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </dpm_age_chronological_years>\,,,,,,,,,,,,,,,,,
      <dpm_age_chronological_months openmrs_concept=\"1513^DPM AGE CHRONOLOGICAL MONTHS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </dpm_age_chronological_months>\,,,,,,,,,,,,,,,,,
      <bailey_years openmrs_concept=\"1514^BAILEY YEARS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </bailey_years>\,,,,,,,,,,,,,,,,,
      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </bailey_months>\,,,,,,,,,,,,,,,,,
    </pediatric_nutrition>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",9,11/14/2008 14:06,13,1/11/2011 15:23,0,,,,e28b6b0e-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
71,PTV: PRE-NATAL,0.1,72,0,Livro de registo de consulta de Preveno de Transmiss Vertical Pr-Natal,11,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV: PRE-NATAL\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/71-0.1-72.xsn\" solutionVersion=\"0.1.0.72\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/71-72\" id=\"71\" name=\"PTV: PRE-NATAL\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <ptv_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()} </ptv_code>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <number_of_weeks_pregnant_at_encounter_date openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_weeks_pregnant_at_encounter_date>\,,,,,,,,,,,,,,,,,
    <planned_date_to_administer_nvp_during_pregnancy openmrs_concept=\"1802^PLANNED DATE TO ADMINISTER NVP DURING PREGNANCY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </planned_date_to_administer_nvp_during_pregnancy>\,,,,,,,,,,,,,,,,,
    <antiretroviral_plan_-_tarv_start multiple=\"0\" openmrs_concept=\"1255^ANTIRETROVIRAL PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </antiretroviral_plan_-_tarv_start>\,,,,,,,,,,,,,,,,,
    <azt_profalaxis_for_prevention_of_vertical_transmission openmrs_concept=\"1803^AZT PROFALAXIS FOR PREVENTION OF VERTICAL TRANSMISSION^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother_-_azt multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother_-_azt>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_when_starting_azt_profolaxis openmrs_concept=\"1808^NUMBER OF WEEKS PREGNANT WHEN STARTING AZT PROFOLAXIS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_when_starting_azt_profolaxis>\,,,,,,,,,,,,,,,,,
    </azt_profalaxis_for_prevention_of_vertical_transmission>\,,,,,,,,,,,,,,,,,
    <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </prenatal_visit_number>\,,,,,,,,,,,,,,,,,
    <prenatal_arv_medication_mother_-_ctx multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </prenatal_arv_medication_mother_-_ctx>\,,,,,,,,,,,,,,,,,
    <prescribed_fansidar openmrs_concept=\"1805^PRESCRIBED FANSIDAR^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </fansidar_dose>\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother_-_fansidar multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother_-_fansidar>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_during_first_dose_of_fansidar openmrs_concept=\"1809^NUMBER OF WEEKS PREGNANT DURING FIRST DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_during_first_dose_of_fansidar>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_during_second_dose_of_fansidar openmrs_concept=\"1810^NUMBER OF WEEKS PREGNANT DURING SECOND DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_during_second_dose_of_fansidar>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_during_third_dose_of_fansidar openmrs_concept=\"1811^NUMBER OF WEEKS PREGNANT DURING THIRD DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_during_third_dose_of_fansidar>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_during_dose_of_fansidar openmrs_concept=\"2053^NUMBER OF WEEKS PREGNANT DURING DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_during_dose_of_fansidar>\,,,,,,,,,,,,,,,,,
    </prescribed_fansidar>\,,,,,,,,,,,,,,,,,
    <nevirapine_administered_during_prenatal_consultations openmrs_concept=\"1806^NEVIRAPINE ADMINISTERED DURING PRENATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother_-_nevirapine multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother_-_nevirapine>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_when_starting_nevirapine openmrs_concept=\"1812^NUMBER OF WEEKS PREGNANT WHEN STARTING NEVIRAPINE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_when_starting_nevirapine>\,,,,,,,,,,,,,,,,,
    </nevirapine_administered_during_prenatal_consultations>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <prevention_of_vertical_transmission_observations openmrs_concept=\"1799^PREVENTION OF VERTICAL TRANSMISSION OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </prevention_of_vertical_transmission_observations>\,,,,,,,,,,,,,,,,,
    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_visit_number>\,,,,,,,,,,,,,,,,,
    </visit_number_and_weeks_pregnant_ptv>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",9,11/14/2008 17:17,13,1/11/2011 15:23,0,,,,e28b77e8-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
79,PTV: MATERNIDADE,0.1,59,0,Livro de consulta de Preveno de Transmiss Vertical para Maternidade,23,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV: MATERNIDADE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/79-0.1-59.xsn\" solutionVersion=\"0.1.0.59\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/79-59\" id=\"79\" name=\"PTV: MATERNIDADE\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <ptv_maternity_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(8).getIdentifier()}</ptv_maternity_code>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <hour_mother_entered_hospital_to_give_birth openmrs_concept=\"1828^HOUR MOTHER ENTERED HOSPITAL TO GIVE BIRTH^99DCT\" openmrs_datatype=\"TM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hour_mother_entered_hospital_to_give_birth>\,,,,,,,,,,,,,,,,,
    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
    <dilation_on_entering_hospital openmrs_concept=\"1813^DILATION ON ENTERING HOSPITAL ^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </dilation_on_entering_hospital>\,,,,,,,,,,,,,,,,,
    <administration_of_arv_during_delivery openmrs_concept=\"1824^ADMINISTRATION OF ARV DURING DELIVERY^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
      <nevirapine_administered_at_home multiple=\"0\" openmrs_concept=\"1814^NEVIRAPINE ADMINISTERED AT HOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </nevirapine_administered_at_home>\,,,,,,,,,,,,,,,,,
      <hour_nvp_taken_in_maternity openmrs_concept=\"1829^HOUR NVP TAKEN IN MATERNITY^99DCT\" openmrs_datatype=\"TS\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hour_nvp_taken_in_maternity>\,,,,,,,,,,,,,,,,,
      <patient_vomited_within_an_hour_of_taking_nevirapine multiple=\"0\" openmrs_concept=\"1815^PATIENT VOMITED WITHIN AN HOUR OF TAKING NEVIRAPINE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_vomited_within_an_hour_of_taking_nevirapine>\,,,,,,,,,,,,,,,,,
      <patient_took_nevirapine_in_maternity multiple=\"0\" openmrs_concept=\"1816^PATIENT TOOK NEVIRAPINE IN MATERNITY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_took_nevirapine_in_maternity>\,,,,,,,,,,,,,,,,,
    </administration_of_arv_during_delivery>\,,,,,,,,,,,,,,,,,
    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </infant_feeding_method>\,,,,,,,,,,,,,,,,,
    <time_of_birth openmrs_concept=\"1830^DATE AND TIME NVP TAKEN AT HOME^99DCT\" openmrs_datatype=\"TS\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </time_of_birth>\,,,,,,,,,,,,,,,,,
    <location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </location_of_delivery>\,,,,,,,,,,,,,,,,,
    <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </birth_weight_kg>\,,,,,,,,,,,,,,,,,
    <stillborn multiple=\"0\" openmrs_concept=\"1819^STILLBORN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </stillborn>\,,,,,,,,,,,,,,,,,
    <prophylaxis_administered_to_newborn openmrs_concept=\"1825^PROPHYLAXIS ADMINISTERED TO NEWBORN^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <first_dose_of_nevirapine_given_to_child_at_birth multiple=\"0\" openmrs_concept=\"1821^FIRST DOSE OF NEVIRAPINE GIVEN TO CHILD AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </first_dose_of_nevirapine_given_to_child_at_birth>\,,,,,,,,,,,,,,,,,
      <_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth multiple=\"0\" openmrs_concept=\"1822^2ND DOSE OF NEVIRAPINE GIVEN TO CHILD 48 TO 72 HOURS AFER BIRTH^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth>\,,,,,,,,,,,,,,,,,
      <mother_took_azt_syrup_home multiple=\"0\" openmrs_concept=\"1823^MOTHER TOOK AZT SYRUP HOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mother_took_azt_syrup_home>\,,,,,,,,,,,,,,,,,
    </prophylaxis_administered_to_newborn>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28b810c-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
80,CCR: PROCESSO,0.1,65,0,Processo de consulta de crians em risco,8,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"CCR: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/80-0.1-65.xsn\" solutionVersion=\"0.1.0.65\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/80-65\" id=\"80\" name=\"CCR: PROCESSO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <ccr_nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(9).getIdentifier()}</ccr_nid>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <location_of_temporary_housing openmrs_concept=\"1832^LOCATION OF TEMPORARY HOUSING^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </location_of_temporary_housing>\,,,,,,,,,,,,,,,,,
    <temporarily_living_in_the_home_of openmrs_concept=\"1833^TEMPORARILY LIVING IN THE HOME OF^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </temporarily_living_in_the_home_of>\,,,,,,,,,,,,,,,,,
    <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </name_of_mother>\,,,,,,,,,,,,,,,,,
    <mothers_workplace openmrs_concept=\"1834^MOTHERS WORKPLACE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </mothers_workplace>\,,,,,,,,,,,,,,,,,
    <name_of_father openmrs_concept=\"1485^NAME OF FATHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </name_of_father>\,,,,,,,,,,,,,,,,,
    <fathers_workplace openmrs_concept=\"1835^FATHERS WORKPLACE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </fathers_workplace>\,,,,,,,,,,,,,,,,,
    <location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </location_of_delivery>\,,,,,,,,,,,,,,,,,
    <method_of_delivery multiple=\"0\" openmrs_concept=\"5630^METHOD OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </method_of_delivery>\,,,,,,,,,,,,,,,,,
    <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </birth_weight_kg>\,,,,,,,,,,,,,,,,,
    <prevention_of_vertical_trasmission_child multiple=\"1\" openmrs_concept=\"1836^PREVENTION OF VERTICAL TRASMISSION, CHILD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
    </prevention_of_vertical_trasmission_child>\,,,,,,,,,,,,,,,,,
    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
    </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </infant_feeding_method>\,,,,,,,,,,,,,,,,,
    <age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </age_weaned_from_breast_feeding_months>\,,,,,,,,,,,,,,,,,
    <duration_of_weaning multiple=\"0\" openmrs_concept=\"1839^DURATION OF WEANING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </duration_of_weaning>\,,,,,,,,,,,,,,,,,
    <reason_for_weaning openmrs_concept=\"1840^REASON FOR WEANING^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_for_weaning>\,,,,,,,,,,,,,,,,,
    <child_feeding_method openmrs_concept=\"1841^CHILD FEEDING METHOD^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </child_feeding_method>\,,,,,,,,,,,,,,,,,
    <reason_for_entering_child_at_risk_treatment multiple=\"1\" openmrs_concept=\"1874^REASON FOR ENTERING CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <contact_with_tuberculosis openmrs_concept=\"1845^CONTACT WITH TUBERCULOSIS^99DCT\">false</contact_with_tuberculosis>\,,,,,,,,,,,,,,,,,
        <mother_hiv_positive openmrs_concept=\"1586^MOTHER HIV POSITIVE^99DCT\">false</mother_hiv_positive>\,,,,,,,,,,,,,,,,,
        <twin openmrs_concept=\"1846^TWIN^99DCT\">false</twin>\,,,,,,,,,,,,,,,,,
        <sudden_weaning_or_exclusive_artificial_feeding_for_more_than_one_year openmrs_concept=\"1843^SUDDEN WEANING OR EXCLUSIVE ARTIFICIAL FEEDING FOR MORE THAN ONE YEAR^99DCT\">false</sudden_weaning_or_exclusive_artificial_feeding_for_more_than_one_year>\,,,,,,,,,,,,,,,,,
        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\,,,,,,,,,,,,,,,,,
        <chronic_malnutrition openmrs_concept=\"1844^CHRONIC MALNUTRITION^99DCT\">false</chronic_malnutrition>\,,,,,,,,,,,,,,,,,
        <child_without_mother openmrs_concept=\"1847^CHILD WITHOUT MOTHER^99DCT\">false</child_without_mother>\,,,,,,,,,,,,,,,,,
        <premature_birth_or_low_birth_weight openmrs_concept=\"1842^PREMATURE BIRTH OR LOW BIRTH WEIGHT^99DCT\">false</premature_birth_or_low_birth_weight>\,,,,,,,,,,,,,,,,,
    </reason_for_entering_child_at_risk_treatment>\,,,,,,,,,,,,,,,,,
    <other_reason_for_enrollment_in_child_at_risk_clinic openmrs_concept=\"1848^OTHER REASON FOR ENROLLMENT IN CHILD AT RISK CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_reason_for_enrollment_in_child_at_risk_clinic>\,,,,,,,,,,,,,,,,,
    <number_of_hospitalizations openmrs_concept=\"1849^NUMBER OF HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_hospitalizations>\,,,,,,,,,,,,,,,,,
    <hiv_exposure_through_blood_transfusion multiple=\"0\" openmrs_concept=\"1686^HIV EXPOSURE THROUGH BLOOD TRANSFUSION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_exposure_through_blood_transfusion>\,,,,,,,,,,,,,,,,,
    <previous_illness openmrs_concept=\"1850^PREVIOUS ILLNESS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </previous_illness>\,,,,,,,,,,,,,,,,,
    <family_member_has_tuberculosis multiple=\"0\" openmrs_concept=\"1851^FAMILY MEMBER HAS TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </family_member_has_tuberculosis>\,,,,,,,,,,,,,,,,,
    <other_illnesses_in_the_family openmrs_concept=\"1852^OTHER ILLNESSES IN THE FAMILY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_illnesses_in_the_family>\,,,,,,,,,,,,,,,,,
    <number_of_adult_household_members openmrs_concept=\"1853^NUMBER OF ADULT HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_adult_household_members>\,,,,,,,,,,,,,,,,,
    <number_of_child_household_members openmrs_concept=\"1854^NUMBER OF CHILD HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_child_household_members>\,,,,,,,,,,,,,,,,,
    <type_of_house multiple=\"0\" openmrs_concept=\"1858^TYPE OF HOUSE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </type_of_house>\,,,,,,,,,,,,,,,,,
    <patients_water_source multiple=\"0\" openmrs_concept=\"1862^PATIENTS WATER SOURCE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patients_water_source>\,,,,,,,,,,,,,,,,,
    <patient_has_mosquito_net multiple=\"0\" openmrs_concept=\"1863^PATIENT HAS MOSQUITO NET^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_has_mosquito_net>\,,,,,,,,,,,,,,,,,
    <patient_has_latrine multiple=\"0\" openmrs_concept=\"1864^PATIENT HAS LATRINE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_has_latrine>\,,,,,,,,,,,,,,,,,
    <source_of_income multiple=\"0\" openmrs_concept=\"1875^SOURCE OF INCOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </source_of_income>\,,,,,,,,,,,,,,,,,
    <other_source_of_income openmrs_concept=\"1876^OTHER SOURCE OF INCOME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_source_of_income>\,,,,,,,,,,,,,,,,,
    <house_call_observations openmrs_concept=\"1870^HOUSE CALL OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </house_call_observations>\,,,,,,,,,,,,,,,,,
    <exit_from_child_at_risk_treatment multiple=\"0\" openmrs_concept=\"1873^EXIT FROM CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </exit_from_child_at_risk_treatment>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28b9c3c-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
81,CCR: SEGUIMENTO,0.1,107,0,Ficha de seguimento de processo de consulta de crians em risco,10,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"CCR: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/81-0.1-107.xsn\" solutionVersion=\"0.1.0.107\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/81-107\" id=\"81\" name=\"CCR: SEGUIMENTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </weight_kg>\,,,,,,,,,,,,,,,,,
    <height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </height_cm>\,,,,,,,,,,,,,,,,,
    <weight_divided_by_height_as_a_percentage openmrs_concept=\"1888^WEIGHT DIVIDED BY HEIGHT AS A PERCENTAGE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </weight_divided_by_height_as_a_percentage>\,,,,,,,,,,,,,,,,,
    <head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </head_circumference>\,,,,,,,,,,,,,,,,,
    <vaccinations_are_up_to_date multiple=\"0\" openmrs_concept=\"1889^VACCINATIONS ARE UP TO DATE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </vaccinations_are_up_to_date>\,,,,,,,,,,,,,,,,,
    <pediatric_clinical_history multiple=\"1\" openmrs_concept=\"1610^PEDIATRIC CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false</candidiasis>\,,,,,,,,,,,,,,,,,
        <tuberculosis_treatment_status openmrs_concept=\"5965^TUBERCULOSIS TREATMENT STATUS^99DCT\">false</tuberculosis_treatment_status>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false</hiv_staging_-_serious_bacterial_infections>\,,,,,,,,,,,,,,,,,
        <failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false</failure_to_thrive>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\,,,,,,,,,,,,,,,,,
        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\,,,,,,,,,,,,,,,,
        <cough_persistent openmrs_concept=\"1429^COUGH, PERSISTENT^99DCT\">false</cough_persistent>\,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\,,,,,,,,,,,,,,,,,
        <cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false</cohabitant_being_treated_for_tb>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\,,,,,,,,,,,,,,,,
    </pediatric_clinical_history>\,,,,,,,,,,,,,,,,,
    <written_history openmrs_concept=\"1671^WRITTEN HISTORY^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </written_history>\,,,,,,,,,,,,,,,,,
    <child_at_risk_clinical_evaluation multiple=\"1\" openmrs_concept=\"1880^CHILD AT RISK CLINICAL EVALUATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false</candidiasis>\,,,,,,,,,,,,,,,,,
        <pale_palms openmrs_concept=\"1879^PALE PALMS^99DCT\">false</pale_palms>\,,,,,,,,,,,,,,,,,
        <fluid_secretion openmrs_concept=\"1878^FLUID SECRETION^99DCT\">false</fluid_secretion>\,,,,,,,,,,,,,,,,,
        <dermatitis openmrs_concept=\"119^DERMATITIS^99DCT\">false</dermatitis>\,,,,,,,,,,,,,,,,,
        <oedema openmrs_concept=\"460^OEDEMA^99DCT\">false</oedema>\,,,,,,,,,,,,,,,,,
        <adenomegaly openmrs_concept=\"1877^ADENOMEGALY^99DCT\">false</adenomegaly>\,,,,,,,,,,,,,,,,,
    </child_at_risk_clinical_evaluation>\,,,,,,,,,,,,,,,,,
    <respiratory_rate openmrs_concept=\"5242^RESPIRATORY RATE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </respiratory_rate>\,,,,,,,,,,,,,,,,,
    <clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </clinical_history_not_coded>\,,,,,,,,,,,,,,,,,
    <psychomotor_development multiple=\"0\" openmrs_concept=\"1882^PSYCHOMOTOR DEVELOPMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </psychomotor_development>\,,,,,,,,,,,,,,,,,
    <child_at_risk_treatment multiple=\"1\" openmrs_concept=\"1885^CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false</plumpy_nut>\,,,,,,,,,,,,,,,,,
        <mebendazole openmrs_concept=\"244^MEBENDAZOLE^99DCT\">false</mebendazole>\,,,,,,,,,,,,,,,,,
        <vitamin_a openmrs_concept=\"1720^VITAMIN A^99DCT\">false</vitamin_a>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <multivitamin openmrs_concept=\"1883^MULTIVITAMIN^99DCT\">false</multivitamin>\,,,,,,,,,,,,,,,,,
    </child_at_risk_treatment>\,,,,,,,,,,,,,,,,,
    <child_at_risk_other_treatment openmrs_concept=\"1886^CHILD AT RISK, OTHER TREATMENT^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </child_at_risk_other_treatment>\,,,,,,,,,,,,,,,,,
    <feeding_plan multiple=\"1\" openmrs_concept=\"985^FEEDING PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <expressed_breastmilk openmrs_concept=\"1173^EXPRESSED BREASTMILK^99DCT\">false</expressed_breastmilk>\,,,,,,,,,,,,,,,,,
        <weaned openmrs_concept=\"1152^WEANED^99DCT\">false</weaned>\,,,,,,,,,,,,,,,,,
        <infant_formula openmrs_concept=\"5254^INFANT FORMULA^99DCT\">false</infant_formula>\,,,,,,,,,,,,,,,,,
        <breastfed_predominately openmrs_concept=\"1150^BREASTFED PREDOMINATELY^99DCT\">false</breastfed_predominately>\,,,,,,,,,,,,,,,,,
        <mixed_feeding openmrs_concept=\"6046^MIXED FEEDING^99DCT\">false</mixed_feeding>\,,,,,,,,,,,,,,,,,
        <breastfed_exclusively openmrs_concept=\"5526^BREASTFED EXCLUSIVELY^99DCT\">false</breastfed_exclusively>\,,,,,,,,,,,,,,,,,
        <cow_milk openmrs_concept=\"968^COW MILK^99DCT\">false</cow_milk>\,,,,,,,,,,,,,,,,,
    </feeding_plan>\,,,,,,,,,,,,,,,,,
    <child_feeding_method openmrs_concept=\"1841^CHILD FEEDING METHOD^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </child_feeding_method>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false</social_support_services>\,,,,,,,,,,,,,,,,,
        <tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false</tuberculosis_treatment_or_dot_program>\,,,,,,,,,,,,,,,,,
        <disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false</disclosure_counseling>\,,,,,,,,,,,,,,,,,
        <nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false</nutritional_support>\,,,,,,,,,,,,,,,,,
        <adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false</adherence_counseling>\,,,,,,,,,,,,,,,,,
        <mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false</mental_health_services>\,,,,,,,,,,,,,,,,,
        <psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false</psychosocial_counseling>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false</family_planning_services>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false</alcohol_counseling>\,,,,,,,,,,,,,,,,,
        <inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false</inpatient_care_or_hospitalization>\,,,,,,,,,,,,,,,,,
        <home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false</home_based_care>\,,,,,,,,,,,,,,,,,
        <plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false</plano_nacional_para_combate_tuberculose>\,,,,,,,,,,,,,,,,,
        <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false</day_hospital>\,,,,,,,,,,,,,,,,,
        <medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false</medical_consultation>\,,,,,,,,,,,,,,,,,
        <triage openmrs_concept=\"1887^TRIAGE^99DCT\">false</triage>\,,,,,,,,,,,,,,,,,
        <pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false</pre-natal_consultation>\,,,,,,,,,,,,,,,,,
        <association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false</association_of_people_with_hiv>\,,,,,,,,,,,,,,,,,
        <sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false</sexually_transmitted_disease_consultation>\,,,,,,,,,,,,,,,,,
        <domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false</domestic_visit>\,,,,,,,,,,,,,,,,,
        <voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false</voluntary_counceling_and_testing>\,,,,,,,,,,,,,,,,,
        <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false</referral_other>\,,,,,,,,,,,,,,,,
        <family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false</family_was_referred_to_the_health_unit>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_dna_polymerase_chain_reaction_qualitative>\,,,,,,,,,,,,,,,,,
    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_rapid_test_1_qualitative>\,,,,,,,,,,,,,,,,,
    <polymerase_chain_reaction_date_send_to_laboratory openmrs_concept=\"2070^POLYMERASE CHAIN REACTION, DATE SEND TO LABORATORY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </polymerase_chain_reaction_date_send_to_laboratory>\,,,,,,,,,,,,,,,,,
    <return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit_date>\,,,,,,,,,,,,,,,,,
    <symptomatic multiple=\"0\" openmrs_concept=\"1068^SYMPTOMATIC^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </symptomatic>\,,,,,,,,,,,,,,,,,
    <mother_received_counceling_for_polymerase_chain_reaction multiple=\"0\" openmrs_concept=\"2132^MOTHER RECEIVED COUNCELING FOR POLYMERASE CHAIN REACTION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </mother_received_counceling_for_polymerase_chain_reaction>\,,,,,,,,,,,,,,,,,
    <date_of_delivery_the_pcr_result_to_the_family openmrs_concept=\"2133^DATE OF DELIVERY THE PCR RESULT TO THE FAMILY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_delivery_the_pcr_result_to_the_family>\,,,,,,,,,,,,,,,,,
    <polymerase_chain_reaction_result_return_date openmrs_concept=\"1999^POLYMERASE CHAIN REACTION RESULT RETURN DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </polymerase_chain_reaction_result_return_date>\,,,,,,,,,,,,,,,,,
    <exit_from_child_at_risk_treatment multiple=\"0\" openmrs_concept=\"1873^EXIT FROM CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </exit_from_child_at_risk_treatment>\,,,,,,,,,,,,,,,,,
    <polymerase_chain_reaction_date_ordered openmrs_concept=\"1998^POLYMERASE CHAIN REACTION, DATE ORDERED^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </polymerase_chain_reaction_date_ordered>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/27/2011 11:39,0,,,,e28ba07e-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
82,ATS,0.1,138,0,"MISAU:  Aconselhamento e Testagem de Saude (GATV, VTS)",14,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ATS\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/82-0.1-138.xsn\" solutionVersion=\"0.1.0.138\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/82-138\" id=\"82\" name=\"ATS\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <ats_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(5).getIdentifier()} </ats_number>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}</patient_address.city>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </organization>\,,,,,,,,,,,,,,,,,
    <couples_vct_code openmrs_concept=\"1916^COUPLES VCT CODE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </couples_vct_code>\,,,,,,,,,,,,,,,,,
    <partners_vct_code openmrs_concept=\"1917^PARTNERS VCT CODE^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </partners_vct_code>\,,,,,,,,,,,,,,,,,
    <counseling_site_type multiple=\"0\" openmrs_concept=\"1988^COUNSELING SITE TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </counseling_site_type>\,,,,,,,,,,,,,,,,,
    <location_of_vct multiple=\"0\" openmrs_concept=\"1991^LOCATION OF VCT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </location_of_vct>\,,,,,,,,,,,,,,,,,
    <return_visit multiple=\"0\" openmrs_concept=\"1992^RETURN VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit>\,,,,,,,,,,,,,,,,,
    <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </pregant>\,,,,,,,,,,,,,,,,,
    <counseling_session multiple=\"0\" openmrs_concept=\"1727^COUNSELING SESSION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </counseling_session>\,,,,,,,,,,,,,,,,,
    <type_of_visit multiple=\"0\" openmrs_concept=\"1981^TYPE OF VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </type_of_visit>\,,,,,,,,,,,,,,,,,
    <patient_paid_for_visit multiple=\"0\" openmrs_concept=\"1993^PATIENT PAID FOR VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_paid_for_visit>\,,,,,,,,,,,,,,,,,
    <patient_home_location_type multiple=\"0\" openmrs_concept=\"1997^PATIENT HOME LOCATION TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_home_location_type>\,,,,,,,,,,,,,,,,,
    <civil_status multiple=\"0\" openmrs_concept=\"1054^CIVIL STATUS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </civil_status>\,,,,,,,,,,,,,,,,,
    <religion multiple=\"0\" openmrs_concept=\"1898^RELIGION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </religion>\,,,,,,,,,,,,,,,,,
    <level_of_education multiple=\"0\" openmrs_concept=\"1443^LEVEL OF EDUCATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </level_of_education>\,,,,,,,,,,,,,,,,,
    <in_school multiple=\"0\" openmrs_concept=\"1899^IN SCHOOL^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </in_school>\,,,,,,,,,,,,,,,,,
    <occupation_coded multiple=\"1\" openmrs_concept=\"1914^OCCUPATION, CODED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <house_wife openmrs_concept=\"1907^HOUSE WIFE^99DCT\">false</house_wife>\,,,,,,,,,,,,,,,,,
        <not_applicable openmrs_concept=\"1175^NOT APPLICABLE^99DCT\">false</not_applicable>\,,,,,,,,,,,,,,,,,
        <politician openmrs_concept=\"1911^POLITICIAN^99DCT\">false</politician>\,,,,,,,,,,,,,,,,,
        <military_slash_police openmrs_concept=\"1902^MILITARY/POLICE^99DCT\">false</military_slash_police>\,,,,,,,,,,,,,,,,,
        <sex_worker openmrs_concept=\"1901^SEX WORKER^99DCT\">false</sex_worker>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <student openmrs_concept=\"1900^STUDENT^99DCT\">false</student>\,,,,,,,,,,,,,,,,,
        <professor openmrs_concept=\"1906^PROFESSOR^99DCT\">false</professor>\,,,,,,,,,,,,,,,,,
        <house_worker openmrs_concept=\"1909^HOUSE WORKER^99DCT\">false</house_worker>\,,,,,,,,,,,,,,,,,
        <subsistence_farmer openmrs_concept=\"1910^SUBSISTENCE FARMER^99DCT\">false</subsistence_farmer>\,,,,,,,,,,,,,,,,,
        <health_worker openmrs_concept=\"1912^HEALTH WORKER^99DCT\">false</health_worker>\,,,,,,,,,,,,,,,,,
        <security_worker openmrs_concept=\"1913^SECURITY WORKER^99DCT\">false</security_worker>\,,,,,,,,,,,,,,,,,
        <vendor openmrs_concept=\"1905^VENDOR^99DCT\">false</vendor>\,,,,,,,,,,,,,,,,,
        <miner openmrs_concept=\"1908^MINER^99DCT\">false</miner>\,,,,,,,,,,,,,,,,,
        <driver openmrs_concept=\"1903^DRIVER^99DCT\">false</driver>\,,,,,,,,,,,,,,,,,
        <migrant_worker openmrs_concept=\"1904^MIGRANT WORKER^99DCT\">false</migrant_worker>\,,,,,,,,,,,,,,,,,
    </occupation_coded>\,,,,,,,,,,,,,,,,,
    <currently_employed multiple=\"0\" openmrs_concept=\"1915^CURRENTLY EMPLOYED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </currently_employed>\,,,,,,,,,,,,,,,,,
    <informed_of_the_need_for_hiv_testing_by multiple=\"1\" openmrs_concept=\"1931^INFORMED OF THE NEED FOR HIV TESTING BY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <family openmrs_concept=\"1927^FAMILY^99DCT\">false</family>\,,,,,,,,,,,,,,,,,
        <neighbors openmrs_concept=\"1923^NEIGHBORS^99DCT\">false</neighbors>\,,,,,,,,,,,,,,,,,
        <other_patients openmrs_concept=\"1928^OTHER PATIENTS^99DCT\">false</other_patients>\,,,,,,,,,,,,,,,,,
        <blood_bank openmrs_concept=\"1926^BLOOD BANK^99DCT\">false</blood_bank>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <radio openmrs_concept=\"1918^RADIO^99DCT\">false</radio>\,,,,,,,,,,,,,,,,,
        <health_worker openmrs_concept=\"1912^HEALTH WORKER^99DCT\">false</health_worker>\,,,,,,,,,,,,,,,,,
        <television openmrs_concept=\"1919^TELEVISION^99DCT\">false</television>\,,,,,,,,,,,,,,,,,
        <sexual_partner openmrs_concept=\"1921^SEXUAL PARTNER^99DCT\">false</sexual_partner>\,,,,,,,,,,,,,,,,,
        <community openmrs_concept=\"1922^COMMUNITY^99DCT\">false</community>\,,,,,,,,,,,,,,,,,
        <at_work openmrs_concept=\"1925^AT WORK^99DCT\">false</at_work>\,,,,,,,,,,,,,,,,,
        <friend_or_colleague openmrs_concept=\"1930^FRIEND OR COLLEAGUE^99DCT\">false</friend_or_colleague>\,,,,,,,,,,,,,,,,,
        <theatre_slash_dance_slash_music_group openmrs_concept=\"1929^THEATRE/DANCE/MUSIC GROUP^99DCT\">false</theatre_slash_dance_slash_music_group>\,,,,,,,,,,,,,,,,,
        <pamphlet openmrs_concept=\"1920^PAMPHLET^99DCT\">false</pamphlet>\,,,,,,,,,,,,,,,,,
        <school_or_church openmrs_concept=\"1924^SCHOOL OR CHURCH^99DCT\">false</school_or_church>\,,,,,,,,,,,,,,,,,
    </informed_of_the_need_for_hiv_testing_by>\,,,,,,,,,,,,,,,,,
    <main_reason_for_requesting_hiv_testing_and_counseling multiple=\"0\" openmrs_concept=\"1947^MAIN REASON FOR REQUESTING HIV TESTING AND COUNSELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </main_reason_for_requesting_hiv_testing_and_counseling>\,,,,,,,,,,,,,,,,,
    <when_sick_do_you_go_to_a_traditional_healer multiple=\"0\" openmrs_concept=\"1950^WHEN SICK DO YOU GO TO A TRADITIONAL HEALER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </when_sick_do_you_go_to_a_traditional_healer>\,,,,,,,,,,,,,,,,,
    <have_you_ever_been_vaccinated_by_a_traditional_healer multiple=\"0\" openmrs_concept=\"1951^HAVE YOU EVER BEEN VACCINATED BY A TRADITIONAL HEALER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </have_you_ever_been_vaccinated_by_a_traditional_healer>\,,,,,,,,,,,,,,,,,
    <patient_has_scarification_or_tattoo multiple=\"0\" openmrs_concept=\"1952^PATIENT HAS SCARIFICATION OR TATTOO^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_has_scarification_or_tattoo>\,,,,,,,,,,,,,,,,,
    <prior_hiv_test multiple=\"0\" openmrs_concept=\"1955^PRIOR HIV TEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </prior_hiv_test>\,,,,,,,,,,,,,,,,,
    <reason_for_repeating_hiv_test multiple=\"1\" openmrs_concept=\"1959^REASON FOR REPEATING HIV TEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <not_applicable openmrs_concept=\"1175^NOT APPLICABLE^99DCT\">false</not_applicable>\,,,,,,,,,,,,,,,,,
        <test_results_may_have_changed openmrs_concept=\"1958^TEST RESULTS MAY HAVE CHANGED^99DCT\">false</test_results_may_have_changed>\,,,,,,,,,,,,,,,,,
        <patient_does_not_believe_test_results openmrs_concept=\"1956^PATIENT DOES NOT BELIEVE TEST RESULTS^99DCT\">false</patient_does_not_believe_test_results>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <in_time_period_to_retest openmrs_concept=\"1957^IN TIME PERIOD TO RETEST^99DCT\">false</in_time_period_to_retest>\,,,,,,,,,,,,,,,,,
    </reason_for_repeating_hiv_test>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment_in_the_past_2_years multiple=\"0\" openmrs_concept=\"1960^TUBERCULOSIS TREATMENT IN THE PAST 2 YEARS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment_in_the_past_2_years>\,,,,,,,,,,,,,,,,,
    <patient_had_sexual_relations_that_included_penetration multiple=\"0\" openmrs_concept=\"1961^PATIENT HAD SEXUAL RELATIONS THAT INCLUDED PENETRATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_had_sexual_relations_that_included_penetration>\,,,,,,,,,,,,,,,,,
    <parter_tested_for_hiv_in_last_3_months multiple=\"0\" openmrs_concept=\"1962^PARTER TESTED FOR HIV IN LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </parter_tested_for_hiv_in_last_3_months>\,,,,,,,,,,,,,,,,,
    <patient_had_sexually_transmitted_disease_in_the_last_12_months multiple=\"0\" openmrs_concept=\"1963^PATIENT HAD SEXUALLY TRANSMITTED DISEASE IN THE LAST 12 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_had_sexually_transmitted_disease_in_the_last_12_months>\,,,,,,,,,,,,,,,,,
    <number_of_sexual_partners_in_last_12_months openmrs_concept=\"1964^NUMBER OF SEXUAL PARTNERS IN LAST 12 MONTHS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_sexual_partners_in_last_12_months>\,,,,,,,,,,,,,,,,,
    <used_condom_in_last_sexual_encounter multiple=\"0\" openmrs_concept=\"1965^USED CONDOM IN LAST SEXUAL ENCOUNTER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </used_condom_in_last_sexual_encounter>\,,,,,,,,,,,,,,,,,
    <last_sexual_encounter_was_with_regular_partner multiple=\"0\" openmrs_concept=\"1966^LAST SEXUAL ENCOUNTER WAS WITH REGULAR PARTNER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </last_sexual_encounter_was_with_regular_partner>\,,,,,,,,,,,,,,,,,
    <how_often_did_you_use_condoms_in_the_last_3_months multiple=\"0\" openmrs_concept=\"1967^HOW OFTEN DID YOU USE CONDOMS IN THE LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </how_often_did_you_use_condoms_in_the_last_3_months>\,,,,,,,,,,,,,,,,,
    <patient_was_tested_for_hiv_today multiple=\"0\" openmrs_concept=\"1968^PATIENT WAS TESTED FOR HIV TODAY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_was_tested_for_hiv_today>\,,,,,,,,,,,,,,,,,
    <patient_received_hiv_testing_results multiple=\"0\" openmrs_concept=\"1969^PATIENT RECEIVED HIV TESTING RESULTS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_hiv_testing_results>\,,,,,,,,,,,,,,,,,
    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_rapid_test_1_qualitative>\,,,,,,,,,,,,,,,,,
    <symptoms_for_newly_diagnosed_hiv_patient multiple=\"1\" openmrs_concept=\"1994^SYMPTOMS FOR NEWLY DIAGNOSED HIV PATIENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\,,,,,,,,,,,,,,,,,
        <not_applicable openmrs_concept=\"1175^NOT APPLICABLE^99DCT\">false</not_applicable>\,,,,,,,,,,,,,,,,,
        <weight_loss openmrs_concept=\"832^WEIGHT LOSS^99DCT\">false</weight_loss>\,,,,,,,,,,,,,,,,,
        <coughing_up_blood openmrs_concept=\"1761^COUGHING UP BLOOD^99DCT\">false</coughing_up_blood>\,,,,,,,,,,,,,,,,,
        <swollen_glands openmrs_concept=\"1971^SWOLLEN GLANDS^99DCT\">false</swollen_glands>\,,,,,,,,,,,,,,,,,
        <cough_lasting_more_than_3_weeks openmrs_concept=\"1760^COUGH LASTING MORE THAN 3 WEEKS^99DCT\">false</cough_lasting_more_than_3_weeks>\,,,,,,,,,,,,,,,,,
    </symptoms_for_newly_diagnosed_hiv_patient>\,,,,,,,,,,,,,,,,,
    <the_couples_results_are_different multiple=\"0\" openmrs_concept=\"1995^THE COUPLES RESULTS ARE DIFFERENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </the_couples_results_are_different>\,,,,,,,,,,,,,,,,,
    <plan_to_reduce_risk_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1996^PLAN TO REDUCE RISK OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <reduce_number_of_sexual_partners openmrs_concept=\"1973^REDUCE NUMBER OF SEXUAL PARTNERS^99DCT\">false</reduce_number_of_sexual_partners>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <treatment_of_sexually_transmitted_disease openmrs_concept=\"1975^TREATMENT OF SEXUALLY TRANSMITTED DISEASE^99DCT\">false</treatment_of_sexually_transmitted_disease>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <condoms openmrs_concept=\"190^CONDOMS^99DCT\">false</condoms>\,,,,,,,,,,,,,,,,,
        <abstinence openmrs_concept=\"1974^ABSTINENCE^99DCT\">false</abstinence>\,,,,,,,,,,,,,,,,,
        <fidelity openmrs_concept=\"1972^FIDELITY^99DCT\">false</fidelity>\,,,,,,,,,,,,,,,,,
    </plan_to_reduce_risk_of_hiv_exposure>\,,,,,,,,,,,,,,,,,
    <did_the_patient_take_condoms_today multiple=\"0\" openmrs_concept=\"1976^DID THE PATIENT TAKE CONDOMS TODAY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </did_the_patient_take_condoms_today>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false</social_support_services>\,,,,,,,,,,,,,,,,,
        <tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false</tuberculosis_treatment_or_dot_program>\,,,,,,,,,,,,,,,,,
        <disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false</disclosure_counseling>\,,,,,,,,,,,,,,,,,
        <nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false</nutritional_support>\,,,,,,,,,,,,,,,,,
        <adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false</adherence_counseling>\,,,,,,,,,,,,,,,,,
        <mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false</mental_health_services>\,,,,,,,,,,,,,,,,,
        <psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false</psychosocial_counseling>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false</family_planning_services>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false</alcohol_counseling>\,,,,,,,,,,,,,,,,,
        <inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false</inpatient_care_or_hospitalization>\,,,,,,,,,,,,,,,,,
        <home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false</home_based_care>\,,,,,,,,,,,,,,,,,
        <plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false</plano_nacional_para_combate_tuberculose>\,,,,,,,,,,,,,,,,,
        <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false</day_hospital>\,,,,,,,,,,,,,,,,,
        <medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false</medical_consultation>\,,,,,,,,,,,,,,,,,
        <triage openmrs_concept=\"1887^TRIAGE^99DCT\">false</triage>\,,,,,,,,,,,,,,,,,
        <pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false</pre-natal_consultation>\,,,,,,,,,,,,,,,,,
        <association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false</association_of_people_with_hiv>\,,,,,,,,,,,,,,,,,
        <sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false</sexually_transmitted_disease_consultation>\,,,,,,,,,,,,,,,,,
        <domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false</domestic_visit>\,,,,,,,,,,,,,,,,,
        <voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false</voluntary_counceling_and_testing>\,,,,,,,,,,,,,,,,,
        <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false</referral_other>\,,,,,,,,,,,,,,,,
        <family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false</family_was_referred_to_the_health_unit>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <why_patient_did_not_take_hiv_test multiple=\"0\" openmrs_concept=\"2051^WHY PATIENT DID NOT TAKE HIV TEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </why_patient_did_not_take_hiv_test>\,,,,,,,,,,,,,,,,,
    <child_of_mother_hiv_counseling multiple=\"0\" openmrs_concept=\"2069^CHILD OF MOTHER HIV+, COUNSELING ^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </child_of_mother_hiv_counseling>\,,,,,,,,,,,,,,,,,
    <counseling_post_delivery multiple=\"0\" openmrs_concept=\"2068^COUNSELING POST DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </counseling_post_delivery>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28baa74-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
83,PCR,0.1,58,0,Formulario de solicitacao do teste de PCR para ADN de HIV,22,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PCR\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/83-0.1-58.xsn\" solutionVersion=\"0.1.0.58\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/83-58\" id=\"83\" name=\"PCR\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <pcr_lab_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(10).getIdentifier()}</pcr_lab_number>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <pcr_order_number openmrs_concept=\"2042^PCR ORDER NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </pcr_order_number>\,,,,,,,,,,,,,,,,,
    <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </name_of_mother>\,,,,,,,,,,,,,,,,,
    <entry_point_into_pcr_testing_referal_type multiple=\"1\" openmrs_concept=\"1046^ENTRY POINT INTO PCR TESTING, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <referred_from_hiv_treatment_day_hospital openmrs_concept=\"844^REFERRED FROM HIV TREATMENT (DAY HOSPITAL)^99DCT\">false</referred_from_hiv_treatment_day_hospital>\,,,,,,,,,,,,,,,,,
        <referred_from_pediatric_treatment openmrs_concept=\"1044^REFERRED FROM PEDIATRIC TREATMENT^99DCT\">false</referred_from_pediatric_treatment>\,,,,,,,,,,,,,,,,,
        <child_at_risk_clinic openmrs_concept=\"1872^CHILD AT RISK CLINIC^99DCT\">false</child_at_risk_clinic>\,,,,,,,,,,,,,,,,,
        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
        <referred_from_prevention_of_vertical_transmission openmrs_concept=\"1939^REFERRED FROM PREVENTION OF VERTICAL TRANSMISSION^99DCT\">false</referred_from_prevention_of_vertical_transmission>\,,,,,,,,,,,,,,,,,
    </entry_point_into_pcr_testing_referal_type>\,,,,,,,,,,,,,,,,,
    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </infant_feeding_method>\,,,,,,,,,,,,,,,,,
    <age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </age_weaned_from_breast_feeding_months>\,,,,,,,,,,,,,,,,,
    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
    </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
    <ptv_treatment_child openmrs_concept=\"1970^PTV TREATMENT CHILD^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prevention_of_vertical_trasmission_child multiple=\"1\" openmrs_concept=\"1836^PREVENTION OF VERTICAL TRASMISSION, CHILD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
      </prevention_of_vertical_trasmission_child>\,,,,,,,,,,,,,,,,,
      <duration openmrs_concept=\"1710^DURATION^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </duration>\,,,,,,,,,,,,,,,,,
    </ptv_treatment_child>\,,,,,,,,,,,,,,,,,
    <polymerase_chain_reaction_test openmrs_concept=\"2001^POLYMERASE CHAIN REACTION TEST^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_dna_polymerase_chain_reaction_qualitative>\,,,,,,,,,,,,,,,,,
      <polymerase_chain_reaction_date_ordered openmrs_concept=\"1998^POLYMERASE CHAIN REACTION, DATE ORDERED^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </polymerase_chain_reaction_date_ordered>\,,,,,,,,,,,,,,,,,
      <polymerase_chain_reaction_result_return_date openmrs_concept=\"1999^POLYMERASE CHAIN REACTION RESULT RETURN DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </polymerase_chain_reaction_result_return_date>\,,,,,,,,,,,,,,,,,
      <polymerase_chain_reaction_laboratory_technician openmrs_concept=\"2000^POLYMERASE CHAIN REACTION, LABORATORY TECHNICIAN^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </polymerase_chain_reaction_laboratory_technician>\,,,,,,,,,,,,,,,,,
    </polymerase_chain_reaction_test>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28bb654-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
84,STI,0.1,130,0,MISAU: REGISTRO DIIO DOS CASOS DE DTS ANTENDIDOS NAS CONSULTAS DE TRIAGEM MEDICINA E SMI - ABORDAGEM SINDRICA,2,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"STI\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/84-0.1-130.xsn\" solutionVersion=\"0.1.0.130\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/84-130\" id=\"84\" name=\"STI\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <sti_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(7).getIdentifier()}</sti_number>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <review_of_systems_genitourinary multiple=\"1\" openmrs_concept=\"1080^REVIEW OF SYSTEMS, GENITOURINARY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <urinary_tract_infection openmrs_concept=\"55^URINARY TRACT INFECTION^99DCT\">false</urinary_tract_infection>\,,,,,,,,,,,,,,,,,
        <hematuria openmrs_concept=\"840^HEMATURIA^99DCT\">false</hematuria>\,,,,,,,,,,,,,,,,,
        <menstruating openmrs_concept=\"5989^MENSTRUATING^99DCT\">false</menstruating>\,,,,,,,,,,,,,,,,,
        <menopausal openmrs_concept=\"5990^MENOPAUSAL^99DCT\">false</menopausal>\,,,,,,,,,,,,,,,,,
        <vaginal_discharge openmrs_concept=\"5993^VAGINAL DISCHARGE^99DCT\">false</vaginal_discharge>\,,,,,,,,,,,,,,,,,
        <urethral_discharge openmrs_concept=\"5995^URETHRAL DISCHARGE^99DCT\">false</urethral_discharge>\,,,,,,,,,,,,,,,,,
        <dysuria openmrs_concept=\"6020^DYSURIA^99DCT\">false</dysuria>\,,,,,,,,,,,,,,,,,
        <oliguria openmrs_concept=\"6021^OLIGURIA^99DCT\">false</oliguria>\,,,,,,,,,,,,,,,,,
        <renal_disease openmrs_concept=\"6033^RENAL DISEASE^99DCT\">false</renal_disease>\,,,,,,,,,,,,,,,,,
        <negative openmrs_concept=\"664^NEGATIVE^99DCT\">false</negative>\,,,,,,,,,,,,,,,,,
        <genital_sores openmrs_concept=\"864^GENITAL SORES^99DCT\">false</genital_sores>\,,,,,,,,,,,,,,,,,
    </review_of_systems_genitourinary>\,,,,,,,,,,,,,,,,,
    <return_visit multiple=\"0\" openmrs_concept=\"1992^RETURN VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </return_visit>\,,,,,,,,,,,,,,,,,
    <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </pregant>\,,,,,,,,,,,,,,,,,
    <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </rapid_plasma_reagin>\,,,,,,,,,,,,,,,,,
    <treatment_non-coded openmrs_concept=\"2002^TREATMENT, NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </treatment_non-coded>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28bbfe6-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
90,BUSCA ACTIVA,0.1,38,0,Busca Activa,21,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"BUSCA ACTIVA\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/90-0.1-38.xsn\" solutionVersion=\"0.1.0.38\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/90-38\" id=\"90\" name=\"BUSCA ACTIVA\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <activist_located_missing_patient multiple=\"0\" openmrs_concept=\"2003^ACTIVIST LOCATED MISSING PATIENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </activist_located_missing_patient>\,,,,,,,,,,,,,,,,,
    <organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </organization>\,,,,,,,,,,,,,,,,,
    <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </personal_reference_-_name>\,,,,,,,,,,,,,,,,,
    <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </personal_reference_-_surname>\,,,,,,,,,,,,,,,,,
    <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </personal_reference_-_telephone_number>\,,,,,,,,,,,,,,,,,
    <date_patient_went_missing openmrs_concept=\"2004^DATE PATIENT WENT MISSING^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_patient_went_missing>\,,,,,,,,,,,,,,,,,
    <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </pregant>\,,,,,,,,,,,,,,,,,
    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
    <reason_patient_missed_visit multiple=\"1\" openmrs_concept=\"2016^REASON PATIENT MISSED VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <patient_forgot_visit_date openmrs_concept=\"2005^PATIENT FORGOT VISIT DATE^99DCT\">false</patient_forgot_visit_date>\,,,,,,,,,,,,,,,,,
        <patient_is_treating_hiv_with_traditional_medicine openmrs_concept=\"2013^PATIENT IS TREATING HIV WITH TRADITIONAL MEDICINE^99DCT\">false</patient_is_treating_hiv_with_traditional_medicine>\,,,,,,,,,,,,,,,,,
        <patient_has_social_problems openmrs_concept=\"2009^PATIENT HAS SOCIAL PROBLEMS^99DCT\">false</patient_has_social_problems>\,,,,,,,,,,,,,,,,,
        <patient_took_a_trip openmrs_concept=\"2011^PATIENT TOOK A TRIP^99DCT\">false</patient_took_a_trip>\,,,,,,,,,,,,,,,,,
        <distance_or_money_for_transport_is_to_much_for_patient openmrs_concept=\"2007^DISTANCE OR MONEY FOR TRANSPORT IS TO MUCH FOR PATIENT^99DCT\">false</distance_or_money_for_transport_is_to_much_for_patient>\,,,,,,,,,,,,,,,,,
        <patients_work_prevents_clinic_visit openmrs_concept=\"2014^PATIENTS WORK PREVENTS CLINIC VISIT^99DCT\">false</patients_work_prevents_clinic_visit>\,,,,,,,,,,,,,,,,,
        <patient_has_lack_of_motivation openmrs_concept=\"2012^PATIENT HAS LACK OF MOTIVATION^99DCT\">false</patient_has_lack_of_motivation>\,,,,,,,,,,,,,,,,,
        <patient_has_lack_of_food openmrs_concept=\"2008^PATIENT HAS LACK OF FOOD^99DCT\">false</patient_has_lack_of_food>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <patient_is_dissatisfied_with_day_hospital_services openmrs_concept=\"2010^PATIENT IS DISSATISFIED WITH DAY HOSPITAL SERVICES^99DCT\">false</patient_is_dissatisfied_with_day_hospital_services>\,,,,,,,,,,,,,,,,,
        <patient_does_not_like_arv_treatment_side_effects openmrs_concept=\"2015^PATIENT DOES NOT LIKE ARV TREATMENT SIDE EFFECTS^99DCT\">false</patient_does_not_like_arv_treatment_side_effects>\,,,,,,,,,,,,,,,,,
        <patient_is_bedridden_at_home openmrs_concept=\"2006^PATIENT IS BEDRIDDEN AT HOME^99DCT\">false</patient_is_bedridden_at_home>\,,,,,,,,,,,,,,,,,
        <other_reason_why_patient_missed_visit openmrs_concept=\"2017^OTHER REASON WHY PATIENT MISSED VISIT ^99DCT\">false</other_reason_why_patient_missed_visit>\,,,,,,,,,,,,,,,,,
    </reason_patient_missed_visit>\,,,,,,,,,,,,,,,,,
    <other_reason_why_patient_missed_visit openmrs_concept=\"2017^OTHER REASON WHY PATIENT MISSED VISIT ^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_reason_why_patient_missed_visit>\,,,,,,,,,,,,,,,,,
    <arrangements_required_for_patient_to_visit_hospital multiple=\"1\" openmrs_concept=\"2022^ARRANGEMENTS REQUIRED FOR PATIENT TO VISIT HOSPITAL^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <patient_will_borrow_money openmrs_concept=\"2021^PATIENT WILL BORROW MONEY^99DCT\">false</patient_will_borrow_money>\,,,,,,,,,,,,,,,,,
        <patient_will_leave_children_with_somebody openmrs_concept=\"2019^PATIENT WILL LEAVE CHILDREN WITH SOMEBODY^99DCT\">false</patient_will_leave_children_with_somebody>\,,,,,,,,,,,,,,,,,
        <patient_will_get_a_ride openmrs_concept=\"2018^PATIENT WILL GET A RIDE^99DCT\">false</patient_will_get_a_ride>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <patient_will_get_authorization_from_work openmrs_concept=\"2020^PATIENT WILL GET AUTHORIZATION FROM WORK^99DCT\">false</patient_will_get_authorization_from_work>\,,,,,,,,,,,,,,,,,
        <patient_is_bedridden_at_home openmrs_concept=\"2006^PATIENT IS BEDRIDDEN AT HOME^99DCT\">false</patient_is_bedridden_at_home>\,,,,,,,,,,,,,,,,,
    </arrangements_required_for_patient_to_visit_hospital>\,,,,,,,,,,,,,,,,,
    <other_arrangements_for_patient_to_get_to_hospital openmrs_concept=\"2023^OTHER ARRANGEMENTS FOR PATIENT TO GET TO HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_arrangements_for_patient_to_get_to_hospital>\,,,,,,,,,,,,,,,,,
    <reason_patient_not_found_by_activist multiple=\"1\" openmrs_concept=\"2031^REASON PATIENT NOT FOUND BY ACTIVIST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <patient_record_has_wrong_address openmrs_concept=\"2024^PATIENT RECORD HAS WRONG ADDRESS^99DCT\">false</patient_record_has_wrong_address>\,,,,,,,,,,,,,,,,,
        <transferred_out_to_another_facility openmrs_concept=\"1706^TRANSFERRED OUT TO ANOTHER FACILITY^99DCT\">false</transferred_out_to_another_facility>\,,,,,,,,,,,,,,,,,
        <patient_was_admitted_at_hospital openmrs_concept=\"2028^PATIENT WAS ADMITTED AT HOSPITAL^99DCT\">false</patient_was_admitted_at_hospital>\,,,,,,,,,,,,,,,,,
        <patient_took_a_trip openmrs_concept=\"2011^PATIENT TOOK A TRIP^99DCT\">false</patient_took_a_trip>\,,,,,,,,,,,,,,,,,
        <patient_moved_houses openmrs_concept=\"2026^PATIENT MOVED HOUSES^99DCT\">false</patient_moved_houses>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <patient_is_dead openmrs_concept=\"2027^PATIENT IS DEAD^99DCT\">false</patient_is_dead>\,,,,,,,,,,,,,,,,,
        <patient_was_working_on_their_farm openmrs_concept=\"2029^PATIENT WAS WORKING ON THEIR FARM^99DCT\">false</patient_was_working_on_their_farm>\,,,,,,,,,,,,,,,,,
        <nobody_answered_at_patients_home openmrs_concept=\"2025^NOBODY ANSWERED AT PATIENTS HOME^99DCT\">false</nobody_answered_at_patients_home>\,,,,,,,,,,,,,,,,,
        <patient_was_at_work openmrs_concept=\"2030^PATIENT WAS AT WORK^99DCT\">false</patient_was_at_work>\,,,,,,,,,,,,,,,,,
        <other_reasons_why_patient_was_not_located_by_activist openmrs_concept=\"2032^OTHER REASONS WHY PATIENT WAS NOT LOCATED BY ACTIVIST^99DCT\">false</other_reasons_why_patient_was_not_located_by_activist>\,,,,,,,,,,,,,,,,,
    </reason_patient_not_found_by_activist>\,,,,,,,,,,,,,,,,,
    <other_reasons_why_patient_was_not_located_by_activist openmrs_concept=\"2032^OTHER REASONS WHY PATIENT WAS NOT LOCATED BY ACTIVIST^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_reasons_why_patient_was_not_located_by_activist>\,,,,,,,,,,,,,,,,,
    <reason_patient_not_found_provided_by multiple=\"1\" openmrs_concept=\"2037^REASON PATIENT NOT FOUND PROVIDED BY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <chief_of_neighborhood_provided_reason_patient_was_not_located openmrs_concept=\"2036^CHIEF OF NEIGHBORHOOD PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</chief_of_neighborhood_provided_reason_patient_was_not_located>\,,,,,,,,,,,,,,,,,
        <neighbor_provided_reason_patient_was_not_located openmrs_concept=\"2034^NEIGHBOR PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</neighbor_provided_reason_patient_was_not_located>\,,,,,,,,,,,,,,,,,
        <relative_provided_reason_patient_was_not_located openmrs_concept=\"2035^RELATIVE PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</relative_provided_reason_patient_was_not_located>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <confidant_provided_reason_patient_was_not_located openmrs_concept=\"2033^CONFIDANT PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</confidant_provided_reason_patient_was_not_located>\,,,,,,,,,,,,,,,,,
    </reason_patient_not_found_provided_by>\,,,,,,,,,,,,,,,,,
    <who_provided_reason_patient_not_found_other openmrs_concept=\"2038^WHO PROVIDED REASON PATIENT NOT FOUND, OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </who_provided_reason_patient_not_found_other>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false</social_support_services>\,,,,,,,,,,,,,,,,,
        <tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false</tuberculosis_treatment_or_dot_program>\,,,,,,,,,,,,,,,,,
        <disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false</disclosure_counseling>\,,,,,,,,,,,,,,,,,
        <nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false</nutritional_support>\,,,,,,,,,,,,,,,,,
        <adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false</adherence_counseling>\,,,,,,,,,,,,,,,,,
        <mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false</mental_health_services>\,,,,,,,,,,,,,,,,,
        <psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false</psychosocial_counseling>\,,,,,,,,,,,,,,,,,
        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\,,,,,,,,,,,,,,,,,
        <family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false</family_planning_services>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false</alcohol_counseling>\,,,,,,,,,,,,,,,,,
        <inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false</inpatient_care_or_hospitalization>\,,,,,,,,,,,,,,,,,
        <home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false</home_based_care>\,,,,,,,,,,,,,,,,,
        <plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false</plano_nacional_para_combate_tuberculose>\,,,,,,,,,,,,,,,,,
        <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false</day_hospital>\,,,,,,,,,,,,,,,,,
        <medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false</medical_consultation>\,,,,,,,,,,,,,,,,,
        <triage openmrs_concept=\"1887^TRIAGE^99DCT\">false</triage>\,,,,,,,,,,,,,,,,,
        <pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false</pre-natal_consultation>\,,,,,,,,,,,,,,,,,
        <association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false</association_of_people_with_hiv>\,,,,,,,,,,,,,,,,,
        <sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false</sexually_transmitted_disease_consultation>\,,,,,,,,,,,,,,,,,
        <domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false</domestic_visit>\,,,,,,,,,,,,,,,,,
        <voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false</voluntary_counceling_and_testing>\,,,,,,,,,,,,,,,,,
        <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false</referral_other>\,,,,,,,,,,,,,,,,
        <family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false</family_was_referred_to_the_health_unit>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referral_other>\,,,,,,,,,,,,,,,,,
    <activists_observations openmrs_concept=\"2041^ACTIVISTS OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </activists_observations>\,,,,,,,,,,,,,,,,,
    <on_arv_treatment multiple=\"0\" openmrs_concept=\"2052^ON ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </on_arv_treatment>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",9,12/10/2008 14:53,13,1/11/2011 15:23,0,,,,e28fa7dc-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
91,TARV: ACONSELHAMENTO SEGUIMENTO,0.1,45,0,Seguimento de Aconselhamento TARV,24,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: ACONSELHAMENTO SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/91-0.1-45.xsn\" solutionVersion=\"0.1.0.45\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/91-45\" id=\"91\" name=\"TARV: ACONSELHAMENTO SEGUIMENTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <other_masses_description openmrs_concept=\"1553^OTHER MASSES, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_masses_description>\,,,,,,,,,,,,,,,,,
    <attendance_type multiple=\"0\" openmrs_concept=\"2047^ATTENDANCE TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </attendance_type>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28fae8a-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
92,TUBERCULOSE: PROCESSO,0.1,69,0,FICHA INDIVIDUAL DE TRATAMENTO DE TUBERCULOSE,26,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TUBERCULOSE: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/92-0.1-69.xsn\" solutionVersion=\"0.1.0.69\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/92-69\" id=\"92\" name=\"TUBERCULOSE: PROCESSO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}</nit>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment_plan>\,,,,,,,,,,,,,,,,,
    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_drug_treatment_start_date>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </type_of_tuberculosis>\,,,,,,,,,,,,,,,,,
    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </tubuculosis_exams>\,,,,,,,,,,,,,,,,,
      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </sputum_for_acid_fast_bacilli>\,,,,,,,,,,,,,,,,,
      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </x-ray_chest>\,,,,,,,,,,,,,,,,,
      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ultrasound_tb>\,,,,,,,,,,,,,,,,,
      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymph_node_biopsy>\,,,,,,,,,,,,,,,,,
      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </paracentesis>\,,,,,,,,,,,,,,,,,
      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </thoracentesis>\,,,,,,,,,,,,,,,,,
      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </purified_protein_derivative>\,,,,,,,,,,,,,,,,,
      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gastric_levage>\,,,,,,,,,,,,,,,,,
      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </test_other>\,,,,,,,,,,,,,,,,,
      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </bailey_months>\,,,,,,,,,,,,,,,,,
      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </weight_kg>\,,,,,,,,,,,,,,,,,
      <number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_layers>\,,,,,,,,,,,,,,,,,
    </tuberculosis_exams_set>\,,,,,,,,,,,,,,,,,
    <date_of_administration_of_medication_for_tb_intensive_phase openmrs_concept=\"1650^DATE OF ADMINISTRATION OF MEDICATION FOR TB, INTENSIVE PHASE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_administration_of_medication_for_tb_intensive_phase>\,,,,,,,,,,,,,,,,,
    <patient_reported_current_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1111^PATIENT REPORTED CURRENT TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_reported_current_tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
    <date_of_tb_administration_of_medication_maintenance_phase openmrs_concept=\"2058^DATE OF TB ADMINISTRATION OF MEDICATION, MAINTENANCE PHASE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_tb_administration_of_medication_maintenance_phase>\,,,,,,,,,,,,,,,,,
    <transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </transfer_from_other_facility_facility_name>\,,,,,,,,,,,,,,,,,
      <transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </transferred_out_to_another_facility_facility_name>\,,,,,,,,,,,,,,,,,
    </transfer_facility_names>\,,,,,,,,,,,,,,,,,
    <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </entry_point_into_hiv_care_referal_type>\,,,,,,,,,,,,,,,,,
    <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hospital_slash_clinic>\,,,,,,,,,,,,,,,,,
    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_name>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_surname>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_telephone_number>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_address openmrs_concept=\"2067^PERSONAL REFERENCE - ADDRESS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_address>\,,,,,,,,,,,,,,,,,
    </personal_reference>\,,,,,,,,,,,,,,,,,
    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_patient_hiv_positive>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"1\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </day_hospital>\,,,,,,,,,,,,,,,,,
    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </historical_drug_start_date>\,,,,,,,,,,,,,,,,,
    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_tuberculosis_treatment_stopped>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28fb36c-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
93,PTV-CPN: PROCESSO,0.1,52,0,"Processo de PTV - CPN, Adaptado do LIVRO OFICIAL DA PTV - CPN",11,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV-CPN: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/93-0.1-52.xsn\" solutionVersion=\"0.1.0.52\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/93-52\" id=\"93\" name=\"PTV-CPN: PROCESSO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <ptv-cpn_codigo openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(6).getIdentifier()}</ptv-cpn_codigo>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_visit_number>\,,,,,,,,,,,,,,,,,
    </visit_number_and_weeks_pregnant_ptv>\,,,,,,,,,,,,,,,,,
    <first_pregnant multiple=\"0\" openmrs_concept=\"2073^FIRST PREGNANT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </first_pregnant>\,,,,,,,,,,,,,,,,,
    <estimated_date_of_confinement openmrs_concept=\"5596^ESTIMATED DATE OF CONFINEMENT^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </estimated_date_of_confinement>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
    <planned_date_to_administer_nvp_during_pregnancy openmrs_concept=\"1802^PLANNED DATE TO ADMINISTER NVP DURING PREGNANCY^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </planned_date_to_administer_nvp_during_pregnancy>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28fbefc-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
94,TUBERCULOSE: SEGUIMENTO,0.1,74,0,FICHA DE SEGUIMENTO DE DOENTES COM TUBERCULOSE,27,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TUBERCULOSE: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/94-0.1-74.xsn\" solutionVersion=\"0.1.0.74\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/94-74\" id=\"94\" name=\"TUBERCULOSE: SEGUIMENTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}</nit>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment_plan>\,,,,,,,,,,,,,,,,,
    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_drug_treatment_start_date>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </type_of_tuberculosis>\,,,,,,,,,,,,,,,,,
    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </tubuculosis_exams>\,,,,,,,,,,,,,,,,,
      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </sputum_for_acid_fast_bacilli>\,,,,,,,,,,,,,,,,,
      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </x-ray_chest>\,,,,,,,,,,,,,,,,,
      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ultrasound_tb>\,,,,,,,,,,,,,,,,,
      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymph_node_biopsy>\,,,,,,,,,,,,,,,,,
      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </paracentesis>\,,,,,,,,,,,,,,,,,
      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </thoracentesis>\,,,,,,,,,,,,,,,,,
      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </purified_protein_derivative>\,,,,,,,,,,,,,,,,,
      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gastric_levage>\,,,,,,,,,,,,,,,,,
      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </test_other>\,,,,,,,,,,,,,,,,,
      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </bailey_months>\,,,,,,,,,,,,,,,,,
      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </weight_kg>\,,,,,,,,,,,,,,,,,
      <number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_layers>\,,,,,,,,,,,,,,,,,
    </tuberculosis_exams_set>\,,,,,,,,,,,,,,,,,
    <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hospital_slash_clinic>\,,,,,,,,,,,,,,,,,
    <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </day_hospital>\,,,,,,,,,,,,,,,,,
    <transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </transfer_from_other_facility_facility_name>\,,,,,,,,,,,,,,,,,
      <transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </transferred_out_to_another_facility_facility_name>\,,,,,,,,,,,,,,,,,
    </transfer_facility_names>\,,,,,,,,,,,,,,,,,
    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </historical_drug_start_date>\,,,,,,,,,,,,,,,,,
    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_tuberculosis_treatment_stopped>\,,,,,,,,,,,,,,,,,
    <tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
    </tuberculosis_prophylaxis_started>\,,,,,,,,,,,,,,,,,
    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_rapid_test_1_qualitative>\,,,,,,,,,,,,,,,,,
    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </medication_quantity_available>\,,,,,,,,,,,,,,,,,
    <number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_children>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e28fcb2c-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
95,PTV-CPN: SEGUIMENTO - PILOTO,0.1,77,0,FICHA DE SEGUIMENTO DE PTV na CPN,12,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV-CPN: SEGUIMENTO - PILOTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/95-0.1-77.xsn\" solutionVersion=\"0.1.0.77\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/95-77\" id=\"95\" name=\"PTV-CPN: SEGUIMENTO - PILOTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <codigo_ptv_cpn openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()}</codigo_ptv_cpn>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <nid_servico_tarv openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid_servico_tarv>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_visit_number>\,,,,,,,,,,,,,,,,,
    </visit_number_and_weeks_pregnant_ptv>\,,,,,,,,,,,,,,,,,
    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_counceling>\,,,,,,,,,,,,,,,,,
    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_rapid_test_1_qualitative>\,,,,,,,,,,,,,,,,,
    <accepts_home_visit multiple=\"0\" openmrs_concept=\"2071^ACCEPTS HOME VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </accepts_home_visit>\,,,,,,,,,,,,,,,,,
    <fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </fansidar_dose>\,,,,,,,,,,,,,,,,,
    <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </rapid_plasma_reagin>\,,,,,,,,,,,,,,,,,
    <malarial_smear multiple=\"0\" openmrs_concept=\"32^MALARIAL SMEAR^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </malarial_smear>\,,,,,,,,,,,,,,,,,
    <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hemoglobin>\,,,,,,,,,,,,,,,,,
    <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cd4_count>\,,,,,,,,,,,,,,,,,
    <patient_received_cd4_results multiple=\"0\" openmrs_concept=\"2072^PATIENT RECEIVED CD4 RESULTS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_cd4_results>\,,,,,,,,,,,,,,,,,
    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_who_hiv_stage>\,,,,,,,,,,,,,,,,,
    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
    </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </historical_drug_start_date>\,,,,,,,,,,,,,,,,,
    <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </entry_point_into_hiv_care_patient_code_at_location>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
    <result_of_hiv_test_of_partner multiple=\"0\" openmrs_concept=\"2074^RESULT OF HIV TEST OF PARTNER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </result_of_hiv_test_of_partner>\,,,,,,,,,,,,,,,,,
    <partner_received_counceling multiple=\"0\" openmrs_concept=\"2075^PARTNER RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </partner_received_counceling>\,,,,,,,,,,,,,,,,,
    <antiretroviral_drugs multiple=\"1\" openmrs_concept=\"1085^ANTIRETROVIRAL DRUGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <unknown_antiretroviral_drug openmrs_concept=\"5811^UNKNOWN ANTIRETROVIRAL DRUG^99DCT\">false</unknown_antiretroviral_drug>\,,,,,,,,,,,,,,,,,
        <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\,,,,,,,,,,,,,,,,,
        <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\,,,,,,,,,,,,,,,,,
        <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
        <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\,,,,,,,,,,,,,,,,,
        <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\,,,,,,,,,,,,,,,,,
        <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\,,,,,,,,,,,,,,,,,
        <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\,,,,,,,,,,,,,,,,,
        <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\,,,,,,,,,,,,,,,,,
        <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\,,,,,,,,,,,,,,,,,
    </antiretroviral_drugs>\,,,,,,,,,,,,,,,,,
    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </medication_quantity_available>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28ff412-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
96,PTV: MATERNIDADE - PILOTO,0.1,63,0,Livro: Programa de Preveno de Transmiss Vertical para Maternidade,23,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV: MATERNIDADE - PILOTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/96-0.1-63.xsn\" solutionVersion=\"0.1.0.63\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/96-63\" id=\"96\" name=\"PTV: MATERNIDADE - PILOTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <ptv_maternity_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(8).getIdentifier()}</ptv_maternity_code>\,,,,,,,,,,,,,,,,,
    <ptv-cpn_codigo openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(6).getIdentifier()}</ptv-cpn_codigo>\,,,,,,,,,,,,,,,,,
    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <hour_mother_entered_hospital_to_give_birth openmrs_concept=\"1828^HOUR MOTHER ENTERED HOSPITAL TO GIVE BIRTH^99DCT\" openmrs_datatype=\"TM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hour_mother_entered_hospital_to_give_birth>\,,,,,,,,,,,,,,,,,
    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
    <dilation_on_entering_hospital openmrs_concept=\"1813^DILATION ON ENTERING HOSPITAL ^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </dilation_on_entering_hospital>\,,,,,,,,,,,,,,,,,
    <administration_of_arv_during_delivery openmrs_concept=\"1824^ADMINISTRATION OF ARV DURING DELIVERY^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
            <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
            <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
      <nevirapine_administered_at_home multiple=\"0\" openmrs_concept=\"1814^NEVIRAPINE ADMINISTERED AT HOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </nevirapine_administered_at_home>\,,,,,,,,,,,,,,,,,
      <hour_nvp_taken_in_maternity openmrs_concept=\"1829^HOUR NVP TAKEN IN MATERNITY^99DCT\" openmrs_datatype=\"TS\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hour_nvp_taken_in_maternity>\,,,,,,,,,,,,,,,,,
      <patient_vomited_within_an_hour_of_taking_nevirapine multiple=\"0\" openmrs_concept=\"1815^PATIENT VOMITED WITHIN AN HOUR OF TAKING NEVIRAPINE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_vomited_within_an_hour_of_taking_nevirapine>\,,,,,,,,,,,,,,,,,
      <administration_of_azt_during_pregnacy multiple=\"0\" openmrs_concept=\"2087^ADMINISTRATION OF AZT DURING PREGNACY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </administration_of_azt_during_pregnacy>\,,,,,,,,,,,,,,,,,
      <patient_took_nevirapine_in_maternity multiple=\"0\" openmrs_concept=\"1816^PATIENT TOOK NEVIRAPINE IN MATERNITY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_took_nevirapine_in_maternity>\,,,,,,,,,,,,,,,,,
      <azt_during_delivery multiple=\"1\" openmrs_concept=\"2088^AZT DURING DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <three_doses openmrs_concept=\"2084^THREE DOSES^99DCT\">false</three_doses>\,,,,,,,,,,,,,,,,,
            <one_dose openmrs_concept=\"1182^ONE DOSE^99DCT\">false</one_dose>\,,,,,,,,,,,,,,,,,
            <four_doses openmrs_concept=\"2085^FOUR DOSES^99DCT\">false</four_doses>\,,,,,,,,,,,,,,,,,
            <two_doses openmrs_concept=\"1183^TWO DOSES^99DCT\">false</two_doses>\,,,,,,,,,,,,,,,,,
      </azt_during_delivery>\,,,,,,,,,,,,,,,,,
      <azt_slash_3tc_for_mother multiple=\"1\" openmrs_concept=\"2089^AZT/3TC FOR MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <three_doses openmrs_concept=\"2084^THREE DOSES^99DCT\">false</three_doses>\,,,,,,,,,,,,,,,,,
            <one_dose openmrs_concept=\"1182^ONE DOSE^99DCT\">false</one_dose>\,,,,,,,,,,,,,,,,,
            <four_doses openmrs_concept=\"2085^FOUR DOSES^99DCT\">false</four_doses>\,,,,,,,,,,,,,,,,,
            <two_doses openmrs_concept=\"1183^TWO DOSES^99DCT\">false</two_doses>\,,,,,,,,,,,,,,,,,
      </azt_slash_3tc_for_mother>\,,,,,,,,,,,,,,,,,
    </administration_of_arv_during_delivery>\,,,,,,,,,,,,,,,,,
    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </infant_feeding_method>\,,,,,,,,,,,,,,,,,
    <received_counceling_for_infant_feeding_method multiple=\"0\" openmrs_concept=\"2086^RECEIVED COUNCELING FOR INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </received_counceling_for_infant_feeding_method>\,,,,,,,,,,,,,,,,,
    <time_of_birth openmrs_concept=\"1830^DATE AND TIME NVP TAKEN AT HOME^99DCT\" openmrs_datatype=\"TS\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </time_of_birth>\,,,,,,,,,,,,,,,,,
    <location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </location_of_delivery>\,,,,,,,,,,,,,,,,,
    <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </birth_weight_kg>\,,,,,,,,,,,,,,,,,
    <stillborn multiple=\"0\" openmrs_concept=\"1819^STILLBORN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </stillborn>\,,,,,,,,,,,,,,,,,
    <prophylaxis_administered_to_newborn openmrs_concept=\"1825^PROPHYLAXIS ADMINISTERED TO NEWBORN^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <first_dose_of_nevirapine_given_to_child_at_birth multiple=\"0\" openmrs_concept=\"1821^FIRST DOSE OF NEVIRAPINE GIVEN TO CHILD AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </first_dose_of_nevirapine_given_to_child_at_birth>\,,,,,,,,,,,,,,,,,
      <_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth multiple=\"0\" openmrs_concept=\"1822^2ND DOSE OF NEVIRAPINE GIVEN TO CHILD 48 TO 72 HOURS AFER BIRTH^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth>\,,,,,,,,,,,,,,,,,
      <mother_took_azt_syrup_home multiple=\"0\" openmrs_concept=\"1823^MOTHER TOOK AZT SYRUP HOME^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </mother_took_azt_syrup_home>\,,,,,,,,,,,,,,,,,
    </prophylaxis_administered_to_newborn>\,,,,,,,,,,,,,,,,,
    <ptv_hiv_result_set openmrs_concept=\"2090^PTV HIV RESULT, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <patient_was_tested_for_hiv_in_pre_natal_consultation multiple=\"0\" openmrs_concept=\"2078^PATIENT WAS TESTED FOR HIV IN PRE NATAL CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_was_tested_for_hiv_in_pre_natal_consultation>\,,,,,,,,,,,,,,,,,
      <hiv_result_for_test_taken_on_pre_natal_consultation multiple=\"0\" openmrs_concept=\"2079^HIV RESULT FOR TEST TAKEN ON PRE NATAL CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_result_for_test_taken_on_pre_natal_consultation>\,,,,,,,,,,,,,,,,,
      <patient_was_tested_on_pre-natal_consultation_more_than_3_months_ago multiple=\"0\" openmrs_concept=\"2080^PATIENT WAS TESTED ON PRE-NATAL CONSULTATION MORE THAN 3 MONTHS AGO^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </patient_was_tested_on_pre-natal_consultation_more_than_3_months_ago>\,,,,,,,,,,,,,,,,,
      <received_counceling_and_tested_on_maternity_before_delivery multiple=\"0\" openmrs_concept=\"2081^RECEIVED COUNCELING AND TESTED ON MATERNITY BEFORE DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </received_counceling_and_tested_on_maternity_before_delivery>\,,,,,,,,,,,,,,,,,
      <received_counceling_and_tested_on_maternity_after_delivery multiple=\"0\" openmrs_concept=\"2082^RECEIVED COUNCELING AND TESTED ON MATERNITY AFTER DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </received_counceling_and_tested_on_maternity_after_delivery>\,,,,,,,,,,,,,,,,,
      <hiv_result_for_test_taken_on_maternity_consultation multiple=\"0\" openmrs_concept=\"2083^HIV RESULT FOR TEST TAKEN ON MATERNITY CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </hiv_result_for_test_taken_on_maternity_consultation>\,,,,,,,,,,,,,,,,,
    </ptv_hiv_result_set>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28ff908-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
97,PTV-CPN: SEGUIMENTO,0.1,79,0,FICHA DE SEGUIMENTO DE PTV na CPN,12,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV-CPN: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/97-0.1-79.xsn\" solutionVersion=\"0.1.0.79\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/97-79\" id=\"97\" name=\"PTV-CPN: SEGUIMENTO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <codigo_ptv_cpn openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()}</codigo_ptv_cpn>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <nid_servico_tarv openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid_servico_tarv>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant>\,,,,,,,,,,,,,,,,,
      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_visit_number>\,,,,,,,,,,,,,,,,,
    </visit_number_and_weeks_pregnant_ptv>\,,,,,,,,,,,,,,,,,
    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_counceling>\,,,,,,,,,,,,,,,,,
    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_rapid_test_1_qualitative>\,,,,,,,,,,,,,,,,,
    <accepts_home_visit multiple=\"0\" openmrs_concept=\"2071^ACCEPTS HOME VISIT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </accepts_home_visit>\,,,,,,,,,,,,,,,,,
    <fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </fansidar_dose>\,,,,,,,,,,,,,,,,,
    <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </rapid_plasma_reagin>\,,,,,,,,,,,,,,,,,
    <malarial_smear multiple=\"0\" openmrs_concept=\"32^MALARIAL SMEAR^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </malarial_smear>\,,,,,,,,,,,,,,,,,
    <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hemoglobin>\,,,,,,,,,,,,,,,,,
    <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cd4_count>\,,,,,,,,,,,,,,,,,
    <patient_received_cd4_results multiple=\"0\" openmrs_concept=\"2072^PATIENT RECEIVED CD4 RESULTS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_received_cd4_results>\,,,,,,,,,,,,,,,,,
    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </current_who_hiv_stage>\,,,,,,,,,,,,,,,,,
    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\,,,,,,,,,,,,,,,,,
        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
    </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </historical_drug_start_date>\,,,,,,,,,,,,,,,,,
    <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </entry_point_into_hiv_care_patient_code_at_location>\,,,,,,,,,,,,,,,,,
    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </referrals_ordered>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
    <result_of_hiv_test_of_partner multiple=\"0\" openmrs_concept=\"2074^RESULT OF HIV TEST OF PARTNER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </result_of_hiv_test_of_partner>\,,,,,,,,,,,,,,,,,
    <partner_received_counceling multiple=\"0\" openmrs_concept=\"2075^PARTNER RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </partner_received_counceling>\,,,,,,,,,,,,,,,,,
    <antiretroviral_drugs multiple=\"1\" openmrs_concept=\"1085^ANTIRETROVIRAL DRUGS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <unknown_antiretroviral_drug openmrs_concept=\"5811^UNKNOWN ANTIRETROVIRAL DRUG^99DCT\">false</unknown_antiretroviral_drug>\,,,,,,,,,,,,,,,,,
        <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\,,,,,,,,,,,,,,,,,
        <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\,,,,,,,,,,,,,,,,,
        <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\,,,,,,,,,,,,,,,,,
        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\,,,,,,,,,,,,,,,,,
        <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\,,,,,,,,,,,,,,,,,
        <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\,,,,,,,,,,,,,,,,,
        <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\,,,,,,,,,,,,,,,,,
        <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\,,,,,,,,,,,,,,,,,
        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\,,,,,,,,,,,,,,,,,
        <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\,,,,,,,,,,,,,,,,,
        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\,,,,,,,,,,,,,,,,,
        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\,,,,,,,,,,,,,,,,,
        <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\,,,,,,,,,,,,,,,,,
        <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\,,,,,,,,,,,,,,,,,
        <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\,,,,,,,,,,,,,,,,,
        <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\,,,,,,,,,,,,,,,,,
    </antiretroviral_drugs>\,,,,,,,,,,,,,,,,,
    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </medication_quantity_available>\,,,,,,,,,,,,,,,,,
    <azt_profalaxis_for_prevention_of_vertical_transmission openmrs_concept=\"1803^AZT PROFALAXIS FOR PREVENTION OF VERTICAL TRANSMISSION^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_when_starting_azt_profolaxis openmrs_concept=\"1808^NUMBER OF WEEKS PREGNANT WHEN STARTING AZT PROFOLAXIS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_when_starting_azt_profolaxis>\,,,,,,,,,,,,,,,,,
      <date_of_prophylaxis_with_azt_azt_nvp_intrapartum openmrs_concept=\"2091^DATE OF PROPHYLAXIS WITH AZT (AZT + NVP INTRAPARTUM)^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </date_of_prophylaxis_with_azt_azt_nvp_intrapartum>\,,,,,,,,,,,,,,,,,
    </azt_profalaxis_for_prevention_of_vertical_transmission>\,,,,,,,,,,,,,,,,,
    <nevirapine_administered_during_prenatal_consultations openmrs_concept=\"1806^NEVIRAPINE ADMINISTERED DURING PRENATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </prenatal_arv_medication_mother>\,,,,,,,,,,,,,,,,,
      <number_of_weeks_pregnant_when_starting_nevirapine openmrs_concept=\"1812^NUMBER OF WEEKS PREGNANT WHEN STARTING NEVIRAPINE^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_weeks_pregnant_when_starting_nevirapine>\,,,,,,,,,,,,,,,,,
      <date_of_delivery_niverapine_at_pre-natal_consultations openmrs_concept=\"2092^DATE OF DELIVERY NIVERAPINE AT PRE-NATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </date_of_delivery_niverapine_at_pre-natal_consultations>\,,,,,,,,,,,,,,,,,
    </nevirapine_administered_during_prenatal_consultations>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:23,0,,,,e28ffd86-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
98,TUBERCULOSE: LIVRO,0.1,71,0,Livro de Registo de doentes com Tuberculose,25,<?xml version=\1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TUBERCULOSE: LIVRO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/98-0.1-71.xsn\" solutionVersion=\"0.1.0.71\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/98-71\" id=\"98\" name=\"TUBERCULOSE: LIVRO\" version=\"0.1\">\,,,,,,,,,,
  <header>\,,,,,,,,,,,,,,,,,
    <enterer>$!{enterer}</enterer>\,,,,,,,,,,,,,,,,,
    <date_entered>$!{dateEntered}</date_entered>\,,,,,,,,,,,,,,,,,
    <session>$!{sessionId}</session>\,,,,,,,,,,,,,,,,,
    <uid>$!{uid}</uid>\,,,,,,,,,,,,,,,,,
  </header>\,,,,,,,,,,,,,,,,,
  <patient>\,,,,,,,,,,,,,,,,,
    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\,,,,,,,,,,,,,,,,,
    <nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}</nit>\,,,,,,,,,,,,,,,,,
    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\,,,,,,,,,,,,,,,,,
    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\,,,,,,,,,,,,,,,,,
    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\,,,,,,,,,,,,,,,,,
    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\,,,,,,,,,,,,,,,,,
    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\,,,,,,,,,,,,,,,,,
    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\,,,,,,,,,,,,,,,,,
    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\,,,,,,,,,,,,,,,,,
    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\,,,,,,,,,,,,,,,,,
    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\,,,,,,,,,,,,,,,,,
    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\,,,,,,,,,,,,,,,,,
    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\,,,,,,,,,,,,,,,,,
    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\,,,,,,,,,,,,,,,,,
    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\,,,,,,,,,,,,,,,,,
    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\,,,,,,,,,,,,,,,,,
    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\,,,,,,,,,,,,,,,,,
    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\,,,,,,,,,,,,,,,,,
    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\,,,,,,,,,,,,,,,,,
    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\,,,,,,,,,,,,,,,,,
    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\,,,,,,,,,,,,,,,,,
    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\,,,,,,,,,,,,,,,,,
    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\,,,,,,,,,,,,,,,,,
    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\,,,,,,,,,,,,,,,,,
    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\,,,,,,,,,,,,,,,,,
    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\,,,,,,,,,,,,,,,,,
    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\,,,,,,,,,,,,,,,,,
  </patient>\,,,,,,,,,,,,,,,,,
  <encounter>\,,,,,,,,,,,,,,,,,
    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\,,,,,,,,,,,,,,,,,
  </encounter>\,,,,,,,,,,,,,,,,,
  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment_plan>\,,,,,,,,,,,,,,,,,
    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_drug_treatment_start_date>\,,,,,,,,,,,,,,,,,
    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </other_non-coded>\,,,,,,,,,,,,,,,,,
    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </type_of_tuberculosis>\,,,,,,,,,,,,,,,,,
    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </tubuculosis_exams>\,,,,,,,,,,,,,,,,,
      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </sputum_for_acid_fast_bacilli>\,,,,,,,,,,,,,,,,,
      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </x-ray_chest>\,,,,,,,,,,,,,,,,,
      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </ultrasound_tb>\,,,,,,,,,,,,,,,,,
      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </lymph_node_biopsy>\,,,,,,,,,,,,,,,,,
      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </paracentesis>\,,,,,,,,,,,,,,,,,
      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </thoracentesis>\,,,,,,,,,,,,,,,,,
      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </purified_protein_derivative>\,,,,,,,,,,,,,,,,,
      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </gastric_levage>\,,,,,,,,,,,,,,,,,
      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </test_other>\,,,,,,,,,,,,,,,,,
      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </bailey_months>\,,,,,,,,,,,,,,,,,
      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </weight_kg>\,,,,,,,,,,,,,,,,,
      <number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </number_of_layers>\,,,,,,,,,,,,,,,,,
    </tuberculosis_exams_set>\,,,,,,,,,,,,,,,,,
    <date_of_administration_of_medication_for_tb_intensive_phase openmrs_concept=\"1650^DATE OF ADMINISTRATION OF MEDICATION FOR TB, INTENSIVE PHASE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_administration_of_medication_for_tb_intensive_phase>\,,,,,,,,,,,,,,,,,
    <patient_reported_current_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1111^PATIENT REPORTED CURRENT TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </patient_reported_current_tuberculosis_treatment>\,,,,,,,,,,,,,,,,,
    <date_of_tb_administration_of_medication_maintenance_phase openmrs_concept=\"2058^DATE OF TB ADMINISTRATION OF MEDICATION, MAINTENANCE PHASE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </date_of_tb_administration_of_medication_maintenance_phase>\,,,,,,,,,,,,,,,,,
    <transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,
      <transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </transfer_from_other_facility_facility_name>\,,,,,,,,,,,,,,,,,
      <transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </transferred_out_to_another_facility_facility_name>\,,,,,,,,,,,,,,,,,
    </transfer_facility_names>\,,,,,,,,,,,,,,,,,
    <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </entry_point_into_hiv_care_referal_type>\,,,,,,,,,,,,,,,,,
    <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hospital_slash_clinic>\,,,,,,,,,,,,,,,,,
    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\,,,,,,,,,,,,,,,,,
      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_name>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_surname>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_telephone_number>\,,,,,,,,,,,,,,,,,
      <personal_reference_-_address openmrs_concept=\"2067^PERSONAL REFERENCE - ADDRESS^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
            <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
            <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
      </personal_reference_-_address>\,,,,,,,,,,,,,,,,,
    </personal_reference>\,,,,,,,,,,,,,,,,,
    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </is_patient_hiv_positive>\,,,,,,,,,,,,,,,,,
    <cotrimoxazole_use multiple=\"1\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\,,,,,,,,,,,,,,,,,
    </cotrimoxazole_use>\,,,,,,,,,,,,,,,,,
    <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </day_hospital>\,,,,,,,,,,,,,,,,,
    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </historical_drug_start_date>\,,,,,,,,,,,,,,,,,
    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </reason_tuberculosis_treatment_stopped>\,,,,,,,,,,,,,,,,,
    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </hiv_rapid_test_1_qualitative>\,,,,,,,,,,,,,,,,,
    <tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\,,,,,,,,,,,,,,,,,
        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\,,,,,,,,,,,,,,,,,
    </tuberculosis_prophylaxis_started>\,,,,,,,,,,,,,,,,,
    <number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\,,,,,,,,,,,,,,,,,
        <date xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <time xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
        <value xsi:nil=\"true\"/>\,,,,,,,,,,,,,,,,,
    </number_of_children>\,,,,,,,,,,,,,,,,,
  </obs>\,,,,,,,,,,,,,,,,,
  <other/></form>",<?xml version=\1.0\" encoding=\"UTF-8\"?>,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!--,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
OpenMRS FormEntry Form HL7 Translation,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
This XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Burke Mamlin, MD,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@author Ben Wolfe,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
@version 1.9.7,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.6 - added encounter/encounter.encounter_id to PV1-1,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.5 - allow for organizing sections under \"obs\" section,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37),,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) ,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
1.9.2 - first generally useful version,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
-->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:output method=\""text\"" version=\""1.0\"" encoding=\""UTF-8\"" indent=\""no\""/>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
                                                       <!-- for now, must match patient_identifier_type.name -->,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"/\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:apply-templates />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Form template -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template match=\"form\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- MSH Header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header", field separator, and encoding characters -->,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$SENDING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-APPLICATION\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$RECEIVING-FACILITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""header/uid\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""header/uid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""current-dateTime()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""@id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$FORM-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PID</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""pid\"" select=\""patient/patient.patient_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""type\"" select=\""L\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.previous_mrn\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""PRIOR\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Additional patient identifiers -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>~</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""patient_id\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""pid\"" select=\""patient/patient.mtctplus_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""auth\"" select=\""$PATIENT-AUTHORITY\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""type\"" select=\""MTCTPLUS\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PID-5 Patient name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- Family name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.family_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Given name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.given_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Middle name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.middle_name\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-6 Mother's maiden name -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""patient/patient.date_of_birth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- PV1 header -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>PV1</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.location_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.provider_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""encounter/encounter.encounter_id\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""patient/patient.health_center\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""replace(patient/patient.health_center",'\\^','&amp;')\" />,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- We use encounter date as the timestamp for each observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""encounterTimestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:with-param name=\""date\"" select=\""encounter/encounter.encounter_datetime\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:variable>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- ORC Common Order Segment -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>ORC</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:with-param name=\""date\"" select=\""xs:dateTime(header/date_entered)\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""header/enterer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsList\"" select=\""obs/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsListCount\"" select=\""count($obsList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>1</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""obs/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- observation OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""concat($setId",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Grouped observation(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- <xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" /> -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupList\"" select=\""obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""obsGroupListCount\"" select=\""count($obsGroupList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$obsGroupList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Observation OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Generate OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[(@openmrs_concept and value and value/text() != '') or *[@openmrs_concept and text()='true']]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""subId\"" select=\""1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""concat('1.'",position())\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Problem list(s) -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemList\"" select=\""problem_list/*[value[text() != '']]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""problemListCount\"" select=\""count($problemList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""problem_list/@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Problem list OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""$problemList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""datatype\"" select=\""'CWE'\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>		",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<!-- Orders -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderList\"" select=\""orders/*[*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]]\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:variable name=\""orderListCount\"" select=\""count($orderList)\"" as=\""xs:integer\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:for-each select=\""$orderList\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order section OBR -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>OBR</xsl:text>            <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""$obsListCount + $obsGroupListCount + $problemListCount + 1\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<!-- Order OBXs -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:for-each select=\""*[@openmrs_concept and ((value and value/text() != '') or *[@openmrs_concept and text() = 'true'])]\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""value\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""datatype\"" select=\""@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""units\"" select=\""@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""concept\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""date\"" select=\""date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""time\"" select=\""time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""value\"" select=\""value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:variable name=\""setId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:for-each select=\""*[@openmrs_concept and text() = 'true']\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						<xsl:call-template name=\""obsObx\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""setId\"" select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""subId\"" select=\""position()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""datatype\"" select=\""../@openmrs_datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""units\"" select=\""../@openmrs_units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""concept\"" select=\""../@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""date\"" select=\""../date/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""time\"" select=\""../time/text()\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""value\"" select=\""@openmrs_concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"							<xsl:with-param name=\""encounterTimestamp\"" select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"						</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:for-each>	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:for-each>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Patient Identifier (CX) generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"patient_id\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$pid\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check digit -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$auth\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>^</xsl:text>              <!-- Identifier Type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$type\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- OBX Generator -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"obsObx\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""setId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""subId\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""datatype\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""concept\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""value\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""units\"" required=\""no\""></xsl:param>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""encounterTimestamp\"" required=\""yes\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>OBX</xsl:text>                     <!-- Message type -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Set ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$setId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:text>NM</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$datatype\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$concept\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$subId\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Value -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TS'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'DT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'TM'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""time\"" select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$datatype = 'BIT'\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:when test=\""$value = '0' or upper-case($value) = 'FALSE'\"">0</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:otherwise>1</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$value\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Units -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:value-of select=\""$units\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Reference range -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Probability -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Observation result status -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Effective date -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date and $time\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Timestamp\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""dateTime($date",$time)\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:when test=\""$date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:with-param name=\""date\"" select=\""$date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:value-of select=\""$encounterTimestamp\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:text>&#x000d;</xsl:text>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted timestamp -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Timestamp\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(year-from-dateTime($date)",format-number(month-from-dateTime($date),'00'),format-number(day-from-dateTime($date),'00'),format-number(hours-from-dateTime($date),'00'),format-number(minutes-from-dateTime($date),'00'),format-number(floor(seconds-from-dateTime($date)),'00'))\" />,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted date -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Date\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""date\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""string($date) != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:choose>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:when test=\""contains(string($date)",'T')\">,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				<xsl:call-template name=\""hl7Date\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:with-param name=\""date\"" select=\""xs:date(substring-before($date",'T'))\" />,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"				</xsl:call-template>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:when>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			<xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"					<xsl:value-of select=\""concat(year-from-date($date)",format-number(month-from-date($date),'00'),format-number(day-from-date($date),'00'))\" />,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"			</xsl:otherwise>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		</xsl:choose>				",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<!-- Generate HL7-formatted time -->,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
<xsl:template name=\"hl7Time\">,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:param name=\""time\"" />",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	<xsl:if test=\""$time != ''\"">",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"		<xsl:value-of select=\""concat(format-number(hours-from-time($time)",'00'),format-number(minutes-from-time($time),'00'),format-number(floor(seconds-from-time($time)),'00'))\" />,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
"	</xsl:if>",,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:template>,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,
\,,,,,,,,,,,,,,,,,
</xsl:stylesheet>",1,7/18/2006 11:02,13,1/11/2011 15:24,0,,,,e2901708-1d5f-11e0-b929-000c29ad1d07,,,,,,,,
99,ADULTO: PROCESSO PARTE A - ANAMNESE,1,,0,"Processo clinico, servi TARV, Adulto: as duas primeiras paginas",5,,,13,2011-01-11 15:20,13,2014-05-07 12:51,0,,,,527a5141-2931-4546-b789-14125d30545a
100,ADULTO: PROCESSO PARTE B - EXAME CLINICO,1,,1,"Processo clinico, servico TARV, adulto: as duas ultimas paginas",1,,,13,2011-01-11 15:49,13,2012-03-27 13:08,0,,,,d3bda8e6-25f2-4fb9-a7cb-5c0cae4276de
101,ADULTO: SEGUIMENTO,1,,1,Ficha de seguimento de pacientes no servi TARV: Adulto,6,,,13,2011-01-11 15:00,13,2012-06-26 13:42,1,13,6/26/2012 13:33,Existe nova ficha de seguimento,8498935e-a226-478b-a24a-ac0265187ec0
102,ATS,1,,0,Aconselhamento e testagem em saude.,14,,,13,2011-01-11 17:51,13,2011-05-26 12:56,0,,,,ac6d2a83-7879-4bf5-89ab-ff16b1805d43
103,BUSCA ACTIVA,1,,0,Formulario de busca activa,21,,,13,2011-01-11 17:29,13,2011-05-26 12:38,0,,,,e90e66d8-8651-4b55-8c8e-6a75ae7719be
104,CCR: PROCESSO,1,,0,Processo de consulta de crians em risco,8,,,13,2011-01-11 17:54,13,2013-12-13 17:03,0,,,,bc06725c-2aba-42eb-9a5e-089d46eaae1c
105,CCR: SEGUIMENTO,1,,0,Seguimento de consulta de crians em risco,10,,,13,2011-01-11 17:30,13,2013-12-13 17:21,0,,,,60c02a76-6f1e-486c-95c2-a147cec0895d
106,LABORATORIO GERAL,1,,1,Ficha geral (de todos programas) para registo de resultados de exames laboratoriais,13,,,13,2011-01-11 17:53,13,2012-01-14 13:23,0,,,,8377e4ff-d0fe-44a5-81c3-74c9040fd5f8
107,PCR,1,,0,Ficha de colheita de amostras e resultado de PCR,22,,,13,2011-01-11 17:20,13,2011-05-26 12:55,0,,,,342dd283-0475-44fc-aea9-304fac6e1be4
108,PEDIATRIA: PROCESSO PARTE A - ANAMNESE,1,,0,"Processo clinico, servi TARV, Pediatria: as duas primeiras paginas",7,,,13,2011-01-11 17:45,13,2012-02-29 17:59,0,,,,6c620a7b-50d1-44a0-a1db-3258dd1194d1
109,PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO,1,,1,"Processo clinico, servi TARV, Pediatria: as duas ultimas paginas",3,,,13,2011-01-11 17:47,13,2013-12-12 17:59,0,,,,a7171965-0189-4174-9b0a-d58d557d5aec
110,PEDIATRIA: SEGUIMENTO,1,,1,"Ficha de seguimento, Servico TARV, Pediatria",9,,,13,2011-01-11 17:23,13,2012-06-26 13:28,1,13,6/26/2012 13:18,Existe nova ficha de seguimento,04b49755-e494-4db0-98ba-f4449656b8c1
111,PTV: PRE-NATAL,1,,0,"Livro de registo na PTV, Consulta Pr-natal",11,,,13,2011-01-12 12:35,13,2013-12-13 17:43,0,,,,799c6994-4a46-4d51-b671-bd983f03143f
112,PTV: PRE-NATAL - NOVO,1,,0,"Livro de registo de PTV, Pr-natal, Novo",11,,,13,2011-01-12 12:50,13,2011-05-26 13:56,0,,,,b40e887f-9f21-4c85-9c58-3965eaba7160
113,PTV: MATERNIDADE,1,,0,"Livro de registo de PTV, Maternidade",23,,,13,2011-01-12 12:10,13,2013-12-13 17:20,0,,,,4dab74bf-efda-46d9-95c4-7ad5b96c356a
114,PTV: MATERNIDADE - NOVO,1,,0,"Livro de registo de PTV, Maternidade, Novo",23,,,13,2011-01-12 12:52,13,2011-05-26 13:08,0,,,,475f73d2-2085-4123-affe-2895fe525556
115,TARV: ACONSELHAMENTO,1,,0,"Ficha de aconselhamento, TARV e Pr-TARV",19,,,13,2011-01-12 12:51,13,2013-12-13 17:04,0,,,,e702ee08-7ab8-4c93-92dc-d77570af854b
116,TARV: ACONSELHAMENTO SEGUIMENTO,1,,1,"Seguimento de aconselhamento, TARV e Pr-TARV",24,,,13,2011-01-12 12:26,13,2011-05-26 12:20,0,,,,43784dad-a494-45b8-a4b3-f313a3c84c70
117,TARV: FRIDA,1,,0,Ficha de Registo Individual de Despesas de ARV,18,,,13,2011-01-12 13:58,13,2013-12-13 17:03,0,,,,0450f11d-3ac5-451c-8e82-1c79868bc88f
118,TARV: RASTREIO DE TUBERCULOSE,1,,0,Ficha de rastreio de tuberculose para pacientes HIV+,20,,,13,2011-01-12 13:31,13,2013-12-13 17:26,0,,,,074bfef6-b048-4dd1-80a2-de6396918a3e
119,TARV: SOLICITACAO,1,,0,Solicitao de ARV,17,,,13,2011-01-12 13:48,13,2013-12-13 17:59,0,,,,7d7b660b-bdba-4457-95b8-2b5d7b64fcab
120,TUBERCULOSE: LIVRO,1,,0,"Livro de registo de doentes com tuberculose, PNCT",25,,,13,2011-01-12 13:35,13,2013-12-13 17:12,0,,,,566be870-74ea-4d79-bad5-7e37d5f0931d
121,TARV: VISITA DOMICILIARIA,1,,1,Visita domiciliaria/busca para pacientes na unidade sanitia,21,,,13,2011-01-12 13:35,13,2012-02-08 13:10,0,,,,b1ecb071-6471-4d87-89f4-d9e1b0c80630
122,CCU: RASTREIO,1,,0,Rastreio de cancro do colo do utero,28,,,13,2011-01-12 14:51,13,2013-12-13 17:33,0,,,,5ce0e3ab-c88b-421e-9fbb-876c03ddef0f
123,TARV: AVALICAO E PREPARACAO DO CANDIDATO AO TARV,1,,1,Ficha de avaliacao e preparacao psicologica do candidato ao TARV,29,,,13,2011-09-09 10:59,13,2014-04-21 14:30,0,,,,dc1e3f95-57a4-4b0b-9686-11e19f2bc5ab
124,TARV: AVALIACAO DE ADESAO,1,,1,Formulario de avaliacao de ADESAO para pacientes em TARV,31,,,13,2011-09-12 16:35,13,2013-12-13 17:20,0,,,,f8d1f33c-fdab-4bc7-a8c5-594302c177f7
125,TARV: TERMO DE CONSENTIMENTO,1,,1,Termo de consentimento de visita domiciliaria e Busca activa,30,,,13,2011-09-14 10:40,13,2012-06-26 13:56,0,,,,4b9c4669-4ff8-4cb7-a180-f40cc0ac30dd
126,ADULTO: SEGUIMENTO,0.1,,0,Ficha de Seguimento para Adultos no Servi TARV,6,,,1,2012-02-22 14:22,13,2013-12-13 06:55,0,,,,78d47629-5ac4-4e16-8972-2166eef30bfd
127,PEDIATRIA: SEGUIMENTO,0.1,,0,Nova ficha de seguimento para crian,9,,,1,2012-02-22 16:56,13,2013-07-01 09:25,0,,,,ff79c06c-2403-4cf6-9d78-fc6fabcad3b7
128,LIVRO DE REGISTO PRE-TARV,1,,1,"Representa o livro de registo (1,2) PRE-TARV",32,,,13,2012-02-29 17:59,13,2013-12-13 17:14,0,,,,fbb1f0ed-1cf5-4e12-b7ee-bd8653c54e9b
129,LIVRO DE REGISTO TARV,1,,1,"Representa o livro de registo (1,2) TARV",33,,,13,2012-02-29 17:54,13,2013-12-13 08:27,0,,,,f81b9361-a4a4-4895-94a1-a9dc8db06e1b
130,FILA,1,,1,Ficha Individual de Levantamento de ARVs,18,,,13,2012-05-31 16:18,13,2014-04-23 14:37,0,,,,49857ace-1a92-4980-8313-1067714df151
131,TARV: AVALIAO PSICOLOGICA E PP - INICIAL,1,,1,Ficha de avaliao psicologica e preveno positiva: Inicial,34,,,13,2013-06-24 17:10,13,2013-06-24 17:36,0,,,,7fe58112-e912-4c60-9c15-a110490488bc
132,TARV: AVALIAO PSICOLOGICA E PP - SEGUIMENTO,1,,1,Ficha de avaliao psicologica e preveno positiva: Seguimento,34,,,13,2013-06-24 17:16,13,2013-06-24 17:55,0,,,,ba229747-6382-475a-beb8-6f90bae8b120
133,POC: CURRENT STORY,1,,0,,36,,,271,2016-08-01 10:41,271,2018-05-12 17:26,0,,,,65896366-17b2-4c3e-9cce-440edcfe7b4e
