<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>form-migration</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2019/10/09 14:52:03.047</created_date>
    <modified_user>-</modified_user>
    <modified_date>2019/10/09 14:52:03.047</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>OpenMRS Source DB</name>
    <server>${ETL_DATABASE_HOST}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>${ETL_SOURCE_DATABASE}</database>
    <port>${ETL_DATABASE_PORT}</port>
    <username>${ETL_DATABASE_USER}</username>
    <password>${ETL_DATABASE_PASSWORD}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${ETL_DATABASE_PORT}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SQL_CONNECT</code>
        <attribute>set  foreign_key_checks=0</attribute>
      </attribute>
      <attribute>
        <code>STREAM_RESULTS</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>true/false</from>
      <to>Join rows (cartesian product)</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step</from>
      <to>update_encounter</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step</from>
      <to>update_form_field</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step</from>
      <to>update_form_resouce</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step</from>
      <to>update_htmlform</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Join rows (cartesian product)</from>
      <to>lookup_harmonized_user</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>lookup_harmonized_user</from>
      <to>get_current_date</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>get_current_date</from>
      <to>join_old_form</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step 2</from>
      <to>Table input</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Table input</from>
      <to>Join rows (cartesian product)</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script</from>
      <to>Blocking step 7</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step 7</from>
      <to>Execute SQL script 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script 2</from>
      <to>Blocking step 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step 4</from>
      <to>Execute SQL script 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script 3</from>
      <to>Blocking step 5</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step 5</from>
      <to>Execute SQL script 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script 4</from>
      <to>Blocking step 6</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocking step 6</from>
      <to>Execute SQL script 5</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script 5</from>
      <to>Blocking step 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>join_old_form</from>
      <to>Filter rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>Blocking step</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Blocking step</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1248</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocking step 2</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocking step 4</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>416</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocking step 5</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>720</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocking step 6</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>560</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocking step 7</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <pass_all_rows>Y</pass_all_rows>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>block</prefix>
    <cache_size>5000</cache_size>
    <compress>Y</compress>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>144</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Execute SQL script</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>set global max_allowed_packet=404857600;</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Execute SQL script 2</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>INSERT INTO `form` VALUES (1,'Template: Basic Form','0.1',1,0,'core elements needed for most forms',4,NULL,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2008-12-15 10:29:00',0,NULL,NULL,NULL,'e28a599e-1d5f-11e0-b929-000c29ad1d07');
 
INSERT INTO `form` VALUES (11,'PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO','0.1',89,0,'Processo de Hospital de Dia Pediatria 2/2',3,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/11-0.1-89.xsn\" solutionVersion=\"0.1.0.89\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?&gt;&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/11-89\" id=\"11\" name=\"PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;pediatric_objective_exam openmrs_concept=\"1622^PEDIATRIC OBJECTIVE EXAM^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/weight_kg>\n      &lt;height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/height_cm>\n      &lt;head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/head_circumference>\n      &lt;pediatric_diagnostic_exam multiple=\"1\" openmrs_concept=\"1616^PEDIATRIC DIAGNOSTIC EXAM^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;anemia openmrs_concept=\"3^ANEMIA^99DCT\">false&lt;/anemia>\n            &lt;shortness_of_breath openmrs_concept=\"5960^SHORTNESS OF BREATH^99DCT\">false&lt;/shortness_of_breath>\n            &lt;dermatitis openmrs_concept=\"119^DERMATITIS^99DCT\">false&lt;/dermatitis>\n            &lt;lymphadenopathy openmrs_concept=\"161^LYMPHADENOPATHY^99DCT\">false&lt;/lymphadenopathy>\n            &lt;parotidas_aumentadas openmrs_concept=\"1540^PAROTIDAS AUMENTADAS^99DCT\">false&lt;/parotidas_aumentadas>\n            &lt;ictericas openmrs_concept=\"1419^ICTERICAS^99DCT\">false&lt;/ictericas>\n            &lt;fever openmrs_concept=\"5945^FEVER^99DCT\">false&lt;/fever>\n            &lt;candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false&lt;/candidiasis_oral>\n      &lt;/pediatric_diagnostic_exam>\n      &lt;oral_exam_non_specific openmrs_concept=\"1542^ORAL EXAM, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/oral_exam_non_specific>\n      &lt;pulmonary_exam_auscultation_mv multiple=\"0\" openmrs_concept=\"1545^PULMONARY EXAM AUSCULTATION MV^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pulmonary_exam_auscultation_mv>\n      &lt;pulmonary_exam_auscultation multiple=\"1\" openmrs_concept=\"1629^PULMONARY EXAM AUSCULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;sopro_tubarico openmrs_concept=\"1550^SOPRO TUBARICO^99DCT\">false&lt;/sopro_tubarico>\n            &lt;snoring openmrs_concept=\"1549^SNORING^99DCT\">false&lt;/snoring>\n            &lt;murmur_anforico openmrs_concept=\"1551^MURMUR ANFORICO^99DCT\">false&lt;/murmur_anforico>\n            &lt;fervor openmrs_concept=\"1548^FERVOR^99DCT\">false&lt;/fervor>\n      &lt;/pulmonary_exam_auscultation>\n      &lt;cardiac_exam_findings multiple=\"1\" openmrs_concept=\"1124^CARDIAC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;s3_gallop openmrs_concept=\"550^S3 GALLOP^99DCT\">false&lt;/s3_gallop>\n            &lt;cardiac_murmur openmrs_concept=\"562^CARDIAC MURMUR^99DCT\">false&lt;/cardiac_murmur>\n            &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n            &lt;abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false&lt;/abnormal>\n            &lt;abnormal_sounds openmrs_concept=\"1117^ABNORMAL SOUNDS^99DCT\">false&lt;/abnormal_sounds>\n            &lt;left_ventricular_lift openmrs_concept=\"5156^LEFT VENTRICULAR LIFT^99DCT\">false&lt;/left_ventricular_lift>\n            &lt;right_ventricular_lift openmrs_concept=\"5157^RIGHT VENTRICULAR LIFT^99DCT\">false&lt;/right_ventricular_lift>\n            &lt;evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false&lt;/evidence_of_cardiac_enlargement>\n            &lt;diastolic_descresendo_murmur openmrs_concept=\"5160^DIASTOLIC DESCRESENDO MURMUR^99DCT\">false&lt;/diastolic_descresendo_murmur>\n            &lt;holosystolic_murmur openmrs_concept=\"5162^HOLOSYSTOLIC MURMUR^99DCT\">false&lt;/holosystolic_murmur>\n            &lt;diastolic_rumble openmrs_concept=\"5164^DIASTOLIC RUMBLE^99DCT\">false&lt;/diastolic_rumble>\n            &lt;systolic_ejection_murmur openmrs_concept=\"5166^SYSTOLIC EJECTION MURMUR^99DCT\">false&lt;/systolic_ejection_murmur>\n            &lt;pericardial_friction_rub openmrs_concept=\"5176^PERICARDIAL FRICTION RUB^99DCT\">false&lt;/pericardial_friction_rub>\n            &lt;chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false&lt;/chronic_obstructive_pulmonary_disease>\n            &lt;arrythmia openmrs_concept=\"1395^ARRYTHMIA^99DCT\">false&lt;/arrythmia>\n      &lt;/cardiac_exam_findings>\n      &lt;ap_te multiple=\"0\" openmrs_concept=\"1552^PULMONARY AUSCULTATION TE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ap_te>\n      &lt;liver_size openmrs_concept=\"5153^LIVER SIZE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/liver_size>\n      &lt;spleen_size openmrs_concept=\"5195^SPLEEN SIZE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/spleen_size>\n      &lt;other_masses_description openmrs_concept=\"1553^OTHER MASSES, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/other_masses_description>\n      &lt;perineum_description openmrs_concept=\"1554^PERINEUM, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/perineum_description>\n      &lt;membros_superiores openmrs_concept=\"1555^MEMBROS SUPERIORES^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/membros_superiores>\n      &lt;membros_inferiores openmrs_concept=\"1556^LOWER LIMBS^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/membros_inferiores>\n      &lt;neurological_exam_other openmrs_concept=\"1407^NEUROLOGICAL EXAM OTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/neurological_exam_other>\n      &lt;non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/non_coded_diagnosis>\n    &lt;/pediatric_objective_exam>\n    &lt;pediatric_blood_tests openmrs_concept=\"1618^PEDIATRIC BLOOD TESTS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hemoglobin>\n      &lt;hematocrit openmrs_concept=\"1015^HEMATOCRIT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hematocrit>\n      &lt;platelets openmrs_concept=\"729^PLATELETS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/platelets>\n      &lt;white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/white_blood_cells>\n      &lt;neutrophils openmrs_concept=\"1022^NEUTROPHILS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/neutrophils>\n      &lt;lymphocytes openmrs_concept=\"1021^LYMPHOCYTES^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymphocytes>\n      &lt;eosinophils openmrs_concept=\"1024^EOSINOPHILS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/eosinophils>\n      &lt;erythrocyte_sedimentation_rate openmrs_concept=\"855^ERYTHROCYTE SEDIMENTATION RATE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/erythrocyte_sedimentation_rate>\n      &lt;total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/total_protein>\n      &lt;globulinas openmrs_concept=\"1520^GLOBULINS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/globulinas>\n      &lt;immuno_globulin_hiv openmrs_concept=\"1519^IMMUNO GLOBULIN HIV^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/immuno_globulin_hiv>\n      &lt;urinary_albumin openmrs_concept=\"849^URINARY ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/urinary_albumin>\n      &lt;fa openmrs_concept=\"1521^FA^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/fa>\n      &lt;cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cd4_count>\n      &lt;cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cd4_percent>\n      &lt;hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_viral_load>\n      &lt;hiv_viral_load_log openmrs_concept=\"1518^HIV VIRAL LOAD LOG^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_viral_load_log>\n      &lt;total_bilirubin openmrs_concept=\"655^TOTAL BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/total_bilirubin>\n      &lt;direct_bilirubin openmrs_concept=\"1297^DIRECT BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/direct_bilirubin>\n      &lt;serum_glutamic-oxaloacetic_transaminase openmrs_concept=\"653^SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glutamic-oxaloacetic_transaminase>\n      &lt;serum_glutamic-pyruvic_transaminase openmrs_concept=\"654^SERUM GLUTAMIC-PYRUVIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glutamic-pyruvic_transaminase>\n      &lt;lactate_dehydrogenase openmrs_concept=\"1014^LACTATE DEHYDROGENASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lactate_dehydrogenase>\n      &lt;blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/blood_urea_nitrogen>\n      &lt;serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_creatinine>\n      &lt;serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_sodium>\n      &lt;serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_potassium>\n      &lt;serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glucose>\n      &lt;serum_albumin openmrs_concept=\"848^SERUM ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_albumin>\n      &lt;alkaline_phosphatase openmrs_concept=\"785^ALKALINE PHOSPHATASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/alkaline_phosphatase>\n      &lt;mean_corpuscular_volume openmrs_concept=\"851^MEAN CORPUSCULAR VOLUME^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mean_corpuscular_volume>\n    &lt;/pediatric_blood_tests>\n    &lt;pediatric_urinalysis multiple=\"1\" openmrs_concept=\"1619^PEDIATRIC URINALYSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;urina_piocytes openmrs_concept=\"1525^URINA PIOCYTES^99DCT\">false&lt;/urina_piocytes>\n        &lt;urine_erithrocytes openmrs_concept=\"1523^URINE ERITHROCYTES^99DCT\">false&lt;/urine_erithrocytes>\n        &lt;urine_leucocytes openmrs_concept=\"1522^URINE LEUCOCYTES^99DCT\">false&lt;/urine_leucocytes>\n        &lt;epithelial_cells openmrs_concept=\"666^EPITHELIAL CELLS^99DCT\">false&lt;/epithelial_cells>\n        &lt;urine_cilinders openmrs_concept=\"1524^URINE CILINDERS^99DCT\">false&lt;/urine_cilinders>\n    &lt;/pediatric_urinalysis>\n    &lt;pediatric_feces_test multiple=\"1\" openmrs_concept=\"1620^PEDIATRIC FECES TEST^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;feces_giardia openmrs_concept=\"1527^FECES GIARDIA^99DCT\">false&lt;/feces_giardia>\n        &lt;feces_e_hystolitica openmrs_concept=\"1529^FECES E HYSTOLITICA^99DCT\">false&lt;/feces_e_hystolitica>\n        &lt;feces_strongolides openmrs_concept=\"1526^FECES STRONGOLIDES^99DCT\">false&lt;/feces_strongolides>\n        &lt;fezes_trichuria openmrs_concept=\"1528^FEZES TRICHURIA^99DCT\">false&lt;/fezes_trichuria>\n        &lt;feces_ascaris openmrs_concept=\"1530^FECES ASCARIS^99DCT\">false&lt;/feces_ascaris>\n    &lt;/pediatric_feces_test>\n    &lt;feces_other openmrs_concept=\"1531^FECES OTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/feces_other>\n    &lt;lcr_patologico multiple=\"0\" openmrs_concept=\"1532^LCR PATHOLOGY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/lcr_patologico>\n    &lt;x-ray_chest multiple=\"1\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n        &lt;pulmonary_effusion openmrs_concept=\"1136^PULMONARY EFFUSION^99DCT\">false&lt;/pulmonary_effusion>\n        &lt;miliary_changes openmrs_concept=\"1137^MILIARY CHANGES^99DCT\">false&lt;/miliary_changes>\n        &lt;evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false&lt;/evidence_of_cardiac_enlargement>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;infiltrate openmrs_concept=\"6049^INFILTRATE^99DCT\">false&lt;/infiltrate>\n        &lt;diffuse_non-miliary_changes openmrs_concept=\"6050^DIFFUSE NON-MILIARY CHANGES^99DCT\">false&lt;/diffuse_non-miliary_changes>\n        &lt;cavitary_lesion openmrs_concept=\"6052^CAVITARY LESION^99DCT\">false&lt;/cavitary_lesion>\n        &lt;infiltrate_retuculonodular openmrs_concept=\"1641^INFILTRATE RETUCULONODULAR^99DCT\">false&lt;/infiltrate_retuculonodular>\n        &lt;infiltrado_reticular openmrs_concept=\"1643^INFILTRADO RETICULAR^99DCT\">false&lt;/infiltrado_reticular>\n        &lt;derrames openmrs_concept=\"1647^DERRAMES^99DCT\">false&lt;/derrames>\n        &lt;condensacoes openmrs_concept=\"1644^CONDENSACOES^99DCT\">false&lt;/condensacoes>\n        &lt;adenopatias_aumentadas openmrs_concept=\"1645^ADENOPATIAS AUMENTADAS^99DCT\">false&lt;/adenopatias_aumentadas>\n        &lt;mediastino_alargado openmrs_concept=\"1646^MEDIASTINO ALARGADO^99DCT\">false&lt;/mediastino_alargado>\n        &lt;negative openmrs_concept=\"664^NEGATIVE^99DCT\">false&lt;/negative>\n        &lt;positive openmrs_concept=\"703^POSITIVE^99DCT\">false&lt;/positive>\n        &lt;unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false&lt;/unknown>\n    &lt;/x-ray_chest>\n    &lt;x-ray_chest_other openmrs_concept=\"1642^X-RAY, CHEST, OTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/x-ray_chest_other>\n    &lt;non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/non_coded_diagnosis>\n    &lt;pediatric_initial_treatment openmrs_concept=\"1648^PEDIATRIC INITIAL TREATMENT^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;patient_is_on_antibiotic_treatment multiple=\"0\" openmrs_concept=\"1533^PATIENT IS ON ANTIBIOTIC TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_is_on_antibiotic_treatment>\n      &lt;antibiotics_prescribed multiple=\"1\" openmrs_concept=\"1621^ANTIBIOTICS PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;penicillin openmrs_concept=\"784^PENICILLIN^99DCT\">false&lt;/penicillin>\n            &lt;cefuroxime openmrs_concept=\"737^CEFUROXIME^99DCT\">false&lt;/cefuroxime>\n            &lt;cefixime openmrs_concept=\"963^CEFIXIME^99DCT\">false&lt;/cefixime>\n            &lt;amoxicillin openmrs_concept=\"265^AMOXICILLIN^99DCT\">false&lt;/amoxicillin>\n            &lt;cetirizine openmrs_concept=\"779^CETIRIZINE^99DCT\">false&lt;/cetirizine>\n            &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n            &lt;trimethoprim openmrs_concept=\"91^TRIMETHOPRIM^99DCT\">false&lt;/trimethoprim>\n      &lt;/antibiotics_prescribed>\n      &lt;antiretroviral_use multiple=\"0\" openmrs_concept=\"1192^ANTIRETROVIRAL USE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/antiretroviral_use>\n      &lt;current_antiretroviral_drugs_used_for_treatment multiple=\"1\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n            &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n            &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n            &lt;abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false&lt;/abacavir>\n            &lt;efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false&lt;/efavirenz>\n            &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\"&gt;false&lt;/nevirapine>\n            &lt;nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false&lt;/nelfinavir>\n            &lt;other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false&lt;/other_antiretroviral_drug>\n            &lt;indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false&lt;/indinavir>\n            &lt;ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false&lt;/ritonavir>\n            &lt;abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false&lt;/abacavir_lamivudine_zidovudine>\n            &lt;zidovudine_lamivudine_nevirapine openmrs_concept=\"1651^ZIDOVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_lamivudine_nevirapine>\n            &lt;abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false&lt;/abacavir_didanosine_nelfinavir>\n            &lt;ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false&lt;/ziduvadinedidanosinenelfinavir>\n            &lt;zidovudine_lamivudine_efavirenz openmrs_concept=\"1703^ZIDOVUDINE + LAMIVUDINE + EFAVIRENZ^99DCT\">false&lt;/zidovudine_lamivudine_efavirenz>\n            &lt;zidovudine_lamivudine_nelfinavir openmrs_concept=\"1702^ZIDOVUDINE + LAMIVUDINE + NELFINAVIR^99DCT\">false&lt;/zidovudine_lamivudine_nelfinavir>\n            &lt;stavudinelamivudineefavirennz openmrs_concept=\"1827^STAVUDINE+LAMIVUDINE+EFAVIRENNZ^99DCT\">false&lt;/stavudinelamivudineefavirennz>\n            &lt;stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false&lt;/stavudine>\n            &lt;d4t-40 openmrs_concept=\"625^STAVUDINE^99DCT^6^d4T-40^99RX\">false&lt;/d4t-40>\n            &lt;d4t-30 openmrs_concept=\"625^STAVUDINE^99DCT^5^d4T-30^99RX\">false&lt;/d4t-30>\n            &lt;lopinavir_and_ritonavir openmrs_concept=\"794^LOPINAVIR AND RITONAVIR^99DCT\">false&lt;/lopinavir_and_ritonavir>\n            &lt;triomune-30 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^2^Triomune-30^99RX\">false&lt;/triomune-30>\n            &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n            &lt;triomune-40 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^3^Triomune-40^99RX\">false&lt;/triomune-40>\n            &lt;ddi_125 openmrs_concept=\"796^DIDANOSINE^99DCT^9^DDI 125^99RX\">false&lt;/ddi_125>\n            &lt;stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false&lt;/stavudine_lamivudine>\n            &lt;ddi_200 openmrs_concept=\"796^DIDANOSINE^99DCT^10^DDI 200^99RX\">false&lt;/ddi_200>\n            &lt;didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false&lt;/didanosine>\n            &lt;zidovudinelamivudinelopinavir openmrs_concept=\"6100^ZIDOVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false&lt;/zidovudinelamivudinelopinavir>\n            &lt;zidovudinelamivudinesaquinavir openmrs_concept=\"6101^ZIDOVUDINE+LAMIVUDINE+SAQUINAVIR^99DCT\">false&lt;/zidovudinelamivudinesaquinavir>\n            &lt;stavudinelamivudineabacavir openmrs_concept=\"6102^STAVUDINE+LAMIVUDINE+ABACAVIR^99DCT\">false&lt;/stavudinelamivudineabacavir>\n            &lt;stavudinelamivudinelopinavir openmrs_concept=\"6103^STAVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false&lt;/stavudinelamivudinelopinavir>\n            &lt;abacavirlamivudineefavirenz openmrs_concept=\"6104^ABACAVIR+LAMIVUDINE+EFAVIRENZ^99DCT\">false&lt;/abacavirlamivudineefavirenz>\n            &lt;abc3tcnvp openmrs_concept=\"6105^ABC+3TC+NVP^99DCT\">false&lt;/abc3tcnvp>\n            &lt;abc3tclpv openmrs_concept=\"6106^ABC+3TC+LPV^99DCT\">false&lt;/abc3tclpv>\n            &lt;tdfazt3tclpv openmrs_concept=\"6107^TDF+AZT+3TC+LPV^99DCT\">false&lt;/tdfazt3tclpv>\n            &lt;tdf3tclpv openmrs_concept=\"6108^TDF+3TC+LPV^99DCT\">false&lt;/tdf3tclpv>\n            &lt;aztddilpv openmrs_concept=\"6109^AZT+DDI+LPV^99DCT\">false&lt;/aztddilpv>\n            &lt;d4t_63tcnvp openmrs_concept=\"6110^D4T 6+3TC+NVP^99DCT\">false&lt;/d4t_63tcnvp>\n            &lt;d4t_63tcefv openmrs_concept=\"6111^D4T 6+3TC+EFV^99DCT\">false&lt;/d4t_63tcefv>\n            &lt;d4t_63tcabc openmrs_concept=\"6112^D4T 6+3TC+ABC^99DCT\">false&lt;/d4t_63tcabc>\n            &lt;d4t_63tclpv openmrs_concept=\"6113^D4T 6+3TC+LPV^99DCT\">false&lt;/d4t_63tclpv>\n            &lt;azt603tcnvp openmrs_concept=\"6114^AZT60+3TC+NVP^99DCT\">false&lt;/azt603tcnvp>\n            &lt;azt603tcefv openmrs_concept=\"6115^AZT60+3TC+EFV^99DCT\">false&lt;/azt603tcefv>\n            &lt;azt603tcabc openmrs_concept=\"6116^AZT60+3TC+ABC^99DCT\">false&lt;/azt603tcabc>\n            &lt;azt603tclpv openmrs_concept=\"6117^AZT60+3TC+LPV^99DCT\">false&lt;/azt603tclpv>\n            &lt;ddi50abclpv openmrs_concept=\"6118^DDI50+ABC+LPV^99DCT\">false&lt;/ddi50abclpv>\n            &lt;ddi250ecabclpv openmrs_concept=\"6119^DDI250Ec+ABC+LPV^99DCT\">false&lt;/ddi250ecabclpv>\n      &lt;/current_antiretroviral_drugs_used_for_treatment>\n      &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cotrimoxazole_use>\n      &lt;cotrimoxazole_use_specifically openmrs_concept=\"1536^COTRIMOXAZOLE USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cotrimoxazole_use_specifically>\n      &lt;vitamin_a multiple=\"0\" openmrs_concept=\"1535^VITAMIN A TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/vitamin_a>\n      &lt;vitamin_a_use_specifically openmrs_concept=\"1537^VITAMIN A USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/vitamin_a_use_specifically>\n      &lt;antifungal_use multiple=\"0\" openmrs_concept=\"1538^ANTIFUNGAL USE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/antifungal_use>\n      &lt;antifungal_use_specifically openmrs_concept=\"1539^ANTIFUNGAL USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/antifungal_use_specifically>\n      &lt;treatment_non_specific openmrs_concept=\"1541^TREATMENT, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/treatment_non_specific>\n    &lt;/pediatric_initial_treatment>\n  &lt;/obs>\n  &lt;problem_list openmrs_concept=\"1284^PROBLEM LIST^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;problem_added multiple=\"0\" openmrs_concept=\"6042^PROBLEM ADDED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/problem_added>\n    &lt;problem_resolved multiple=\"0\" openmrs_concept=\"6097^PROBLEM RESOLVED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/problem_resolved>\n  &lt;/problem_list>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose&gt;\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-27 11:59:39',0,NULL,NULL,NULL,'e28a6ace-1d5f-11e0-b929-000c29ad1d07');

INSERT INTO `form` VALUES (13,'Template: MISAU header','0.1',39,0,'header without address, separate line for each item',4,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"Template: MISAU header\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/13-0.1-39.xsn\" solutionVersion=\"0.1.0.39\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/13-39\" id=\"13\" name=\"Template: MISAU header\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}&lt;/patient.tribe>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/placeholder>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text&gt;              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value --&gt;\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:11',0,NULL,NULL,NULL,'e28a7550-1d5f-11e0-b929-000c29ad1d07');

INSERT INTO `form` VALUES (37,'ADULTO: SEGUIMENTO','0.1',106,1,'Ficha de Seguimento adulto',6,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"ADULTO: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/37-0.1-106.xsn\" solutionVersion=\"0.1.0.106\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/37-106\" id=\"37\" name=\"ADULTO: SEGUIMENTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}&lt;/encouter.location_name>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/temperature_c>\n    &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/weight_kg>\n    &lt;altura_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/altura_cm>\n    &lt;systolic_blood_pressure openmrs_concept=\"5085^SYSTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/systolic_blood_pressure>\n    &lt;month_of_current_gestation openmrs_concept=\"5992^MONTH OF CURRENT GESTATION^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/month_of_current_gestation>\n    &lt;mozambique_stage_1_adult multiple=\"1\" openmrs_concept=\"1564^STAGE 1 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;asymptomatic_hiv_infection openmrs_concept=\"5327^ASYMPTOMATIC HIV INFECTION^99DCT\">false&lt;/asymptomatic_hiv_infection>\n    &lt;/mozambique_stage_1_adult>\n    &lt;mozambique_stage_2_adult multiple=\"1\" openmrs_concept=\"1565^STAGE 2 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false&lt;/hiv_staging_-_adult_herpes_zoster>\n        &lt;hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false&lt;/hiv_staging_-_recurrent_upper_respiratory_infection>\n        &lt;hiv_staging_-_weight_loss_less_than_ten_percent openmrs_concept=\"5332^HIV STAGING - WEIGHT LOSS LESS THAN TEN PERCENT^99DCT\">false&lt;/hiv_staging_-_weight_loss_less_than_ten_percent>\n        &lt;hiv_staging_-_minor_mucocutaneous_manifestations openmrs_concept=\"5330^HIV STAGING - MINOR MUCOCUTANEOUS MANIFESTATIONS^99DCT\">false&lt;/hiv_staging_-_minor_mucocutaneous_manifestations>\n    &lt;/mozambique_stage_2_adult>\n    &lt;mozambique_stage_3_adult multiple=\"1\" openmrs_concept=\"1566^STAGE 3 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;candidiasis_vaginal openmrs_concept=\"298^CANDIDIASIS, VAGINAL^99DCT\">false&lt;/candidiasis_vaginal>\n        &lt;hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false&lt;/hiv_staging_-_persistent_fever>\n        &lt;hiv_staging_-_severe_bacterial_infection openmrs_concept=\"5333^HIV STAGING - SEVERE BACTERIAL INFECTION^99DCT\">false&lt;/hiv_staging_-_severe_bacterial_infection>\n        &lt;oral_hairy_leukoplakia openmrs_concept=\"5337^ORAL HAIRY LEUKOPLAKIA^99DCT\">false&lt;/oral_hairy_leukoplakia>\n        &lt;diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false&lt;/diarrhea_chronic>\n        &lt;bedridden_less_than_50_percent_of_time openmrs_concept=\"1567^BEDRIDDEN LESS THAN 50% OF TIME^99DCT\">false&lt;/bedridden_less_than_50_percent_of_time>\n        &lt;hiv_staging_-_weight_loss_greater_than_ten_percent openmrs_concept=\"5339^HIV STAGING - WEIGHT LOSS GREATER THAN TEN PERCENT^99DCT\">false&lt;/hiv_staging_-_weight_loss_greater_than_ten_percent>\n        &lt;candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false&lt;/candidiasis_oral>\n        &lt;hiv_staging_-_tuberculosis_within_year openmrs_concept=\"5338^HIV STAGING - TUBERCULOSIS WITHIN YEAR^99DCT\">false&lt;/hiv_staging_-_tuberculosis_within_year>\n    &lt;/mozambique_stage_3_adult>\n    &lt;mozambique_stage_4_adult multiple=\"1\" openmrs_concept=\"1569^STAGE 4 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false&lt;/pneumocystic_carinii_pneumonia>\n        &lt;cervical_cancer openmrs_concept=\"1570^CERVICAL CANCER^99DCT\">false&lt;/cervical_cancer>\n        &lt;hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false&lt;/hiv_staging_-_lymphoma>\n        &lt;hiv_staging_-_cytomegalovirus_disease openmrs_concept=\"5035^HIV STAGING - CYTOMEGALOVIRUS DISEASE^99DCT\">false&lt;/hiv_staging_-_cytomegalovirus_disease>\n        &lt;hiv_staging_-_mycobacterium_other openmrs_concept=\"5043^HIV STAGING - MYCOBACTERIUM, OTHER^99DCT\">false&lt;/hiv_staging_-_mycobacterium_other>\n        &lt;kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false&lt;/kaposi_apos_s_sarcoma>\n        &lt;progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false&lt;/progressive_multifocal_leukoencephalopathy>\n        &lt;hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false&lt;/hiv_staging-candidiasis_respiratory_tract>\n        &lt;bedridden_more_than_50_percent_of_time openmrs_concept=\"1568^BEDRIDDEN MORE THAN 50% OF TIME^99DCT\">false&lt;/bedridden_more_than_50_percent_of_time>\n        &lt;wasting_syndrome openmrs_concept=\"823^WASTING SYNDROME^99DCT\">false&lt;/wasting_syndrome>\n        &lt;hiv_staging_-_cryptococcosis_extrapulmonary openmrs_concept=\"5033^HIV STAGING - CRYPTOCOCCOSIS, EXTRAPULMONARY^99DCT\">false&lt;/hiv_staging_-_cryptococcosis_extrapulmonary>\n        &lt;toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false&lt;/toxoplasmosis>\n        &lt;hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false&lt;/hiv_staging_-_mucocutaneous_herpes_simplex>\n        &lt;hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false&lt;/hiv_staging_-_cryptosporidiosis>\n        &lt;mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false&lt;/mycobacterium_tuberculosis_extrapulmonary>\n        &lt;encephalopathy openmrs_concept=\"5345^ENCEPHALOPATHY^99DCT\">false&lt;/encephalopathy>\n    &lt;/mozambique_stage_4_adult>\n    &lt;referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referrals_ordered>\n    &lt;non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/non_coded_diagnosis>\n    &lt;current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_who_hiv_stage>\n    &lt;documented_observed_laboratory_data openmrs_concept=\"1689^DOCUMENTED OBSERVED LABORATORY DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;neutrophils_absolute_count_obs openmrs_concept=\"1690^NEUTROPHILS ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/neutrophils_absolute_count_obs>\n      &lt;lymphocites_absolute_count_obs openmrs_concept=\"1691^LYMPHOCITES ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymphocites_absolute_count_obs>\n      &lt;hemoglobin_obs openmrs_concept=\"1692^HEMOGLOBIN OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hemoglobin_obs>\n      &lt;ast_obs openmrs_concept=\"1693^AST OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ast_obs>\n      &lt;alt_obs openmrs_concept=\"1694^ALT OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/alt_obs>\n      &lt;cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cd4_absolute_obs&gt;\n    &lt;/documented_observed_laboratory_data>\n    &lt;current_antiretroviral_drugs_used_for_treatment multiple=\"1\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false&lt;/abacavir>\n        &lt;efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false&lt;/efavirenz>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false&lt;/nelfinavir>\n        &lt;other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false&lt;/other_antiretroviral_drug>\n        &lt;indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false&lt;/indinavir>\n        &lt;ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false&lt;/ritonavir>\n        &lt;abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false&lt;/abacavir_lamivudine_zidovudine>\n        &lt;zidovudine_lamivudine_nevirapine openmrs_concept=\"1651^ZIDOVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_lamivudine_nevirapine>\n        &lt;abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false&lt;/abacavir_didanosine_nelfinavir>\n        &lt;ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false&lt;/ziduvadinedidanosinenelfinavir>\n        &lt;zidovudine_lamivudine_efavirenz openmrs_concept=\"1703^ZIDOVUDINE + LAMIVUDINE + EFAVIRENZ^99DCT\">false&lt;/zidovudine_lamivudine_efavirenz>\n        &lt;zidovudine_lamivudine_nelfinavir openmrs_concept=\"1702^ZIDOVUDINE + LAMIVUDINE + NELFINAVIR^99DCT\">false&lt;/zidovudine_lamivudine_nelfinavir>\n        &lt;stavudinelamivudineefavirennz openmrs_concept=\"1827^STAVUDINE+LAMIVUDINE+EFAVIRENNZ^99DCT\">false&lt;/stavudinelamivudineefavirennz>\n        &lt;stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false&lt;/stavudine>\n        &lt;d4t-40 openmrs_concept=\"625^STAVUDINE^99DCT^6^d4T-40^99RX\">false&lt;/d4t-40>\n        &lt;d4t-30 openmrs_concept=\"625^STAVUDINE^99DCT^5^d4T-30^99RX\">false&lt;/d4t-30>\n        &lt;lopinavir_and_ritonavir openmrs_concept=\"794^LOPINAVIR AND RITONAVIR^99DCT\">false&lt;/lopinavir_and_ritonavir>\n        &lt;triomune-30 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^2^Triomune-30^99RX\">false&lt;/triomune-30>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;triomune-40 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^3^Triomune-40^99RX\">false&lt;/triomune-40>\n        &lt;ddi_125 openmrs_concept=\"796^DIDANOSINE^99DCT^9^DDI 125^99RX\">false&lt;/ddi_125>\n        &lt;stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false&lt;/stavudine_lamivudine>\n        &lt;ddi_200 openmrs_concept=\"796^DIDANOSINE^99DCT^10^DDI 200^99RX\">false&lt;/ddi_200>\n        &lt;didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false&lt;/didanosine>\n        &lt;zidovudinelamivudinelopinavir openmrs_concept=\"6100^ZIDOVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false&lt;/zidovudinelamivudinelopinavir>\n        &lt;zidovudinelamivudinesaquinavir openmrs_concept=\"6101^ZIDOVUDINE+LAMIVUDINE+SAQUINAVIR^99DCT\">false&lt;/zidovudinelamivudinesaquinavir>\n        &lt;stavudinelamivudineabacavir openmrs_concept=\"6102^STAVUDINE+LAMIVUDINE+ABACAVIR^99DCT\">false&lt;/stavudinelamivudineabacavir>\n        &lt;stavudinelamivudinelopinavir openmrs_concept=\"6103^STAVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false&lt;/stavudinelamivudinelopinavir>\n        &lt;abacavirlamivudineefavirenz openmrs_concept=\"6104^ABACAVIR+LAMIVUDINE+EFAVIRENZ^99DCT\">false&lt;/abacavirlamivudineefavirenz>\n        &lt;abc3tcnvp openmrs_concept=\"6105^ABC+3TC+NVP^99DCT\">false&lt;/abc3tcnvp>\n        &lt;abc3tclpv openmrs_concept=\"6106^ABC+3TC+LPV^99DCT\">false&lt;/abc3tclpv>\n        &lt;tdfazt3tclpv openmrs_concept=\"6107^TDF+AZT+3TC+LPV^99DCT\">false&lt;/tdfazt3tclpv>\n        &lt;tdf3tclpv openmrs_concept=\"6108^TDF+3TC+LPV^99DCT\">false&lt;/tdf3tclpv>\n        &lt;aztddilpv openmrs_concept=\"6109^AZT+DDI+LPV^99DCT\">false&lt;/aztddilpv>\n        &lt;d4t_63tcnvp openmrs_concept=\"6110^D4T 6+3TC+NVP^99DCT\">false&lt;/d4t_63tcnvp>\n        &lt;d4t_63tcefv openmrs_concept=\"6111^D4T 6+3TC+EFV^99DCT\">false&lt;/d4t_63tcefv>\n        &lt;d4t_63tcabc openmrs_concept=\"6112^D4T 6+3TC+ABC^99DCT\">false&lt;/d4t_63tcabc>\n        &lt;d4t_63tclpv openmrs_concept=\"6113^D4T 6+3TC+LPV^99DCT\">false&lt;/d4t_63tclpv>\n        &lt;azt603tcnvp openmrs_concept=\"6114^AZT60+3TC+NVP^99DCT\">false&lt;/azt603tcnvp>\n        &lt;azt603tcefv openmrs_concept=\"6115^AZT60+3TC+EFV^99DCT\">false&lt;/azt603tcefv>\n        &lt;azt603tcabc openmrs_concept=\"6116^AZT60+3TC+ABC^99DCT\">false&lt;/azt603tcabc>\n        &lt;azt603tclpv openmrs_concept=\"6117^AZT60+3TC+LPV^99DCT\">false&lt;/azt603tclpv>\n        &lt;ddi50abclpv openmrs_concept=\"6118^DDI50+ABC+LPV^99DCT\">false&lt;/ddi50abclpv>\n        &lt;ddi250ecabclpv openmrs_concept=\"6119^DDI250Ec+ABC+LPV^99DCT\">false&lt;/ddi250ecabclpv>\n    &lt;/current_antiretroviral_drugs_used_for_treatment>\n    &lt;tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment_plan>\n    &lt;diastolic_blood_pressure openmrs_concept=\"5086^DIASTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/diastolic_blood_pressure>\n    &lt;treatment_prescribed multiple=\"0\" openmrs_concept=\"1719^TREATMENT PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/treatment_prescribed>\n    &lt;return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/return_visit_date>\n    &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cotrimoxazole_use>\n    &lt;isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/isoniazid_use>\n    &lt;hipoteses_de_diagnosticos_outros multiple=\"1\" openmrs_concept=\"1406^OTHER DIAGNOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;anemia openmrs_concept=\"3^ANEMIA^99DCT\">false&lt;/anemia>\n        &lt;malaria openmrs_concept=\"123^MALARIA^99DCT\">false&lt;/malaria>\n        &lt;malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false&lt;/malnutrition>\n        &lt;polyp openmrs_concept=\"2142^POLYP^99DCT\">false&lt;/polyp>\n        &lt;rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false&lt;/rectovaginal_fistula>\n        &lt;prolapse openmrs_concept=\"2141^PROLAPSE^99DCT\">false&lt;/prolapse>\n    &lt;/hipoteses_de_diagnosticos_outros>\n    &lt;nutritional_supplement multiple=\"1\" openmrs_concept=\"2152^NUTRITIONAL SUPPLEMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false&lt;/plumpy_nut>\n        &lt;basic_food_basket openmrs_concept=\"2151^BASIC FOOD BASKET^99DCT\">false&lt;/basic_food_basket>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;enriched_porridge openmrs_concept=\"2150^ENRICHED PORRIDGE^99DCT\">false&lt;/enriched_porridge>\n    &lt;/nutritional_supplement>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-26 18:01:09',0,NULL,NULL,NULL,'e28aa7aa-1d5f-11e0-b929-000c29ad1d07');

INSERT INTO `form` VALUES (42,'Template: MISAU header, full address','0.1',47,0,'Template for MISAU forms with full address',4,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"Template: MISAU header, full address\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/42-0.1-47.xsn\" solutionVersion=\"0.1.0.47\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/42-47\" id=\"42\" name=\"Template: MISAU header, full address\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}&lt;/patient.tribe>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/placeholder>\n    &lt;organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/organization>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" /&gt;\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number --&gt;\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:14',0,NULL,NULL,NULL,'e28aabd8-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (44,'PEDIATRIA: SEGUIMENTO','0.1',82,1,'Ficha de Seguimento pediatria',9,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PEDIATRIA: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/44-0.1-82.xsn\" solutionVersion=\"0.1.0.82\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/44-82\" id=\"44\" name=\"PEDIATRIA: SEGUIMENTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}&lt;/encouter.location_name>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;mozambique_stage_1_pediatric multiple=\"1\" openmrs_concept=\"1558^STAGE 1 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false&lt;/hiv_staging_-_adult_herpes_zoster>\n        &lt;asymptomatic_hiv_infection openmrs_concept=\"5327^ASYMPTOMATIC HIV INFECTION^99DCT\">false&lt;/asymptomatic_hiv_infection>\n        &lt;hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false&lt;/hiv_staging_-_recurrent_upper_respiratory_infection>\n        &lt;hiv_staging_-_persistent_generalized_lymphadenopathy openmrs_concept=\"5328^HIV STAGING - PERSISTENT GENERALIZED LYMPHADENOPATHY^99DCT\">false&lt;/hiv_staging_-_persistent_generalized_lymphadenopathy>\n        &lt;hiv_staging_-_weight_loss_less_than_ten_percent openmrs_concept=\"5332^HIV STAGING - WEIGHT LOSS LESS THAN TEN PERCENT^99DCT\">false&lt;/hiv_staging_-_weight_loss_less_than_ten_percent>\n        &lt;minor_cutaneous_manifestations openmrs_concept=\"1296^MINOR CUTANEOUS MANIFESTATIONS^99DCT\">false&lt;/minor_cutaneous_manifestations>\n    &lt;/mozambique_stage_1_pediatric>\n    &lt;mozambique_stage_2_pediatric multiple=\"1\" openmrs_concept=\"1561^STAGE 2 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false&lt;/hiv_staging_-_serious_bacterial_infections>\n        &lt;pneumonia_tuberculous openmrs_concept=\"42^PNEUMONIA, TUBERCULOUS^99DCT\">false&lt;/pneumonia_tuberculous>\n        &lt;hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false&lt;/hiv_staging_-_persistent_fever>\n        &lt;hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false&lt;/hiv_staging_-_recurrent_bacterial_pneumonia>\n        &lt;diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false&lt;/diarrhea_chronic>\n        &lt;hiv_staging_-_weight_loss_greater_than_ten_percent openmrs_concept=\"5339^HIV STAGING - WEIGHT LOSS GREATER THAN TEN PERCENT^99DCT\">false&lt;/hiv_staging_-_weight_loss_greater_than_ten_percent>\n        &lt;candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false&lt;/candidiasis_oral>\n        &lt;hepatosplenomegaly openmrs_concept=\"825^HEPATOSPLENOMEGALY^99DCT\">false&lt;/hepatosplenomegaly>\n        &lt;recurrent_oral_ulcer openmrs_concept=\"2065^RECURRENT ORAL ULCER^99DCT\">false&lt;/recurrent_oral_ulcer>\n        &lt;parotid_enlargement openmrs_concept=\"1210^PAROTID ENLARGEMENT^99DCT\">false&lt;/parotid_enlargement>\n        &lt;hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false&lt;/hiv_staging_-_recurrent_upper_respiratory_infection>\n        &lt;molluscum_contagiosum openmrs_concept=\"1212^MOLLUSCUM CONTAGIOSUM^99DCT\">false&lt;/molluscum_contagiosum>\n        &lt;linear_gingival_erythema openmrs_concept=\"2064^LINEAR GINGIVAL ERYTHEMA^99DCT\">false&lt;/linear_gingival_erythema>\n        &lt;herpes_zoster openmrs_concept=\"836^HERPES ZOSTER^99DCT\">false&lt;/herpes_zoster>\n    &lt;/mozambique_stage_2_pediatric>\n    &lt;mozambique_stage_3_pediatric multiple=\"1\" openmrs_concept=\"1562^STAGE 3 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false&lt;/failure_to_thrive>\n        &lt;pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false&lt;/pneumocystic_carinii_pneumonia>\n        &lt;hiv_staging_-_salmonella_septicemia openmrs_concept=\"5354^HIV STAGING - SALMONELLA SEPTICEMIA^99DCT\">false&lt;/hiv_staging_-_salmonella_septicemia>\n        &lt;hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false&lt;/hiv_staging_-_lymphoma>\n        &lt;hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false&lt;/hiv_staging_-_mucocutaneous_herpes_simplex>\n        &lt;kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false&lt;/kaposi_apos_s_sarcoma>\n        &lt;progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false&lt;/progressive_multifocal_leukoencephalopathy>\n        &lt;mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false&lt;/mycobacterium_tuberculosis_extrapulmonary>\n        &lt;hiv_staging_-_lymphoid_interstitial_pneumonia openmrs_concept=\"5024^HIV STAGING - LYMPHOID INTERSTITIAL PNEUMONIA^99DCT\">false&lt;/hiv_staging_-_lymphoid_interstitial_pneumonia>\n        &lt;hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false&lt;/hiv_staging-candidiasis_respiratory_tract>\n        &lt;hiv_staging_-_hsv_stomatitis openmrs_concept=\"5020^HIV STAGING - HSV STOMATITIS^99DCT\">false&lt;/hiv_staging_-_hsv_stomatitis>\n        &lt;chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false&lt;/chronic_obstructive_pulmonary_disease>\n        &lt;oral_hairy_leukoplakia openmrs_concept=\"5337^ORAL HAIRY LEUKOPLAKIA^99DCT\">false&lt;/oral_hairy_leukoplakia>\n        &lt;pneumonia_tuberculous openmrs_concept=\"42^PNEUMONIA, TUBERCULOUS^99DCT\">false&lt;/pneumonia_tuberculous>\n        &lt;hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false&lt;/hiv_staging_-_persistent_fever>\n        &lt;hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false&lt;/hiv_staging_-_recurrent_bacterial_pneumonia>\n        &lt;diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false&lt;/diarrhea_chronic>\n        &lt;tuberculosis_ganglionic openmrs_concept=\"2063^TUBERCULOSIS GANGLIONIC^99DCT\">false&lt;/tuberculosis_ganglionic>\n        &lt;malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false&lt;/malnutrition&gt;\n        &lt;hiv_staging_-_refractory_anemia openmrs_concept=\"1217^HIV STAGING - REFRACTORY ANEMIA^99DCT\">false&lt;/hiv_staging_-_refractory_anemia>\n        &lt;candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false&lt;/candidiasis_oral>\n    &lt;/mozambique_stage_3_pediatric>\n    &lt;stage_4_pediatric_mozambique multiple=\"1\" openmrs_concept=\"2066^STAGE 4 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false&lt;/rectovaginal_fistula>\n        &lt;pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false&lt;/pneumocystic_carinii_pneumonia>\n        &lt;hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false&lt;/hiv_staging_-_lymphoma>\n        &lt;cervical_cancer openmrs_concept=\"1570^CERVICAL CANCER^99DCT\">false&lt;/cervical_cancer>\n        &lt;hiv_staging_-_cytomegalovirus_disease openmrs_concept=\"5035^HIV STAGING - CYTOMEGALOVIRUS DISEASE^99DCT\">false&lt;/hiv_staging_-_cytomegalovirus_disease>\n        &lt;kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false&lt;/kaposi_apos_s_sarcoma>\n        &lt;progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false&lt;/progressive_multifocal_leukoencephalopathy>\n        &lt;hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false&lt;/hiv_staging-candidiasis_respiratory_tract>\n        &lt;hiv_staging_-_nonresponsive_herpes_simplex_virus openmrs_concept=\"1216^HIV STAGING - NONRESPONSIVE HERPES SIMPLEX VIRUS^99DCT\">false&lt;/hiv_staging_-_nonresponsive_herpes_simplex_virus>\n        &lt;toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false&lt;/toxoplasmosis>\n        &lt;hiv_staging_-_cryptococcosis_extrapulmonary openmrs_concept=\"5033^HIV STAGING - CRYPTOCOCCOSIS, EXTRAPULMONARY^99DCT\">false&lt;/hiv_staging_-_cryptococcosis_extrapulmonary>\n        &lt;hiv_staging_-_severe_bacterial_infection openmrs_concept=\"5333^HIV STAGING - SEVERE BACTERIAL INFECTION^99DCT\">false&lt;/hiv_staging_-_severe_bacterial_infection>\n        &lt;hiv_staging_-_disseminated_endemic_mycosis openmrs_concept=\"5350^HIV STAGING - DISSEMINATED ENDEMIC MYCOSIS^99DCT\">false&lt;/hiv_staging_-_disseminated_endemic_mycosis>\n        &lt;hiv_staging_-_mycobacterium_avium_complex openmrs_concept=\"5044^HIV STAGING - MYCOBACTERIUM AVIUM COMPLEX^99DCT\">false&lt;/hiv_staging_-_mycobacterium_avium_complex>\n        &lt;nephropathy openmrs_concept=\"5025^NEPHROPATHY^99DCT\">false&lt;/nephropathy>\n        &lt;hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false&lt;/hiv_staging_-_cryptosporidiosis>\n        &lt;chronic_malnutrition openmrs_concept=\"1844^CHRONIC MALNUTRITION^99DCT\">false&lt;/chronic_malnutrition>\n        &lt;encephalopathy openmrs_concept=\"5345^ENCEPHALOPATHY^99DCT\">false&lt;/encephalopathy>\n        &lt;mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false&lt;/mycobacterium_tuberculosis_extrapulmonary>\n        &lt;hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false&lt;/hiv_staging_-_mucocutaneous_herpes_simplex>\n    &lt;/stage_4_pediatric_mozambique>\n    &lt;is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_patient_hiv_positive>\n    &lt;hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_dna_polymerase_chain_reaction_qualitative>\n    &lt;temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/temperature_c>\n    &lt;head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/head_circumference>\n    &lt;altura_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/altura_cm>\n    &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/weight_kg>\n    &lt;weight_divided_by_height_as_a_percentage openmrs_concept=\"1888^WEIGHT DIVIDED BY HEIGHT AS A PERCENTAGE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/weight_divided_by_height_as_a_percentage>\n    &lt;psychomotor_development multiple=\"0\" openmrs_concept=\"1882^PSYCHOMOTOR DEVELOPMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/psychomotor_development>\n    &lt;treatment_non_specific openmrs_concept=\"1541^TREATMENT, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/treatment_non_specific>\n    &lt;non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/non_coded_diagnosis>\n    &lt;referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referrals_ordered>\n    &lt;documented_observed_laboratory_data openmrs_concept=\"1689^DOCUMENTED OBSERVED LABORATORY DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;neutrophils_absolute_count_obs openmrs_concept=\"1690^NEUTROPHILS ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/neutrophils_absolute_count_obs>\n      &lt;lymphocites_absolute_count_obs openmrs_concept=\"1691^LYMPHOCITES ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymphocites_absolute_count_obs>\n      &lt;hemoglobin_obs openmrs_concept=\"1692^HEMOGLOBIN OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hemoglobin_obs>\n      &lt;ast_obs openmrs_concept=\"1693^AST OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ast_obs>\n      &lt;alt_obs openmrs_concept=\"1694^ALT OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/alt_obs>\n      &lt;cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cd4_absolute_obs>\n      &lt;white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/white_blood_cells>\n      &lt;total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/total_protein>\n      &lt;urinary_albumin openmrs_concept=\"849^URINARY ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/urinary_albumin>\n      &lt;hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_viral_load>\n    &lt;/documented_observed_laboratory_data>\n    &lt;current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_antiretroviral_drugs_used_for_treatment>\n    &lt;tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment_plan>\n    &lt;hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hospital_slash_clinic>\n      &lt;diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/diagnosis_for_hospitalization>\n      &lt;date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/date_of_hospital_stay_entry>\n      &lt;data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/data_of_hospital_stay_exit>\n      &lt;hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hosptal_treatment>\n    &lt;/hospitalizations>\n    &lt;treatment_prescribed multiple=\"0\" openmrs_concept=\"1719^TREATMENT PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/treatment_prescribed>\n    &lt;side_effect_with_severity openmrs_concept=\"1365^SIDE EFFECT WITH SEVERITY^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/side_effect_with_severity>\n    &lt;reason_antiretrovirals_stopped multiple=\"0\" openmrs_concept=\"1252^REASON ANTIRETROVIRALS STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_antiretrovirals_stopped>\n    &lt;adherence multiple=\"0\" openmrs_concept=\"1714^ADHERENCE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/adherence>\n    &lt;return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/return_visit_date>\n    &lt;current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_who_hiv_stage>\n    &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cotrimoxazole_use>\n    &lt;isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/isoniazid_use>\n    &lt;nutritional_supplement multiple=\"1\" openmrs_concept=\"2152^NUTRITIONAL SUPPLEMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false&lt;/plumpy_nut>\n        &lt;basic_food_basket openmrs_concept=\"2151^BASIC FOOD BASKET^99DCT\">false&lt;/basic_food_basket>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;enriched_porridge openmrs_concept=\"2150^ENRICHED PORRIDGE^99DCT\">false&lt;/enriched_porridge>\n    &lt;/nutritional_supplement>\n    &lt;hipoteses_de_diagnosticos_outros multiple=\"1\" openmrs_concept=\"1406^OTHER DIAGNOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;anemia openmrs_concept=\"3^ANEMIA^99DCT\">false&lt;/anemia>\n        &lt;malaria openmrs_concept=\"123^MALARIA^99DCT\">false&lt;/malaria>\n        &lt;malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false&lt;/malnutrition>\n        &lt;polyp openmrs_concept=\"2142^POLYP^99DCT\">false&lt;/polyp>\n        &lt;rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false&lt;/rectovaginal_fistula>\n        &lt;prolapse openmrs_concept=\"2141^PROLAPSE^99DCT\">false&lt;/prolapse>\n    &lt;/hipoteses_de_diagnosticos_outros>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR --&gt;\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-26 18:23:36',0,NULL,NULL,NULL,'e28ac028-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (50,'ADULTO: PROCESSO PARTE B - EXAME CLINICO','1',82,0,'Processo de Hospital de Dia 2/2',1,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"ADULTO: PROCESSO PARTE B - EXAME CLINICO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/50-1-82.xsn\" solutionVersion=\"1.0.0.82\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/50-82\" id=\"50\" name=\"ADULTO: PROCESSO PARTE B - EXAME CLINICO\" version=\"1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered&gt;\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;vital_data openmrs_concept=\"1673^VITAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;written_history openmrs_concept=\"1671^WRITTEN HISTORY^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/written_history>\n      &lt;general_physical_state multiple=\"0\" openmrs_concept=\"1382^GENERAL PHYSICAL STATE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/general_physical_state>\n      &lt;systolic_blood_pressure openmrs_concept=\"5085^SYSTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/systolic_blood_pressure>\n      &lt;diastolic_blood_pressure openmrs_concept=\"5086^DIASTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/diastolic_blood_pressure>\n      &lt;temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/temperature_c>\n      &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/weight_kg>\n      &lt;height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/height_cm>\n      &lt;body_mass_index openmrs_concept=\"1342^BODY MASS INDEX^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/body_mass_index>\n      &lt;exame_mucosas multiple=\"1\" openmrs_concept=\"1415^EXAME OF MUCOSAL MEMBRANES^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;conjuntivas openmrs_concept=\"1418^CONJUNTIVAS^99DCT\">false&lt;/conjuntivas>\n            &lt;anictericas openmrs_concept=\"1420^ANICTERICAS^99DCT\">false&lt;/anictericas>\n            &lt;ictericas openmrs_concept=\"1419^ICTERICAS^99DCT\">false&lt;/ictericas>\n            &lt;descoradas openmrs_concept=\"1417^DESCORADAS^99DCT\">false&lt;/descoradas>\n            &lt;coradas openmrs_concept=\"1416^CORADAS^99DCT\">false&lt;/coradas>\n      &lt;/exame_mucosas>\n      &lt;findings_of_the_oral_cavity multiple=\"0\" openmrs_concept=\"1672^FINDINGS OF THE ORAL CAVITY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/findings_of_the_oral_cavity>\n      &lt;type_of_oral_sores openmrs_concept=\"1424^TYPE OF ORAL SORES^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/type_of_oral_sores>\n    &lt;/vital_data>\n    &lt;skin_exam_findings multiple=\"0\" openmrs_concept=\"1120^SKIN EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/skin_exam_findings>\n    &lt;skin_exam openmrs_concept=\"1674^SKIN EXAM^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;type_of_skin_lesion openmrs_concept=\"1423^TYPE OF SKIN LESION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/type_of_skin_lesion>\n      &lt;anatomic_locations multiple=\"0\" openmrs_concept=\"1239^ANATOMIC LOCATIONS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/anatomic_locations>\n    &lt;/skin_exam>\n    &lt;is_patient_hydrated multiple=\"0\" openmrs_concept=\"1425^IS PATIENT HYDRATED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_patient_hydrated>\n    &lt;lymph_node_exam_findings multiple=\"1\" openmrs_concept=\"1121^LYMPH NODE EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;submandibular openmrs_concept=\"504^SUBMANDIBULAR^99DCT\">false&lt;/submandibular>\n        &lt;supraclavicular openmrs_concept=\"505^SUPRACLAVICULAR^99DCT\">false&lt;/supraclavicular>\n        &lt;inguinal openmrs_concept=\"506^INGUINAL^99DCT\">false&lt;/inguinal>\n        &lt;cervical openmrs_concept=\"643^CERVICAL^99DCT\">false&lt;/cervical>\n        &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n        &lt;abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false&lt;/abnormal>\n        &lt;axillary openmrs_concept=\"5112^AXILLARY^99DCT\">false&lt;/axillary>\n        &lt;other_inguinal openmrs_concept=\"1426^OTHER INGUINAL^99DCT\">false&lt;/other_inguinal>\n    &lt;/lymph_node_exam_findings>\n    &lt;cardiological_exam openmrs_concept=\"1676^CARDIOLOGICAL EXAM^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;pulse openmrs_concept=\"5087^PULSE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pulse>\n      &lt;cardiac_exam_findings multiple=\"1\" openmrs_concept=\"1124^CARDIAC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;s3_gallop openmrs_concept=\"550^S3 GALLOP^99DCT\">false&lt;/s3_gallop>\n            &lt;cardiac_murmur openmrs_concept=\"562^CARDIAC MURMUR^99DCT\">false&lt;/cardiac_murmur>\n            &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n            &lt;abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false&lt;/abnormal>\n            &lt;abnormal_sounds openmrs_concept=\"1117^ABNORMAL SOUNDS^99DCT\">false&lt;/abnormal_sounds>\n            &lt;left_ventricular_lift openmrs_concept=\"5156^LEFT VENTRICULAR LIFT^99DCT\">false&lt;/left_ventricular_lift>\n            &lt;right_ventricular_lift openmrs_concept=\"5157^RIGHT VENTRICULAR LIFT^99DCT\">false&lt;/right_ventricular_lift>\n            &lt;evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false&lt;/evidence_of_cardiac_enlargement>\n            &lt;diastolic_descresendo_murmur openmrs_concept=\"5160^DIASTOLIC DESCRESENDO MURMUR^99DCT\">false&lt;/diastolic_descresendo_murmur>\n            &lt;holosystolic_murmur openmrs_concept=\"5162^HOLOSYSTOLIC MURMUR^99DCT\">false&lt;/holosystolic_murmur>\n            &lt;diastolic_rumble openmrs_concept=\"5164^DIASTOLIC RUMBLE^99DCT\">false&lt;/diastolic_rumble>\n            &lt;systolic_ejection_murmur openmrs_concept=\"5166^SYSTOLIC EJECTION MURMUR^99DCT\">false&lt;/systolic_ejection_murmur>\n            &lt;pericardial_friction_rub openmrs_concept=\"5176^PERICARDIAL FRICTION RUB^99DCT\">false&lt;/pericardial_friction_rub>\n            &lt;chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false&lt;/chronic_obstructive_pulmonary_disease>\n            &lt;arrythmia openmrs_concept=\"1395^ARRYTHMIA^99DCT\">false&lt;/arrythmia>\n      &lt;/cardiac_exam_findings>\n    &lt;/cardiological_exam>\n    &lt;pulmonary_exam_set openmrs_concept=\"1675^PULMONARY EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;pulmonary_exam multiple=\"0\" openmrs_concept=\"1427^PULMONARY EXAM^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pulmonary_exam>\n      &lt;respiratory_rate openmrs_concept=\"5242^RESPIRATORY RATE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/respiratory_rate>\n      &lt;pulmonary_auscultation_non_specific openmrs_concept=\"1543^PULMONARY AUSCULTATION, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pulmonary_auscultation_non_specific>\n      &lt;pulmonary_exam_auscultation multiple=\"1\" openmrs_concept=\"1629^PULMONARY EXAM AUSCULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;sopro_tubarico openmrs_concept=\"1550^SOPRO TUBARICO^99DCT\">false&lt;/sopro_tubarico>\n            &lt;snoring openmrs_concept=\"1549^SNORING^99DCT\">false&lt;/snoring>\n            &lt;murmur_anforico openmrs_concept=\"1551^MURMUR ANFORICO^99DCT\">false&lt;/murmur_anforico>\n            &lt;fervor openmrs_concept=\"1548^FERVOR^99DCT\">false&lt;/fervor>\n      &lt;/pulmonary_exam_auscultation>\n    &lt;/pulmonary_exam_set>\n    &lt;abdominal_exam_set openmrs_concept=\"1677^ABDOMINAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\"&gt;\n      &lt;abdominal_exam_findings multiple=\"1\" openmrs_concept=\"1125^ABDOMINAL EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;ascites openmrs_concept=\"581^ASCITES^99DCT\">false&lt;/ascites>\n            &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n            &lt;abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false&lt;/abnormal>\n            &lt;hepatomegaly openmrs_concept=\"5008^HEPATOMEGALY^99DCT\">false&lt;/hepatomegaly>\n            &lt;splenomegaly openmrs_concept=\"5009^SPLENOMEGALY^99DCT\">false&lt;/splenomegaly>\n            &lt;mass_abdominal openmrs_concept=\"5103^MASS, ABDOMINAL^99DCT\">false&lt;/mass_abdominal>\n            &lt;abdominal_tenderness openmrs_concept=\"5105^ABDOMINAL TENDERNESS^99DCT\">false&lt;/abdominal_tenderness>\n            &lt;distended openmrs_concept=\"1397^DISTENDED^99DCT\">false&lt;/distended>\n            &lt;flatulence openmrs_concept=\"1398^FLATULENCE^99DCT\">false&lt;/flatulence>\n      &lt;/abdominal_exam_findings>\n      &lt;abdominal_exam_other openmrs_concept=\"1396^ABDOMINAL EXAM, OTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/abdominal_exam_other>\n    &lt;/abdominal_exam_set>\n    &lt;genital_exam_set openmrs_concept=\"1679^GENITAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;urogenital_exam_findings multiple=\"1\" openmrs_concept=\"1126^UROGENITAL EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n            &lt;abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false&lt;/abnormal>\n            &lt;not_done openmrs_concept=\"1118^NOT DONE^99DCT\">false&lt;/not_done>\n            &lt;secretions openmrs_concept=\"1399^SECRETIONS^99DCT\">false&lt;/secretions>\n            &lt;condylomas openmrs_concept=\"1400^CONDYLOMAS^99DCT\">false&lt;/condylomas>\n            &lt;ulcers openmrs_concept=\"1602^ULCERS^99DCT\">false&lt;/ulcers>\n      &lt;/urogenital_exam_findings>\n      &lt;genital_exam_findings_non_coded openmrs_concept=\"1678^GENITAL EXAM FINDINGS, NON CODED^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/genital_exam_findings_non_coded>\n    &lt;/genital_exam_set>\n    &lt;neurological_exam_set openmrs_concept=\"1681^NEUROLOGICAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;neurologic_exam_findings multiple=\"1\" openmrs_concept=\"1129^NEUROLOGIC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;seizure openmrs_concept=\"206^SEIZURE^99DCT\">false&lt;/seizure>\n            &lt;cranial_nerve_abnormalities openmrs_concept=\"599^CRANIAL NERVE ABNORMALITIES^99DCT\">false&lt;/cranial_nerve_abnormalities>\n            &lt;normal openmrs_concept=\"1115^NORMAL^99DCT\">false&lt;/normal>\n            &lt;abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false&lt;/abnormal>\n            &lt;asymmetric_reflexes openmrs_concept=\"1199^ASYMMETRIC REFLEXES^99DCT\">false&lt;/asymmetric_reflexes>\n            &lt;abnormal_gait openmrs_concept=\"5108^ABNORMAL GAIT^99DCT\">false&lt;/abnormal_gait>\n            &lt;decreased_sensation openmrs_concept=\"5135^DECREASED SENSATION^99DCT\">false&lt;/decreased_sensation>\n            &lt;abnormal_tone openmrs_concept=\"5264^ABNORMAL TONE^99DCT\">false&lt;/abnormal_tone>\n            &lt;focal_weakness openmrs_concept=\"6005^FOCAL WEAKNESS^99DCT\">false&lt;/focal_weakness>\n            &lt;irritability openmrs_concept=\"6023^IRRITABILITY^99DCT\">false&lt;/irritability>\n            &lt;paresi openmrs_concept=\"1401^PARESI^99DCT\">false&lt;/paresi>\n            &lt;hemiparesis openmrs_concept=\"828^HEMIPARESIS^99DCT\">false&lt;/hemiparesis>\n            &lt;peripheral_neuropathy openmrs_concept=\"821^PERIPHERAL NEUROPATHY^99DCT\">false&lt;/peripheral_neuropathy>\n            &lt;nuchal_rigidity openmrs_concept=\"5170^NUCHAL RIGIDITY^99DCT\">false&lt;/nuchal_rigidity>\n      &lt;/neurologic_exam_findings>\n      &lt;type_of_paralysis_non_coded openmrs_concept=\"1680^TYPE OF PARALYSIS, NON CODED^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/type_of_paralysis_non_coded>\n      &lt;neurological_exam_other openmrs_concept=\"1407^NEUROLOGICAL EXAM OTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/neurological_exam_other>\n    &lt;/neurological_exam_set>\n    &lt;extremities_exam_set openmrs_concept=\"1683^EXTREMITIES EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;extremity_exam_findings multiple=\"0\" openmrs_concept=\"1127^EXTREMITY EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/extremity_exam_findings>\n      &lt;anatomic_locations multiple=\"0\" openmrs_concept=\"1239^ANATOMIC LOCATIONS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/anatomic_locations>\n    &lt;/extremities_exam_set>\n    &lt;extremities_exam_other_non_coded openmrs_concept=\"1682^EXTREMITIES EXAM, OTHER NON CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/extremities_exam_other_non_coded>\n    &lt;karnofsky_performance_score openmrs_concept=\"5283^KARNOFSKY PERFORMANCE SCORE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/karnofsky_performance_score>\n    &lt;non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/non_coded_diagnosis&gt;\n    &lt;counceling_date openmrs_concept=\"1475^COUNCELING DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/counceling_date>\n    &lt;thereputic_plan openmrs_concept=\"1474^THEREPUTIC PLAN^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/thereputic_plan>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer --&gt;\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',9,'2008-10-23 10:15:56',13,'2011-01-11 15:23:07',0,NULL,NULL,NULL,'e28ad2ac-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (51,'TARV: FRIDA','0.1',68,0,'Registo Individual de Dispesas Medicamentos',18,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TARV: FRIDA\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/51-0.1-68.xsn\" solutionVersion=\"0.1.0.68\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/51-68\" id=\"51\" name=\"TARV: FRIDA\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}&lt;/encouter.location_name>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;posology openmrs_concept=\"1711^POSOLOGY^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/posology>\n    &lt;duration openmrs_concept=\"1710^DURATION^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/duration>\n    &lt;quantity_prescribed openmrs_concept=\"1712^QUANTITY PRESCRIBED^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/quantity_prescribed>\n    &lt;pills_left_over openmrs_concept=\"1713^PILLS LEFT OVER^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/pills_left_over>\n    &lt;adherence multiple=\"0\" openmrs_concept=\"1714^ADHERENCE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/adherence>\n    &lt;medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/medication_quantity_available>\n    &lt;antiretroviral_plan_-_tarv_start multiple=\"0\" openmrs_concept=\"1255^ANTIRETROVIRAL PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/antiretroviral_plan_-_tarv_start>\n    &lt;exit_from_arv_treatment multiple=\"0\" openmrs_concept=\"1708^EXIT FROM ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/exit_from_arv_treatment>\n    &lt;current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^CURRENT ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_antiretroviral_drugs_used_for_treatment>\n    &lt;historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/historical_drug_start_date>\n    &lt;return_visit_date openmrs_concept=\"5096^RETURN VISIT DATE FOR ARV DRUG^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/return_visit_date>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID --&gt;\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:05',0,NULL,NULL,NULL,'e28ae562-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (56,'Template: MISAU header, compact','0.1',92,0,'DO NOT USE \r\nHeader without address made as small as possible',4,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"Template: MISAU header, compact\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/56-0.1-92.xsn\" solutionVersion=\"0.1.0.92\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/56-92\" id=\"56\" name=\"Template: MISAU header, compact\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}&lt;/patient.tribe>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;return_visit_date openmrs_concept=\"5096^RETURN VISIT DATE FOR ARV DRUG^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/return_visit_date>\n    &lt;placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/placeholder>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:13',0,NULL,NULL,NULL,'e28b1406-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (60,'LABORATORIO GERAL','0.1',116,0,'Ficha Laboratorio Todos resultados',13,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"LABORATORIO GERAL\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/60-0.1-116.xsn\" solutionVersion=\"0.1.0.116\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/60-116\" id=\"60\" name=\"LABORATORIO GERAL\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}&lt;/encouter.location_name>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;biochemistry_laboratory_set openmrs_concept=\"1633^BIOCHEMISTRY LABORATORY SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/total_protein>\n      &lt;serum_albumin openmrs_concept=\"848^SERUM ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_albumin>\n      &lt;globulinas openmrs_concept=\"1520^GLOBULINS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/globulinas>\n      &lt;total_bilirubin openmrs_concept=\"655^TOTAL BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/total_bilirubin>\n      &lt;direct_bilirubin openmrs_concept=\"1297^DIRECT BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/direct_bilirubin>\n      &lt;serum_glutamic-oxaloacetic_transaminase openmrs_concept=\"653^SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glutamic-oxaloacetic_transaminase>\n      &lt;serum_glutamic-pyruvic_transaminase openmrs_concept=\"654^SERUM GLUTAMIC-PYRUVIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glutamic-pyruvic_transaminase>\n      &lt;lactate_dehydrogenase openmrs_concept=\"1014^LACTATE DEHYDROGENASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lactate_dehydrogenase>\n      &lt;alkaline_phosphatase openmrs_concept=\"785^ALKALINE PHOSPHATASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/alkaline_phosphatase>\n      &lt;amylase openmrs_concept=\"1299^AMYLASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/amylase>\n      &lt;total_cholesterol openmrs_concept=\"1006^TOTAL CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/total_cholesterol>\n      &lt;high-density_lipoprotein_cholesterol openmrs_concept=\"1007^HIGH-DENSITY LIPOPROTEIN CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/high-density_lipoprotein_cholesterol>\n      &lt;low-density_lipoprotein_cholesterol openmrs_concept=\"1008^LOW-DENSITY LIPOPROTEIN CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/low-density_lipoprotein_cholesterol>\n      &lt;creatine_kinase openmrs_concept=\"1011^CREATINE KINASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/creatine_kinase>\n      &lt;serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_creatinine>\n      &lt;gamma_glutamyl_transferase openmrs_concept=\"2077^GAMMA GLUTAMYL TRANSFERASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gamma_glutamyl_transferase>\n      &lt;serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glucose>\n      &lt;serum_lactate openmrs_concept=\"1012^SERUM LACTATE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_lactate>\n      &lt;serum_lipase openmrs_concept=\"1013^SERUM LIPASE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_lipase>\n      &lt;triglycerides openmrs_concept=\"1009^TRIGLYCERIDES^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/triglycerides>\n      &lt;blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/blood_urea_nitrogen>\n      &lt;serum_chloride openmrs_concept=\"1134^SERUM CHLORIDE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_chloride>\n      &lt;serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_potassium>\n      &lt;serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_sodium>\n    &lt;/biochemistry_laboratory_set>\n    &lt;hemogram_kx21n openmrs_concept=\"1723^HEMOGRAM KX21N^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hemoglobin>\n      &lt;hematocrit openmrs_concept=\"1015^HEMATOCRIT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hematocrit>\n      &lt;mean_corpuscular_volume openmrs_concept=\"851^MEAN CORPUSCULAR VOLUME^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mean_corpuscular_volume>\n      &lt;platelets openmrs_concept=\"729^PLATELETS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/platelets>\n      &lt;white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/white_blood_cells>\n      &lt;absolute_neutrophil_count openmrs_concept=\"1330^ABSOLUTE NEUTROPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/absolute_neutrophil_count>\n      &lt;lymphocytes openmrs_concept=\"1021^LYMPHOCYTES^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymphocytes>\n      &lt;neutrophils openmrs_concept=\"1022^NEUTROPHILS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/neutrophils>\n      &lt;absolute_lymphocyte_count openmrs_concept=\"952^ABSOLUTE LYMPHOCYTE COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/absolute_lymphocyte_count>\n      &lt;eosinophils openmrs_concept=\"1024^EOSINOPHILS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/eosinophils>\n      &lt;absolute_eosinophil_count openmrs_concept=\"1332^ABSOLUTE EOSINOPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/absolute_eosinophil_count>\n      &lt;basophils openmrs_concept=\"1025^BASOPHILS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/basophils>\n      &lt;absolute_basophil_count openmrs_concept=\"1333^ABSOLUTE BASOPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/absolute_basophil_count>\n      &lt;monocytes openmrs_concept=\"1023^MONOCYTES^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/monocytes>\n      &lt;absolute_monocyte_count openmrs_concept=\"1331^ABSOLUTE MONOCYTE COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/absolute_monocyte_count>\n      &lt;red_blood_cells openmrs_concept=\"679^RED BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/red_blood_cells>\n      &lt;mean_cell_hemoglobin_concentration openmrs_concept=\"1017^MEAN CELL HEMOGLOBIN CONCENTRATION^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mean_cell_hemoglobin_concentration>\n      &lt;mean_corpuscular_hemoglobin openmrs_concept=\"1018^MEAN CORPUSCULAR HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mean_corpuscular_hemoglobin>\n      &lt;red_cell_distribution_width openmrs_concept=\"1016^RED CELL DISTRIBUTION WIDTH^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/red_cell_distribution_width>\n      &lt;erythrocyte_sedimentation_rate openmrs_concept=\"855^ERYTHROCYTE SEDIMENTATION RATE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/&gt;\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/erythrocyte_sedimentation_rate>\n      &lt;blood_typing multiple=\"0\" openmrs_concept=\"300^BLOOD TYPING^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/blood_typing>\n      &lt;mean_platelet_volume openmrs_concept=\"1307^MEAN PLATELET VOLUME^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mean_platelet_volume>\n      &lt;vdrl multiple=\"0\" openmrs_concept=\"299^VDRL^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/vdrl>\n    &lt;/hemogram_kx21n>\n    &lt;serum_laboratory_set openmrs_concept=\"1640^SERUM LABORATORY SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/blood_urea_nitrogen>\n      &lt;serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_creatinine>\n      &lt;serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\"&gt;\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_sodium>\n      &lt;serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_potassium>\n      &lt;serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/serum_glucose>\n    &lt;/serum_laboratory_set>\n    &lt;immunology openmrs_concept=\"1639^IMMUNOLOGY^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/rapid_plasma_reagin>\n      &lt;immuno_globulin_hiv openmrs_concept=\"1519^IMMUNO GLOBULIN HIV^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/immuno_globulin_hiv>\n      &lt;cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cd4_count>\n      &lt;cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/cd4_percent>\n    &lt;/immunology>\n    &lt;virology_tests openmrs_concept=\"1632^VIROLOGY TESTS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_viral_load>\n      &lt;hiv_viral_load_log openmrs_concept=\"1518^HIV VIRAL LOAD LOG^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_viral_load_log>\n      &lt;viral_load_exam_type multiple=\"0\" openmrs_concept=\"1574^VIRAL LOAD EXAM TYPE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/viral_load_exam_type>\n      &lt;hiv_viral_load_qualitative multiple=\"0\" openmrs_concept=\"1305^HIV VIRAL LOAD, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_viral_load_qualitative>\n    &lt;/virology_tests>\n    &lt;hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_dna_polymerase_chain_reaction_qualitative>\n    &lt;pediatric_urinalysis multiple=\"1\" openmrs_concept=\"1619^PEDIATRIC URINALYSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;urina_piocytes openmrs_concept=\"1525^URINA PIOCYTES^99DCT\">false&lt;/urina_piocytes>\n        &lt;urine_erithrocytes openmrs_concept=\"1523^URINE ERITHROCYTES^99DCT\">false&lt;/urine_erithrocytes>\n        &lt;urine_leucocytes openmrs_concept=\"1522^URINE LEUCOCYTES^99DCT\">false&lt;/urine_leucocytes>\n        &lt;epithelial_cells openmrs_concept=\"666^EPITHELIAL CELLS^99DCT\">false&lt;/epithelial_cells>\n        &lt;urine_cilinders openmrs_concept=\"1524^URINE CILINDERS^99DCT\">false&lt;/urine_cilinders>\n    &lt;/pediatric_urinalysis>\n    &lt;parasitology_feces multiple=\"0\" openmrs_concept=\"1635^PARASITOLOGY, FECES^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/parasitology_feces>\n    &lt;serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/serum_creatinine>\n    &lt;sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/sputum_for_acid_fast_bacilli>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" /&gt;\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',2,'2008-10-31 11:06:07',13,'2011-01-11 15:23:28',0,NULL,NULL,NULL,'e28b23a6-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (62,'TARV: RASTREIO DE TUBERCULOSE','0.1',60,0,'Formulario de restrio de casos de suspeita de tuberculose em doentes com HIV',20,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TARV: RASTREIO DE TUBERCULOSE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/62-0.1-60.xsn\" solutionVersion=\"0.1.0.60\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/62-60\" id=\"62\" name=\"TARV: RASTREIO DE TUBERCULOSE\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;tb_observations multiple=\"1\" openmrs_concept=\"1766^TB OBSERVATIONS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;nightsweats_lasting_more_than_3_weeks openmrs_concept=\"1762^NIGHTSWEATS LASTING MORE THAN 3 WEEKS^99DCT\">false&lt;/nightsweats_lasting_more_than_3_weeks>\n        &lt;cough_lasting_more_than_3_weeks openmrs_concept=\"1760^COUGH LASTING MORE THAN 3 WEEKS^99DCT\">false&lt;/cough_lasting_more_than_3_weeks>\n        &lt;weight_loss_of_more_than_3_kg_in_last_month openmrs_concept=\"1764^WEIGHT LOSS OF MORE THAN 3 KG IN LAST MONTH^99DCT\"&gt;false&lt;/weight_loss_of_more_than_3_kg_in_last_month>\n        &lt;coughing_up_blood openmrs_concept=\"1761^COUGHING UP BLOOD^99DCT\">false&lt;/coughing_up_blood>\n        &lt;fever_lasting_more_than_3_weeks openmrs_concept=\"1763^FEVER LASTING MORE THAN 3 WEEKS^99DCT\">false&lt;/fever_lasting_more_than_3_weeks>\n        &lt;cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false&lt;/cohabitant_being_treated_for_tb>\n    &lt;/tb_observations>\n    &lt;tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/tubuculosis_exams>\n      &lt;sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/sputum_for_acid_fast_bacilli>\n      &lt;x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/x-ray_chest>\n      &lt;ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ultrasound_tb>\n      &lt;lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymph_node_biopsy>\n      &lt;paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/paracentesis>\n      &lt;thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/thoracentesis>\n      &lt;purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/purified_protein_derivative>\n      &lt;gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gastric_levage>\n      &lt;test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/test_other>\n    &lt;/tuberculosis_exams_set>\n    &lt;does_patient_have_tuberculosis multiple=\"0\" openmrs_concept=\"1785^DOES PATIENT HAVE TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/does_patient_have_tuberculosis>\n    &lt;type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/type_of_tuberculosis>\n    &lt;tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_drug_treatment_start_date>\n    &lt;tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment>\n    &lt;reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_tuberculosis_treatment_stopped>\n    &lt;tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false&lt;/isoniazid>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n    &lt;/tuberculosis_prophylaxis_started>\n    &lt;reason_tuberculosis_prophylaxis_stopped multiple=\"0\" openmrs_concept=\"1266^REASON TUBERCULOSIS PROPHYLAXIS STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_tuberculosis_prophylaxis_stopped>\n    &lt;service_providing_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1783^SERVICE PROVIDING TUBERCULOSIS TREATMENT ^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/service_providing_tuberculosis_treatment>\n    &lt;service_providing_prophylaxis_treatment multiple=\"0\" openmrs_concept=\"1786^SERVICE PROVIDING PROPHYLAXIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/service_providing_prophylaxis_treatment>\n    &lt;tuberculosis_drug_treatment_end_date openmrs_concept=\"6120^TUBERCULOSIS DRUG TREATMENT END DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_drug_treatment_end_date>\n    &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cotrimoxazole_use>\n    &lt;isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/isoniazid_use>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) &gt; 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" /&gt;\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-26 17:28:03',0,NULL,NULL,NULL,'e28b2fb8-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (63,'TARV: ACONSELHAMENTO','1',73,0,'Ficha de aconselhamento Pr-TARV',19,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TARV: ACONSELHAMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/63-1-73.xsn\" solutionVersion=\"1.0.0.73\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/63-73\" id=\"63\" name=\"TARV: ACONSELHAMENTO\" version=\"1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;counseling_session_number openmrs_concept=\"1724^COUNSELING SESSION NUMBER^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/counseling_session_number>\n    &lt;current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_who_hiv_stage>\n    &lt;cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cd4_absolute_obs>\n    &lt;who_slash_cdc_staging_criteria_met multiple=\"0\" openmrs_concept=\"1248^WHO/CDC STAGING CRITERIA MET^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/who_slash_cdc_staging_criteria_met>\n    &lt;date_of_counseling_session openmrs_concept=\"1758^DATE OF COUNSELING SESSION^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_counseling_session>\n    &lt;counseling_session multiple=\"0\" openmrs_concept=\"1727^COUNSELING SESSION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/counseling_session>\n    &lt;confidante_present multiple=\"0\" openmrs_concept=\"1728^CONFIDANTE PRESENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/confidante_present>\n    &lt;patient_understands_treatment_concepts multiple=\"0\" openmrs_concept=\"1729^PATIENT UNDERSTANDS TREATMENT CONCEPTS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_understands_treatment_concepts>\n    &lt;date_of_evaluation openmrs_concept=\"1730^DATE OF EVALUATION^99DCT\" openmrs_datatype=\"DT\"&gt;\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_evaluation>\n    &lt;patient_knowledge_of_hiv_contraction openmrs_concept=\"1731^PATIENT KNOWLEDGE OF HIV CONTRACTION^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_knowledge_of_hiv_contraction>\n    &lt;patient_knowledge_of_effect_of_hiv openmrs_concept=\"1732^PATIENT KNOWLEDGE OF EFFECT OF HIV^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_knowledge_of_effect_of_hiv>\n    &lt;patient_understands_purpose_of_cd4 openmrs_concept=\"1733^PATIENT UNDERSTANDS PURPOSE OF CD4^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_understands_purpose_of_cd4>\n    &lt;patient_understands_importance_of_adherence openmrs_concept=\"1734^PATIENT UNDERSTANDS IMPORTANCE OF ADHERENCE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_understands_importance_of_adherence>\n    &lt;patient_knowledge_of_treatment_duration openmrs_concept=\"1735^PATIENT KNOWLEDGE OF TREATMENT DURATION^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_knowledge_of_treatment_duration>\n    &lt;is_the_patient_interested_in_taking_arv multiple=\"0\" openmrs_concept=\"1736^IS THE PATIENT INTERESTED IN TAKING ARV^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_the_patient_interested_in_taking_arv>\n    &lt;did_the_patient_sign_the_consent_form multiple=\"0\" openmrs_concept=\"1738^DID THE PATIENT SIGN THE CONSENT FORM^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/did_the_patient_sign_the_consent_form>\n    &lt;did_the_patient_present_a_confidant multiple=\"0\" openmrs_concept=\"1739^DID THE PATIENT PRESENT A CONFIDANT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/did_the_patient_present_a_confidant>\n    &lt;confidant_name openmrs_concept=\"1740^CONFIDANT NAME^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/confidant_name>\n    &lt;confidant_relation_to_candidate openmrs_concept=\"1741^CONFIDANT RELATION TO CANDIDATE^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/confidant_relation_to_candidate>\n    &lt;does_the_confidant_live_in_the_patients_home multiple=\"0\" openmrs_concept=\"1742^DOES THE CONFIDANT LIVE IN THE PATIENTS HOME^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/does_the_confidant_live_in_the_patients_home>\n    &lt;confidant_contact openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/confidant_contact>\n    &lt;can_the_patient_visit_the_hospital_regularly_to_continue_arv_treatment multiple=\"0\" openmrs_concept=\"1743^CAN THE PATIENT VISIT THE HOSPITAL REGULARLY TO CONTINUE ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/can_the_patient_visit_the_hospital_regularly_to_continue_arv_treatment>\n    &lt;distance_from_patients_home_to_the_hospital multiple=\"0\" openmrs_concept=\"1747^DISTANCE FROM PATIENTS HOME TO THE HOSPITAL^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/distance_from_patients_home_to_the_hospital>\n    &lt;transportation_problems multiple=\"0\" openmrs_concept=\"1737^TRANSPORTATION PROBLEMS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/transportation_problems>\n    &lt;problems_with_food_security multiple=\"0\" openmrs_concept=\"1759^PROBLEMS WITH FOOD SECURITY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/problems_with_food_security>\n    &lt;other_problems openmrs_concept=\"1748^OTHER PROBLEMS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_problems>\n    &lt;arv_adherence_risk multiple=\"0\" openmrs_concept=\"1749^ARV ADHERENCE RISK^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/arv_adherence_risk>\n    &lt;drug_habits multiple=\"1\" openmrs_concept=\"1389^DRUG HABIT(S)^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;tobacco openmrs_concept=\"1388^TOBACCO^99DCT\">false&lt;/tobacco>\n        &lt;alcohol_use openmrs_concept=\"1603^ALCOHOL USE^99DCT\">false&lt;/alcohol_use>\n        &lt;intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false&lt;/intravenous_drug_use>\n    &lt;/drug_habits>\n    &lt;does_the_patient_suffer_from_depression multiple=\"0\" openmrs_concept=\"1750^DOES THE PATIENT SUFFER FROM DEPRESSION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/does_the_patient_suffer_from_depression>\n    &lt;history_of_poor_adherence openmrs_concept=\"1751^HISTORY OF POOR ADHERENCE^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/history_of_poor_adherence>\n    &lt;does_the_patient_understand_the_regimen_of_treatment multiple=\"0\" openmrs_concept=\"1752^DOES THE PATIENT UNDERSTAND THE REGIMEN OF TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/does_the_patient_understand_the_regimen_of_treatment>\n    &lt;patient_understands_arv_medicines_and_schedules openmrs_concept=\"1753^PATIENT UNDERSTANDS ARV MEDICINES AND SCHEDULES^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_understands_arv_medicines_and_schedules>\n    &lt;patient_understands_missed_arv_dose_and_vomiting openmrs_concept=\"1754^PATIENT UNDERSTANDS MISSED ARV DOSE AND VOMITING^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_understands_missed_arv_dose_and_vomiting>\n    &lt;patient_understands_arv_side_effects openmrs_concept=\"1755^PATIENT UNDERSTANDS ARV SIDE EFFECTS^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_understands_arv_side_effects>\n    &lt;is_the_patient_ready_to_take_arv_drugs multiple=\"0\" openmrs_concept=\"1756^IS THE PATIENT READY TO TAKE ARV DRUGS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_the_patient_ready_to_take_arv_drugs>\n    &lt;comments_of_the_counselor openmrs_concept=\"1757^COMMENTS OF THE COUNSELOR^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/comments_of_the_counselor>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name --&gt;\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text&gt;              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',9,'2008-11-06 11:20:42',13,'2011-01-11 15:24:01',0,NULL,NULL,NULL,'e28b3b52-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (65,'TARV: SOLICITACAO','0.1',57,0,'Ficha de Solicitao de Medicamentos ARV',17,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TARV: SOLICITACAO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/65-0.1-57.xsn\" solutionVersion=\"0.1.0.57\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/65-57\" id=\"65\" name=\"TARV: SOLICITACAO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/name_of_mother>\n    &lt;patient_notified_of_tarv_details openmrs_concept=\"1592^PATIENT NOTIFIED OF TARV DETAILS^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_notified_of_tarv_details>\n    &lt;arv_treatment_plan openmrs_concept=\"1795^ARV TREATMENT PLAN^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^CURRENT ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/current_antiretroviral_drugs_used_for_treatment>\n      &lt;arv_dosage_amount openmrs_concept=\"1793^ARV DOSAGE AMOUNT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/arv_dosage_amount>\n      &lt;arv_frequency openmrs_concept=\"1794^ARV FREQUENCY^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/arv_frequency>\n    &lt;/arv_treatment_plan>\n    &lt;patient_has_exibited_symptoms_of_hiv_infection multiple=\"0\" openmrs_concept=\"1591^PATIENT HAS EXIBITED SYMPTOMS OF HIV INFECTION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_has_exibited_symptoms_of_hiv_infection>\n    &lt;patient_catagory_for_tarv_request multiple=\"0\" openmrs_concept=\"1585^PATIENT CATAGORY FOR TARV REQUEST^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_catagory_for_tarv_request>\n    &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_weeks_pregnant>\n    &lt;nevaripin_used_during_delivery multiple=\"0\" openmrs_concept=\"1583^NEVARIPIN USED DURING DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/nevaripin_used_during_delivery>\n    &lt;patient_reported_current_pcp_prophylaxis multiple=\"0\" openmrs_concept=\"1109^PATIENT REPORTED CURRENT PCP PROPHYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_reported_current_pcp_prophylaxis>\n    &lt;rifampicin_use multiple=\"0\" openmrs_concept=\"1582^RIFAMPICIN USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/rifampicin_use>\n    &lt;cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cd4_count>\n    &lt;cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cd4_percent>\n    &lt;hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_viral_load>\n    &lt;viral_load_exam_type multiple=\"0\" openmrs_concept=\"1574^VIRAL LOAD EXAM TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/viral_load_exam_type>\n    &lt;months_perscription_is_valid openmrs_concept=\"1290^MONTHS PERSCRIPTION IS VALID^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/months_perscription_is_valid>\n    &lt;justification_for_two_months_of_arv_medication openmrs_concept=\"1291^JUSTIFICATION FOR TWO MONTHS OF ARV MEDICATION^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/justification_for_two_months_of_arv_medication>\n    &lt;clinical_hiv_manifestations multiple=\"1\" openmrs_concept=\"1788^CLINICAL HIV MANIFESTATIONS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false&lt;/pneumocystic_carinii_pneumonia>\n        &lt;hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false&lt;/hiv_staging_-_lymphoma>\n        &lt;mac openmrs_concept=\"1796^MAC^99DCT\">false&lt;/mac>\n        &lt;kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false&lt;/kaposi_apos_s_sarcoma>\n        &lt;progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false&lt;/progressive_multifocal_leukoencephalopathy>\n        &lt;hiv_staging_-_lymphoma_brain openmrs_concept=\"5040^HIV STAGING - LYMPHOMA, BRAIN^99DCT\">false&lt;/hiv_staging_-_lymphoma_brain>\n        &lt;hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false&lt;/hiv_staging-candidiasis_respiratory_tract>\n        &lt;hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false&lt;/hiv_staging_-_adult_herpes_zoster>\n        &lt;toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false&lt;/toxoplasmosis>\n        &lt;cryptococcosis openmrs_concept=\"1219^CRYPTOCOCCOSIS^99DCT\">false&lt;/cryptococcosis>\n        &lt;tuberculosis openmrs_concept=\"58^TUBERCULOSIS^99DCT\">false&lt;/tuberculosis>\n        &lt;hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false&lt;/hiv_staging_-_cryptosporidiosis>\n        &lt;hiv_staging_-_histoplasmosis_disseminated openmrs_concept=\"5038^HIV STAGING - HISTOPLASMOSIS, DISSEMINATED^99DCT\">false&lt;/hiv_staging_-_histoplasmosis_disseminated>\n        &lt;hiv_staging_-_infant_cytomegalovirus openmrs_concept=\"5017^HIV STAGING - INFANT CYTOMEGALOVIRUS^99DCT\">false&lt;/hiv_staging_-_infant_cytomegalovirus>\n    &lt;/clinical_hiv_manifestations>\n    &lt;justification_to_change_arv_treatment multiple=\"0\" openmrs_concept=\"1792^JUSTIFICATION TO CHANGE ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/justification_to_change_arv_treatment>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" /&gt;\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:10',0,NULL,NULL,NULL,'e28b5c54-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (67,'ADULTO: PROCESSO PARTE A - ANAMNESE','1.1',157,1,'Processo de Hospital de Dia 1/2',5,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"ADULTO: PROCESSO PARTE A - ANAMNESE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/67-1.1-157.xsn\" solutionVersion=\"1.1.0.157\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/67-157\" id=\"67\" name=\"ADULTO: PROCESSO PARTE A - ANAMNESE\" version=\"1.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}&lt;/patient_address.city>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_name>\n      &lt;personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_surname>\n      &lt;personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_telephone_number>\n    &lt;/personal_reference>\n    &lt;other_personal_information openmrs_concept=\"1657^OTHER PERSONAL INFORMATION^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;occupation openmrs_concept=\"1459^OCCUPATION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/occupation>\n      &lt;level_of_education multiple=\"0\" openmrs_concept=\"1443^LEVEL OF EDUCATION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/level_of_education>\n      &lt;number_of_household_members openmrs_concept=\"1656^NUMBER OF HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_household_members>\n    &lt;/other_personal_information>\n    &lt;civil_information_for_hiv_postitive_patients openmrs_concept=\"1659^CIVIL INFORMATION FOR HIV POSTITIVE PATIENTS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;civil_status multiple=\"0\" openmrs_concept=\"1054^CIVIL STATUS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/civil_status>\n      &lt;number_of_wives openmrs_concept=\"5557^NUMBER OF WIVES^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_wives>\n      &lt;hiv_status_of_wives multiple=\"0\" openmrs_concept=\"1449^HIV STATUS OF WIVES^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_status_of_wives>\n      &lt;patient_id_of_hiv_positive_wife openmrs_concept=\"1450^PATIENT ID OF HIV POSITIVE WIFE^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_id_of_hiv_positive_wife>\n      &lt;other_partners openmrs_concept=\"1451^OTHER PARTNERS^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/other_partners>\n      &lt;number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_children>\n      &lt;number_of_children_tested_for_hiv openmrs_concept=\"1452^NUMBER OF CHILDREN TESTED FOR HIV^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_children_tested_for_hiv>\n      &lt;number_of_hiv_positive_children openmrs_concept=\"1453^NUMBER OF HIV POSITIVE CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_hiv_positive_children>\n      &lt;patient_id_for_hiv_positive_children openmrs_concept=\"1454^PATIENT ID FOR HIV POSITIVE CHILDREN^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_id_for_hiv_positive_children>\n    &lt;/civil_information_for_hiv_postitive_patients>\n    &lt;social_status openmrs_concept=\"1660^SOCIAL STATUS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;refrigerator_in_home multiple=\"0\" openmrs_concept=\"1455^REFRIGERATOR IN HOME^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/refrigerator_in_home>\n      &lt;home_electricity multiple=\"0\" openmrs_concept=\"5609^HOME ELECTRICITY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/home_electricity>\n    &lt;/social_status>\n    &lt;entry_point_into_hiv_care_set openmrs_concept=\"1625^ENTRY POINT INTO HIV CARE, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/entry_point_into_hiv_care_referal_type>\n      &lt;entry_point_into_hiv_care_location_name openmrs_concept=\"1626^ENTRY POINT INTO HIV CARE, LOCATION NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/entry_point_into_hiv_care_location_name>\n      &lt;entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/entry_point_into_hiv_care_patient_code_at_location>\n    &lt;/entry_point_into_hiv_care_set>\n    &lt;hiv_diagnostics openmrs_concept=\"1661^HIV DIAGNOSTICS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/is_patient_hiv_positive>\n      &lt;patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_received_counceling>\n    &lt;/hiv_diagnostics>\n    &lt;patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_received_counceling>\n    &lt;drug_habits multiple=\"1\" openmrs_concept=\"1389^DRUG HABIT(S)^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;tobacco openmrs_concept=\"1388^TOBACCO^99DCT\">false&lt;/tobacco>\n        &lt;alcohol_use openmrs_concept=\"1603^ALCOHOL USE^99DCT\">false&lt;/alcohol_use>\n        &lt;intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false&lt;/intravenous_drug_use>\n    &lt;/drug_habits>\n    &lt;sexual_preference multiple=\"0\" openmrs_concept=\"1375^SEXUAL PREFERENCE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/sexual_preference>\n    &lt;number_of_sexual_partners_in_the_last_3_months multiple=\"0\" openmrs_concept=\"1666^NUMBER OF SEXUAL PARTNERS IN THE LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_sexual_partners_in_the_last_3_months>\n    &lt;gynacological_history openmrs_concept=\"1393^GYNACOLOGICAL HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;gravida openmrs_concept=\"5624^GRAVIDA^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gravida>\n      &lt;gpav_para openmrs_concept=\"1392^GPAV PARA^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gpav_para>\n      &lt;gpav_aborted openmrs_concept=\"1390^GPAV ABORTED^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gpav_aborted>\n      &lt;gpav_vivos openmrs_concept=\"1391^GPAV VIVOS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gpav_vivos>\n      &lt;antecedentes_ginecologicos_outros openmrs_concept=\"1394^GYNECOLOGICAL HISTORY, OTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/antecedentes_ginecologicos_outros>\n      &lt;date_of_last_menstration openmrs_concept=\"1465^DATE OF LAST MENSTRATION^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/date_of_last_menstration>\n    &lt;/gynacological_history>\n    &lt;obstectric_history openmrs_concept=\"1668^OBSTECTRIC HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prior_abortion multiple=\"0\" openmrs_concept=\"1667^PRIOR ABORTION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prior_abortion>\n      &lt;tratamento_ptv multiple=\"0\" openmrs_concept=\"1466^PMTCT TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/tratamento_ptv>\n      &lt;tratamento_ptv_quais multiple=\"0\" openmrs_concept=\"1467^PMTCT TREATMENT, SPECIFIC^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/tratamento_ptv_quais>\n      &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n            &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n            &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n            &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n            &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n            &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n            &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n            &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n            &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n            &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n      &lt;/prenatal_arv_medication_mother>\n      &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant>\n      &lt;pregnancy_due_date openmrs_concept=\"1600^PREGNANCY DUE DATE^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pregnancy_due_date>\n      &lt;prior_delivery_date openmrs_concept=\"5599^PRIOR DELIVERY DATE^99DCT\" openmrs_datatype=\"TS\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prior_delivery_date>\n      &lt;pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pregant>\n    &lt;/obstectric_history>\n    &lt;infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/infant_feeding_method>\n    &lt;allergies_to_medicine openmrs_concept=\"1669^ALLERGIES TO MEDICINE^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;medication_allergy multiple=\"0\" openmrs_concept=\"1601^MEDICATION ALLERGY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/medication_allergy>\n      &lt;medication_allergies multiple=\"0\" openmrs_concept=\"1605^MEDICATION ALLERGIES^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/medication_allergies>\n      &lt;medication_allergy_specific_non_coded openmrs_concept=\"1517^MEDICATION ALLERGY SPECIFIC NON CODED^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/medication_allergy_specific_non_coded>\n    &lt;/allergies_to_medicine>\n    &lt;antiretroviral_use multiple=\"0\" openmrs_concept=\"1192^ANTIRETROVIRAL USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/antiretroviral_use>\n    &lt;previous_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1087^PREVIOUS ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/previous_antiretroviral_drugs_used_for_treatment>\n    &lt;adult_clinical_history multiple=\"0\" openmrs_concept=\"1670^ADULT CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/adult_clinical_history>\n    &lt;clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/clinical_history_not_coded>\n    &lt;hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hospital_slash_clinic>\n      &lt;diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/diagnosis_for_hospitalization>\n      &lt;date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/date_of_hospital_stay_entry>\n      &lt;data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/data_of_hospital_stay_exit>\n      &lt;hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hosptal_treatment>\n    &lt;/hospitalizations>\n    &lt;hiv_exposure_adult_set openmrs_concept=\"1688^HIV EXPOSURE ADULT, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hiv_exposure_through_surgery multiple=\"0\" openmrs_concept=\"1685^HIV EXPOSURE THROUGH SURGERY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_exposure_through_surgery>\n      &lt;description_of_surgical_intervention openmrs_concept=\"1473^DESCRIPTION OF SURGICAL INTERVENTION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/description_of_surgical_intervention>\n      &lt;hiv_exposure_through_blood_transfusion multiple=\"0\" openmrs_concept=\"1686^HIV EXPOSURE THROUGH BLOOD TRANSFUSION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_exposure_through_blood_transfusion>\n      &lt;hiv_exposure_through_accident multiple=\"0\" openmrs_concept=\"1687^HIV EXPOSURE THROUGH ACCIDENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_exposure_through_accident>\n      &lt;description_of_accident openmrs_concept=\"1435^DESCRIPTION OF ACCIDENT^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/description_of_accident>\n      &lt;method_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1061^METHOD OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;suspected_past_hiv_exposure openmrs_concept=\"1062^SUSPECTED PAST HIV EXPOSURE^99DCT\">false&lt;/suspected_past_hiv_exposure>\n            &lt;blood_transfusion openmrs_concept=\"1063^BLOOD TRANSFUSION^99DCT\">false&lt;/blood_transfusion>\n            &lt;spouses_partner_suspected_hiv openmrs_concept=\"5564^SPOUSES PARTNER SUSPECTED HIV+^99DCT\">false&lt;/spouses_partner_suspected_hiv>\n            &lt;contaminated_needle_stick openmrs_concept=\"181^CONTAMINATED NEEDLE STICK^99DCT\">false&lt;/contaminated_needle_stick>\n            &lt;intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false&lt;/intravenous_drug_use>\n            &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n            &lt;unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false&lt;/unknown>\n            &lt;injections openmrs_concept=\"1507^INJECTIONS^99DCT\">false&lt;/injections>\n            &lt;surgical_intervention openmrs_concept=\"1472^SURGICAL INTERVENTION^99DCT\">false&lt;/surgical_intervention>\n            &lt;dental_extraction openmrs_concept=\"1508^DENTAL EXTRACTION^99DCT\">false&lt;/dental_extraction>\n            &lt;scarrification openmrs_concept=\"1509^SCARRIFICATION^99DCT\">false&lt;/scarrification>\n            &lt;accidental_exposure openmrs_concept=\"1433^ACCIDENTAL EXPOSURE^99DCT\">false&lt;/accidental_exposure>\n      &lt;/method_of_hiv_exposure>\n    &lt;/hiv_exposure_adult_set>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',271,'2008-11-14 13:46:09',271,'2018-10-08 12:48:36',0,NULL,NULL,NULL,'e28b6096-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (68,'PEDIATRIA: PROCESSO PARTE A - ANAMNESE','1.1',110,1,'Processo de Hospital de Dia Pediatria 1/2',7,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PEDIATRIA: PROCESSO PARTE A - ANAMNESE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/68-1.1-110.xsn\" solutionVersion=\"1.1.0.110\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/68-110\" id=\"68\" name=\"PEDIATRIA: PROCESSO PARTE A - ANAMNESE\" version=\"1.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}&lt;/patient_address.city>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_telephone_number>\n      &lt;personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_name>\n      &lt;personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_surname>\n    &lt;/personal_reference>\n    &lt;maternal_data openmrs_concept=\"1607^MATERNAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/name_of_mother>\n      &lt;age_of_mother openmrs_concept=\"1478^AGE OF MOTHER^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/age_of_mother>\n      &lt;mother_alive multiple=\"0\" openmrs_concept=\"1479^MOTHER ALIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mother_alive>\n      &lt;mother_ill multiple=\"0\" openmrs_concept=\"1480^MOTHER ILL^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mother_ill>\n      &lt;sickness_of_mother openmrs_concept=\"1481^SICKNESS OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/sickness_of_mother>\n      &lt;result_of_hiv_test_mother multiple=\"0\" openmrs_concept=\"1483^RESULT OF HIV TEST MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/result_of_hiv_test_mother>\n      &lt;professsion_of_mother openmrs_concept=\"1482^PROFESSSION OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/professsion_of_mother>\n      &lt;mother_on_antiretroviral_treatment multiple=\"0\" openmrs_concept=\"1484^MOTHER ON ANTIRETROVIRAL TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mother_on_antiretroviral_treatment>\n    &lt;/maternal_data>\n    &lt;paternal_data openmrs_concept=\"1608^PATERNAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;name_of_father openmrs_concept=\"1485^NAME OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/name_of_father>\n      &lt;age_of_father openmrs_concept=\"1486^AGE OF FATHER^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/age_of_father>\n      &lt;father_alive multiple=\"0\" openmrs_concept=\"1487^FATHER ALIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/father_alive>\n      &lt;father_ill multiple=\"0\" openmrs_concept=\"1488^FATHER ILL^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/father_ill>\n      &lt;sickness_of_father openmrs_concept=\"1489^SICKNESS OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/sickness_of_father>\n      &lt;profession_of_father openmrs_concept=\"1490^PROFESSION OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/profession_of_father>\n      &lt;result_of_hiv_test_father multiple=\"0\" openmrs_concept=\"1491^RESULT OF HIV TEST FATHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/result_of_hiv_test_father>\n      &lt;father_on_antiretroviral_treatment multiple=\"0\" openmrs_concept=\"1492^FATHER ON ANTIRETROVIRAL TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/father_on_antiretroviral_treatment>\n    &lt;/paternal_data>\n    &lt;patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_received_counceling>\n    &lt;is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_patient_hiv_positive>\n    &lt;entry_point_into_hiv_care_set openmrs_concept=\"1625^ENTRY POINT INTO HIV CARE, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/entry_point_into_hiv_care_referal_type>\n      &lt;entry_point_into_hiv_care_location_name openmrs_concept=\"1626^ENTRY POINT INTO HIV CARE, LOCATION NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/&gt;\n      &lt;/entry_point_into_hiv_care_location_name>\n      &lt;entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/entry_point_into_hiv_care_patient_code_at_location>\n    &lt;/entry_point_into_hiv_care_set>\n    &lt;pediatric_clinical_history multiple=\"1\" openmrs_concept=\"1610^PEDIATRIC CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false&lt;/candidiasis>\n        &lt;tuberculosis_treatment_status openmrs_concept=\"5965^TUBERCULOSIS TREATMENT STATUS^99DCT\">false&lt;/tuberculosis_treatment_status>\n        &lt;hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false&lt;/hiv_staging_-_serious_bacterial_infections>\n        &lt;failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false&lt;/failure_to_thrive>\n        &lt;hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false&lt;/hiv_staging_-_recurrent_bacterial_pneumonia>\n        &lt;diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false&lt;/diarrhea_chronic>\n        &lt;cough_persistent openmrs_concept=\"1429^COUGH, PERSISTENT^99DCT\">false&lt;/cough_persistent>\n        &lt;hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false&lt;/hiv_staging_-_persistent_fever>\n        &lt;cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false&lt;/cohabitant_being_treated_for_tb>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false&lt;/hiv_staging-candidiasis_respiratory_tract>\n    &lt;/pediatric_clinical_history>\n    &lt;clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/clinical_history_not_coded>\n    &lt;pediatric_personal_history openmrs_concept=\"1612^PEDIATRIC PERSONAL HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;method_of_delivery multiple=\"0\" openmrs_concept=\"5630^METHOD OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/method_of_delivery>\n      &lt;location_of_birth openmrs_concept=\"1505^LOCATION OF BIRTH^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/location_of_birth>\n      &lt;pregnancy_to_term multiple=\"0\" openmrs_concept=\"1500^PREGNANCY TO TERM^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pregnancy_to_term>\n      &lt;birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/birth_weight_kg>\n      &lt;perinatal_exposure_to_arv_mother multiple=\"0\" openmrs_concept=\"1501^PERINATAL EXPOSURE TO ARV, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/perinatal_exposure_to_arv_mother>\n      &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine&gt;\n            &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n            &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n            &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n            &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n            &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n            &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n            &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n            &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n            &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n      &lt;/prenatal_arv_medication_mother>\n      &lt;prenatal_exposure_to_arv_at_birth multiple=\"0\" openmrs_concept=\"1502^PRENATAL EXPOSURE TO ARV, AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_exposure_to_arv_at_birth>\n      &lt;perinatal_arv_medication_at_birth multiple=\"0\" openmrs_concept=\"1503^PERINATAL ARV MEDICATION, AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/perinatal_arv_medication_at_birth>\n      &lt;newborn_pathology openmrs_concept=\"1506^NEWBORN PATHOLOGY^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/newborn_pathology>\n    &lt;/pediatric_personal_history>\n    &lt;method_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1061^METHOD OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;suspected_past_hiv_exposure openmrs_concept=\"1062^SUSPECTED PAST HIV EXPOSURE^99DCT\">false&lt;/suspected_past_hiv_exposure>\n        &lt;blood_transfusion openmrs_concept=\"1063^BLOOD TRANSFUSION^99DCT\">false&lt;/blood_transfusion>\n        &lt;spouses_partner_suspected_hiv openmrs_concept=\"5564^SPOUSES PARTNER SUSPECTED HIV+^99DCT\">false&lt;/spouses_partner_suspected_hiv>\n        &lt;contaminated_needle_stick openmrs_concept=\"181^CONTAMINATED NEEDLE STICK^99DCT\">false&lt;/contaminated_needle_stick>\n        &lt;intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false&lt;/intravenous_drug_use>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false&lt;/unknown>\n        &lt;injections openmrs_concept=\"1507^INJECTIONS^99DCT\">false&lt;/injections>\n        &lt;surgical_intervention openmrs_concept=\"1472^SURGICAL INTERVENTION^99DCT\">false&lt;/surgical_intervention>\n        &lt;dental_extraction openmrs_concept=\"1508^DENTAL EXTRACTION^99DCT\">false&lt;/dental_extraction>\n        &lt;scarrification openmrs_concept=\"1509^SCARRIFICATION^99DCT\">false&lt;/scarrification>\n        &lt;accidental_exposure openmrs_concept=\"1433^ACCIDENTAL EXPOSURE^99DCT\">false&lt;/accidental_exposure>\n    &lt;/method_of_hiv_exposure>\n    &lt;hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hospital_slash_clinic>\n      &lt;diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/diagnosis_for_hospitalization>\n      &lt;date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/date_of_hospital_stay_entry>\n      &lt;data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/data_of_hospital_stay_exit>\n      &lt;hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hosptal_treatment>\n    &lt;/hospitalizations>\n    &lt;pediatric_nutrition openmrs_concept=\"1614^PEDIATRIC NUTRITION^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;child_breast_fed_in_past multiple=\"0\" openmrs_concept=\"6061^CHILD BREAST FED IN PAST^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/child_breast_fed_in_past>\n      &lt;was_the_child_exclusivly_breastfed multiple=\"0\" openmrs_concept=\"1613^WAS THE CHILD EXCLUSIVLY BREASTFED^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/was_the_child_exclusivly_breastfed>\n      &lt;age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/age_weaned_from_breast_feeding_months>\n      &lt;pav_complete multiple=\"0\" openmrs_concept=\"1511^PAV COMPLETE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/pav_complete>\n      &lt;dpm_age_chronological_years openmrs_concept=\"1512^DPM AGE CHRONOLOGICAL YEARS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/dpm_age_chronological_years>\n      &lt;dpm_age_chronological_months openmrs_concept=\"1513^DPM AGE CHRONOLOGICAL MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/dpm_age_chronological_months>\n      &lt;bailey_years openmrs_concept=\"1514^BAILEY YEARS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/bailey_years>\n      &lt;bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/bailey_months>\n    &lt;/pediatric_nutrition>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\"&gt;\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" /&gt;\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',9,'2008-11-14 14:06:20',13,'2011-01-11 15:23:34',0,NULL,NULL,NULL,'e28b6b0e-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (71,'PTV: PRE-NATAL','0.1',72,0,'Livro de registo de consulta de Preveno de Transmisso Vertical Pr-Natal',11,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PTV: PRE-NATAL\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/71-0.1-72.xsn\" solutionVersion=\"0.1.0.72\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/71-72\" id=\"71\" name=\"PTV: PRE-NATAL\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;ptv_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()} &lt;/ptv_code>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;number_of_weeks_pregnant_at_encounter_date openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_weeks_pregnant_at_encounter_date>\n    &lt;planned_date_to_administer_nvp_during_pregnancy openmrs_concept=\"1802^PLANNED DATE TO ADMINISTER NVP DURING PREGNANCY^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/planned_date_to_administer_nvp_during_pregnancy>\n    &lt;antiretroviral_plan_-_tarv_start multiple=\"0\" openmrs_concept=\"1255^ANTIRETROVIRAL PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/antiretroviral_plan_-_tarv_start>\n    &lt;azt_profalaxis_for_prevention_of_vertical_transmission openmrs_concept=\"1803^AZT PROFALAXIS FOR PREVENTION OF VERTICAL TRANSMISSION^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prenatal_arv_medication_mother_-_azt multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_arv_medication_mother_-_azt>\n      &lt;number_of_weeks_pregnant_when_starting_azt_profolaxis openmrs_concept=\"1808^NUMBER OF WEEKS PREGNANT WHEN STARTING AZT PROFOLAXIS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_when_starting_azt_profolaxis>\n    &lt;/azt_profalaxis_for_prevention_of_vertical_transmission>\n    &lt;prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/prenatal_visit_number>\n    &lt;prenatal_arv_medication_mother_-_ctx multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/prenatal_arv_medication_mother_-_ctx>\n    &lt;prescribed_fansidar openmrs_concept=\"1805^PRESCRIBED FANSIDAR^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/fansidar_dose>\n      &lt;prenatal_arv_medication_mother_-_fansidar multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_arv_medication_mother_-_fansidar>\n      &lt;number_of_weeks_pregnant_during_first_dose_of_fansidar openmrs_concept=\"1809^NUMBER OF WEEKS PREGNANT DURING FIRST DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_during_first_dose_of_fansidar>\n      &lt;number_of_weeks_pregnant_during_second_dose_of_fansidar openmrs_concept=\"1810^NUMBER OF WEEKS PREGNANT DURING SECOND DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_during_second_dose_of_fansidar>\n      &lt;number_of_weeks_pregnant_during_third_dose_of_fansidar openmrs_concept=\"1811^NUMBER OF WEEKS PREGNANT DURING THIRD DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_during_third_dose_of_fansidar>\n      &lt;number_of_weeks_pregnant_during_dose_of_fansidar openmrs_concept=\"2053^NUMBER OF WEEKS PREGNANT DURING DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_during_dose_of_fansidar>\n    &lt;/prescribed_fansidar>\n    &lt;nevirapine_administered_during_prenatal_consultations openmrs_concept=\"1806^NEVIRAPINE ADMINISTERED DURING PRENATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prenatal_arv_medication_mother_-_nevirapine multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_arv_medication_mother_-_nevirapine>\n      &lt;number_of_weeks_pregnant_when_starting_nevirapine openmrs_concept=\"1812^NUMBER OF WEEKS PREGNANT WHEN STARTING NEVIRAPINE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_when_starting_nevirapine>\n    &lt;/nevirapine_administered_during_prenatal_consultations>\n    &lt;referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referrals_ordered>\n    &lt;prevention_of_vertical_transmission_observations openmrs_concept=\"1799^PREVENTION OF VERTICAL TRANSMISSION OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/prevention_of_vertical_transmission_observations>\n    &lt;visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant>\n      &lt;prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_visit_number>\n    &lt;/visit_number_and_weeks_pregnant_ptv>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',9,'2008-11-14 17:17:56',13,'2011-01-11 15:23:57',0,NULL,NULL,NULL,'e28b77e8-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (79,'PTV: MATERNIDADE','0.1',59,0,'Livro de consulta de Preveno de Transmisso Vertical para Maternidade',23,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PTV: MATERNIDADE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/79-0.1-59.xsn\" solutionVersion=\"0.1.0.59\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/79-59\" id=\"79\" name=\"PTV: MATERNIDADE\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;ptv_maternity_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(8).getIdentifier()}&lt;/ptv_maternity_code>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;hour_mother_entered_hospital_to_give_birth openmrs_concept=\"1828^HOUR MOTHER ENTERED HOSPITAL TO GIVE BIRTH^99DCT\" openmrs_datatype=\"TM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hour_mother_entered_hospital_to_give_birth>\n    &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_weeks_pregnant>\n    &lt;dilation_on_entering_hospital openmrs_concept=\"1813^DILATION ON ENTERING HOSPITAL ^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/dilation_on_entering_hospital>\n    &lt;administration_of_arv_during_delivery openmrs_concept=\"1824^ADMINISTRATION OF ARV DURING DELIVERY^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_arv_medication_mother>\n      &lt;nevirapine_administered_at_home multiple=\"0\" openmrs_concept=\"1814^NEVIRAPINE ADMINISTERED AT HOME^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/nevirapine_administered_at_home>\n      &lt;hour_nvp_taken_in_maternity openmrs_concept=\"1829^HOUR NVP TAKEN IN MATERNITY^99DCT\" openmrs_datatype=\"TS\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hour_nvp_taken_in_maternity>\n      &lt;patient_vomited_within_an_hour_of_taking_nevirapine multiple=\"0\" openmrs_concept=\"1815^PATIENT VOMITED WITHIN AN HOUR OF TAKING NEVIRAPINE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_vomited_within_an_hour_of_taking_nevirapine>\n      &lt;patient_took_nevirapine_in_maternity multiple=\"0\" openmrs_concept=\"1816^PATIENT TOOK NEVIRAPINE IN MATERNITY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_took_nevirapine_in_maternity>\n    &lt;/administration_of_arv_during_delivery>\n    &lt;infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/infant_feeding_method>\n    &lt;time_of_birth openmrs_concept=\"1830^DATE AND TIME NVP TAKEN AT HOME^99DCT\" openmrs_datatype=\"TS\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/time_of_birth>\n    &lt;location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/location_of_delivery>\n    &lt;birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/birth_weight_kg>\n    &lt;stillborn multiple=\"0\" openmrs_concept=\"1819^STILLBORN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/stillborn>\n    &lt;prophylaxis_administered_to_newborn openmrs_concept=\"1825^PROPHYLAXIS ADMINISTERED TO NEWBORN^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;first_dose_of_nevirapine_given_to_child_at_birth multiple=\"0\" openmrs_concept=\"1821^FIRST DOSE OF NEVIRAPINE GIVEN TO CHILD AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/first_dose_of_nevirapine_given_to_child_at_birth>\n      &lt;_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth multiple=\"0\" openmrs_concept=\"1822^2ND DOSE OF NEVIRAPINE GIVEN TO CHILD 48 TO 72 HOURS AFER BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth>\n      &lt;mother_took_azt_syrup_home multiple=\"0\" openmrs_concept=\"1823^MOTHER TOOK AZT SYRUP HOME^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mother_took_azt_syrup_home>\n    &lt;/prophylaxis_administered_to_newborn>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:52',0,NULL,NULL,NULL,'e28b810c-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (80,'CCR: PROCESSO','0.1',65,0,'Processo de consulta de crianas em risco',8,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"CCR: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/80-0.1-65.xsn\" solutionVersion=\"0.1.0.65\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/80-65\" id=\"80\" name=\"CCR: PROCESSO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;ccr_nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(9).getIdentifier()}&lt;/ccr_nid>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated&gt;\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;location_of_temporary_housing openmrs_concept=\"1832^LOCATION OF TEMPORARY HOUSING^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/location_of_temporary_housing>\n    &lt;temporarily_living_in_the_home_of openmrs_concept=\"1833^TEMPORARILY LIVING IN THE HOME OF^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/temporarily_living_in_the_home_of>\n    &lt;name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/name_of_mother>\n    &lt;mothers_workplace openmrs_concept=\"1834^MOTHERS WORKPLACE^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/mothers_workplace>\n    &lt;name_of_father openmrs_concept=\"1485^NAME OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/name_of_father>\n    &lt;fathers_workplace openmrs_concept=\"1835^FATHERS WORKPLACE^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/fathers_workplace>\n    &lt;location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/location_of_delivery>\n    &lt;method_of_delivery multiple=\"0\" openmrs_concept=\"5630^METHOD OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/method_of_delivery>\n    &lt;birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/birth_weight_kg>\n    &lt;prevention_of_vertical_trasmission_child multiple=\"1\" openmrs_concept=\"1836^PREVENTION OF VERTICAL TRASMISSION, CHILD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n    &lt;/prevention_of_vertical_trasmission_child>\n    &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n        &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n    &lt;/prenatal_arv_medication_mother>\n    &lt;infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/infant_feeding_method>\n    &lt;age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/age_weaned_from_breast_feeding_months>\n    &lt;duration_of_weaning multiple=\"0\" openmrs_concept=\"1839^DURATION OF WEANING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/duration_of_weaning>\n    &lt;reason_for_weaning openmrs_concept=\"1840^REASON FOR WEANING^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_for_weaning>\n    &lt;child_feeding_method openmrs_concept=\"1841^CHILD FEEDING METHOD^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/child_feeding_method>\n    &lt;reason_for_entering_child_at_risk_treatment multiple=\"1\" openmrs_concept=\"1874^REASON FOR ENTERING CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;contact_with_tuberculosis openmrs_concept=\"1845^CONTACT WITH TUBERCULOSIS^99DCT\">false&lt;/contact_with_tuberculosis>\n        &lt;mother_hiv_positive openmrs_concept=\"1586^MOTHER HIV POSITIVE^99DCT\">false&lt;/mother_hiv_positive>\n        &lt;twin openmrs_concept=\"1846^TWIN^99DCT\">false&lt;/twin>\n        &lt;sudden_weaning_or_exclusive_artificial_feeding_for_more_than_one_year openmrs_concept=\"1843^SUDDEN WEANING OR EXCLUSIVE ARTIFICIAL FEEDING FOR MORE THAN ONE YEAR^99DCT\">false&lt;/sudden_weaning_or_exclusive_artificial_feeding_for_more_than_one_year>\n        &lt;malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false&lt;/malnutrition>\n        &lt;chronic_malnutrition openmrs_concept=\"1844^CHRONIC MALNUTRITION^99DCT\">false&lt;/chronic_malnutrition>\n        &lt;child_without_mother openmrs_concept=\"1847^CHILD WITHOUT MOTHER^99DCT\">false&lt;/child_without_mother>\n        &lt;premature_birth_or_low_birth_weight openmrs_concept=\"1842^PREMATURE BIRTH OR LOW BIRTH WEIGHT^99DCT\">false&lt;/premature_birth_or_low_birth_weight>\n    &lt;/reason_for_entering_child_at_risk_treatment>\n    &lt;other_reason_for_enrollment_in_child_at_risk_clinic openmrs_concept=\"1848^OTHER REASON FOR ENROLLMENT IN CHILD AT RISK CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_reason_for_enrollment_in_child_at_risk_clinic>\n    &lt;number_of_hospitalizations openmrs_concept=\"1849^NUMBER OF HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_hospitalizations>\n    &lt;hiv_exposure_through_blood_transfusion multiple=\"0\" openmrs_concept=\"1686^HIV EXPOSURE THROUGH BLOOD TRANSFUSION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_exposure_through_blood_transfusion>\n    &lt;previous_illness openmrs_concept=\"1850^PREVIOUS ILLNESS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/previous_illness>\n    &lt;family_member_has_tuberculosis multiple=\"0\" openmrs_concept=\"1851^FAMILY MEMBER HAS TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/&gt;\n    &lt;/family_member_has_tuberculosis>\n    &lt;other_illnesses_in_the_family openmrs_concept=\"1852^OTHER ILLNESSES IN THE FAMILY^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_illnesses_in_the_family>\n    &lt;number_of_adult_household_members openmrs_concept=\"1853^NUMBER OF ADULT HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_adult_household_members>\n    &lt;number_of_child_household_members openmrs_concept=\"1854^NUMBER OF CHILD HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_child_household_members>\n    &lt;type_of_house multiple=\"0\" openmrs_concept=\"1858^TYPE OF HOUSE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/type_of_house>\n    &lt;patients_water_source multiple=\"0\" openmrs_concept=\"1862^PATIENTS WATER SOURCE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patients_water_source>\n    &lt;patient_has_mosquito_net multiple=\"0\" openmrs_concept=\"1863^PATIENT HAS MOSQUITO NET^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_has_mosquito_net>\n    &lt;patient_has_latrine multiple=\"0\" openmrs_concept=\"1864^PATIENT HAS LATRINE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_has_latrine>\n    &lt;source_of_income multiple=\"0\" openmrs_concept=\"1875^SOURCE OF INCOME^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/source_of_income>\n    &lt;other_source_of_income openmrs_concept=\"1876^OTHER SOURCE OF INCOME^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_source_of_income>\n    &lt;house_call_observations openmrs_concept=\"1870^HOUSE CALL OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/house_call_observations>\n    &lt;exit_from_child_at_risk_treatment multiple=\"0\" openmrs_concept=\"1873^EXIT FROM CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/exit_from_child_at_risk_treatment>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text&gt;|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" /&gt;\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text&gt;              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:22',0,NULL,NULL,NULL,'e28b9c3c-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (81,'CCR: SEGUIMENTO','0.1',107,0,'Ficha de seguimento de processo de consulta de crianas em risco',10,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"CCR: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/81-0.1-107.xsn\" solutionVersion=\"0.1.0.107\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/81-107\" id=\"81\" name=\"CCR: SEGUIMENTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}&lt;/encouter.location_name>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/weight_kg>\n    &lt;height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/height_cm>\n    &lt;weight_divided_by_height_as_a_percentage openmrs_concept=\"1888^WEIGHT DIVIDED BY HEIGHT AS A PERCENTAGE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/weight_divided_by_height_as_a_percentage>\n    &lt;head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/head_circumference>\n    &lt;vaccinations_are_up_to_date multiple=\"0\" openmrs_concept=\"1889^VACCINATIONS ARE UP TO DATE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/vaccinations_are_up_to_date>\n    &lt;pediatric_clinical_history multiple=\"1\" openmrs_concept=\"1610^PEDIATRIC CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false&lt;/candidiasis>\n        &lt;tuberculosis_treatment_status openmrs_concept=\"5965^TUBERCULOSIS TREATMENT STATUS^99DCT\">false&lt;/tuberculosis_treatment_status>\n        &lt;hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false&lt;/hiv_staging_-_serious_bacterial_infections>\n        &lt;failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false&lt;/failure_to_thrive>\n        &lt;hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false&lt;/hiv_staging_-_recurrent_bacterial_pneumonia>\n        &lt;diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false&lt;/diarrhea_chronic>\n        &lt;cough_persistent openmrs_concept=\"1429^COUGH, PERSISTENT^99DCT\">false&lt;/cough_persistent>\n        &lt;hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false&lt;/hiv_staging_-_persistent_fever>\n        &lt;cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false&lt;/cohabitant_being_treated_for_tb>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false&lt;/hiv_staging-candidiasis_respiratory_tract>\n    &lt;/pediatric_clinical_history>\n    &lt;written_history openmrs_concept=\"1671^WRITTEN HISTORY^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/written_history>\n    &lt;child_at_risk_clinical_evaluation multiple=\"1\" openmrs_concept=\"1880^CHILD AT RISK CLINICAL EVALUATION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false&lt;/candidiasis>\n        &lt;pale_palms openmrs_concept=\"1879^PALE PALMS^99DCT\">false&lt;/pale_palms>\n        &lt;fluid_secretion openmrs_concept=\"1878^FLUID SECRETION^99DCT\">false&lt;/fluid_secretion>\n        &lt;dermatitis openmrs_concept=\"119^DERMATITIS^99DCT\">false&lt;/dermatitis>\n        &lt;oedema openmrs_concept=\"460^OEDEMA^99DCT\">false&lt;/oedema>\n        &lt;adenomegaly openmrs_concept=\"1877^ADENOMEGALY^99DCT\">false&lt;/adenomegaly>\n    &lt;/child_at_risk_clinical_evaluation>\n    &lt;respiratory_rate openmrs_concept=\"5242^RESPIRATORY RATE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/respiratory_rate>\n    &lt;clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/clinical_history_not_coded>\n    &lt;psychomotor_development multiple=\"0\" openmrs_concept=\"1882^PSYCHOMOTOR DEVELOPMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/psychomotor_development>\n    &lt;child_at_risk_treatment multiple=\"1\" openmrs_concept=\"1885^CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false&lt;/plumpy_nut>\n        &lt;mebendazole openmrs_concept=\"244^MEBENDAZOLE^99DCT\">false&lt;/mebendazole>\n        &lt;vitamin_a openmrs_concept=\"1720^VITAMIN A^99DCT\">false&lt;/vitamin_a>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;multivitamin openmrs_concept=\"1883^MULTIVITAMIN^99DCT\">false&lt;/multivitamin>\n    &lt;/child_at_risk_treatment>\n    &lt;child_at_risk_other_treatment openmrs_concept=\"1886^CHILD AT RISK, OTHER TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/child_at_risk_other_treatment>\n    &lt;feeding_plan multiple=\"1\" openmrs_concept=\"985^FEEDING PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;expressed_breastmilk openmrs_concept=\"1173^EXPRESSED BREASTMILK^99DCT\">false&lt;/expressed_breastmilk>\n        &lt;weaned openmrs_concept=\"1152^WEANED^99DCT\">false&lt;/weaned>\n        &lt;infant_formula openmrs_concept=\"5254^INFANT FORMULA^99DCT\">false&lt;/infant_formula>\n        &lt;breastfed_predominately openmrs_concept=\"1150^BREASTFED PREDOMINATELY^99DCT\">false&lt;/breastfed_predominately>\n        &lt;mixed_feeding openmrs_concept=\"6046^MIXED FEEDING^99DCT\">false&lt;/mixed_feeding>\n        &lt;breastfed_exclusively openmrs_concept=\"5526^BREASTFED EXCLUSIVELY^99DCT\">false&lt;/breastfed_exclusively>\n        &lt;cow_milk openmrs_concept=\"968^COW MILK^99DCT\">false&lt;/cow_milk>\n    &lt;/feeding_plan>\n    &lt;child_feeding_method openmrs_concept=\"1841^CHILD FEEDING METHOD^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/child_feeding_method>\n    &lt;referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false&lt;/social_support_services>\n        &lt;tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false&lt;/tuberculosis_treatment_or_dot_program>\n        &lt;disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false&lt;/disclosure_counseling>\n        &lt;nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false&lt;/nutritional_support>\n        &lt;adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false&lt;/adherence_counseling>\n        &lt;mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false&lt;/mental_health_services>\n        &lt;psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false&lt;/psychosocial_counseling>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false&lt;/family_planning_services>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false&lt;/alcohol_counseling>\n        &lt;inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false&lt;/inpatient_care_or_hospitalization>\n        &lt;home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false&lt;/home_based_care>\n        &lt;plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false&lt;/plano_nacional_para_combate_tuberculose>\n        &lt;day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false&lt;/day_hospital>\n        &lt;medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false&lt;/medical_consultation>\n        &lt;triage openmrs_concept=\"1887^TRIAGE^99DCT\">false&lt;/triage>\n        &lt;pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false&lt;/pre-natal_consultation>\n        &lt;association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false&lt;/association_of_people_with_hiv>\n        &lt;sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false&lt;/sexually_transmitted_disease_consultation>\n        &lt;domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false&lt;/domestic_visit>\n        &lt;voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false&lt;/voluntary_counceling_and_testing>\n        &lt;referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false&lt;/referral_other>\n        &lt;family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false&lt;/family_was_referred_to_the_health_unit>\n    &lt;/referrals_ordered>\n    &lt;hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_dna_polymerase_chain_reaction_qualitative>\n    &lt;hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_rapid_test_1_qualitative>\n    &lt;polymerase_chain_reaction_date_send_to_laboratory openmrs_concept=\"2070^POLYMERASE CHAIN REACTION, DATE SEND TO LABORATORY^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/polymerase_chain_reaction_date_send_to_laboratory>\n    &lt;return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/return_visit_date>\n    &lt;symptomatic multiple=\"0\" openmrs_concept=\"1068^SYMPTOMATIC^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/symptomatic>\n    &lt;mother_received_counceling_for_polymerase_chain_reaction multiple=\"0\" openmrs_concept=\"2132^MOTHER RECEIVED COUNCELING FOR POLYMERASE CHAIN REACTION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/mother_received_counceling_for_polymerase_chain_reaction>\n    &lt;date_of_delivery_the_pcr_result_to_the_family openmrs_concept=\"2133^DATE OF DELIVERY THE PCR RESULT TO THE FAMILY^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_delivery_the_pcr_result_to_the_family>\n    &lt;polymerase_chain_reaction_result_return_date openmrs_concept=\"1999^POLYMERASE CHAIN REACTION RESULT RETURN DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/polymerase_chain_reaction_result_return_date>\n    &lt;exit_from_child_at_risk_treatment multiple=\"0\" openmrs_concept=\"1873^EXIT FROM CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/exit_from_child_at_risk_treatment>\n    &lt;polymerase_chain_reaction_date_ordered openmrs_concept=\"1998^POLYMERASE CHAIN REACTION, DATE ORDERED^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/polymerase_chain_reaction_date_ordered>\n    &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cotrimoxazole_use>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating --&gt;\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-27 11:39:50',0,NULL,NULL,NULL,'e28ba07e-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (83,'PCR','0.1',58,0,'Formulario de solicitacao do teste de PCR para ADN de HIV',22,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PCR\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/83-0.1-58.xsn\" solutionVersion=\"0.1.0.58\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/83-58\" id=\"83\" name=\"PCR\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;pcr_lab_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(10).getIdentifier()}&lt;/pcr_lab_number>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;pcr_order_number openmrs_concept=\"2042^PCR ORDER NUMBER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/pcr_order_number>\n    &lt;name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/name_of_mother>\n    &lt;entry_point_into_pcr_testing_referal_type multiple=\"1\" openmrs_concept=\"1046^ENTRY POINT INTO PCR TESTING, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;referred_from_hiv_treatment_day_hospital openmrs_concept=\"844^REFERRED FROM HIV TREATMENT (DAY HOSPITAL)^99DCT\">false&lt;/referred_from_hiv_treatment_day_hospital>\n        &lt;referred_from_pediatric_treatment openmrs_concept=\"1044^REFERRED FROM PEDIATRIC TREATMENT^99DCT\">false&lt;/referred_from_pediatric_treatment>\n        &lt;child_at_risk_clinic openmrs_concept=\"1872^CHILD AT RISK CLINIC^99DCT\">false&lt;/child_at_risk_clinic>\n        &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n        &lt;referred_from_prevention_of_vertical_transmission openmrs_concept=\"1939^REFERRED FROM PREVENTION OF VERTICAL TRANSMISSION^99DCT\">false&lt;/referred_from_prevention_of_vertical_transmission>\n    &lt;/entry_point_into_pcr_testing_referal_type>\n    &lt;infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/infant_feeding_method>\n    &lt;age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/age_weaned_from_breast_feeding_months>\n    &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n        &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n    &lt;/prenatal_arv_medication_mother>\n    &lt;ptv_treatment_child openmrs_concept=\"1970^PTV TREATMENT CHILD^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prevention_of_vertical_trasmission_child multiple=\"1\" openmrs_concept=\"1836^PREVENTION OF VERTICAL TRASMISSION, CHILD^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n            &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n            &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n            &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n      &lt;/prevention_of_vertical_trasmission_child>\n      &lt;duration openmrs_concept=\"1710^DURATION^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/duration>\n    &lt;/ptv_treatment_child>\n    &lt;polymerase_chain_reaction_test openmrs_concept=\"2001^POLYMERASE CHAIN REACTION TEST^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_dna_polymerase_chain_reaction_qualitative>\n      &lt;polymerase_chain_reaction_date_ordered openmrs_concept=\"1998^POLYMERASE CHAIN REACTION, DATE ORDERED^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/polymerase_chain_reaction_date_ordered>\n      &lt;polymerase_chain_reaction_result_return_date openmrs_concept=\"1999^POLYMERASE CHAIN REACTION RESULT RETURN DATE^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/polymerase_chain_reaction_result_return_date>\n      &lt;polymerase_chain_reaction_laboratory_technician openmrs_concept=\"2000^POLYMERASE CHAIN REACTION, LABORATORY TECHNICIAN^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/polymerase_chain_reaction_laboratory_technician>\n    &lt;/polymerase_chain_reaction_test>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID --&gt;\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text&gt;OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:30',0,NULL,NULL,NULL,'e28bb654-1d5f-11e0-b929-000c29ad1d07');
</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Execute SQL script 3</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>INSERT INTO `form` VALUES (84,'STI','0.1',130,0,'MISAU: REGISTRO DIRIO DOS CASOS DE DTS ANTENDIDOS NAS CONSULTAS DE TRIAGEM MEDICINA E SMI - ABORDAGEM SINDRMICA',2,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"STI\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/84-0.1-130.xsn\" solutionVersion=\"0.1.0.130\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/84-130\" id=\"84\" name=\"STI\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;sti_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(7).getIdentifier()}&lt;/sti_number>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}&lt;/encounter.location_id>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;review_of_systems_genitourinary multiple=\"1\" openmrs_concept=\"1080^REVIEW OF SYSTEMS, GENITOURINARY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;urinary_tract_infection openmrs_concept=\"55^URINARY TRACT INFECTION^99DCT\">false&lt;/urinary_tract_infection>\n        &lt;hematuria openmrs_concept=\"840^HEMATURIA^99DCT\">false&lt;/hematuria>\n        &lt;menstruating openmrs_concept=\"5989^MENSTRUATING^99DCT\">false&lt;/menstruating>\n        &lt;menopausal openmrs_concept=\"5990^MENOPAUSAL^99DCT\">false&lt;/menopausal>\n        &lt;vaginal_discharge openmrs_concept=\"5993^VAGINAL DISCHARGE^99DCT\">false&lt;/vaginal_discharge>\n        &lt;urethral_discharge openmrs_concept=\"5995^URETHRAL DISCHARGE^99DCT\">false&lt;/urethral_discharge>\n        &lt;dysuria openmrs_concept=\"6020^DYSURIA^99DCT\">false&lt;/dysuria>\n        &lt;oliguria openmrs_concept=\"6021^OLIGURIA^99DCT\">false&lt;/oliguria>\n        &lt;renal_disease openmrs_concept=\"6033^RENAL DISEASE^99DCT\">false&lt;/renal_disease>\n        &lt;negative openmrs_concept=\"664^NEGATIVE^99DCT\">false&lt;/negative>\n        &lt;genital_sores openmrs_concept=\"864^GENITAL SORES^99DCT\">false&lt;/genital_sores>\n    &lt;/review_of_systems_genitourinary>\n    &lt;return_visit multiple=\"0\" openmrs_concept=\"1992^RETURN VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/return_visit>\n    &lt;pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/pregant>\n    &lt;rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/rapid_plasma_reagin>\n    &lt;treatment_non-coded openmrs_concept=\"2002^TREATMENT, NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/treatment_non-coded>\n    &lt;referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referrals_ordered>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:59',0,NULL,NULL,NULL,'e28bbfe6-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (90,'BUSCA ACTIVA','0.1',38,0,'Busca Activa',21,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"BUSCA ACTIVA\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/90-0.1-38.xsn\" solutionVersion=\"0.1.0.38\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/90-38\" id=\"90\" name=\"BUSCA ACTIVA\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;activist_located_missing_patient multiple=\"0\" openmrs_concept=\"2003^ACTIVIST LOCATED MISSING PATIENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/activist_located_missing_patient>\n    &lt;organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/organization>\n    &lt;personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/personal_reference_-_name>\n    &lt;personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/personal_reference_-_surname>\n    &lt;personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/personal_reference_-_telephone_number>\n    &lt;date_patient_went_missing openmrs_concept=\"2004^DATE PATIENT WENT MISSING^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_patient_went_missing>\n    &lt;pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/pregant>\n    &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_weeks_pregnant>\n    &lt;reason_patient_missed_visit multiple=\"1\" openmrs_concept=\"2016^REASON PATIENT MISSED VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;patient_forgot_visit_date openmrs_concept=\"2005^PATIENT FORGOT VISIT DATE^99DCT\">false&lt;/patient_forgot_visit_date>\n        &lt;patient_is_treating_hiv_with_traditional_medicine openmrs_concept=\"2013^PATIENT IS TREATING HIV WITH TRADITIONAL MEDICINE^99DCT\">false&lt;/patient_is_treating_hiv_with_traditional_medicine>\n        &lt;patient_has_social_problems openmrs_concept=\"2009^PATIENT HAS SOCIAL PROBLEMS^99DCT\">false&lt;/patient_has_social_problems>\n        &lt;patient_took_a_trip openmrs_concept=\"2011^PATIENT TOOK A TRIP^99DCT\">false&lt;/patient_took_a_trip>\n        &lt;distance_or_money_for_transport_is_to_much_for_patient openmrs_concept=\"2007^DISTANCE OR MONEY FOR TRANSPORT IS TO MUCH FOR PATIENT^99DCT\">false&lt;/distance_or_money_for_transport_is_to_much_for_patient>\n        &lt;patients_work_prevents_clinic_visit openmrs_concept=\"2014^PATIENTS WORK PREVENTS CLINIC VISIT^99DCT\">false&lt;/patients_work_prevents_clinic_visit>\n        &lt;patient_has_lack_of_motivation openmrs_concept=\"2012^PATIENT HAS LACK OF MOTIVATION^99DCT\">false&lt;/patient_has_lack_of_motivation>\n        &lt;patient_has_lack_of_food openmrs_concept=\"2008^PATIENT HAS LACK OF FOOD^99DCT\">false&lt;/patient_has_lack_of_food>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;patient_is_dissatisfied_with_day_hospital_services openmrs_concept=\"2010^PATIENT IS DISSATISFIED WITH DAY HOSPITAL SERVICES^99DCT\">false&lt;/patient_is_dissatisfied_with_day_hospital_services>\n        &lt;patient_does_not_like_arv_treatment_side_effects openmrs_concept=\"2015^PATIENT DOES NOT LIKE ARV TREATMENT SIDE EFFECTS^99DCT\">false&lt;/patient_does_not_like_arv_treatment_side_effects>\n        &lt;patient_is_bedridden_at_home openmrs_concept=\"2006^PATIENT IS BEDRIDDEN AT HOME^99DCT\">false&lt;/patient_is_bedridden_at_home>\n        &lt;other_reason_why_patient_missed_visit openmrs_concept=\"2017^OTHER REASON WHY PATIENT MISSED VISIT ^99DCT\">false&lt;/other_reason_why_patient_missed_visit>\n    &lt;/reason_patient_missed_visit>\n    &lt;other_reason_why_patient_missed_visit openmrs_concept=\"2017^OTHER REASON WHY PATIENT MISSED VISIT ^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_reason_why_patient_missed_visit>\n    &lt;arrangements_required_for_patient_to_visit_hospital multiple=\"1\" openmrs_concept=\"2022^ARRANGEMENTS REQUIRED FOR PATIENT TO VISIT HOSPITAL^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;patient_will_borrow_money openmrs_concept=\"2021^PATIENT WILL BORROW MONEY^99DCT\">false&lt;/patient_will_borrow_money>\n        &lt;patient_will_leave_children_with_somebody openmrs_concept=\"2019^PATIENT WILL LEAVE CHILDREN WITH SOMEBODY^99DCT\">false&lt;/patient_will_leave_children_with_somebody>\n        &lt;patient_will_get_a_ride openmrs_concept=\"2018^PATIENT WILL GET A RIDE^99DCT\">false&lt;/patient_will_get_a_ride>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;patient_will_get_authorization_from_work openmrs_concept=\"2020^PATIENT WILL GET AUTHORIZATION FROM WORK^99DCT\">false&lt;/patient_will_get_authorization_from_work>\n        &lt;patient_is_bedridden_at_home openmrs_concept=\"2006^PATIENT IS BEDRIDDEN AT HOME^99DCT\">false&lt;/patient_is_bedridden_at_home>\n    &lt;/arrangements_required_for_patient_to_visit_hospital>\n    &lt;other_arrangements_for_patient_to_get_to_hospital openmrs_concept=\"2023^OTHER ARRANGEMENTS FOR PATIENT TO GET TO HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_arrangements_for_patient_to_get_to_hospital>\n    &lt;reason_patient_not_found_by_activist multiple=\"1\" openmrs_concept=\"2031^REASON PATIENT NOT FOUND BY ACTIVIST^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;patient_record_has_wrong_address openmrs_concept=\"2024^PATIENT RECORD HAS WRONG ADDRESS^99DCT\">false&lt;/patient_record_has_wrong_address>\n        &lt;transferred_out_to_another_facility openmrs_concept=\"1706^TRANSFERRED OUT TO ANOTHER FACILITY^99DCT\">false&lt;/transferred_out_to_another_facility>\n        &lt;patient_was_admitted_at_hospital openmrs_concept=\"2028^PATIENT WAS ADMITTED AT HOSPITAL^99DCT\">false&lt;/patient_was_admitted_at_hospital>\n        &lt;patient_took_a_trip openmrs_concept=\"2011^PATIENT TOOK A TRIP^99DCT\">false&lt;/patient_took_a_trip>\n        &lt;patient_moved_houses openmrs_concept=\"2026^PATIENT MOVED HOUSES^99DCT\">false&lt;/patient_moved_houses>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;patient_is_dead openmrs_concept=\"2027^PATIENT IS DEAD^99DCT\">false&lt;/patient_is_dead>\n        &lt;patient_was_working_on_their_farm openmrs_concept=\"2029^PATIENT WAS WORKING ON THEIR FARM^99DCT\">false&lt;/patient_was_working_on_their_farm>\n        &lt;nobody_answered_at_patients_home openmrs_concept=\"2025^NOBODY ANSWERED AT PATIENTS HOME^99DCT\">false&lt;/nobody_answered_at_patients_home>\n        &lt;patient_was_at_work openmrs_concept=\"2030^PATIENT WAS AT WORK^99DCT\">false&lt;/patient_was_at_work>\n        &lt;other_reasons_why_patient_was_not_located_by_activist openmrs_concept=\"2032^OTHER REASONS WHY PATIENT WAS NOT LOCATED BY ACTIVIST^99DCT\">false&lt;/other_reasons_why_patient_was_not_located_by_activist>\n    &lt;/reason_patient_not_found_by_activist>\n    &lt;other_reasons_why_patient_was_not_located_by_activist openmrs_concept=\"2032^OTHER REASONS WHY PATIENT WAS NOT LOCATED BY ACTIVIST^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_reasons_why_patient_was_not_located_by_activist>\n    &lt;reason_patient_not_found_provided_by multiple=\"1\" openmrs_concept=\"2037^REASON PATIENT NOT FOUND PROVIDED BY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;chief_of_neighborhood_provided_reason_patient_was_not_located openmrs_concept=\"2036^CHIEF OF NEIGHBORHOOD PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false&lt;/chief_of_neighborhood_provided_reason_patient_was_not_located>\n        &lt;neighbor_provided_reason_patient_was_not_located openmrs_concept=\"2034^NEIGHBOR PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false&lt;/neighbor_provided_reason_patient_was_not_located>\n        &lt;relative_provided_reason_patient_was_not_located openmrs_concept=\"2035^RELATIVE PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false&lt;/relative_provided_reason_patient_was_not_located>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;confidant_provided_reason_patient_was_not_located openmrs_concept=\"2033^CONFIDANT PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false&lt;/confidant_provided_reason_patient_was_not_located>\n    &lt;/reason_patient_not_found_provided_by>\n    &lt;who_provided_reason_patient_not_found_other openmrs_concept=\"2038^WHO PROVIDED REASON PATIENT NOT FOUND, OTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/who_provided_reason_patient_not_found_other>\n    &lt;referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false&lt;/social_support_services>\n        &lt;tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false&lt;/tuberculosis_treatment_or_dot_program>\n        &lt;disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false&lt;/disclosure_counseling>\n        &lt;nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false&lt;/nutritional_support>\n        &lt;adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false&lt;/adherence_counseling>\n        &lt;mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false&lt;/mental_health_services>\n        &lt;psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false&lt;/psychosocial_counseling>\n        &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false&lt;/other_non-coded>\n        &lt;family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false&lt;/family_planning_services>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false&lt;/alcohol_counseling>\n        &lt;inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false&lt;/inpatient_care_or_hospitalization>\n        &lt;home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false&lt;/home_based_care>\n        &lt;plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false&lt;/plano_nacional_para_combate_tuberculose>\n        &lt;day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false&lt;/day_hospital>\n        &lt;medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false&lt;/medical_consultation>\n        &lt;triage openmrs_concept=\"1887^TRIAGE^99DCT\">false&lt;/triage>\n        &lt;pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false&lt;/pre-natal_consultation>\n        &lt;association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false&lt;/association_of_people_with_hiv>\n        &lt;sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false&lt;/sexually_transmitted_disease_consultation>\n        &lt;domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false&lt;/domestic_visit>\n        &lt;voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false&lt;/voluntary_counceling_and_testing>\n        &lt;referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false&lt;/referral_other>\n        &lt;family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false&lt;/family_was_referred_to_the_health_unit>\n    &lt;/referrals_ordered>\n    &lt;referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referral_other>\n    &lt;activists_observations openmrs_concept=\"2041^ACTIVISTS OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/activists_observations>\n    &lt;on_arv_treatment multiple=\"0\" openmrs_concept=\"2052^ON ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/on_arv_treatment>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text&gt;|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" /&gt;\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" /&gt;\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when&gt;\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',9,'2008-12-10 14:53:51',13,'2011-01-11 15:23:20',0,NULL,NULL,NULL,'e28fa7dc-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (91,'TARV: ACONSELHAMENTO SEGUIMENTO','0.1',45,0,'Seguimento de Aconselhamento TARV',24,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TARV: ACONSELHAMENTO SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/91-0.1-45.xsn\" solutionVersion=\"0.1.0.45\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/91-45\" id=\"91\" name=\"TARV: ACONSELHAMENTO SEGUIMENTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}&lt;/nid>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;other_masses_description openmrs_concept=\"1553^OTHER MASSES, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_masses_description>\n    &lt;attendance_type multiple=\"0\" openmrs_concept=\"2047^ATTENDANCE TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/attendance_type>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text&gt;              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" /&gt;\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:03',0,NULL,NULL,NULL,'e28fae8a-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (92,'TUBERCULOSE: PROCESSO','0.1',69,0,'FICHA INDIVIDUAL DE TRATAMENTO DE TUBERCULOSE',26,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TUBERCULOSE: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/92-0.1-69.xsn\" solutionVersion=\"0.1.0.69\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/92-69\" id=\"92\" name=\"TUBERCULOSE: PROCESSO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}&lt;/nit>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}&lt;/patient.local_trabalho>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment_plan>\n    &lt;tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_drug_treatment_start_date>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n    &lt;tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment>\n    &lt;type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/type_of_tuberculosis>\n    &lt;tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/tubuculosis_exams>\n      &lt;sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/sputum_for_acid_fast_bacilli>\n      &lt;x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/x-ray_chest>\n      &lt;ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ultrasound_tb>\n      &lt;lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymph_node_biopsy>\n      &lt;paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/paracentesis>\n      &lt;thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/thoracentesis>\n      &lt;purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/purified_protein_derivative>\n      &lt;gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gastric_levage>\n      &lt;test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/test_other>\n      &lt;bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/bailey_months>\n      &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/weight_kg>\n      &lt;number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_layers>\n    &lt;/tuberculosis_exams_set>\n    &lt;date_of_administration_of_medication_for_tb_intensive_phase openmrs_concept=\"1650^DATE OF ADMINISTRATION OF MEDICATION FOR TB, INTENSIVE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_administration_of_medication_for_tb_intensive_phase>\n    &lt;patient_reported_current_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1111^PATIENT REPORTED CURRENT TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_reported_current_tuberculosis_treatment>\n    &lt;date_of_tb_administration_of_medication_maintenance_phase openmrs_concept=\"2058^DATE OF TB ADMINISTRATION OF MEDICATION, MAINTENANCE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_tb_administration_of_medication_maintenance_phase>\n    &lt;transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/transfer_from_other_facility_facility_name>\n      &lt;transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/transferred_out_to_another_facility_facility_name>\n    &lt;/transfer_facility_names>\n    &lt;entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/entry_point_into_hiv_care_referal_type>\n    &lt;hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hospital_slash_clinic>\n    &lt;personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_name>\n      &lt;personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_surname>\n      &lt;personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_telephone_number>\n      &lt;personal_reference_-_address openmrs_concept=\"2067^PERSONAL REFERENCE - ADDRESS^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_address>\n    &lt;/personal_reference>\n    &lt;is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_patient_hiv_positive>\n    &lt;cotrimoxazole_use multiple=\"1\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false&lt;/isoniazid>\n    &lt;/cotrimoxazole_use>\n    &lt;day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/day_hospital>\n    &lt;historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/historical_drug_start_date>\n    &lt;reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_tuberculosis_treatment_stopped>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text&gt;|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:20',0,NULL,NULL,NULL,'e28fb36c-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (93,'PTV-CPN: PROCESSO','0.1',52,0,'Processo de PTV - CPN, Adaptado do LIVRO OFICIAL DA PTV - CPN',11,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PTV-CPN: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/93-0.1-52.xsn\" solutionVersion=\"0.1.0.52\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/93-52\" id=\"93\" name=\"PTV-CPN: PROCESSO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(2).getIdentifier()}&lt;/nid>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;ptv-cpn_codigo openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(6).getIdentifier()}&lt;/ptv-cpn_codigo>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\"&gt;\n      &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant>\n      &lt;prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_visit_number>\n    &lt;/visit_number_and_weeks_pregnant_ptv>\n    &lt;first_pregnant multiple=\"0\" openmrs_concept=\"2073^FIRST PREGNANT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/first_pregnant>\n    &lt;estimated_date_of_confinement openmrs_concept=\"5596^ESTIMATED DATE OF CONFINEMENT^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/estimated_date_of_confinement>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n    &lt;planned_date_to_administer_nvp_during_pregnancy openmrs_concept=\"1802^PLANNED DATE TO ADMINISTER NVP DURING PREGNANCY^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/planned_date_to_administer_nvp_during_pregnancy>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text&gt;              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:45',0,NULL,NULL,NULL,'e28fbefc-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (94,'TUBERCULOSE: SEGUIMENTO','0.1',74,0,'FICHA DE SEGUIMENTO DE DOENTES COM TUBERCULOSE',27,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TUBERCULOSE: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/94-0.1-74.xsn\" solutionVersion=\"0.1.0.74\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/94-74\" id=\"94\" name=\"TUBERCULOSE: SEGUIMENTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}&lt;/nit>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}&lt;/patient.local_trabalho>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment_plan>\n    &lt;tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_drug_treatment_start_date>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n    &lt;type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/type_of_tuberculosis>\n    &lt;tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/tubuculosis_exams>\n      &lt;sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/sputum_for_acid_fast_bacilli>\n      &lt;x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/x-ray_chest>\n      &lt;ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ultrasound_tb>\n      &lt;lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymph_node_biopsy>\n      &lt;paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/paracentesis>\n      &lt;thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/thoracentesis>\n      &lt;purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/purified_protein_derivative>\n      &lt;gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gastric_levage>\n      &lt;test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/test_other>\n      &lt;bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/bailey_months>\n      &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/weight_kg>\n      &lt;number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_layers>\n    &lt;/tuberculosis_exams_set>\n    &lt;hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hospital_slash_clinic>\n    &lt;day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/day_hospital>\n    &lt;transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/transfer_from_other_facility_facility_name>\n      &lt;transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/transferred_out_to_another_facility_facility_name>\n    &lt;/transfer_facility_names>\n    &lt;historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/&gt;\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/historical_drug_start_date>\n    &lt;reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_tuberculosis_treatment_stopped>\n    &lt;tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false&lt;/isoniazid>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n    &lt;/tuberculosis_prophylaxis_started>\n    &lt;hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_rapid_test_1_qualitative>\n    &lt;medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/medication_quantity_available>\n    &lt;number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_children>\n    &lt;tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:22',0,NULL,NULL,NULL,'e28fcb2c-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (95,'PTV-CPN: SEGUIMENTO - PILOTO','0.1',77,0,'FICHA DE SEGUIMENTO DE PTV na CPN',12,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PTV-CPN: SEGUIMENTO - PILOTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/95-0.1-77.xsn\" solutionVersion=\"0.1.0.77\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/95-77\" id=\"95\" name=\"PTV-CPN: SEGUIMENTO - PILOTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;codigo_ptv_cpn openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()}&lt;/codigo_ptv_cpn>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}&lt;/patient.local_trabalho>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;nid_servico_tarv openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(2).getIdentifier()}&lt;/nid_servico_tarv>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant>\n      &lt;prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_visit_number>\n    &lt;/visit_number_and_weeks_pregnant_ptv>\n    &lt;patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_received_counceling>\n    &lt;hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_rapid_test_1_qualitative>\n    &lt;accepts_home_visit multiple=\"0\" openmrs_concept=\"2071^ACCEPTS HOME VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/accepts_home_visit>\n    &lt;fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/fansidar_dose>\n    &lt;rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/rapid_plasma_reagin>\n    &lt;malarial_smear multiple=\"0\" openmrs_concept=\"32^MALARIAL SMEAR^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/malarial_smear>\n    &lt;hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hemoglobin>\n    &lt;cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cd4_count>\n    &lt;patient_received_cd4_results multiple=\"0\" openmrs_concept=\"2072^PATIENT RECEIVED CD4 RESULTS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_received_cd4_results>\n    &lt;current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_who_hiv_stage>\n    &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n        &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n    &lt;/prenatal_arv_medication_mother>\n    &lt;historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/historical_drug_start_date>\n    &lt;entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/entry_point_into_hiv_care_patient_code_at_location>\n    &lt;referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referrals_ordered>\n    &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cotrimoxazole_use>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n    &lt;result_of_hiv_test_of_partner multiple=\"0\" openmrs_concept=\"2074^RESULT OF HIV TEST OF PARTNER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/result_of_hiv_test_of_partner>\n    &lt;partner_received_counceling multiple=\"0\" openmrs_concept=\"2075^PARTNER RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/partner_received_counceling>\n    &lt;antiretroviral_drugs multiple=\"1\" openmrs_concept=\"1085^ANTIRETROVIRAL DRUGS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;unknown_antiretroviral_drug openmrs_concept=\"5811^UNKNOWN ANTIRETROVIRAL DRUG^99DCT\">false&lt;/unknown_antiretroviral_drug>\n        &lt;abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false&lt;/abacavir_lamivudine_zidovudine>\n        &lt;other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false&lt;/other_antiretroviral_drug>\n        &lt;didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false&lt;/didanosine>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n        &lt;indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false&lt;/indinavir>\n        &lt;ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false&lt;/ritonavir>\n        &lt;abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false&lt;/abacavir>\n        &lt;stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false&lt;/stavudine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false&lt;/efavirenz>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false&lt;/nelfinavir>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false&lt;/stavudine_lamivudine>\n        &lt;ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false&lt;/ziduvadinedidanosinenelfinavir>\n        &lt;abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false&lt;/abacavir_didanosine_nelfinavir>\n    &lt;/antiretroviral_drugs>\n    &lt;medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/medication_quantity_available>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number --&gt;\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" /&gt;\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" /&gt;\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text&gt;                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:50',0,NULL,NULL,NULL,'e28ff412-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (96,'PTV: MATERNIDADE - PILOTO','0.1',63,0,'Livro: Programa de Preveno de Transmisso Vertical para Maternidade',23,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PTV: MATERNIDADE - PILOTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/96-0.1-63.xsn\" solutionVersion=\"0.1.0.63\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/96-63\" id=\"96\" name=\"PTV: MATERNIDADE - PILOTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;ptv_maternity_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(8).getIdentifier()}&lt;/ptv_maternity_code>\n    &lt;ptv-cpn_codigo openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(6).getIdentifier()}&lt;/ptv-cpn_codigo>\n    &lt;nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(2).getIdentifier()}&lt;/nid>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;hour_mother_entered_hospital_to_give_birth openmrs_concept=\"1828^HOUR MOTHER ENTERED HOSPITAL TO GIVE BIRTH^99DCT\" openmrs_datatype=\"TM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hour_mother_entered_hospital_to_give_birth>\n    &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_weeks_pregnant>\n    &lt;dilation_on_entering_hospital openmrs_concept=\"1813^DILATION ON ENTERING HOSPITAL ^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/dilation_on_entering_hospital>\n    &lt;administration_of_arv_during_delivery openmrs_concept=\"1824^ADMINISTRATION OF ARV DURING DELIVERY^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n            &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n            &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n            &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n            &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n            &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n            &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n            &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n            &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n            &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n      &lt;/prenatal_arv_medication_mother>\n      &lt;nevirapine_administered_at_home multiple=\"0\" openmrs_concept=\"1814^NEVIRAPINE ADMINISTERED AT HOME^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/nevirapine_administered_at_home>\n      &lt;hour_nvp_taken_in_maternity openmrs_concept=\"1829^HOUR NVP TAKEN IN MATERNITY^99DCT\" openmrs_datatype=\"TS\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hour_nvp_taken_in_maternity>\n      &lt;patient_vomited_within_an_hour_of_taking_nevirapine multiple=\"0\" openmrs_concept=\"1815^PATIENT VOMITED WITHIN AN HOUR OF TAKING NEVIRAPINE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_vomited_within_an_hour_of_taking_nevirapine>\n      &lt;administration_of_azt_during_pregnacy multiple=\"0\" openmrs_concept=\"2087^ADMINISTRATION OF AZT DURING PREGNACY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/administration_of_azt_during_pregnacy>\n      &lt;patient_took_nevirapine_in_maternity multiple=\"0\" openmrs_concept=\"1816^PATIENT TOOK NEVIRAPINE IN MATERNITY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_took_nevirapine_in_maternity>\n      &lt;azt_during_delivery multiple=\"1\" openmrs_concept=\"2088^AZT DURING DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;three_doses openmrs_concept=\"2084^THREE DOSES^99DCT\">false&lt;/three_doses>\n            &lt;one_dose openmrs_concept=\"1182^ONE DOSE^99DCT\">false&lt;/one_dose>\n            &lt;four_doses openmrs_concept=\"2085^FOUR DOSES^99DCT\">false&lt;/four_doses>\n            &lt;two_doses openmrs_concept=\"1183^TWO DOSES^99DCT\">false&lt;/two_doses>\n      &lt;/azt_during_delivery>\n      &lt;azt_slash_3tc_for_mother multiple=\"1\" openmrs_concept=\"2089^AZT/3TC FOR MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;three_doses openmrs_concept=\"2084^THREE DOSES^99DCT\">false&lt;/three_doses>\n            &lt;one_dose openmrs_concept=\"1182^ONE DOSE^99DCT\">false&lt;/one_dose>\n            &lt;four_doses openmrs_concept=\"2085^FOUR DOSES^99DCT\">false&lt;/four_doses>\n            &lt;two_doses openmrs_concept=\"1183^TWO DOSES^99DCT\">false&lt;/two_doses>\n      &lt;/azt_slash_3tc_for_mother>\n    &lt;/administration_of_arv_during_delivery>\n    &lt;infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/infant_feeding_method>\n    &lt;received_counceling_for_infant_feeding_method multiple=\"0\" openmrs_concept=\"2086^RECEIVED COUNCELING FOR INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/received_counceling_for_infant_feeding_method>\n    &lt;time_of_birth openmrs_concept=\"1830^DATE AND TIME NVP TAKEN AT HOME^99DCT\" openmrs_datatype=\"TS\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/time_of_birth>\n    &lt;location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/location_of_delivery>\n    &lt;birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/birth_weight_kg>\n    &lt;stillborn multiple=\"0\" openmrs_concept=\"1819^STILLBORN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/stillborn>\n    &lt;prophylaxis_administered_to_newborn openmrs_concept=\"1825^PROPHYLAXIS ADMINISTERED TO NEWBORN^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;first_dose_of_nevirapine_given_to_child_at_birth multiple=\"0\" openmrs_concept=\"1821^FIRST DOSE OF NEVIRAPINE GIVEN TO CHILD AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/first_dose_of_nevirapine_given_to_child_at_birth>\n      &lt;_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth multiple=\"0\" openmrs_concept=\"1822^2ND DOSE OF NEVIRAPINE GIVEN TO CHILD 48 TO 72 HOURS AFER BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth>\n      &lt;mother_took_azt_syrup_home multiple=\"0\" openmrs_concept=\"1823^MOTHER TOOK AZT SYRUP HOME^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/mother_took_azt_syrup_home>\n    &lt;/prophylaxis_administered_to_newborn>\n    &lt;ptv_hiv_result_set openmrs_concept=\"2090^PTV HIV RESULT, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;patient_was_tested_for_hiv_in_pre_natal_consultation multiple=\"0\" openmrs_concept=\"2078^PATIENT WAS TESTED FOR HIV IN PRE NATAL CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_was_tested_for_hiv_in_pre_natal_consultation>\n      &lt;hiv_result_for_test_taken_on_pre_natal_consultation multiple=\"0\" openmrs_concept=\"2079^HIV RESULT FOR TEST TAKEN ON PRE NATAL CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_result_for_test_taken_on_pre_natal_consultation>\n      &lt;patient_was_tested_on_pre-natal_consultation_more_than_3_months_ago multiple=\"0\" openmrs_concept=\"2080^PATIENT WAS TESTED ON PRE-NATAL CONSULTATION MORE THAN 3 MONTHS AGO^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/patient_was_tested_on_pre-natal_consultation_more_than_3_months_ago>\n      &lt;received_counceling_and_tested_on_maternity_before_delivery multiple=\"0\" openmrs_concept=\"2081^RECEIVED COUNCELING AND TESTED ON MATERNITY BEFORE DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/received_counceling_and_tested_on_maternity_before_delivery>\n      &lt;received_counceling_and_tested_on_maternity_after_delivery multiple=\"0\" openmrs_concept=\"2082^RECEIVED COUNCELING AND TESTED ON MATERNITY AFTER DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/received_counceling_and_tested_on_maternity_after_delivery>\n      &lt;hiv_result_for_test_taken_on_maternity_consultation multiple=\"0\" openmrs_concept=\"2083^HIV RESULT FOR TEST TAKEN ON MATERNITY CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/hiv_result_for_test_taken_on_maternity_consultation>\n    &lt;/ptv_hiv_result_set>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" /&gt;\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:55',0,NULL,NULL,NULL,'e28ff908-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (97,'PTV-CPN: SEGUIMENTO','0.1',79,0,'FICHA DE SEGUIMENTO DE PTV na CPN',12,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"PTV-CPN: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/97-0.1-79.xsn\" solutionVersion=\"0.1.0.79\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/97-79\" id=\"97\" name=\"PTV-CPN: SEGUIMENTO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;codigo_ptv_cpn openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()}&lt;/codigo_ptv_cpn>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}&lt;/patient.local_trabalho>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;nid_servico_tarv openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(2).getIdentifier()}&lt;/nid_servico_tarv>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant>\n      &lt;prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_visit_number>\n    &lt;/visit_number_and_weeks_pregnant_ptv>\n    &lt;patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_received_counceling>\n    &lt;hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_rapid_test_1_qualitative>\n    &lt;accepts_home_visit multiple=\"0\" openmrs_concept=\"2071^ACCEPTS HOME VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/accepts_home_visit>\n    &lt;fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/fansidar_dose>\n    &lt;rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/rapid_plasma_reagin>\n    &lt;malarial_smear multiple=\"0\" openmrs_concept=\"32^MALARIAL SMEAR^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/malarial_smear>\n    &lt;hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hemoglobin>\n    &lt;cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cd4_count>\n    &lt;patient_received_cd4_results multiple=\"0\" openmrs_concept=\"2072^PATIENT RECEIVED CD4 RESULTS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_received_cd4_results>\n    &lt;current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/current_who_hiv_stage>\n    &lt;prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false&lt;/sulfadoxine_and_pyrimethamine>\n        &lt;tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false&lt;/tarv_treatment>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false&lt;/zidovudine_nevirapine>\n        &lt;none openmrs_concept=\"1107^NONE^99DCT\">false&lt;/none>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n    &lt;/prenatal_arv_medication_mother>\n    &lt;historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/historical_drug_start_date>\n    &lt;entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/entry_point_into_hiv_care_patient_code_at_location>\n    &lt;referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/referrals_ordered>\n    &lt;cotrimoxazole_use multiple=\"0\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/cotrimoxazole_use>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n    &lt;result_of_hiv_test_of_partner multiple=\"0\" openmrs_concept=\"2074^RESULT OF HIV TEST OF PARTNER^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/result_of_hiv_test_of_partner>\n    &lt;partner_received_counceling multiple=\"0\" openmrs_concept=\"2075^PARTNER RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/partner_received_counceling>\n    &lt;antiretroviral_drugs multiple=\"1\" openmrs_concept=\"1085^ANTIRETROVIRAL DRUGS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;unknown_antiretroviral_drug openmrs_concept=\"5811^UNKNOWN ANTIRETROVIRAL DRUG^99DCT\">false&lt;/unknown_antiretroviral_drug>\n        &lt;abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false&lt;/abacavir_lamivudine_zidovudine>\n        &lt;other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false&lt;/other_antiretroviral_drug>\n        &lt;didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false&lt;/didanosine>\n        &lt;zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false&lt;/zidovudine_and_lamivudine>\n        &lt;indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false&lt;/indinavir>\n        &lt;ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false&lt;/ritonavir>\n        &lt;abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false&lt;/abacavir>\n        &lt;stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false&lt;/stavudine>\n        &lt;zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false&lt;/zidovudine>\n        &lt;efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false&lt;/efavirenz>\n        &lt;lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false&lt;/lamivudine>\n        &lt;nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false&lt;/nevirapine>\n        &lt;nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false&lt;/nelfinavir>\n        &lt;stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false&lt;/stavudine_lamivudine_nevirapine>\n        &lt;stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false&lt;/stavudine_lamivudine>\n        &lt;ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false&lt;/ziduvadinedidanosinenelfinavir>\n        &lt;abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false&lt;/abacavir_didanosine_nelfinavir>\n    &lt;/antiretroviral_drugs>\n    &lt;medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/medication_quantity_available>\n    &lt;azt_profalaxis_for_prevention_of_vertical_transmission openmrs_concept=\"1803^AZT PROFALAXIS FOR PREVENTION OF VERTICAL TRANSMISSION^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_arv_medication_mother>\n      &lt;number_of_weeks_pregnant_when_starting_azt_profolaxis openmrs_concept=\"1808^NUMBER OF WEEKS PREGNANT WHEN STARTING AZT PROFOLAXIS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_when_starting_azt_profolaxis>\n      &lt;date_of_prophylaxis_with_azt_azt_nvp_intrapartum openmrs_concept=\"2091^DATE OF PROPHYLAXIS WITH AZT (AZT + NVP INTRAPARTUM)^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/date_of_prophylaxis_with_azt_azt_nvp_intrapartum>\n    &lt;/azt_profalaxis_for_prevention_of_vertical_transmission>\n    &lt;nevirapine_administered_during_prenatal_consultations openmrs_concept=\"1806^NEVIRAPINE ADMINISTERED DURING PRENATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/prenatal_arv_medication_mother>\n      &lt;number_of_weeks_pregnant_when_starting_nevirapine openmrs_concept=\"1812^NUMBER OF WEEKS PREGNANT WHEN STARTING NEVIRAPINE^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_weeks_pregnant_when_starting_nevirapine>\n      &lt;date_of_delivery_niverapine_at_pre-natal_consultations openmrs_concept=\"2092^DATE OF DELIVERY NIVERAPINE AT PRE-NATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"DT\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/date_of_delivery_niverapine_at_pre-natal_consultations>\n    &lt;/nevirapine_administered_during_prenatal_consultations>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text&gt;|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:48',0,NULL,NULL,NULL,'e28ffd86-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (98,'TUBERCULOSE: LIVRO','0.1',71,0,'Livro de Registo de doentes com Tuberculose',25,'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;?mso-infoPathSolution name=\"TUBERCULOSE: LIVRO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/98-0.1-71.xsn\" solutionVersion=\"0.1.0.71\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?>&lt;?mso-application progid=\"InfoPath.Document\"?>&lt;form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/98-71\" id=\"98\" name=\"TUBERCULOSE: LIVRO\" version=\"0.1\">\n  &lt;header>\n    &lt;enterer>$!{enterer}&lt;/enterer>\n    &lt;date_entered>$!{dateEntered}&lt;/date_entered>\n    &lt;session>$!{sessionId}&lt;/session>\n    &lt;uid>$!{uid}&lt;/uid>\n  &lt;/header>\n  &lt;patient>\n    &lt;patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}&lt;/patient.patient_id>\n    &lt;nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}&lt;/nit>\n    &lt;patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}&lt;/patient_identify.bi>\n    &lt;patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}&lt;/patient.local_trabalho>\n    &lt;patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient_identify.other>\n    &lt;patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}&lt;/patient_attribute.cellphone>\n    &lt;patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}&lt;/patient.age>\n    &lt;patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}&lt;/patient.birthdate>\n    &lt;patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}&lt;/patient.birthdate_estimated>\n    &lt;patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}&lt;/patient.family_name>\n    &lt;patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}&lt;/patient.given_name>\n    &lt;patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}&lt;/patient.medical_record_number>\n    &lt;patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}&lt;/patient.middle_name>\n    &lt;patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}&lt;/patient.sex>\n    &lt;patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}&lt;/patient_address.address1>\n    &lt;casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}&lt;/casa>\n    &lt;localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}&lt;/localidade>\n    &lt;celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}&lt;/celula_quarteirao>\n    &lt;distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}&lt;/distrito>\n    &lt;bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}&lt;/bairro>\n    &lt;provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}&lt;/provincia>\n    &lt;patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}&lt;/patient_address.city_village>\n    &lt;patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\"&gt;$!{patient.getPersonAddress().getPostalCode()}&lt;/patient_address.postal_code>\n    &lt;patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}&lt;/patient_address.country>\n    &lt;patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}&lt;/patient_address.latitude>\n    &lt;patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}&lt;/patient_address.longitude>\n    &lt;patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}&lt;/patient_address.township_division>\n  &lt;/patient>\n  &lt;encounter>\n    &lt;encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    &lt;encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    &lt;encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  &lt;/encounter>\n  &lt;obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    &lt;tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment_plan>\n    &lt;tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_drug_treatment_start_date>\n    &lt;other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/other_non-coded>\n    &lt;tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/tuberculosis_treatment>\n    &lt;type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/type_of_tuberculosis>\n    &lt;tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/tubuculosis_exams>\n      &lt;sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/sputum_for_acid_fast_bacilli>\n      &lt;x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/x-ray_chest>\n      &lt;ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/&gt;\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/ultrasound_tb>\n      &lt;lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/lymph_node_biopsy>\n      &lt;paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/paracentesis>\n      &lt;thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/thoracentesis>\n      &lt;purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/purified_protein_derivative>\n      &lt;gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/gastric_levage>\n      &lt;test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/test_other>\n      &lt;bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/bailey_months>\n      &lt;weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/weight_kg>\n      &lt;number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/number_of_layers>\n    &lt;/tuberculosis_exams_set>\n    &lt;date_of_administration_of_medication_for_tb_intensive_phase openmrs_concept=\"1650^DATE OF ADMINISTRATION OF MEDICATION FOR TB, INTENSIVE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_administration_of_medication_for_tb_intensive_phase>\n    &lt;patient_reported_current_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1111^PATIENT REPORTED CURRENT TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/patient_reported_current_tuberculosis_treatment>\n    &lt;date_of_tb_administration_of_medication_maintenance_phase openmrs_concept=\"2058^DATE OF TB ADMINISTRATION OF MEDICATION, MAINTENANCE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/date_of_tb_administration_of_medication_maintenance_phase>\n    &lt;transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/transfer_from_other_facility_facility_name>\n      &lt;transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/transferred_out_to_another_facility_facility_name>\n    &lt;/transfer_facility_names>\n    &lt;entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/entry_point_into_hiv_care_referal_type>\n    &lt;hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hospital_slash_clinic>\n    &lt;personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      &lt;personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_name>\n      &lt;personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_surname>\n      &lt;personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_telephone_number>\n      &lt;personal_reference_-_address openmrs_concept=\"2067^PERSONAL REFERENCE - ADDRESS^99DCT\" openmrs_datatype=\"ST\">\n            &lt;date xsi:nil=\"true\"/>\n            &lt;time xsi:nil=\"true\"/>\n            &lt;value xsi:nil=\"true\"/>\n      &lt;/personal_reference_-_address>\n    &lt;/personal_reference>\n    &lt;is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/is_patient_hiv_positive>\n    &lt;cotrimoxazole_use multiple=\"1\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n        &lt;isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false&lt;/isoniazid>\n    &lt;/cotrimoxazole_use>\n    &lt;day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/day_hospital>\n    &lt;historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/historical_drug_start_date>\n    &lt;reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/reason_tuberculosis_treatment_stopped>\n    &lt;hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/hiv_rapid_test_1_qualitative>\n    &lt;tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false&lt;/isoniazid>\n        &lt;trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false&lt;/trimethoprim_and_sulfamethoxazole>\n    &lt;/tuberculosis_prophylaxis_started>\n    &lt;number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n        &lt;date xsi:nil=\"true\"/>\n        &lt;time xsi:nil=\"true\"/>\n        &lt;value xsi:nil=\"true\"/>\n    &lt;/number_of_children>\n  &lt;/obs>\n  &lt;other/>&lt;/form>','&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n&lt;!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n&lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	&lt;xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n&lt;xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD&lt;/xsl:variable>\r\n&lt;xsl:variable name=\"PATIENT-AUTHORITY\">&lt;/xsl:variable> &lt;!-- leave blank for internal id, max 20 characters -->\r\n                                                       &lt;!-- for now, must match patient_identifier_type.name -->\r\n&lt;xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID&lt;/xsl:variable> &lt;!-- max 20 characters -->\r\n\r\n&lt;xsl:template match=\"/\">\r\n	&lt;xsl:apply-templates />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Form template -->\r\n&lt;xsl:template match=\"form\">\r\n	&lt;!-- MSH Header -->\r\n	&lt;xsl:text>MSH|^~\\&amp;amp;&lt;/xsl:text>   &lt;!-- Message header, field separator, and encoding characters -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-3 Sending application -->\r\n	&lt;xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-4 Sending facility -->\r\n	&lt;xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-5 Receiving application -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-6 Receiving facility -->\r\n	&lt;xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-7 Date/time message sent -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-8 Security -->\r\n	&lt;xsl:text>|ORU^R01&lt;/xsl:text>       &lt;!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-10 Message control ID -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"header/uid\">\r\n			&lt;xsl:value-of select=\"header/uid\" />\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"patient/patient.patient_id\" />\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|P&lt;/xsl:text>             &lt;!-- MSH-11 Processing ID -->\r\n	&lt;xsl:text>|2.5&lt;/xsl:text>           &lt;!-- MSH-12 HL7 version -->\r\n	&lt;xsl:text>|1&lt;/xsl:text>             &lt;!-- MSH-13 Message sequence number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-14 Continuation Pointer -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-15 Accept Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-16 Application Acknowledgement Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-17 Country Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-18 Character Set -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-19 Principal Language of Message -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- MSH-21 Message Profile Identifier -->\r\n	&lt;xsl:value-of select=\"@id\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>\r\n	&lt;xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n\r\n	&lt;!-- PID header -->\r\n	&lt;xsl:text>PID&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-1 Set ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-2 (deprecated) Patient ID -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-3 Patient Identifier List -->\r\n	&lt;xsl:call-template name=\"patient_id\">\r\n		&lt;xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		&lt;xsl:with-param name=\"type\" select=\"L\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if>\r\n	&lt;!-- Additional patient identifiers -->\r\n	&lt;!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	&lt;xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		&lt;xsl:text>~&lt;/xsl:text>\r\n		&lt;xsl:call-template name=\"patient_id\">\r\n			&lt;xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			&lt;xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			&lt;xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:if&gt;\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-4 (deprecated) Alternate patient ID -->\r\n	&lt;!-- PID-5 Patient name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- Family name -->\r\n	&lt;xsl:value-of select=\"patient/patient.family_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Given name -->\r\n	&lt;xsl:value-of select=\"patient/patient.given_name\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Middle name -->\r\n	&lt;xsl:value-of select=\"patient/patient.middle_name\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-6 Mother\'s maiden name -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PID-7 Date/Time of Birth -->\r\n	&lt;xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n	&lt;!-- PV1 header -->\r\n	&lt;xsl:text>PV1&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-1 Sub ID -->\r\n	&lt;xsl:text>|O&lt;/xsl:text>             &lt;!-- PV1-2 Patient class (O = outpatient) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-3 Patient location -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-4 Admission type (2 = return) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-5 Pre-Admin Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-6 Prior Patient Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-7 Attending Doctor -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-8 Referring Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-9 Consulting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-10 Hospital Service -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-11 Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-12 Preadmin Test Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-13 Re-adminssion Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-14 Admit Source -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-15 Ambulatory Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-16 VIP Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-17 Admitting Doctor -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-18 Patient Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-19 Visit Number -->\r\n	&lt;xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-20 Financial Class -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-21 Charge Price Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-22 Courtesy Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-23 Credit Rating -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-24 Contract Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-25 Contract Effective Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-26 Contract Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-27 Contract Period -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-28 Interest Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-29 Transfer to Bad Debt Code -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-30 Transfer to Bad Debt Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Agency Code -->\r\n  &lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-31 Bad Debt Transfer Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-33 Bad Debt Recovery Amount -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-34 Delete Account Indicator -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-35 Delete Account Date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-36 Discharge Disposition -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-37 Discharge To Location -->\r\n	&lt;xsl:if test=\"patient/patient.health_center\">\r\n		&lt;xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;amp;\')\" />\r\n	&lt;/xsl:if>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-38 Diet Type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-39 Servicing Facility -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-40 Bed Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-41 Account Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-42 Pending Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-43 Prior Temporary Location -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-44 Admit Date/Time -->\r\n	&lt;xsl:call-template name=\"hl7Date\">\r\n		&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-45 Discharge Date/Time -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-46 Current Patient Balance -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-47 Total Charges -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-48 Total Adjustments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-49 Total Payments -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- PV1-50 Alternate Visit ID -->\r\n	&lt;xsl:text>|V&lt;/xsl:text>             &lt;!-- PV1-51 Visit Indicator -->\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- We use encounter date as the timestamp for each observation -->\r\n	&lt;xsl:variable name=\"encounterTimestamp\">\r\n		&lt;xsl:call-template name=\"hl7Date\">\r\n			&lt;xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		&lt;/xsl:call-template>\r\n	&lt;/xsl:variable>\r\n	\r\n	&lt;!-- ORC Common Order Segment -->\r\n	&lt;xsl:text>ORC&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|RE&lt;/xsl:text>            &lt;!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-2 Placer Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-3 Filler Order Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-4 Placer Group Number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-5 Order Status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-6 Response Flag -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-7 Quantity/Timing -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-8 Parent -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-9 Date/Time of Transaction -->\r\n	&lt;xsl:call-template name=\"hl7Timestamp\">\r\n		&lt;xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	&lt;/xsl:call-template>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- ORC-10 Entered By -->\r\n	&lt;xsl:value-of select=\"header/enterer\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- Observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	&lt;xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	&lt;xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	&lt;!-- Observation OBR -->\r\n	&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n	&lt;xsl:text>1&lt;/xsl:text>\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n	&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n	&lt;xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n	&lt;!-- observation OBXs -->\r\n	&lt;xsl:for-each select=\"$obsList\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"value\">\r\n				&lt;xsl:call-template name=\"obsObx\">\r\n					&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n					&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n				&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:for-each>\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>\r\n	&lt;/xsl:for-each>\r\n	\r\n	&lt;!-- Grouped observation(s) -->\r\n	&lt;!-- &lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	&lt;xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	&lt;xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$obsGroupList\">\r\n		&lt;!-- Observation OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + position()\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n		\r\n		&lt;!-- Generate OBXs -->\r\n		&lt;xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"subId\" select=\"1\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:for-each>\r\n\r\n	&lt;!-- Problem list(s) -->\r\n	&lt;xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	&lt;xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	&lt;xsl:if test=\"$problemList\">\r\n		&lt;!-- Problem list OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n\r\n		&lt;!-- Problem list OBXs -->\r\n		&lt;xsl:for-each select=\"$problemList\">\r\n			&lt;xsl:call-template name=\"obsObx\">\r\n				&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n				&lt;xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n				&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			&lt;/xsl:call-template>		\r\n		&lt;/xsl:for-each>\r\n	&lt;/xsl:if>\r\n	\r\n	&lt;!-- Orders -->\r\n	&lt;xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	&lt;xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	&lt;xsl:for-each select=\"$orderList\">\r\n		&lt;!-- Order section OBR -->\r\n		&lt;xsl:text>OBR&lt;/xsl:text>            &lt;!-- Message type -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-1 Set ID -->\r\n		&lt;xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-2 Placer order number -->\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-3 Filler order number --&gt;\r\n		&lt;xsl:text>|&lt;/xsl:text>              &lt;!-- OBR-4 OBR concept -->\r\n		&lt;xsl:value-of select=\"@openmrs_concept\" />\r\n		&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>       &lt;!-- new line -->\r\n	\r\n		&lt;!-- Order OBXs -->\r\n		&lt;xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"value\">\r\n					&lt;xsl:call-template name=\"obsObx\">\r\n						&lt;xsl:with-param name=\"setId\" select=\"position()\" />\r\n						&lt;xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						&lt;xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						&lt;xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						&lt;xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						&lt;xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						&lt;xsl:with-param name=\"value\" select=\"value\" />\r\n						&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					&lt;/xsl:call-template>\r\n				&lt;/xsl:when>\r\n				&lt;xsl:otherwise>\r\n					&lt;xsl:variable name=\"setId\" select=\"position()\" />\r\n					&lt;xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						&lt;xsl:call-template name=\"obsObx\">\r\n							&lt;xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							&lt;xsl:with-param name=\"subId\" select=\"position()\" />\r\n							&lt;xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							&lt;xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							&lt;xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							&lt;xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							&lt;xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							&lt;xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						&lt;/xsl:call-template>\r\n					&lt;/xsl:for-each>\r\n				&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:for-each>	\r\n	&lt;/xsl:for-each>\r\n	\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Patient Identifier (CX) generator -->\r\n&lt;xsl:template name=\"patient_id\">\r\n	&lt;xsl:param name=\"pid\" />\r\n	&lt;xsl:param name=\"auth\" />\r\n	&lt;xsl:param name=\"type\" />\r\n	&lt;xsl:value-of select=\"$pid\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check digit -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Check Digit Scheme -->\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Assigning Authority -->\r\n	&lt;xsl:value-of select=\"$auth\" />\r\n	&lt;xsl:text>^&lt;/xsl:text>              &lt;!-- Identifier Type -->\r\n	&lt;xsl:value-of select=\"$type\" />\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- OBX Generator -->\r\n&lt;xsl:template name=\"obsObx\">\r\n	&lt;xsl:param name=\"setId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"subId\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"datatype\" required=\"yes\" />\r\n	&lt;xsl:param name=\"concept\" required=\"yes\" />\r\n	&lt;xsl:param name=\"date\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"time\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"value\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"units\" required=\"no\">&lt;/xsl:param>\r\n	&lt;xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	&lt;xsl:text>OBX&lt;/xsl:text>                     &lt;!-- Message type -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Set ID -->\r\n	&lt;xsl:value-of select=\"$setId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation datatype -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:text>NM&lt;/xsl:text>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$datatype\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Concept (what was observed -->\r\n	&lt;xsl:value-of select=\"$concept\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Sub-ID -->\r\n	&lt;xsl:value-of select=\"$subId\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Value -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$datatype = \'TS\'\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'DT\'\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'TM\'\">\r\n			&lt;xsl:call-template name=\"hl7Time\">\r\n				&lt;xsl:with-param name=\"time\" select=\"$value\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$datatype = \'BIT\'\">\r\n			&lt;xsl:choose>\r\n				&lt;xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0&lt;/xsl:when>\r\n				&lt;xsl:otherwise>1&lt;/xsl:otherwise>\r\n			&lt;/xsl:choose>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$value\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Units -->\r\n	&lt;xsl:value-of select=\"$units\" />\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Reference range -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Abnormal flags -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Probability -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Nature of abnormal test -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Observation result status -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Effective date -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- User defined access checks -->\r\n	&lt;xsl:text>|&lt;/xsl:text>                       &lt;!-- Date time of observation -->\r\n	&lt;xsl:choose>\r\n		&lt;xsl:when test=\"$date and $time\">\r\n			&lt;xsl:call-template name=\"hl7Timestamp\">\r\n				&lt;xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:when test=\"$date\">\r\n			&lt;xsl:call-template name=\"hl7Date\">\r\n				&lt;xsl:with-param name=\"date\" select=\"$date\" />\r\n			&lt;/xsl:call-template>\r\n		&lt;/xsl:when>\r\n		&lt;xsl:otherwise>\r\n			&lt;xsl:value-of select=\"$encounterTimestamp\" />\r\n		&lt;/xsl:otherwise>\r\n	&lt;/xsl:choose>\r\n	&lt;xsl:text>&amp;#x000d;&lt;/xsl:text>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted timestamp -->\r\n&lt;xsl:template name=\"hl7Timestamp\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted date -->\r\n&lt;xsl:template name=\"hl7Date\">\r\n	&lt;xsl:param name=\"date\" />\r\n	&lt;xsl:if test=\"string($date) != \'\'\">\r\n		&lt;xsl:choose>\r\n			&lt;xsl:when test=\"contains(string($date),\'T\')\">\r\n				&lt;xsl:call-template name=\"hl7Date\">\r\n					&lt;xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				&lt;/xsl:call-template>\r\n			&lt;/xsl:when>\r\n			&lt;xsl:otherwise>\r\n					&lt;xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			&lt;/xsl:otherwise>\r\n		&lt;/xsl:choose>				\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;!-- Generate HL7-formatted time -->\r\n&lt;xsl:template name=\"hl7Time\">\r\n	&lt;xsl:param name=\"time\" />\r\n	&lt;xsl:if test=\"$time != \'\'\">\r\n		&lt;xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	&lt;/xsl:if>\r\n&lt;/xsl:template>\r\n\r\n&lt;/xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:17',0,NULL,NULL,NULL,'e2901708-1d5f-11e0-b929-000c29ad1d07');
INSERT INTO `form` VALUES (99,'ADULTO: PROCESSO PARTE A - ANAMNESE','1.0',NULL,0,'Processo clinico, servio TARV, Adulto: as duas primeiras paginas',5,NULL,NULL,13,'2011-01-11 15:30:20',13,'2014-05-07 12:46:51',0,NULL,NULL,NULL,'527a5141-2931-4546-b789-14125d30545a');
INSERT INTO `form` VALUES (100,'ADULTO: PROCESSO PARTE B - EXAME CLINICO','1.0',NULL,1,'Processo clinico, servico TARV, adulto: as duas ultimas paginas',1,NULL,NULL,13,'2011-01-11 15:42:49',13,'2012-03-27 13:43:08',0,NULL,NULL,NULL,'d3bda8e6-25f2-4fb9-a7cb-5c0cae4276de');
INSERT INTO `form` VALUES (101,'ADULTO: SEGUIMENTO','1.0',NULL,1,'Ficha de seguimento de pacientes no servio TARV: Adulto',6,NULL,NULL,13,'2011-01-11 15:49:00',13,'2012-06-26 13:33:42',1,13,'2012-06-26 13:33:42','Existe nova ficha de seguimento','8498935e-a226-478b-a24a-ac0265187ec0');
INSERT INTO `form` VALUES (102,'ATS','1.0',NULL,0,'Aconselhamento e testagem em saude.',14,NULL,NULL,13,'2011-01-11 17:08:51',13,'2011-05-26 12:33:56',0,NULL,NULL,NULL,'ac6d2a83-7879-4bf5-89ab-ff16b1805d43');
INSERT INTO `form` VALUES (103,'BUSCA ACTIVA','1.0',NULL,0,'Formulario de busca activa',21,NULL,NULL,13,'2011-01-11 17:15:29',13,'2011-05-26 12:34:38',0,NULL,NULL,NULL,'e90e66d8-8651-4b55-8c8e-6a75ae7719be');
INSERT INTO `form` VALUES (104,'CCR: PROCESSO','1.0',NULL,0,'Processo de consulta de crianas em risco',8,NULL,NULL,13,'2011-01-11 17:17:54',13,'2013-12-13 17:16:03',0,NULL,NULL,NULL,'bc06725c-2aba-42eb-9a5e-089d46eaae1c');
INSERT INTO `form` VALUES (105,'CCR: SEGUIMENTO','1.0',NULL,0,'Seguimento de consulta de crianas em risco',10,NULL,NULL,13,'2011-01-11 17:21:30',13,'2013-12-13 17:16:21',0,NULL,NULL,NULL,'60c02a76-6f1e-486c-95c2-a147cec0895d');
INSERT INTO `form` VALUES (106,'LABORATORIO GERAL','1.0',NULL,1,'Ficha geral (de todos programas) para registo de resultados de exames laboratoriais',13,NULL,NULL,13,'2011-01-11 17:23:53',13,'2012-01-14 13:05:23',0,NULL,NULL,NULL,'8377e4ff-d0fe-44a5-81c3-74c9040fd5f8');
INSERT INTO `form` VALUES (107,'PCR','1.0',NULL,0,'Ficha de colheita de amostras e resultado de PCR',22,NULL,NULL,13,'2011-01-11 17:28:20',13,'2011-05-26 12:43:55',0,NULL,NULL,NULL,'342dd283-0475-44fc-aea9-304fac6e1be4');
INSERT INTO `form` VALUES (108,'PEDIATRIA: PROCESSO PARTE A - ANAMNESE','1.0',NULL,0,'Processo clinico, servio TARV, Pediatria: as duas primeiras paginas',7,NULL,NULL,13,'2011-01-11 17:30:45',13,'2012-02-29 17:24:59',0,NULL,NULL,NULL,'6c620a7b-50d1-44a0-a1db-3258dd1194d1');
</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>592</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Execute SQL script 4</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>INSERT INTO `form` VALUES (109,'PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO','1.0',NULL,1,'Processo clinico, servio TARV, Pediatria: as duas ultimas paginas',3,NULL,NULL,13,'2011-01-11 17:35:47',13,'2013-12-12 17:52:59',0,NULL,NULL,NULL,'a7171965-0189-4174-9b0a-d58d557d5aec');
INSERT INTO `form` VALUES (110,'PEDIATRIA: SEGUIMENTO','1.0',NULL,1,'Ficha de seguimento, Servico TARV, Pediatria',9,NULL,NULL,13,'2011-01-11 17:41:23',13,'2012-06-26 13:18:28',1,13,'2012-06-26 13:18:28','Existe nova ficha de seguimento','04b49755-e494-4db0-98ba-f4449656b8c1');
INSERT INTO `form` VALUES (111,'PTV: PRE-NATAL','1.0',NULL,0,'Livro de registo na PTV, Consulta Pr-natal',11,NULL,NULL,13,'2011-01-12 12:40:35',13,'2013-12-13 17:35:43',0,NULL,NULL,NULL,'799c6994-4a46-4d51-b671-bd983f03143f');
INSERT INTO `form` VALUES (112,'PTV: PRE-NATAL - NOVO','1.0',NULL,0,'Livro de registo de PTV, Pr-natal, Novo',11,NULL,NULL,13,'2011-01-12 12:42:50',13,'2011-05-26 13:48:56',0,NULL,NULL,NULL,'b40e887f-9f21-4c85-9c58-3965eaba7160');
INSERT INTO `form` VALUES (113,'PTV: MATERNIDADE','1.0',NULL,0,'Livro de registo de PTV, Maternidade',23,NULL,NULL,13,'2011-01-12 12:45:10',13,'2013-12-13 17:35:20',0,NULL,NULL,NULL,'4dab74bf-efda-46d9-95c4-7ad5b96c356a');
INSERT INTO `form` VALUES (114,'PTV: MATERNIDADE - NOVO','1.0',NULL,0,'Livro de registo de PTV, Maternidade, Novo',23,NULL,NULL,13,'2011-01-12 12:46:52',13,'2011-05-26 13:51:08',0,NULL,NULL,NULL,'475f73d2-2085-4123-affe-2895fe525556');
INSERT INTO `form` VALUES (115,'TARV: ACONSELHAMENTO','1.0',NULL,0,'Ficha de aconselhamento, TARV e Pr-TARV',19,NULL,NULL,13,'2011-01-12 12:50:51',13,'2013-12-13 17:36:04',0,NULL,NULL,NULL,'e702ee08-7ab8-4c93-92dc-d77570af854b');
INSERT INTO `form` VALUES (116,'TARV: ACONSELHAMENTO SEGUIMENTO','1.0',NULL,1,'Seguimento de aconselhamento, TARV e Pr-TARV',24,NULL,NULL,13,'2011-01-12 12:57:26',13,'2011-05-26 12:26:20',0,NULL,NULL,NULL,'43784dad-a494-45b8-a4b3-f313a3c84c70');
INSERT INTO `form` VALUES (117,'TARV: FRIDA','1.0',NULL,0,'Ficha de Registo Individual de Despesas de ARV',18,NULL,NULL,13,'2011-01-12 13:00:58',13,'2013-12-13 17:39:03',0,NULL,NULL,NULL,'0450f11d-3ac5-451c-8e82-1c79868bc88f');
INSERT INTO `form` VALUES (118,'TARV: RASTREIO DE TUBERCULOSE','1.0',NULL,0,'Ficha de rastreio de tuberculose para pacientes HIV+',20,NULL,NULL,13,'2011-01-12 13:04:31',13,'2013-12-13 17:39:26',0,NULL,NULL,NULL,'074bfef6-b048-4dd1-80a2-de6396918a3e');
INSERT INTO `form` VALUES (119,'TARV: SOLICITACAO','1.0',NULL,0,'Solicitao de ARV',17,NULL,NULL,13,'2011-01-12 13:06:48',13,'2013-12-13 17:39:59',0,NULL,NULL,NULL,'7d7b660b-bdba-4457-95b8-2b5d7b64fcab');
INSERT INTO `form` VALUES (120,'TUBERCULOSE: LIVRO','1.0',NULL,0,'Livro de registo de doentes com tuberculose, PNCT',25,NULL,NULL,13,'2011-01-12 13:10:35',13,'2013-12-13 17:42:12',0,NULL,NULL,NULL,'566be870-74ea-4d79-bad5-7e37d5f0931d');
INSERT INTO `form` VALUES (121,'TARV: VISITA DOMICILIARIA','1.0',NULL,1,'Visita domiciliaria/busca para pacientes na unidade sanitria',21,NULL,NULL,13,'2011-01-12 13:21:35',13,'2012-02-08 13:40:10',0,NULL,NULL,NULL,'b1ecb071-6471-4d87-89f4-d9e1b0c80630');
INSERT INTO `form` VALUES (122,'CCU: RASTREIO','1.0',NULL,0,'Rastreio de cancro do colo do utero',28,NULL,NULL,13,'2011-01-12 14:21:51',13,'2013-12-13 17:16:33',0,NULL,NULL,NULL,'5ce0e3ab-c88b-421e-9fbb-876c03ddef0f');
INSERT INTO `form` VALUES (123,'TARV: AVALICAO E PREPARACAO DO CANDIDATO AO TARV','1.0',NULL,1,'Ficha de avaliacao e preparacao psicologica do candidato ao TARV',29,NULL,NULL,13,'2011-09-09 10:18:59',13,'2014-04-21 14:29:30',0,NULL,NULL,NULL,'dc1e3f95-57a4-4b0b-9686-11e19f2bc5ab');
INSERT INTO `form` VALUES (124,'TARV: AVALIACAO DE ADESAO','1.0',NULL,1,'Formulario de avaliacao de ADESAO para pacientes em TARV',31,NULL,NULL,13,'2011-09-12 16:44:35',13,'2013-12-13 17:58:20',0,NULL,NULL,NULL,'f8d1f33c-fdab-4bc7-a8c5-594302c177f7');
INSERT INTO `form` VALUES (125,'TARV: TERMO DE CONSENTIMENTO','1.0',NULL,1,'Termo de consentimento de visita domiciliaria e Busca activa',30,NULL,NULL,13,'2011-09-14 10:00:40',13,'2012-06-26 13:36:56',0,NULL,NULL,NULL,'4b9c4669-4ff8-4cb7-a180-f40cc0ac30dd');
INSERT INTO `form` VALUES (126,'ADULTO: SEGUIMENTO','0.1',NULL,0,'Ficha de Seguimento para Adultos no Servio TARV',6,NULL,NULL,1,'2012-02-22 14:46:22',13,'2013-12-13 06:28:55',0,NULL,NULL,NULL,'78d47629-5ac4-4e16-8972-2166eef30bfd');
INSERT INTO `form` VALUES (127,'PEDIATRIA: SEGUIMENTO','0.1',NULL,0,'Nova ficha de seguimento para criana',9,NULL,NULL,1,'2012-02-22 16:05:56',13,'2013-07-01 09:39:25',0,NULL,NULL,NULL,'ff79c06c-2403-4cf6-9d78-fc6fabcad3b7');
INSERT INTO `form` VALUES (128,'LIVRO DE REGISTO PRE-TARV','1.0',NULL,1,'Representa o livro de registo (1,2) PRE-TARV',32,NULL,NULL,13,'2012-02-29 17:18:59',13,'2013-12-13 17:17:14',0,NULL,NULL,NULL,'fbb1f0ed-1cf5-4e12-b7ee-bd8653c54e9b');
</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>720</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Execute SQL script 5</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>INSERT INTO `form` VALUES (129,'LIVRO DE REGISTO TARV','1.0',NULL,1,'Representa o livro de registo (1,2) TARV',33,NULL,NULL,13,'2012-02-29 17:27:54',13,'2013-12-13 08:22:27',0,NULL,NULL,NULL,'f81b9361-a4a4-4895-94a1-a9dc8db06e1b');
INSERT INTO `form` VALUES (130,'FILA','1.0',NULL,1,'Ficha Individual de Levantamento de ARVs',18,NULL,NULL,13,'2012-05-31 16:33:18',13,'2014-04-23 14:10:37',0,NULL,NULL,NULL,'49857ace-1a92-4980-8313-1067714df151');
INSERT INTO `form` VALUES (131,'TARV: AVALIAO PSICOLOGICA E PP - INICIAL','1.0',NULL,1,'Ficha de avaliao psicologica e preveno positiva: Inicial',34,NULL,NULL,13,'2013-06-24 17:01:10',13,'2013-06-24 17:01:36',0,NULL,NULL,NULL,'7fe58112-e912-4c60-9c15-a110490488bc');
INSERT INTO `form` VALUES (132,'TARV: AVALIAO PSICOLOGICA E PP - SEGUIMENTO','1.0',NULL,1,'Ficha de avaliao psicologica e preveno positiva: Seguimento',34,NULL,NULL,13,'2013-06-24 17:04:16',13,'2013-06-24 17:04:55',0,NULL,NULL,NULL,'ba229747-6382-475a-beb8-6f90bae8b120');
INSERT INTO `form` VALUES (135,'FICHA-ATS','1.0',NULL,0,'Aconselhamento e Testagem em Sade',14,NULL,NULL,1,'2016-06-27 09:46:35',NULL,NULL,0,NULL,NULL,NULL,'f767009e-8a32-4af2-82f1-a385feb2d59d');
INSERT INTO `form` VALUES (137,'CCR_SEGUIMENTO','1.0',NULL,0,'CCR_SEGUIMENTO',10,NULL,NULL,1,'2016-07-27 13:14:12',NULL,NULL,0,NULL,NULL,NULL,'f243290f-eb4b-4352-9283-332f38413912');
INSERT INTO `form` VALUES (144,'CCR-SMI','1.0',NULL,0,'Livro de Registo de Criana de Consulta em Risco',10,NULL,NULL,1,'2016-07-26 08:26:24',1,'2016-09-13 08:27:58',0,NULL,NULL,NULL,'c17115d7-5b97-4a43-a0b8-0a0ef49f4b59');
INSERT INTO `form` VALUES (146,'CONSENTIMENTO DE TESTE DE CASO INDICE','1.0',NULL,1,'Para capturar o consentimento do paciente',47,NULL,NULL,1,'2017-01-17 16:27:58',1,'2017-02-22 10:34:14',0,NULL,NULL,NULL,'25c7f95e-0685-43dd-9321-9c9092e35b69');
INSERT INTO `form` VALUES (147,'FSR','1.0',NULL,0,'FORMULARIO DE SOLICITACAO DE TESTE DE CARGA VIRAL DE HIV',13,NULL,NULL,1,'2019-02-26 14:08:34',1,'2019-03-04 14:53:49',0,NULL,NULL,NULL,'5b7cecc3-4ba3-4710-85ae-fc0c13e83e27');
INSERT INTO `form` VALUES (160,'CARTAO DE VISITA DE APOIO E REINTEGRACAO - PARTE A','1.0',NULL,1,'Este formulario &amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;eacute; para a inser&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;ccedil;&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;atilde;o dos dados do cart&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;atilde;o de vista de apoio logo que &amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;eacute; entregue ao volunt&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;aacute;rio',48,NULL,NULL,1,'2018-03-29 09:47:17',1,'2018-11-22 22:02:08',0,NULL,NULL,NULL,'0cee89b3-646c-4793-b50f-e0554c0e8fca');
INSERT INTO `form` VALUES (161,'CARTAO DE VISITA DE APOIO E REINTEGRACAO - PARTE B','1.0',NULL,1,'Este formulario  para a insero dos dados do carto de vista de apoio depois que o voluntrio volta da vista ao paciente',49,NULL,NULL,1,'2018-06-04 10:53:21',1,'2018-11-21 09:58:42',0,NULL,NULL,NULL,'b4f21f8b-0bf5-4a74-86c7-fb18e158d578');
INSERT INTO `form` VALUES (162,'FICHA DE CHAMADA TELEFONICA','1.0',NULL,1,NULL,50,NULL,NULL,1,'2018-06-11 13:01:17',1,'2018-06-27 15:01:50',0,NULL,NULL,NULL,'25bd42b6-76bf-435f-a9de-86625ed9dc8b');
INSERT INTO `form` VALUES (163,'FICHA CLINICA','1.0',NULL,0,'Ficha Clinica  - MasterCard',6,NULL,NULL,1,'2018-11-05 12:58:20',1,'2018-11-06 14:19:03',0,NULL,NULL,NULL,'3c2d563a-5d37-4735-a125-d3943a3de30a');
INSERT INTO `form` VALUES (164,'TARV: FICHA APOIO PSICOSSOCIAL E PP','1.0',NULL,0,'Ficha Apoio Psicossocial e PP Master Card',35,NULL,NULL,1,'2018-11-07 09:42:30',1,'2018-11-22 15:43:13',0,NULL,NULL,NULL,'b8e74e5e-cce4-442e-bd61-86d2800e5956');
INSERT INTO `form` VALUES (165,'FICHA RESUMO','1.0',NULL,0,'Ficha Resumo  - MasterCards',53,NULL,NULL,1,'2018-11-21 11:13:14',1,'2019-07-31 14:29:03',0,NULL,NULL,NULL,'05496c70-845c-40b1-9d28-070f67b3f7da');
INSERT INTO `form` VALUES (166,'RECEPCAO - LEVANTOU TARV','1.0',NULL,0,'Ficha de registe de levantamento de ARV no Master Card',52,NULL,NULL,1,'2019-07-09 13:09:23',1,'2019-07-09 15:22:21',0,NULL,NULL,NULL,'06fd1a20-c67e-4eff-867a-bd90ca2e55bb');
</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>416</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Join rows (cartesian product)</name>
    <type>JoinRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <cache_size>500</cache_size>
    <main/>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue/>
        <function>=</function>
        <rightvalue/>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>400</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <sql>select  *  from form;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>get_current_date</name>
    <type>SystemInfo</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>current_date</name>
        <type>system date (fixed)</type>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>join_old_form</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <rowlimit>0</rowlimit>
    <sql>select 
	form_id old_form_id,
	name  old_name,
	version old_version,
	build old_build,
	published  old_published,
	description old_description,
	encounter_type old_encounter_type,
	template old_template,
	xslt old_xslt,
	creator old_creator,
	date_created old_date_created,
	changed_by old_changed_by,
	date_changed old_date_changed,
	retired old_retired,
	retired_by old_retired_by,
	date_retired  old_date_retired,
	retired_reason  old_retired_reason,
	uuid old_uuid
from old_form
where uuid=?</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>uuid</name>
        <type>None</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>976</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup_harmonized_user</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <rowlimit>0</rowlimit>
    <sql>select user_id AS   harmonized_user_id
from  users
where   system_id = 'harmonization';</sql>
    <outer_join>Y</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>true/false</name>
    <type>DataGrid</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>true</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>false</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <data>
      <line>
        <item>1</item>
        <item>0</item>
      </line>
    </data>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>400</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_encounter</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>encounter</table>
      <key>
        <name>old_form_id</name>
        <field>form_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>false</name>
        <field>seen</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>form_id</name>
        <rename>form_id</rename>
      </value>
      <value>
        <name>seen</name>
        <rename>true</rename>
      </value>
      <value>
        <name>changed_by</name>
        <rename>harmonized_user_id</rename>
      </value>
      <value>
        <name>date_changed</name>
        <rename>current_date</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1360</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_form_field</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>form_field</table>
      <key>
        <name>old_form_id</name>
        <field>form_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>false</name>
        <field>seen</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>form_id</name>
        <rename>form_id</rename>
      </value>
      <value>
        <name>seen</name>
        <rename>true</rename>
      </value>
      <value>
        <name>changed_by</name>
        <rename>harmonized_user_id</rename>
      </value>
      <value>
        <name>date_changed</name>
        <rename>current_date</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_form_resouce</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>form_resource</table>
      <key>
        <name>old_form_id</name>
        <field>form_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>false</name>
        <field>seen</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>form_id</name>
        <rename>form_id</rename>
      </value>
      <value>
        <name>seen</name>
        <rename>true</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>224</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_htmlform</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>OpenMRS Source DB</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>htmlformentry_html_form</table>
      <key>
        <name>old_form_id</name>
        <field>form_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>false</name>
        <field>seen</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>form_id</name>
        <rename>form_id</rename>
      </value>
      <value>
        <name>seen</name>
        <rename>true</rename>
      </value>
      <value>
        <name>changed_by</name>
        <rename>harmonized_user_id</rename>
      </value>
      <value>
        <name>date_changed</name>
        <rename>current_date</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1360</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Filter rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>Blocking step</send_true_to>
    <send_false_to/>
    <compare>
      <condition>
        <negated>Y</negated>
        <leftvalue>old_form_id</leftvalue>
        <function>=</function>
        <rightvalue>form_id</rightvalue>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1120</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
